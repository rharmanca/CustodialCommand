import{E as m,r as h}from"./inspection-data-CU2w-V3k.js";const b=2,S=3;function p(e){const t=["floors","verticalHorizontalSurfaces","ceiling","restrooms","customerSatisfaction","trash","projectCleaning","activitySupport","safetyCompliance","equipment","monitoring"].map(s=>e[s]).filter(s=>typeof s=="number");if(t.length===0)return null;const o=t.reduce((s,i)=>s+i,0)/t.length;return Math.round(o*10)/10}function C(e){return e<b?"critical":e<S?"needs-attention":"acceptable"}function T(e){const r=["urgent","emergency","safety","hazard","leak","flood","fire","electrical"],t=["immediate","asap","critical","dangerous","broken","damaged"],o=["needs","require","attention","maintenance","repair"],s=`${e.notes} ${e.location} ${e.locationDescription}`.toLowerCase();let i="low";const l=[];return r.some(a=>s.includes(a))?(i="urgent",l.push(...r.filter(a=>s.includes(a)))):t.some(a=>s.includes(a))?(i="high",l.push(...t.filter(a=>s.includes(a)))):o.some(a=>s.includes(a))&&(i="medium",l.push(...o.filter(a=>s.includes(a)))),{note:e,severity:i,keywords:l}}function w(e){const r=[],t=[];e.forEach(l=>{const a=p(l);if(a===null)return;const n=C(a);if(n==="acceptable")return;const u={inspection:l,rating:a,severity:n,location:l.inspectionType==="single_room"?`Room ${l.roomNumber}`:l.buildingName||l.locationDescription||"Whole Building",school:l.school,date:l.date};n==="critical"?r.push(u):t.push(u)}),r.sort((l,a)=>l.rating-a.rating),t.sort((l,a)=>l.rating-a.rating);const o=new Set([...r,...t].map(l=>l.school)),s=[...r,...t].reduce((l,a)=>(l[a.school]=(l[a.school]||0)+1,l),{}),i=Object.entries(s).sort(([,l],[,a])=>a-l)[0]?.[0]||null;return{critical:r,needsAttention:t,urgentNotes:[],summary:{totalProblems:r.length+t.length,criticalCount:r.length,needsAttentionCount:t.length,urgentNotesCount:0,affectedSchools:Array.from(o),mostProblematicSchool:i,mostProblematicCategory:null}}}function A(e){return e.map(T).filter(r=>r.severity==="urgent"||r.severity==="high").sort((r,t)=>{const o={urgent:0,high:1,medium:2,low:3};return o[r.severity]-o[t.severity]})}function z(e){switch(e){case"critical":return{variant:"destructive",className:"bg-red-100 text-red-800 border-red-200",text:"Critical"};case"needs-attention":return{variant:"secondary",className:"bg-orange-100 text-orange-800 border-orange-200",text:"Needs Attention"};case"acceptable":return{variant:"default",className:"bg-green-100 text-green-800 border-green-200",text:"Acceptable"}}}function $(e){switch(e){case"urgent":return{variant:"destructive",className:"bg-red-100 text-red-800 border-red-200 animate-pulse",text:"URGENT"};case"high":return{variant:"secondary",className:"bg-orange-100 text-orange-800 border-orange-200",text:"High Priority"};case"medium":return{variant:"outline",className:"bg-yellow-100 text-yellow-800 border-yellow-200",text:"Medium Priority"};case"low":return{variant:"outline",className:"bg-gray-100 text-gray-800 border-gray-200",text:"Low Priority"}}}const g={left:20,right:20},c={primary:"#000000",secondary:"#333333",border:"#CCCCCC",text:"#212121",tableBorder:"#CCCCCC",tableHeader:"#F0F0F0"},d={title:16,heading:12,body:10,small:8};function L(e,r){let t=0;if(t+=50,e.dataTypes.inspections){const o=r.inspections.length;t+=o*.8}if(e.dataTypes.custodialNotes){const o=r.custodialNotes.length;t+=o*.3}if(e.dataTypes.images){const o=r.inspections.reduce((s,i)=>s+(i.images?.length||0),0);t+=o*200}return e.includeCharts&&(t+=500),e.includeDetails&&(t*=1.5),t<1024?`${Math.round(t)} KB`:`${(t/1024).toFixed(1)} MB`}function E(e,r){let t=1;if(e.dataTypes.inspections){const o=r.inspections.length,s=e.includeDetails?2:8;t+=Math.ceil(o/s)}if(e.dataTypes.custodialNotes){const o=r.custodialNotes.length;t+=Math.ceil(o/10)}return e.includeCharts&&(t+=2),Math.max(t,1)}function I(e){const r=[];return!e.dataTypes.inspections&&!e.dataTypes.custodialNotes&&r.push("Please select at least one data type to export"),e.reportType||r.push("Please select a report type"),e.filters.dateRange.from&&e.filters.dateRange.to&&e.filters.dateRange.from>e.filters.dateRange.to&&r.push("Start date must be before end date"),(e.filters.ratingThreshold<1||e.filters.ratingThreshold>5)&&r.push("Rating threshold must be between 1 and 5"),{isValid:r.length===0,errors:r}}function y(e,r){let t=[...e.inspections],o=[...e.custodialNotes];if(r.filters.dateRange.from){const s=r.filters.dateRange.from.getTime();t=t.filter(i=>new Date(i.date).getTime()>=s),o=o.filter(i=>new Date(i.date).getTime()>=s)}if(r.filters.dateRange.to){const s=r.filters.dateRange.to.getTime();t=t.filter(i=>new Date(i.date).getTime()<=s),o=o.filter(i=>new Date(i.date).getTime()<=s)}return r.filters.schools.length>0&&(t=t.filter(s=>r.filters.schools.includes(s.school)),o=o.filter(s=>r.filters.schools.includes(s.school))),r.filters.categories.length>0&&(t=t.filter(s=>r.filters.categories.some(i=>typeof s[i]=="number"))),r.filters.ratingThreshold>0&&(t=t.filter(s=>{const l=["floors","verticalHorizontalSurfaces","ceiling","restrooms","customerSatisfaction","trash","projectCleaning","activitySupport","safetyCompliance","equipment","monitoring"].map(n=>s[n]).filter(n=>typeof n=="number");return l.length===0?!1:l.reduce((n,u)=>n+u,0)/l.length<=r.filters.ratingThreshold})),r.filters.severityLevels.length>0&&(t=t.filter(s=>{const l=["floors","verticalHorizontalSurfaces","ceiling","restrooms"].map(n=>s[n]).filter(n=>typeof n=="number");if(l.length===0)return!1;const a=l.reduce((n,u)=>n+u,0)/l.length;return!!(r.filters.severityLevels.includes("critical")&&a<=2||r.filters.severityLevels.includes("needs-attention")&&a<=3||r.filters.severityLevels.includes("acceptable")&&a>3)})),{inspections:t,custodialNotes:o,totalRecords:t.length+o.length,dateRange:r.filters.dateRange,schools:r.filters.schools,categories:r.filters.categories}}function H(e){const r=[];if(e.filters.dateRange.from||e.filters.dateRange.to){const t=e.filters.dateRange.from?.toLocaleDateString()||"Start",o=e.filters.dateRange.to?.toLocaleDateString()||"End";r.push(`Date: ${t} - ${o}`)}return e.filters.schools.length>0&&r.push(`Schools: ${e.filters.schools.length} selected`),e.filters.categories.length>0&&r.push(`Categories: ${e.filters.categories.length} selected`),e.filters.severityLevels.length>0&&r.push(`Severity: ${e.filters.severityLevels.join(", ")}`),e.filters.ratingThreshold>0&&r.push(`Rating â‰¤ ${e.filters.ratingThreshold} stars`),r}function P(e){const r=e.inspections.reduce((s,i)=>s+(i.images?.length||0),0),t=r*200,o=t<1024?`${t} KB`:`${(t/1024).toFixed(1)} MB`;return{inspections:e.inspections.length,custodialNotes:e.custodialNotes.length,images:r,totalSize:o}}function O(e){const r=new m("p","mm","letter");let t=20;const o=v(e);return t=x(r,e,t),t=D(r,o,t),t=N(r,o,t),R(r),r.output("blob")}function v(e){const r=[],t=e.startDate?.getTime(),o=e.endDate?.getTime();return e.inspections.forEach(s=>{const i=new Date(s.date).getTime();if(t&&i<t||o&&i>o||e.schoolFilter&&s.school!==e.schoolFilter)return;const l=p(s);if(l===null)return;let a="Info";if(l<2)a="Critical";else if(l<3)a="Needs Attention";else return;r.push({date:new Date(s.date).toLocaleDateString(),school:s.school,location:s.locationDescription||s.roomNumber||"N/A",priority:a,description:`Rating: ${l.toFixed(1)}/5.0${s.notes?` - ${s.notes}`:""}`,reportedBy:s.inspectorName||"N/A",category:"Inspection"})}),e.custodialNotes.forEach(s=>{const i=new Date(s.date).getTime();if(t&&i<t||o&&i>o||e.schoolFilter&&s.school!==e.schoolFilter)return;const a=["urgent","emergency","leak","unsafe","broken","immediate"].some(n=>s.notes.toLowerCase().includes(n));r.push({date:new Date(s.date).toLocaleDateString(),school:s.school,location:s.location,priority:a?"Critical":"Needs Attention",description:s.notes,reportedBy:"N/A",category:"Custodial Note"})}),r.sort((s,i)=>{if(s.priority!==i.priority){const l={Critical:0,"Needs Attention":1,Info:2};return l[s.priority]-l[i.priority]}return new Date(i.date).getTime()-new Date(s.date).getTime()}),r}function x(e,r,t){e.setFontSize(d.title),e.setTextColor(c.primary),e.setFont("helvetica","bold"),e.text("Current Custodial Issues Report",g.left,t),t+=8,e.setFontSize(d.body),e.setTextColor(c.secondary),e.setFont("helvetica","normal");const o=r.startDate&&r.endDate?`${r.startDate.toLocaleDateString()} - ${r.endDate.toLocaleDateString()}`:"All Dates";return e.text(`Date Range: ${o}`,g.left,t),t+=5,r.schoolFilter&&(e.text(`School: ${r.schoolFilter}`,g.left,t),t+=5),r.activeFilters&&r.activeFilters.length>0&&(e.text(`Filters: ${r.activeFilters.join(", ")}`,g.left,t),t+=5),e.setFontSize(d.small),e.setTextColor(c.secondary),e.text(`Generated: ${new Date().toLocaleString()}`,g.left,t),t+=5,e.setDrawColor(c.border),e.setLineWidth(.5),e.line(g.left,t,e.internal.pageSize.getWidth()-g.right,t),t+8}function D(e,r,t){const o=r.filter(a=>a.priority==="Critical").length,s=r.filter(a=>a.priority==="Needs Attention").length,i=new Set(r.map(a=>a.school)).size;e.setFontSize(d.heading),e.setTextColor(c.primary),e.setFont("helvetica","bold"),e.text("Summary Statistics",g.left,t),t+=6;const l=[["Total Issues:",r.length.toString()],["Critical:",o.toString()],["Needs Attention:",s.toString()],["Schools Affected:",i.toString()]];return h(e,{startY:t,body:l,theme:"plain",styles:{fontSize:d.body,textColor:c.text,cellPadding:2,lineWidth:.5,lineColor:c.tableBorder},columnStyles:{0:{fontStyle:"bold",cellWidth:40},1:{cellWidth:20}}}),e.lastAutoTable.finalY+10}function N(e,r,t){if(r.length===0)return e.setFontSize(d.body),e.setTextColor(c.secondary),e.text("No issues found for the selected criteria.",g.left,t),t+10;e.setFontSize(d.heading),e.setTextColor(c.primary),e.setFont("helvetica","bold"),e.text("Issues Detail",g.left,t),t+=6;const o=r.map(s=>[s.date,s.school,s.location,s.priority,s.description,s.category]);return h(e,{startY:t,head:[["Date","School","Location","Priority","Description","Type"]],body:o,theme:"grid",headStyles:{fillColor:c.tableHeader,textColor:c.primary,fontStyle:"bold",fontSize:d.small,lineWidth:.5,lineColor:c.tableBorder},bodyStyles:{fontSize:d.small,textColor:c.text,lineWidth:.5,lineColor:c.tableBorder},columnStyles:{0:{cellWidth:20},1:{cellWidth:20},2:{cellWidth:30},3:{cellWidth:25},4:{cellWidth:60},5:{cellWidth:25}},styles:{overflow:"linebreak",cellPadding:3}}),e.lastAutoTable.finalY}function R(e){const r=e.getNumberOfPages();for(let t=1;t<=r;t++){e.setPage(t);const o=e.internal.pageSize.getHeight();e.setFontSize(d.small),e.setTextColor(c.secondary),e.text(`Page ${t} of ${r}`,e.internal.pageSize.getWidth()/2,o-10,{align:"center"}),e.text("Custodial Command System",g.left,o-10)}}function Y(e,r){const t=y(e,r),o=new m("p","mm","letter");let s=20;if(o.setFontSize(d.title),o.setTextColor(c.primary),o.setFont("helvetica","bold"),o.text("EXECUTIVE SUMMARY",g.left,s),s+=15,r.filters.dateRange.from||r.filters.dateRange.to){o.setFontSize(d.body),o.setTextColor(c.secondary);const u=r.filters.dateRange.from?.toLocaleDateString()||"Start",f=r.filters.dateRange.to?.toLocaleDateString()||"End";o.text(`Report Period: ${u} - ${f}`,g.left,s),s+=10}const i=t.inspections.length,l=t.custodialNotes.length,a=i>0?t.inspections.map(p).filter(u=>u!==null).reduce((u,f)=>u+f,0)/i:0,n=[["Total Inspections",i.toString()],["Custodial Notes",l.toString()],["Average Rating",a.toFixed(1)+" stars"],["Schools Covered",t.schools.length.toString()]];return h(o,{startY:s,head:[["Metric","Value"]],body:n,theme:"grid",headStyles:{fillColor:c.tableHeader},styles:{fontSize:d.body}}),s=o.lastAutoTable.finalY+10,o.setFontSize(d.body),o.setTextColor(c.text),o.text("This executive summary provides a high-level overview of custodial performance",g.left,s),s+=6,o.text(`across ${t.schools.length} schools with ${i} inspections conducted.`,g.left,s),o.output("blob")}function B(e,r){const t=y(e,r),o=new m("p","mm","letter");let s=20;o.setFontSize(d.title),o.setTextColor(c.primary),o.setFont("helvetica","bold"),o.text("SCHOOL PERFORMANCE REPORT",g.left,s),s+=15;const i=t.inspections.reduce((a,n)=>{a[n.school]||(a[n.school]={school:n.school,inspections:0,ratings:[]}),a[n.school].inspections++;const u=p(n);return u!==null&&a[n.school].ratings.push(u),a},{}),l=Object.values(i).map(a=>[a.school,a.inspections.toString(),a.ratings.length>0?(a.ratings.reduce((n,u)=>n+u,0)/a.ratings.length).toFixed(1):"N/A"]);return h(o,{startY:s,head:[["School","Inspections","Avg Rating"]],body:l,theme:"grid",headStyles:{fillColor:c.tableHeader},styles:{fontSize:d.body}}),o.output("blob")}function M(e,r){const t=y(e,r),o=new m("p","mm","letter");let s=20;o.setFontSize(d.title),o.setTextColor(c.primary),o.setFont("helvetica","bold"),o.text("CATEGORY ANALYSIS REPORT",g.left,s),s+=15;const l=[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Vertical and Horizontal Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"}].map(a=>{const n=t.inspections.map(u=>u[a.key]).filter(u=>typeof u=="number");return[a.label,n.length.toString(),n.length>0?(n.reduce((u,f)=>u+f,0)/n.length).toFixed(1):"N/A"]});return h(o,{startY:s,head:[["Category","Inspections","Avg Rating"]],body:l,theme:"grid",headStyles:{fillColor:c.tableHeader},styles:{fontSize:d.body}}),o.output("blob")}function W(e,r){const t=y(e,r),o=new m("p","mm","letter");let s=20;if(o.setFontSize(d.title),o.setTextColor(c.primary),o.setFont("helvetica","bold"),o.text("CUSTOM REPORT",g.left,s),s+=15,r.dataTypes.inspections){o.setFontSize(d.heading),o.setTextColor(c.primary),o.text("INSPECTIONS",g.left,s),s+=10;const i=t.inspections.slice(0,10).map(l=>[l.school,l.date,p(l)?.toFixed(1)||"N/A"]);h(o,{startY:s,head:[["School","Date","Rating"]],body:i,theme:"grid",headStyles:{fillColor:c.tableHeader},styles:{fontSize:d.body}}),s=o.lastAutoTable.finalY+10}if(r.dataTypes.custodialNotes){o.setFontSize(d.heading),o.setTextColor(c.primary),o.text("CUSTODIAL NOTES",g.left,s),s+=10;const i=t.custodialNotes.slice(0,10).map(l=>[l.school,l.date,l.notes.substring(0,50)+(l.notes.length>50?"...":"")]);h(o,{startY:s,head:[["School","Date","Note"]],body:i,theme:"grid",headStyles:{fillColor:c.tableHeader},styles:{fontSize:d.body}})}return o.output("blob")}export{w as a,z as b,p as c,C as d,O as e,P as f,$ as g,y as h,A as i,L as j,E as k,H as l,W as m,M as n,B as o,Y as p,I as v};
