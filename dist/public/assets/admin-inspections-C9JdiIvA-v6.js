import{j as e,r}from"./ui-gIZ64paP-v6.js";import{i as se,c as H,u as ve,b as v,f as S,g as k,h as w,d as y,e as o,B as I}from"./index-ClufJbUB-v6.js";import{L as n,I as m}from"./label-BXDX0v-3-v6.js";import{T as $}from"./textarea-DMCDaM7J-v6.js";import{S as _,a as B,b as V,c as W,d as L}from"./select-BouMH4Ba-v6.js";import{D as U,e as G,a as J,b as K,c as Q,d as X}from"./dialog-BVC3i4oB-v6.js";import{A as ye,h as Ne,a as Ce,b as be,c as Se,d as ke,e as we,f as De,g as Te}from"./alert-dialog-CksAzLOH-v6.js";import{T as Ae,a as Ee,b as Y,d as Z}from"./tabs-BvPWvoR_-v6.js";import{u as Ie}from"./use-mobile-BMxJlUOj-v6.js";import{i as Le}from"./custodial-criteria-aPNJLI_7-v6.js";import{L as Fe}from"./loader-circle-AVktpnm2-v6.js";import{T as Oe}from"./trash-2-C-aLTV0V-v6.js";import{S as ze}from"./settings-KdOdbqQ2-v6.js";import"./vendor-Dvwkxfce-v6.js";import"./chevron-down-DcOdNfKy-v6.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=se("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=se("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Re=({size:u="md",className:h,text:g="Loading..."})=>{const j={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsxs("div",{className:H("flex flex-col items-center justify-center p-8",h),children:[e.jsx(Fe,{className:H("animate-spin text-primary",j[u])}),g&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:g})]})},qe=Re;function es({onBack:u}){Ie();const{toast:h}=ve(),[g,j]=r.useState([]),[ae,F]=r.useState(!0),[p,O]=r.useState(null),[te,z]=r.useState(!1),[ie,x]=r.useState(!1),[N,D]=r.useState({username:"",password:""}),[P,f]=r.useState(""),[le,re]=r.useState("inspections"),[T,R]=r.useState(null),[q,A]=r.useState({}),[ne,C]=r.useState(!1),[oe,b]=r.useState(null),ce=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[c,d]=r.useState({inspectorName:"",school:"",date:"",inspectionType:"",locationDescription:"",roomNumber:"",locationCategory:"",floors:null,verticalHorizontalSurfaces:null,ceiling:null,restrooms:null,customerSatisfaction:null,trash:null,projectCleaning:null,activitySupport:null,safetyCompliance:null,equipment:null,monitoring:null,notes:"",isCompleted:!1});r.useEffect(()=>{localStorage.getItem("admin-session-token")?(x(!0),M()):F(!1)},[]);const de=async s=>{s.preventDefault(),f("");try{const t=await(await fetch("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:N.username,password:N.password})})).json();t.success?(x(!0),localStorage.setItem("admin-session-token",t.sessionToken),M()):f(t.message||"Invalid username or password")}catch(a){console.error("Login error:",a),f("Network error. Please try again.")}},me=()=>{x(!1),localStorage.removeItem("admin-session-token"),D({username:"",password:""})},he=s=>{R(s),A({label:s.label,criteria:{...s.criteria}}),C(!0)},xe=()=>{h({title:"✅ Criteria Updated",description:"Criteria updated successfully! (Note: This is a demo - changes are not persisted)"}),C(!1),R(null)},M=async()=>{try{const s=localStorage.getItem("admin-session-token");if(!s){x(!1);return}const a=await fetch("/api/admin/inspections",{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=await a.json();j(t.data||t)}else a.status===401?(x(!1),localStorage.removeItem("admin-session-token"),f("Session expired. Please login again.")):console.error("Failed to fetch inspections")}catch(s){console.error("Error fetching inspections:",s)}finally{F(!1)}},ue=async s=>{try{const a=localStorage.getItem("admin-session-token");if(!a){x(!1);return}const t=await fetch(`/api/admin/inspections/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});t.ok?(j(i=>i.filter(l=>l.id!==s)),h({title:"✅ Inspection Deleted",description:"Inspection deleted successfully"})):t.status===401?(x(!1),localStorage.removeItem("admin-session-token"),f("Session expired. Please login again.")):h({variant:"destructive",title:"Deletion Failed",description:"Failed to delete inspection"})}catch(a){console.error("Error deleting inspection:",a),h({variant:"destructive",title:"Network Error",description:"Error deleting inspection. Please check your connection and try again."})}},pe=s=>{O(s),d({inspectorName:s.inspectorName||"",school:s.school,date:s.date,inspectionType:s.inspectionType,locationDescription:s.locationDescription,roomNumber:s.roomNumber||"",locationCategory:s.locationCategory||"",floors:s.floors,verticalHorizontalSurfaces:s.verticalHorizontalSurfaces,ceiling:s.ceiling,restrooms:s.restrooms,customerSatisfaction:s.customerSatisfaction,trash:s.trash,projectCleaning:s.projectCleaning,activitySupport:s.activitySupport,safetyCompliance:s.safetyCompliance,equipment:s.equipment,monitoring:s.monitoring,notes:s.notes||"",isCompleted:s.isCompleted||!1}),z(!0)},E=()=>{z(!1),O(null)},ge=async()=>{if(p)try{const s=await fetch(`/api/inspections/${p.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(s.ok){const a=await s.json();j(t=>t.map(i=>i.id===p.id?a:i)),E(),h({title:"✅ Inspection Updated",description:"Inspection updated successfully"})}else{const a=await s.json();alert(`Failed to update inspection: ${a.error}`)}}catch(s){console.error("Error updating inspection:",s),alert("Error updating inspection")}},je=s=>new Date(s).toLocaleDateString(),fe=s=>s===null?"bg-gray-100 text-gray-800":s<=2?"bg-red-100 text-red-800":s<=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return ie?ae?e.jsx(qe,{text:"Loading inspections..."}):e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[u&&e.jsx(o,{variant:"outline",onClick:u,className:"flex-shrink-0",children:"← Back"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-gray-900",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage inspections and criteria"})]}),e.jsxs(o,{variant:"outline",onClick:me,className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Logout"]})]}),e.jsxs(Ae,{value:le,onValueChange:re,children:[e.jsxs(Ee,{className:"grid w-full grid-cols-2",children:[e.jsx(Y,{value:"inspections",children:"Manage Inspections"}),e.jsx(Y,{value:"criteria",children:"Edit Criteria"})]}),e.jsx(Z,{value:"inspections",className:"space-y-4 mt-6",children:e.jsx("div",{className:"grid gap-4",children:g.length===0?e.jsx(v,{children:e.jsx(y,{className:"pt-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"No inspections found"})})}):g.map(s=>e.jsxs(v,{className:"overflow-hidden",children:[e.jsx(S,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"text-lg",children:[s.school," - ",s.locationDescription]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Date: ",je(s.date)]}),s.inspectorName&&e.jsxs("div",{children:["Inspector: ",s.inspectorName]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",children:s.inspectionType}),s.isCompleted&&e.jsx(I,{variant:"default",children:"Completed"})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(U,{open:te&&(p==null?void 0:p.id)===s.id,onOpenChange:a=>{a||E()},children:[e.jsx(G,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>pe(s),children:e.jsx(ee,{className:"w-4 h-4"})})}),e.jsxs(J,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Edit Inspection"}),e.jsx(X,{children:"Make changes to the inspection details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-inspector",children:"Inspector Name"}),e.jsx(m,{id:"edit-inspector",value:c.inspectorName,onChange:a=>d(t=>({...t,inspectorName:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-school",children:"School"}),e.jsxs(_,{value:c.school,onValueChange:a=>d(t=>({...t,school:a})),children:[e.jsx(B,{children:e.jsx(V,{})}),e.jsx(W,{children:ce.map(a=>e.jsx(L,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-date",children:"Date"}),e.jsx(m,{id:"edit-date",type:"date",value:c.date,onChange:a=>d(t=>({...t,date:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-type",children:"Inspection Type"}),e.jsxs(_,{value:c.inspectionType,onValueChange:a=>d(t=>({...t,inspectionType:a})),children:[e.jsx(B,{children:e.jsx(V,{})}),e.jsxs(W,{children:[e.jsx(L,{value:"single_room",children:"Single Room"}),e.jsx(L,{value:"whole_building",children:"Whole Building"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-location",children:"Location Description"}),e.jsx(m,{id:"edit-location",value:c.locationDescription,onChange:a=>d(t=>({...t,locationDescription:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-room",children:"Room Number"}),e.jsx(m,{id:"edit-room",value:c.roomNumber,onChange:a=>d(t=>({...t,roomNumber:a.target.value}))})]})]}),c.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Categories (1-5, or leave empty for no rating)"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>e.jsxs("div",{children:[e.jsx(n,{htmlFor:`edit-${a}`,children:t}),e.jsx(m,{id:`edit-${a}`,type:"number",min:"1",max:"5",value:c[a]||"",onChange:i=>d(l=>({...l,[a]:i.target.value?parseInt(i.target.value):null}))})]},a))})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-notes",children:"Notes"}),e.jsx($,{id:"edit-notes",value:c.notes,onChange:a=>d(t=>({...t,notes:a.target.value})),rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:E,children:"Cancel"}),e.jsx(o,{onClick:ge,children:"Save Changes"})]})]})]}),e.jsxs(ye,{open:oe===s.id,onOpenChange:a=>{b(a?s.id:null)},children:[e.jsx(Ne,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(Oe,{className:"w-4 h-4"})})}),e.jsxs(Ce,{children:[e.jsxs(be,{children:[e.jsx(Se,{children:"Delete Inspection"}),e.jsx(ke,{children:"Are you sure you want to delete this inspection? This action cannot be undone."})]}),e.jsxs(we,{children:[e.jsx(De,{onClick:()=>b(null),children:"Cancel"}),e.jsx(Te,{onClick:()=>{ue(s.id),b(null)},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})}),e.jsxs(y,{children:[s.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Ratings:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>{const i=s[a];return e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-gray-600",children:t}),e.jsx(I,{variant:"secondary",className:`text-xs ${fe(i)}`,children:i||"N/A"})]},a)})})]}),s.notes&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]})]})]},s.id))})}),e.jsx(Z,{value:"criteria",className:"space-y-4 mt-6",children:e.jsxs(v,{children:[e.jsxs(S,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5"}),"Inspection Criteria Management"]}),e.jsx(w,{children:"View and edit the criteria used for rating inspections. Each category has specific criteria for ratings 1-5."})]}),e.jsx(y,{className:"space-y-4",children:Le.map(s=>e.jsxs(v,{className:"border-l-4 border-l-blue-500",children:[e.jsx(S,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{className:"text-lg",children:s.label}),e.jsxs(w,{className:"mt-1",children:[Object.keys(s.criteria).length," rating levels defined"]})]}),e.jsxs(U,{open:ne&&(T==null?void 0:T.key)===s.key,onOpenChange:C,children:[e.jsx(G,{asChild:!0,children:e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>he(s),children:[e.jsx(ee,{className:"w-4 h-4"}),"Edit"]})}),e.jsxs(J,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsxs(Q,{children:["Edit Criteria: ",s.label]}),e.jsx(X,{children:"Modify the criteria descriptions for each rating level (1-5 stars)"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"criteria-label",children:"Category Label"}),e.jsx(m,{id:"criteria-label",value:q.label||"",onChange:a=>A(t=>({...t,label:a.target.value})),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Criteria"}),[5,4,3,2,1].map(a=>{var t;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["Rating ",a,":"]}),e.jsxs("div",{className:"flex",children:[Array.from({length:a},(i,l)=>e.jsx("span",{className:"text-yellow-400",children:"★"},l)),Array.from({length:5-a},(i,l)=>e.jsx("span",{className:"text-gray-300",children:"★"},l))]})]}),e.jsx($,{value:((t=q.criteria)==null?void 0:t[a])||"",onChange:i=>A(l=>({...l,criteria:{...l.criteria,[a]:i.target.value}})),rows:3,className:"text-sm",placeholder:`Enter criteria description for ${a} star rating...`})]},a)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(o,{onClick:xe,children:"Save Changes"})]})]})]})]})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(s.criteria).map(([a,t])=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:parseInt(a)},(i,l)=>e.jsx("span",{className:"text-yellow-400 text-sm",children:"★"},l)),Array.from({length:5-parseInt(a)},(i,l)=>e.jsx("span",{className:"text-gray-300 text-sm",children:"★"},l))]}),e.jsx("div",{className:"flex-1 text-sm text-gray-700",children:t})]},a))})})]},s.key))})]})})]})]}):e.jsx("div",{className:"container mx-auto p-6 max-w-md",children:e.jsxs(v,{children:[e.jsxs(S,{children:[e.jsx(k,{className:"text-center",children:"Admin Login"}),e.jsx(w,{className:"text-center",children:"Enter your credentials to access the admin panel"})]}),e.jsx(y,{children:e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"username",children:"Username"}),e.jsx(m,{id:"username",name:"username",type:"text",autoComplete:"username",value:N.username,onChange:s=>D(a=>({...a,username:s.target.value})),placeholder:"Enter username",required:!0})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"password",children:"Password"}),e.jsx(m,{id:"password",name:"password",type:"password",autoComplete:"current-password",value:N.password,onChange:s=>D(a=>({...a,password:s.target.value})),placeholder:"Enter password",required:!0})]}),P&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:P}),e.jsxs("div",{className:"flex gap-2",children:[u&&e.jsx(o,{type:"button",variant:"outline",onClick:u,className:"flex-1",children:"Back"}),e.jsx(o,{type:"submit",className:"flex-1",children:"Login"})]})]})})]})})}export{es as default};
//# sourceMappingURL=admin-inspections-C9JdiIvA-v6.js.map
