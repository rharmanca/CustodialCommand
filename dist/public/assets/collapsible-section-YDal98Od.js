import{k as I,S as r,j as c}from"./index-xQtaxoGA.js";import{r as N}from"./ui-DMqgqLlU.js";import{C as E}from"./chevron-right-7lgzUleG.js";import{a as A}from"./chevron-down-CIgtlx0o.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=I("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),f={DRAFT_INSPECTION:"custodial-draft-inspection",DRAFT_BUILDING_INSPECTION:"custodial-draft-building-inspection",DRAFT_CUSTODIAL_NOTE:"custodial-draft-custodial-note",USER_PREFERENCES:"custodial-user-preferences",LEGACY_INSPECTION_DRAFTS:"custodial_inspection_drafts",LEGACY_BUILDING_DRAFTS:"building_form_drafts"},m={MAX_DRAFT_SIZE:5*1024*1024,MAX_TOTAL_STORAGE:8*1024*1024,MAX_DRAFTS_PER_TYPE:10,IMAGE_QUALITY:.7,MAX_IMAGE_DIMENSIONS:{width:1200,height:1200}},h=()=>{let e=0;const o=r.keys();for(const a of o){const t=r.getItem(a);t&&(e+=t.length+a.length)}return e},_=e=>new Promise((o,a)=>{const t=document.createElement("canvas"),n=t.getContext("2d"),s=new Image;s.onload=()=>{const{width:d,height:u}=m.MAX_IMAGE_DIMENSIONS;let{width:i,height:l}=s;if(i>d||l>u){const C=Math.min(d/i,u/l);i*=C,l*=C}t.width=i,t.height=l,n?.drawImage(s,0,0,i,l);const S=t.toDataURL("image/jpeg",m.IMAGE_QUALITY);o(S)},s.onerror=a,s.src=URL.createObjectURL(e)}),x=(e,o)=>{try{const a={data:o,timestamp:Date.now()},t=JSON.stringify(a);if(t.length>m.MAX_DRAFT_SIZE){console.warn(`Draft too large (${Math.round(t.length/1024)}KB). Skipping save.`);return}if(h()+t.length>m.MAX_TOTAL_STORAGE&&(p(),h()+t.length>m.MAX_TOTAL_STORAGE)){console.warn("Storage limit reached. Cannot save draft.");return}r.setItem(e,t)}catch(a){if(console.error("Failed to save draft to localStorage:",a),a instanceof Error&&a.name==="QuotaExceededError"){p();try{r.setItem(e,JSON.stringify({data:o,timestamp:Date.now()}))}catch(t){console.error("Failed to save draft even after cleanup:",t)}}}},y=e=>{try{const o=r.getItem(e);if(!o)return null;const a=JSON.parse(o);return Date.now()-a.timestamp>10080*60*1e3?(r.removeItem(e),null):a.data}catch(o){return console.error("Failed to load draft from localStorage:",o),null}},G=e=>{try{r.removeItem(e)}catch(o){console.error("Failed to clear draft from localStorage:",o)}},p=()=>{try{const e=Date.now()-6048e5,o=[],a=r.keys();for(const t of a)if(t.startsWith("custodial-"))try{const n=r.getItem(t);if(n){const s=JSON.parse(n);s.timestamp&&s.timestamp<e&&o.push(t)}}catch{o.push(t)}o.forEach(t=>r.removeItem(t)),console.log(`Cleaned up ${o.length} old drafts`)}catch(e){console.error("Failed to cleanup old drafts:",e)}},M=()=>{try{r.getItem(f.LEGACY_INSPECTION_DRAFTS)&&(console.log("Migrating legacy inspection drafts..."),r.removeItem(f.LEGACY_INSPECTION_DRAFTS)),r.getItem(f.LEGACY_BUILDING_DRAFTS)&&(console.log("Migrating legacy building inspection drafts..."),r.removeItem(f.LEGACY_BUILDING_DRAFTS)),p()}catch(e){console.error("Failed to migrate legacy drafts:",e)}},L=async e=>{try{return e.size<500*1024?new Promise((o,a)=>{const t=new FileReader;t.onload=()=>o(t.result),t.onerror=a,t.readAsDataURL(e)}):await _(e)}catch(o){throw console.error("Failed to process image for storage:",o),o}},O=()=>{const e=h(),o=r.keys().filter(a=>a.startsWith("custodial-")).length;return{totalSizeKB:Math.round(e/1024),totalSizeMB:Math.round(e/(1024*1024)*100)/100,draftCount:o,limitMB:Math.round(m.MAX_TOTAL_STORAGE/(1024*1024)),usagePercent:Math.round(e/m.MAX_TOTAL_STORAGE*100)}};function g(...e){return e.filter(Boolean).join(" ")}function w({title:e,children:o,defaultCollapsed:a=!0,className:t,titleClassName:n,contentClassName:s,disabled:d=!1}){const[u,i]=N.useState(a),l=()=>{d||i(!u)};return c.jsxDEV("div",{className:g("border border-gray-200 rounded-lg overflow-hidden",t||""),children:[c.jsxDEV("button",{type:"button",onClick:l,disabled:d,className:g("w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer",d?"cursor-not-allowed opacity-50":"",n||""),children:[c.jsxDEV("span",{className:"text-base",children:e},void 0,!1,{fileName:"G:/CustodialCommand/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:47,columnNumber:9},this),u?c.jsxDEV(E,{className:"w-5 h-5 transition-transform duration-200"},void 0,!1,{fileName:"G:/CustodialCommand/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:49,columnNumber:11},this):c.jsxDEV(A,{className:"w-5 h-5 transition-transform duration-200"},void 0,!1,{fileName:"G:/CustodialCommand/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:51,columnNumber:11},this)]},void 0,!0,{fileName:"G:/CustodialCommand/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:37,columnNumber:7},this),c.jsxDEV("div",{className:g("transition-all duration-300 ease-in-out overflow-hidden",u?"max-h-0":"max-h-[2000px]"),children:c.jsxDEV("div",{className:g("p-4 pt-0",s||""),children:o},void 0,!1,{fileName:"G:/CustodialCommand/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:61,columnNumber:9},this)},void 0,!1,{fileName:"G:/CustodialCommand/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:55,columnNumber:7},this)]},void 0,!0,{fileName:"G:/CustodialCommand/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:36,columnNumber:5},this)}export{w as C,f as S,R as a,G as c,O as g,y as l,M as m,L as p,x as s};
