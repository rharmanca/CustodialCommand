import{F as a,r as A,j as l}from"./index-HLq_73Du.js";import{C as _}from"./chevron-right-DSWSvRdg.js";import{a as E}from"./Combination-CZRApATG.js";const g={DRAFT_INSPECTION:"custodial-draft-inspection",DRAFT_BUILDING_INSPECTION:"custodial-draft-building-inspection",DRAFT_CUSTODIAL_NOTE:"custodial-draft-custodial-note",USER_PREFERENCES:"custodial-user-preferences",LEGACY_INSPECTION_DRAFTS:"custodial_inspection_drafts",LEGACY_BUILDING_DRAFTS:"building_form_drafts"},d={MAX_DRAFT_SIZE:5*1024*1024,MAX_TOTAL_STORAGE:8*1024*1024,MAX_DRAFTS_PER_TYPE:10,IMAGE_QUALITY:.7,MAX_IMAGE_DIMENSIONS:{width:1200,height:1200}},h=()=>{let t=0;const r=a.keys();for(const o of r){const e=a.getItem(o);e&&(t+=e.length+o.length)}return t},T=t=>new Promise((r,o)=>{const e=document.createElement("canvas"),n=e.getContext("2d"),s=new Image;s.onload=()=>{const{width:m,height:f}=d.MAX_IMAGE_DIMENSIONS;let{width:i,height:c}=s;if(i>m||c>f){const I=Math.min(m/i,f/c);i*=I,c*=I}e.width=i,e.height=c,n?.drawImage(s,0,0,i,c);const p=e.toDataURL("image/jpeg",d.IMAGE_QUALITY);r(p)},s.onerror=o,s.src=URL.createObjectURL(t)}),y=(t,r)=>{try{const o={data:r,timestamp:Date.now()},e=JSON.stringify(o);if(e.length>d.MAX_DRAFT_SIZE){console.warn(`Draft too large (${Math.round(e.length/1024)}KB). Skipping save.`);return}if(h()+e.length>d.MAX_TOTAL_STORAGE&&(S(),h()+e.length>d.MAX_TOTAL_STORAGE)){console.warn("Storage limit reached. Cannot save draft.");return}a.setItem(t,e)}catch(o){if(console.error("Failed to save draft to localStorage:",o),o instanceof Error&&o.name==="QuotaExceededError"){S();try{a.setItem(t,JSON.stringify({data:r,timestamp:Date.now()}))}catch(e){console.error("Failed to save draft even after cleanup:",e)}}}},M=t=>{try{const r=a.getItem(t);if(!r)return null;const o=JSON.parse(r);return Date.now()-o.timestamp>10080*60*1e3?(a.removeItem(t),null):o.data}catch(r){return console.error("Failed to load draft from localStorage:",r),null}},O=t=>{try{a.removeItem(t)}catch(r){console.error("Failed to clear draft from localStorage:",r)}},S=()=>{try{const t=Date.now()-6048e5,r=[],o=a.keys();for(const e of o)if(e.startsWith("custodial-"))try{const n=a.getItem(e);if(n){const s=JSON.parse(n);s.timestamp&&s.timestamp<t&&r.push(e)}}catch{r.push(e)}r.forEach(e=>a.removeItem(e)),console.log(`Cleaned up ${r.length} old drafts`)}catch(t){console.error("Failed to cleanup old drafts:",t)}},C=()=>{try{a.getItem(g.LEGACY_INSPECTION_DRAFTS)&&(console.log("Migrating legacy inspection drafts..."),a.removeItem(g.LEGACY_INSPECTION_DRAFTS)),a.getItem(g.LEGACY_BUILDING_DRAFTS)&&(console.log("Migrating legacy building inspection drafts..."),a.removeItem(g.LEGACY_BUILDING_DRAFTS)),S()}catch(t){console.error("Failed to migrate legacy drafts:",t)}},w=async t=>{try{return t.size<500*1024?new Promise((r,o)=>{const e=new FileReader;e.onload=()=>r(e.result),e.onerror=o,e.readAsDataURL(t)}):await T(t)}catch(r){throw console.error("Failed to process image for storage:",r),r}},L=()=>{const t=h(),r=a.keys().filter(o=>o.startsWith("custodial-")).length;return{totalSizeKB:Math.round(t/1024),totalSizeMB:Math.round(t/(1024*1024)*100)/100,draftCount:r,limitMB:Math.round(d.MAX_TOTAL_STORAGE/(1024*1024)),usagePercent:Math.round(t/d.MAX_TOTAL_STORAGE*100)}};function u(...t){return t.filter(Boolean).join(" ")}function v({title:t,children:r,defaultCollapsed:o=!0,className:e,titleClassName:n,contentClassName:s,disabled:m=!1}){const[f,i]=A.useState(o),c=()=>{m||i(!f)};return l.jsxs("div",{className:u("border border-gray-200 rounded-lg overflow-hidden",e||""),children:[l.jsxs("button",{type:"button",onClick:c,disabled:m,className:u("w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer",m?"cursor-not-allowed opacity-50":"",n||""),children:[l.jsx("span",{className:"text-base",children:t}),f?l.jsx(_,{className:"w-5 h-5 transition-transform duration-200"}):l.jsx(E,{className:"w-5 h-5 transition-transform duration-200"})]}),l.jsx("div",{className:u("transition-all duration-300 ease-in-out overflow-hidden",f?"max-h-0":"max-h-[2000px]"),children:l.jsx("div",{className:u("p-4 pt-0",s||""),children:r})})]})}export{v as C,g as S,O as c,L as g,M as l,C as m,w as p,y as s};
