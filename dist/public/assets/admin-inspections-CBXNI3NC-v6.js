var be=Object.defineProperty,Se=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var U=(r,i,l)=>i in r?be(r,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):r[i]=l,o=(r,i)=>{for(var l in i||(i={}))we.call(i,l)&&U(r,l,i[l]);if(W)for(var l of W(i))De.call(i,l)&&U(r,l,i[l]);return r},d=(r,i)=>Se(r,ke(i));var S=(r,i,l)=>new Promise((v,D)=>{var T=p=>{try{C(l.next(p))}catch(N){D(N)}},j=p=>{try{C(l.throw(p))}catch(N){D(N)}},C=p=>p.done?v(p.value):Promise.resolve(p.value).then(T,j);C((l=l.apply(r,i)).next())});import{j as e,r as m}from"./ui-BqtzBtHj-v6.js";import{c as G,u as Te,d as Ae,C as k,e as L,f as F,g as O,h as w,B as x,i as $}from"./index-BaYUFHT0-v6.js";import{L as h,I as f}from"./LoadingOverlay-C66DN95D-v6.js";import{T as J}from"./textarea-goZqq0ZK-v6.js";import{S as K,a as Q,b as X,c as Y,d as H}from"./collapsible-section-B7qixoUz-v6.js";import{D as Z,a as ee,b as se,c as ae,d as te,e as ie}from"./dialog-DQHEhcSp-v6.js";import{A as Ee,a as Ie,b as Le,c as Fe,d as Oe,e as Pe,f as Re,g as ze,h as qe}from"./alert-dialog-D16k0HHK-v6.js";import{T as $e,a as He,b as le,c as re}from"./tabs-BvmPf-cb-v6.js";import{i as Me}from"./rating-criteria-DCg5BUcG-v6.js";import{L as _e,d as Be,S as ne,T as Ve,e as We}from"./icons-CP4MPgx_-v6.js";import"./vendor-oOSsakeb-v6.js";import"./charts-ChLs-CWD-v6.js";import"./utils-Cj9wHvoQ-v6.js";import"./forms-Ba_dyWLB-v6.js";const Ue=({size:r="md",className:i,text:l="Loading..."})=>{const v={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsxs("div",{className:G("flex flex-col items-center justify-center p-8",i),children:[e.jsx(_e,{className:G("animate-spin text-primary",v[r])}),l&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:l})]})},Ge=Ue;function cs({onBack:r}){Te();const{toast:i}=Ae(),[l,v]=m.useState([]),[D,T]=m.useState(!0),[j,C]=m.useState(null),[p,N]=m.useState(!1),[oe,y]=m.useState(!1),[A,P]=m.useState({username:"",password:""}),[M,b]=m.useState(""),[ce,de]=m.useState("inspections"),[R,_]=m.useState(null),[B,z]=m.useState({}),[me,E]=m.useState(!1),[he,I]=m.useState(null),xe=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[u,g]=m.useState({inspectorName:"",school:"",date:"",inspectionType:"",locationDescription:"",roomNumber:"",locationCategory:"",floors:null,verticalHorizontalSurfaces:null,ceiling:null,restrooms:null,customerSatisfaction:null,trash:null,projectCleaning:null,activitySupport:null,safetyCompliance:null,equipment:null,monitoring:null,notes:"",isCompleted:!1});m.useEffect(()=>{localStorage.getItem("admin-session-token")?(y(!0),V()):T(!1)},[]);const ue=s=>S(null,null,function*(){s.preventDefault(),b("");try{const t=yield(yield fetch("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:A.username,password:A.password})})).json();t.success?(y(!0),localStorage.setItem("admin-session-token",t.sessionToken),V()):b(t.message||"Invalid username or password")}catch(a){console.error("Login error:",a),b("Network error. Please try again.")}}),pe=()=>{y(!1),localStorage.removeItem("admin-session-token"),P({username:"",password:""})},ge=s=>{_(s),z({label:s.label,criteria:o({},s.criteria)}),E(!0)},je=()=>{i({title:"✅ Criteria Updated",description:"Criteria updated successfully! (Note: This is a demo - changes are not persisted)"}),E(!1),_(null)},V=()=>S(null,null,function*(){try{const s=localStorage.getItem("admin-session-token");if(!s){y(!1);return}const a=yield fetch("/api/admin/inspections",{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=yield a.json();v(t.data||t)}else a.status===401?(y(!1),localStorage.removeItem("admin-session-token"),b("Session expired. Please login again.")):console.error("Failed to fetch inspections")}catch(s){console.error("Error fetching inspections:",s)}finally{T(!1)}}),fe=s=>S(null,null,function*(){try{const a=localStorage.getItem("admin-session-token");if(!a){y(!1);return}const t=yield fetch(`/api/admin/inspections/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});t.ok?(v(n=>n.filter(c=>c.id!==s)),i({title:"✅ Inspection Deleted",description:"Inspection deleted successfully"})):t.status===401?(y(!1),localStorage.removeItem("admin-session-token"),b("Session expired. Please login again.")):i({variant:"destructive",title:"Deletion Failed",description:"Failed to delete inspection"})}catch(a){console.error("Error deleting inspection:",a),i({variant:"destructive",title:"Network Error",description:"Error deleting inspection. Please check your connection and try again."})}}),ve=s=>{C(s),g({inspectorName:s.inspectorName||"",school:s.school,date:s.date,inspectionType:s.inspectionType,locationDescription:s.locationDescription,roomNumber:s.roomNumber||"",locationCategory:s.locationCategory||"",floors:s.floors,verticalHorizontalSurfaces:s.verticalHorizontalSurfaces,ceiling:s.ceiling,restrooms:s.restrooms,customerSatisfaction:s.customerSatisfaction,trash:s.trash,projectCleaning:s.projectCleaning,activitySupport:s.activitySupport,safetyCompliance:s.safetyCompliance,equipment:s.equipment,monitoring:s.monitoring,notes:s.notes||"",isCompleted:s.isCompleted||!1}),N(!0)},q=()=>{N(!1),C(null)},ye=()=>S(null,null,function*(){if(j)try{const s=yield fetch(`/api/inspections/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(s.ok){const a=yield s.json();v(t=>t.map(n=>n.id===j.id?a:n)),q(),i({title:"✅ Inspection Updated",description:"Inspection updated successfully"})}else{const a=yield s.json();alert(`Failed to update inspection: ${a.error}`)}}catch(s){console.error("Error updating inspection:",s),alert("Error updating inspection")}}),Ce=s=>new Date(s).toLocaleDateString(),Ne=s=>s===null?"bg-gray-100 text-gray-800":s<=2?"bg-red-100 text-red-800":s<=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return oe?D?e.jsx(Ge,{text:"Loading inspections..."}):e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[r&&e.jsx(x,{variant:"outline",onClick:r,className:"flex-shrink-0",children:"← Back"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-gray-900",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage inspections and criteria"})]}),e.jsxs(x,{variant:"outline",onClick:pe,className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(Be,{className:"w-4 h-4"}),"Logout"]})]}),e.jsxs($e,{value:ce,onValueChange:de,children:[e.jsxs(He,{className:"grid w-full grid-cols-2",children:[e.jsx(le,{value:"inspections",children:"Manage Inspections"}),e.jsx(le,{value:"criteria",children:"Edit Criteria"})]}),e.jsx(re,{value:"inspections",className:"space-y-4 mt-6",children:e.jsx("div",{className:"grid gap-4",children:l.length===0?e.jsx(k,{children:e.jsx(w,{className:"pt-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"No inspections found"})})}):l.map(s=>e.jsxs(k,{className:"overflow-hidden",children:[e.jsx(L,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(F,{className:"text-lg",children:[s.school," - ",s.locationDescription]}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Date: ",Ce(s.date)]}),s.inspectorName&&e.jsxs("div",{children:["Inspector: ",s.inspectorName]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"outline",children:s.inspectionType}),s.isCompleted&&e.jsx($,{variant:"default",children:"Completed"})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Z,{open:p&&(j==null?void 0:j.id)===s.id,onOpenChange:a=>{a||q()},children:[e.jsx(ee,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",onClick:()=>ve(s),children:e.jsx(ne,{className:"w-4 h-4"})})}),e.jsxs(se,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Edit Inspection"}),e.jsx(ie,{children:"Make changes to the inspection details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-inspector",children:"Inspector Name"}),e.jsx(f,{id:"edit-inspector",value:u.inspectorName,onChange:a=>g(t=>d(o({},t),{inspectorName:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-school",children:"School"}),e.jsxs(K,{value:u.school,onValueChange:a=>g(t=>d(o({},t),{school:a})),children:[e.jsx(Q,{children:e.jsx(X,{})}),e.jsx(Y,{children:xe.map(a=>e.jsx(H,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-date",children:"Date"}),e.jsx(f,{id:"edit-date",type:"date",value:u.date,onChange:a=>g(t=>d(o({},t),{date:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-type",children:"Inspection Type"}),e.jsxs(K,{value:u.inspectionType,onValueChange:a=>g(t=>d(o({},t),{inspectionType:a})),children:[e.jsx(Q,{children:e.jsx(X,{})}),e.jsxs(Y,{children:[e.jsx(H,{value:"single_room",children:"Single Room"}),e.jsx(H,{value:"whole_building",children:"Whole Building"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-location",children:"Location Description"}),e.jsx(f,{id:"edit-location",value:u.locationDescription,onChange:a=>g(t=>d(o({},t),{locationDescription:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-room",children:"Room Number"}),e.jsx(f,{id:"edit-room",value:u.roomNumber,onChange:a=>g(t=>d(o({},t),{roomNumber:a.target.value}))})]})]}),u.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Categories (1-5, or leave empty for no rating)"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>e.jsxs("div",{children:[e.jsx(h,{htmlFor:`edit-${a}`,children:t}),e.jsx(f,{id:`edit-${a}`,type:"number",min:"1",max:"5",value:u[a]||"",onChange:n=>g(c=>d(o({},c),{[a]:n.target.value?parseInt(n.target.value):null}))})]},a))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(J,{id:"edit-notes",value:u.notes,onChange:a=>g(t=>d(o({},t),{notes:a.target.value})),rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"outline",onClick:q,children:"Cancel"}),e.jsx(x,{onClick:ye,children:"Save Changes"})]})]})]}),e.jsxs(Ee,{open:he===s.id,onOpenChange:a=>{I(a?s.id:null)},children:[e.jsx(Ie,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(Ve,{className:"w-4 h-4"})})}),e.jsxs(Le,{children:[e.jsxs(Fe,{children:[e.jsx(Oe,{children:"Delete Inspection"}),e.jsx(Pe,{children:"Are you sure you want to delete this inspection? This action cannot be undone."})]}),e.jsxs(Re,{children:[e.jsx(ze,{onClick:()=>I(null),children:"Cancel"}),e.jsx(qe,{onClick:()=>{fe(s.id),I(null)},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})}),e.jsxs(w,{children:[s.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Ratings:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>{const n=s[a];return e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-gray-600",children:t}),e.jsx($,{variant:"secondary",className:`text-xs ${Ne(n)}`,children:n||"N/A"})]},a)})})]}),s.notes&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]})]})]},s.id))})}),e.jsx(re,{value:"criteria",className:"space-y-4 mt-6",children:e.jsxs(k,{children:[e.jsxs(L,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"Inspection Criteria Management"]}),e.jsx(O,{children:"View and edit the criteria used for rating inspections. Each category has specific criteria for ratings 1-5."})]}),e.jsx(w,{className:"space-y-4",children:Me.map(s=>e.jsxs(k,{className:"border-l-4 border-l-blue-500",children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(F,{className:"text-lg",children:s.label}),e.jsxs(O,{className:"mt-1",children:[Object.keys(s.criteria).length," rating levels defined"]})]}),e.jsxs(Z,{open:me&&(R==null?void 0:R.key)===s.key,onOpenChange:E,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>ge(s),children:[e.jsx(ne,{className:"w-4 h-4"}),"Edit"]})}),e.jsxs(se,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ae,{children:[e.jsxs(te,{children:["Edit Criteria: ",s.label]}),e.jsx(ie,{children:"Modify the criteria descriptions for each rating level (1-5 stars)"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"criteria-label",children:"Category Label"}),e.jsx(f,{id:"criteria-label",value:B.label||"",onChange:a=>z(t=>d(o({},t),{label:a.target.value})),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Criteria"}),[5,4,3,2,1].map(a=>{var t;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["Rating ",a,":"]}),e.jsxs("div",{className:"flex",children:[Array.from({length:a},(n,c)=>e.jsx("span",{className:"text-yellow-400",children:"★"},c)),Array.from({length:5-a},(n,c)=>e.jsx("span",{className:"text-gray-300",children:"★"},c))]})]}),e.jsx(J,{value:((t=B.criteria)==null?void 0:t[a])||"",onChange:n=>z(c=>d(o({},c),{criteria:d(o({},c.criteria),{[a]:n.target.value})})),rows:3,className:"text-sm",placeholder:`Enter criteria description for ${a} star rating...`})]},a)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(x,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),e.jsx(x,{onClick:je,children:"Save Changes"})]})]})]})]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(s.criteria).map(([a,t])=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:parseInt(a)},(n,c)=>e.jsx("span",{className:"text-yellow-400 text-sm",children:"★"},c)),Array.from({length:5-parseInt(a)},(n,c)=>e.jsx("span",{className:"text-gray-300 text-sm",children:"★"},c))]}),e.jsx("div",{className:"flex-1 text-sm text-gray-700",children:t})]},a))})})]},s.key))})]})})]})]}):e.jsx("div",{className:"container mx-auto p-6 max-w-md",children:e.jsxs(k,{children:[e.jsxs(L,{children:[e.jsx(F,{className:"text-center",children:"Admin Login"}),e.jsx(O,{className:"text-center",children:"Enter your credentials to access the admin panel"})]}),e.jsx(w,{children:e.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"username",children:"Username"}),e.jsx(f,{id:"username",name:"username",type:"text",autoComplete:"username",value:A.username,onChange:s=>P(a=>d(o({},a),{username:s.target.value})),placeholder:"Enter username",required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(f,{id:"password",name:"password",type:"password",autoComplete:"current-password",value:A.password,onChange:s=>P(a=>d(o({},a),{password:s.target.value})),placeholder:"Enter password",required:!0})]}),M&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:M}),e.jsxs("div",{className:"flex gap-2",children:[r&&e.jsx(x,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:"Back"}),e.jsx(x,{type:"submit",className:"flex-1",children:"Login"})]})]})})]})})}export{cs as default};
