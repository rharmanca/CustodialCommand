import{l as W,b as O,r,j as e,d as D,g as T,h as E,i as A,e as F,a as V,k as U,B,C as le,f as P,X as K,c as q,S as oe,Q as R,T as z,V as ce,W as Q}from"./index-HLq_73Du.js";import{S as L,C as de}from"./skeleton-DI_wPArA.js";import{S as me,a as ue,b as he,c as xe,d as fe}from"./select-CeoiMW6k.js";import{B as pe}from"./building-2-s2MRPQzo.js";import{C as ge}from"./calendar-Dpz1FHeL.js";import{M as je}from"./map-pin-BRBikdsy.js";import{F as ve}from"./file-text-BRZoaSmN.js";import{E as G}from"./eye-CK4uExDV.js";import{T as we}from"./trash-2-BAWcCdv_.js";import{D as Z,a as J,c as X}from"./dialog-4J97X8Ll.js";import{C as be}from"./chevron-right-DSWSvRdg.js";import{F as Ne,C as ye,b as Ce,u as Se,t as ke,o as Ie,s as De,n as k}from"./types-Bwb4SlOo.js";import{T as Fe}from"./textarea-DDW2JiL3.js";import{L as _}from"./label-Bt5uGumo.js";import{r as Te,i as Pe}from"./custodial-criteria-aPNJLI_7.js";import{C as Y}from"./circle-check-B-cr6RRo.js";import{L as Le}from"./loader-circle-CfuPqdzB.js";import{S as Ee}from"./star-DG_Ies86.js";import{A as $e}from"./arrow-left-jIfaYMh_.js";import"./Combination-CZRApATG.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=W("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=W("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Re=(s={})=>{const{toast:n}=O(),[l,c]=r.useState([]),[d,o]=r.useState(!1),[a,x]=r.useState(null),[u,f]=r.useState(null),[i,j]=r.useState(!1),[N,v]=r.useState(!1),[m,t]=r.useState(null),[p,C]=r.useState(null),b=r.useCallback(async()=>{o(!0),x(null);try{const h=new URLSearchParams;s.school&&h.append("school",s.school),s.page&&h.append("page",s.page.toString()),s.limit&&h.append("limit",s.limit.toString());const g=h.toString(),w=`/api/inspections/pending${g?`?${g}`:""}`,y=await fetch(w,{credentials:"include"});if(!y.ok){const ie=await y.json().catch(()=>({message:"Unknown error"}));throw new Error(ie.message||`HTTP error! status: ${y.status}`)}const $=await y.json();c($.data),f($.pagination)}catch(h){const g=h instanceof Error?h.message:"Failed to fetch pending inspections";x(g),console.error("Error fetching pending inspections:",h)}finally{o(!1)}},[s.school,s.page,s.limit]);r.useEffect(()=>{b()},[b]);const S=r.useCallback(async(h,g)=>{j(!0),t(null);try{const w=await fetch(`/api/inspections/${h}/complete`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(g)});if(!w.ok){const y=await w.json().catch(()=>({message:"Unknown error"}));throw new Error(y.message||`HTTP error! status: ${w.status}`)}return c(y=>y.filter($=>$.id!==h)),n({title:"Inspection Completed",description:"The inspection has been marked as complete."}),await b(),!0}catch(w){const y=w instanceof Error?w.message:"Failed to complete inspection";return t(y),console.error("Error completing inspection:",w),n({title:"Error",description:y,variant:"destructive"}),!1}finally{j(!1)}},[b,n]),M=r.useCallback(async h=>{v(!0),C(null);try{const g=await fetch(`/api/inspections/${h}/discard`,{method:"PATCH",headers:{"Content-Type":"application/json"},credentials:"include"});if(!g.ok){const w=await g.json().catch(()=>({message:"Unknown error"}));throw new Error(w.message||`HTTP error! status: ${g.status}`)}return c(w=>w.filter(y=>y.id!==h)),n({title:"Inspection Discarded",description:"The inspection has been discarded."}),await b(),!0}catch(g){const w=g instanceof Error?g.message:"Failed to discard inspection";return C(w),console.error("Error discarding inspection:",g),n({title:"Error",description:w,variant:"destructive"}),!1}finally{v(!1)}},[b,n]);return{inspections:l,isLoading:d,error:a,pagination:u,refetch:b,completeInspection:S,discardInspection:M,isCompleting:i,isDiscarding:N,completeError:m,discardError:p}},ze=[{value:"all",label:"All Schools"},{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}];function qe({inspections:s,isLoading:n,error:l,onReview:c,onDiscard:d,selectedId:o}){O();const[a,x]=r.useState("all"),[u,f]=r.useState(null),i=r.useMemo(()=>{let t=[...s];return a!=="all"&&(t=t.filter(p=>p.school===a)),t.sort((p,C)=>{const b=p.captureTimestamp?new Date(p.captureTimestamp).getTime():0;return(C.captureTimestamp?new Date(C.captureTimestamp).getTime():0)-b}),t},[s,a]),j=async t=>{f(t);try{await d(t)}finally{f(null)}},N=t=>t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"Unknown date",v=t=>t?new Date(t).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):"",m=(t,p=60)=>t?t.length<=p?t:t.substring(0,p)+"...":null;return n?e.jsxs(D,{children:[e.jsxs(T,{children:[e.jsx(E,{children:"Pending Inspections"}),e.jsx(A,{children:"Loading pending inspections..."})]}),e.jsx(F,{className:"space-y-4",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex gap-4 p-4 border rounded-lg",children:[e.jsx(L,{className:"h-20 w-20 rounded-md"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(L,{className:"h-4 w-1/3"}),e.jsx(L,{className:"h-3 w-1/4"}),e.jsx(L,{className:"h-3 w-1/2"})]})]},t))})]}):l?e.jsxs(D,{children:[e.jsx(T,{children:e.jsx(E,{children:"Pending Inspections"})}),e.jsx(F,{children:e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-destructive/10 rounded-lg",children:[e.jsx(V,{className:"h-5 w-5 text-destructive"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-destructive",children:"Error loading inspections"}),e.jsx("p",{className:"text-sm text-destructive/80",children:l})]})]})})]}):e.jsxs(D,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(E,{children:"Pending Inspections"}),e.jsxs(A,{children:[i.length," inspection",i.length!==1?"s":""," waiting for review"]})]}),e.jsxs(me,{value:a,onValueChange:x,children:[e.jsx(ue,{className:"w-[180px]",children:e.jsx(he,{placeholder:"Filter by school"})}),e.jsx(xe,{children:ze.map(t=>e.jsx(fe,{value:t.value,children:t.label},t.value))})]})]})}),e.jsx(F,{children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-muted mb-4",children:e.jsx(pe,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No pending inspections"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm mx-auto",children:a!=="all"?`No pending inspections found for ${a}. Try selecting a different school.`:"All caught up! There are no inspections waiting for review at this time."})]}):e.jsx("div",{className:"space-y-3",children:i.map(t=>{const p=o===t.id,C=t.images?.length||0,b=t.thumbnailUrl||(t.images?.[0]?`${t.images[0]}?thumb=1`:null);return e.jsxs("div",{className:`group relative flex gap-4 p-4 rounded-lg border transition-all cursor-pointer ${p?"border-primary bg-primary/5":"border-border hover:border-primary/50 hover:bg-accent/50"}`,onClick:()=>c(t),role:"button",tabIndex:0,onKeyDown:S=>{(S.key==="Enter"||S.key===" ")&&(S.preventDefault(),c(t))},children:[e.jsx("div",{className:"flex-shrink-0",children:b?e.jsxs("div",{className:"relative w-20 h-20 rounded-md overflow-hidden bg-muted",children:[e.jsx("img",{src:b,alt:`Inspection at ${t.locationDescription}`,className:"w-full h-full object-cover",loading:"lazy"}),C>1&&e.jsxs("div",{className:"absolute bottom-1 right-1 bg-black/70 text-white text-xs px-1.5 py-0.5 rounded",children:["+",C-1]})]}):e.jsx("div",{className:"w-20 h-20 rounded-md bg-muted flex items-center justify-center",children:e.jsx(U,{className:"h-8 w-8 text-muted-foreground"})})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(B,{variant:"secondary",className:"font-semibold",children:t.school}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),N(t.captureTimestamp||t.createdAt)]}),e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),v(t.captureTimestamp||t.createdAt)]})]}),e.jsx("h4",{className:"font-medium mt-1 truncate",children:t.locationDescription||"Unknown location"}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),t.roomNumber||"No room specified"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),C," photo",C!==1?"s":""]})]}),t.quickNotes&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-2 flex items-start gap-1",children:[e.jsx(ve,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"line-clamp-2",children:m(t.quickNotes)})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 flex-shrink-0",children:[e.jsxs(P,{size:"sm",onClick:S=>{S.stopPropagation(),c(t)},className:"gap-1",children:[e.jsx(G,{className:"h-4 w-4"}),"Review"]}),e.jsxs(P,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive hover:bg-destructive/10",onClick:S=>{S.stopPropagation(),j(t.id)},disabled:u===t.id,children:[e.jsx(we,{className:"h-4 w-4"}),u===t.id?"Discarding...":"Discard"]})]})]})})]},t.id)})})})]})}function He({thumbnailSrc:s,fullSrc:n,alt:l,onClick:c,className:d="",containerClassName:o=""}){const[a,x]=r.useState(s),[u,f]=r.useState(!1),[i,j]=r.useState(!1),N=r.useRef(null);r.useEffect(()=>{x(s),f(!1);const m=new Image;return m.src=n,m.onload=()=>{x(n),f(!0)},N.current=m,()=>{m.onload=null}},[s,n]);const v=r.useCallback(()=>{c?c():j(!0)},[c]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`relative overflow-hidden rounded-md bg-muted cursor-pointer group ${o}`,onClick:v,role:"button",tabIndex:0,onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),v())},children:[e.jsx("img",{src:a,alt:l,className:`w-full h-full object-cover transition-all duration-500 ${u?"blur-0":"blur-md"} ${d}`,loading:"lazy"}),!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-muted/50",children:e.jsx(L,{className:"w-full h-full"})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100",children:e.jsx(Ve,{className:"w-8 h-8 text-white"})})]}),e.jsx(Z,{open:i,onOpenChange:j,children:e.jsxs(J,{className:"max-w-[95vw] max-h-[95vh] p-0 overflow-hidden bg-black/95 border-none",children:[e.jsx(X,{className:"sr-only",children:l}),e.jsxs("div",{className:"relative flex items-center justify-center min-h-[50vh]",children:[e.jsx("img",{src:n,alt:l,className:"max-w-full max-h-[90vh] object-contain"}),e.jsx(P,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 text-white hover:bg-white/20",onClick:()=>j(!1),children:e.jsx(K,{className:"h-6 w-6"})})]})]})})]})}function Me({photos:s,selectedIndex:n,onSelectPhoto:l,className:c=""}){const[d,o]=r.useState(!1),[a,x]=r.useState(0),u=r.useRef(null),f=r.useCallback(m=>{x(m),o(!0)},[]),i=r.useCallback(()=>{o(!1)},[]),j=r.useCallback(()=>{x(m=>m>0?m-1:s.length-1)},[s.length]),N=r.useCallback(()=>{x(m=>m<s.length-1?m+1:0)},[s.length]);if(r.useEffect(()=>{if(!d)return;const m=t=>{switch(t.key){case"Escape":i();break;case"ArrowLeft":j();break;case"ArrowRight":N();break}};return window.addEventListener("keydown",m),()=>window.removeEventListener("keydown",m)},[d,i,j,N]),s.length===0)return e.jsxs(D,{className:`${c}`,children:[e.jsx(T,{children:e.jsx(E,{className:"text-lg",children:"Photos"})}),e.jsx(F,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx(U,{className:"h-12 w-12 mb-4 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No photos available"})]})})]});const v=s[a];return e.jsxs(e.Fragment,{children:[e.jsxs(D,{className:`sticky top-4 ${c}`,children:[e.jsx(T,{className:"pb-3",children:e.jsxs(E,{className:"text-lg flex items-center justify-between",children:[e.jsxs("span",{children:["Photos (",s.length,")"]}),s.length>1&&e.jsx("span",{className:"text-sm font-normal text-muted-foreground",children:"Click to enlarge"})]})}),e.jsx(F,{children:e.jsx("div",{ref:u,className:"space-y-3 max-h-[calc(100vh-200px)] overflow-y-auto pr-1 scrollbar-thin",children:s.map((m,t)=>e.jsxs("div",{className:`relative rounded-lg overflow-hidden transition-all ${n===t?"ring-2 ring-primary ring-offset-2":""}`,onClick:()=>l?.(t),role:"button",tabIndex:0,onKeyDown:p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),l?.(t))},children:[e.jsx(He,{thumbnailSrc:m.thumbnailUrl,fullSrc:m.fullUrl,alt:m.alt,onClick:()=>f(t),containerClassName:"aspect-video"}),m.capturedAt&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:e.jsx("p",{className:"text-xs text-white",children:new Date(m.capturedAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})}),n===t&&e.jsx("div",{className:"absolute top-2 left-2 bg-primary text-primary-foreground text-xs px-2 py-1 rounded",children:"Selected"})]},m.id||t))})})]}),e.jsx(Z,{open:d,onOpenChange:o,children:e.jsxs(J,{className:"max-w-[98vw] max-h-[98vh] p-0 overflow-hidden bg-black/95 border-none",children:[e.jsx(X,{className:"sr-only",children:v?.alt||"Photo viewer"}),e.jsxs("div",{className:"relative flex items-center justify-center min-h-[60vh]",children:[v&&e.jsx("img",{src:v.fullUrl,alt:v.alt,className:"max-w-full max-h-[90vh] object-contain"}),e.jsx(P,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 text-white hover:bg-white/20 z-50",onClick:i,children:e.jsx(K,{className:"h-6 w-6"})}),s.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"ghost",size:"icon",className:"absolute left-4 top-1/2 -translate-y-1/2 text-white hover:bg-white/20 h-12 w-12",onClick:j,children:e.jsx(de,{className:"h-8 w-8"})}),e.jsx(P,{variant:"ghost",size:"icon",className:"absolute right-4 top-1/2 -translate-y-1/2 text-white hover:bg-white/20 h-12 w-12",onClick:N,children:e.jsx(be,{className:"h-8 w-8"})})]}),s.length>1&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black/70 text-white px-4 py-2 rounded-full text-sm",children:[a+1," / ",s.length]}),v?.capturedAt&&e.jsx("div",{className:"absolute bottom-4 right-4 bg-black/70 text-white px-3 py-1.5 rounded text-sm",children:new Date(v.capturedAt).toLocaleString("en-US",{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})})]})]})})]})}const Ue=Ne,ee=r.createContext({}),Be=({...s})=>e.jsx(ee.Provider,{value:{name:s.name},children:e.jsx(ye,{...s})}),H=()=>{const s=r.useContext(ee),n=r.useContext(se),{getFieldState:l,formState:c}=Ce(),d=l(s.name,c);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:o}=n;return{id:o,name:s.name,formItemId:`${o}-form-item`,formDescriptionId:`${o}-form-item-description`,formMessageId:`${o}-form-item-message`,...d}},se=r.createContext({}),te=r.forwardRef(({className:s,...n},l)=>{const c=r.useId();return e.jsx(se.Provider,{value:{id:c},children:e.jsx("div",{ref:l,className:q("space-y-2",s),...n})})});te.displayName="FormItem";const ae=r.forwardRef(({className:s,...n},l)=>{const{error:c,formItemId:d}=H();return e.jsx(_,{ref:l,className:q(c&&"text-destructive",s),htmlFor:d,...n})});ae.displayName="FormLabel";const re=r.forwardRef(({...s},n)=>{const{error:l,formItemId:c,formDescriptionId:d,formMessageId:o}=H();return e.jsx(oe,{ref:n,id:c,"aria-describedby":l?`${d} ${o}`:`${d}`,"aria-invalid":!!l,...s})});re.displayName="FormControl";const Oe=r.forwardRef(({className:s,...n},l)=>{const{formDescriptionId:c}=H();return e.jsx("p",{ref:l,id:c,className:q("text-sm text-muted-foreground",s),...n})});Oe.displayName="FormDescription";const ne=r.forwardRef(({className:s,children:n,...l},c)=>{const{error:d,formMessageId:o}=H(),a=d?String(d?.message??""):n;return a?e.jsx("p",{ref:c,id:o,className:q("text-sm font-medium text-destructive",s),...l,children:a}):null});ne.displayName="FormMessage";const We=Ie({floors:k().min(1).max(5),verticalHorizontalSurfaces:k().min(1).max(5),ceiling:k().min(1).max(5),restrooms:k().min(1).max(5),customerSatisfaction:k().min(1).max(5),trash:k().min(1).max(5),projectCleaning:k().min(1).max(5),activitySupport:k().min(1).max(5),safetyCompliance:k().min(1).max(5),equipment:k().min(1).max(5),monitoring:k().min(1).max(5),notes:De().optional()});function I({name:s,label:n,value:l,onChange:c,criteria:d}){const[o,a]=r.useState(null),x=o??l??-1,u=x>0?Te[x-1]:null;return e.jsxs("div",{className:"space-y-3",children:[e.jsx(_,{htmlFor:s,children:n}),e.jsx("div",{className:"flex items-center gap-1",children:[1,2,3,4,5].map(f=>e.jsx("button",{type:"button",onClick:()=>c(f),onMouseEnter:()=>a(f),onMouseLeave:()=>a(null),className:"p-1 hover:scale-110 transition-transform focus:outline-none focus-visible:ring-2 focus-visible:ring-primary rounded","aria-label":`Rate ${f} star${f!==1?"s":""}`,children:e.jsx(Ee,{className:`w-6 h-6 transition-colors ${f<=x?"fill-yellow-400 text-yellow-400":"text-gray-300 hover:text-yellow-200"}`})},f))}),u&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:u.label}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.description})]}),d&&x>0&&d[x]&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Detailed Criteria:"}),e.jsx("p",{className:"text-sm text-blue-800",children:d[x]})]})]})}function Ke({inspection:s,onComplete:n,isSubmitting:l,error:c}){const[d,o]=r.useState(!1),a=Se({resolver:ke(We),defaultValues:{floors:s.floors||void 0,verticalHorizontalSurfaces:s.verticalHorizontalSurfaces||void 0,ceiling:s.ceiling||void 0,restrooms:s.restrooms||void 0,customerSatisfaction:s.customerSatisfaction||void 0,trash:s.trash||void 0,projectCleaning:s.projectCleaning||void 0,activitySupport:s.activitySupport||void 0,safetyCompliance:s.safetyCompliance||void 0,equipment:s.equipment||void 0,monitoring:s.monitoring||void 0,notes:s.notes||""}});r.useEffect(()=>{s&&a.reset({floors:s.floors||void 0,verticalHorizontalSurfaces:s.verticalHorizontalSurfaces||void 0,ceiling:s.ceiling||void 0,restrooms:s.restrooms||void 0,customerSatisfaction:s.customerSatisfaction||void 0,trash:s.trash||void 0,projectCleaning:s.projectCleaning||void 0,activitySupport:s.activitySupport||void 0,safetyCompliance:s.safetyCompliance||void 0,equipment:s.equipment||void 0,monitoring:s.monitoring||void 0,notes:s.notes||s.quickNotes||""})},[s,a]);const x=i=>{n(i)},u=i=>Pe.find(N=>N.key===i)?.criteria,f=s.quickNotes&&s.quickNotes.length>0;return e.jsxs(D,{children:[e.jsxs(T,{children:[e.jsx(E,{children:"Complete Inspection"}),e.jsx(A,{children:"Review the photos and rate all categories for this inspection."})]}),d&&e.jsx("div",{className:"px-6 pb-4",children:e.jsxs(R,{className:"bg-green-50 border-green-200",children:[e.jsx(Y,{className:"h-4 w-4 text-green-600"}),e.jsx(z,{className:"text-green-800",children:"Inspection completed successfully!"})]})}),c&&e.jsx("div",{className:"px-6 pb-4",children:e.jsxs(R,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(z,{children:c})]})}),f&&e.jsx("div",{className:"px-6 pb-4",children:e.jsxs("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:[e.jsx("h4",{className:"text-sm font-medium text-amber-900 mb-2",children:"Quick Notes (from field capture)"}),e.jsx("p",{className:"text-sm text-amber-800",children:s.quickNotes})]})}),e.jsx(Ue,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(x),children:[e.jsxs(F,{className:"space-y-8",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Inspection Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"School:"})," ",e.jsx("span",{className:"font-medium",children:s.school})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Location:"})," ",e.jsx("span",{className:"font-medium",children:s.locationDescription})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Room:"})," ",e.jsx("span",{className:"font-medium",children:s.roomNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Captured:"})," ",e.jsx("span",{className:"font-medium",children:s.captureTimestamp?new Date(s.captureTimestamp).toLocaleDateString():new Date(s.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("h3",{className:"font-medium text-lg border-b pb-2",children:"Ratings"}),e.jsx(I,{name:"floors",label:"Floors",value:a.watch("floors")||-1,onChange:i=>a.setValue("floors",i,{shouldValidate:!0}),criteria:u("floors")}),e.jsx(I,{name:"verticalHorizontalSurfaces",label:"Vertical and Horizontal Surfaces",value:a.watch("verticalHorizontalSurfaces")||-1,onChange:i=>a.setValue("verticalHorizontalSurfaces",i,{shouldValidate:!0}),criteria:u("verticalHorizontalSurfaces")}),e.jsx(I,{name:"ceiling",label:"Ceiling",value:a.watch("ceiling")||-1,onChange:i=>a.setValue("ceiling",i,{shouldValidate:!0}),criteria:u("ceiling")}),e.jsx(I,{name:"restrooms",label:"Restrooms",value:a.watch("restrooms")||-1,onChange:i=>a.setValue("restrooms",i,{shouldValidate:!0}),criteria:u("restrooms")}),e.jsx(I,{name:"customerSatisfaction",label:"Customer Satisfaction",value:a.watch("customerSatisfaction")||-1,onChange:i=>a.setValue("customerSatisfaction",i,{shouldValidate:!0}),criteria:u("customerSatisfaction")}),e.jsx(I,{name:"trash",label:"Trash",value:a.watch("trash")||-1,onChange:i=>a.setValue("trash",i,{shouldValidate:!0}),criteria:u("trash")}),e.jsx(I,{name:"projectCleaning",label:"Project Cleaning",value:a.watch("projectCleaning")||-1,onChange:i=>a.setValue("projectCleaning",i,{shouldValidate:!0}),criteria:u("projectCleaning")}),e.jsx(I,{name:"activitySupport",label:"Activity Support",value:a.watch("activitySupport")||-1,onChange:i=>a.setValue("activitySupport",i,{shouldValidate:!0}),criteria:u("activitySupport")}),e.jsx(I,{name:"safetyCompliance",label:"Safety Compliance",value:a.watch("safetyCompliance")||-1,onChange:i=>a.setValue("safetyCompliance",i,{shouldValidate:!0}),criteria:u("safetyCompliance")}),e.jsx(I,{name:"equipment",label:"Equipment",value:a.watch("equipment")||-1,onChange:i=>a.setValue("equipment",i,{shouldValidate:!0}),criteria:u("equipment")}),e.jsx(I,{name:"monitoring",label:"Monitoring",value:a.watch("monitoring")||-1,onChange:i=>a.setValue("monitoring",i,{shouldValidate:!0}),criteria:u("monitoring")})]}),e.jsx("div",{className:"space-y-3",children:e.jsx(Be,{control:a.control,name:"notes",render:({field:i})=>e.jsxs(te,{children:[e.jsx(ae,{children:"Detailed Notes"}),e.jsx(re,{children:e.jsx(Fe,{placeholder:"Enter any additional notes or observations...",className:"min-h-[120px]",...i})}),e.jsx(ne,{})]})})})]}),e.jsx(ce,{className:"flex justify-end gap-3 border-t pt-6",children:e.jsx(P,{type:"submit",disabled:l,className:"min-w-[140px]",children:l?e.jsxs(e.Fragment,{children:[e.jsx(Le,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):"Complete Inspection"})})]})})]})}function Qe(s){return!s.images||s.images.length===0?[]:s.images.map((n,l)=>({id:`${s.id}-${l}`,thumbnailUrl:n.includes("?")?`${n}&thumb=1`:`${n}?thumb=1`,fullUrl:n,alt:`Photo ${l+1} of ${s.locationDescription||"inspection"}`,capturedAt:s.captureTimestamp||s.createdAt}))}function Ge(){const[s,n]=r.useState(!1);return r.useEffect(()=>{const l=()=>{n(window.innerWidth>=1024)};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),s}function Ze(){const[s,n]=Q(),l=r.useMemo(()=>new URL(window.location.href).searchParams,[s]),c=r.useCallback(d=>{const o=new URL(window.location.href);Object.entries(d).forEach(([a,x])=>{x===null?o.searchParams.delete(a):o.searchParams.set(a,x)}),n(o.pathname+o.search)},[n]);return[l,c]}function ps(){Q();const[s,n]=Ze(),{toast:l}=O(),c=Ge(),d=s.get("id"),[o,a]=r.useState(null),[x,u]=r.useState(!1),{inspections:f,isLoading:i,error:j,completeInspection:N,discardInspection:v,isCompleting:m,completeError:t}=Re();r.useEffect(()=>{if(d&&f.length>0){const h=f.find(g=>g.id===parseInt(d,10));h?a(h):(l({title:"Inspection Not Found",description:"This inspection may have already been completed or discarded.",variant:"destructive"}),n({id:null}))}else d||a(null)},[d,f,n,l]);const p=h=>{n({id:h.id.toString()})},C=async h=>{if(!o)return;await N(o.id,h)&&(u(!0),setTimeout(()=>{u(!1),n({id:null})},2e3))},b=async h=>{await v(h)&&o?.id===h&&n({id:null})},S=()=>{n({id:null})},M=r.useMemo(()=>o?Qe(o):[],[o]);return c?x?e.jsx("div",{className:"container mx-auto p-6 max-w-4xl",children:e.jsx(D,{className:"border-green-200 bg-green-50",children:e.jsxs(F,{className:"py-12 text-center",children:[e.jsx(Y,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"Inspection Completed!"}),e.jsx("p",{className:"text-green-700",children:"The inspection has been successfully completed and saved."}),e.jsx(P,{onClick:()=>u(!1),className:"mt-6",variant:"outline",children:"Return to List"})]})})}):o?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(P,{variant:"outline",onClick:S,className:"mb-4",children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Back to Pending List"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Review Inspection"}),e.jsx(B,{variant:"secondary",children:o.school}),e.jsx(B,{variant:"outline",children:o.locationDescription})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-[400px_1fr] gap-6",children:[e.jsx("div",{className:"lg:h-fit",children:e.jsx(Me,{photos:M,className:"h-full"})}),e.jsx("div",{className:"min-w-0",children:i?e.jsxs(D,{children:[e.jsxs(T,{children:[e.jsx(L,{className:"h-6 w-1/3"}),e.jsx(L,{className:"h-4 w-1/2"})]}),e.jsx(F,{className:"space-y-4",children:[1,2,3,4,5].map(h=>e.jsx(L,{className:"h-12 w-full"},h))})]}):e.jsx(Ke,{inspection:o,onComplete:C,isSubmitting:m,error:t})})]})]}):e.jsxs("div",{className:"container mx-auto p-6 max-w-5xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Photo-First Review"}),e.jsx("p",{className:"text-muted-foreground",children:"Complete full inspections using photos captured in the field. Select an inspection to review and rate all categories."})]}),j&&e.jsxs(R,{variant:"destructive",className:"mb-6",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(z,{children:j})]}),e.jsx(qe,{inspections:f,isLoading:i,error:j,onReview:p,onDiscard:b}),e.jsxs(D,{className:"mt-6",children:[e.jsx(T,{children:e.jsxs(E,{className:"text-base flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"How Photo-First Review Works"]})}),e.jsx(F,{children:e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Field staff capture quick photos during their walks"}),e.jsx("li",{children:"Photos are automatically uploaded with location data"}),e.jsx("li",{children:"Office staff review photos and complete full ratings"}),e.jsx("li",{children:"Inspections are marked complete with both capture and completion timestamps"})]})})]})]}):e.jsx("div",{className:"container mx-auto p-4 max-w-4xl",children:e.jsxs(D,{children:[e.jsxs(T,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),"Desktop Only"]}),e.jsx(A,{children:"Photo-first review is optimized for desktop viewing"})]}),e.jsxs(F,{children:[e.jsxs(R,{children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(z,{children:"The photo-first review interface requires a larger screen for optimal viewing. Please access this feature from a desktop or laptop computer (1024px+ width)."})]}),e.jsxs("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:["Current width: ",typeof window<"u"?window.innerWidth:0,"px"]})]})]})})}export{ps as default};
