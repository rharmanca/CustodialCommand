import{i as I,S as a}from"./index-ClufJbUB-v6.js";import{r as _,j as l}from"./ui-gIZ64paP-v6.js";import{C as E}from"./chevron-right-CuSuMaYY-v6.js";import{a as T}from"./chevron-down-DcOdNfKy-v6.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=I("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=I("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]),g={DRAFT_INSPECTION:"custodial-draft-inspection",DRAFT_BUILDING_INSPECTION:"custodial-draft-building-inspection",DRAFT_CUSTODIAL_NOTE:"custodial-draft-custodial-note",USER_PREFERENCES:"custodial-user-preferences",LEGACY_INSPECTION_DRAFTS:"custodial_inspection_drafts",LEGACY_BUILDING_DRAFTS:"building_form_drafts"},d={MAX_DRAFT_SIZE:5*1024*1024,MAX_TOTAL_STORAGE:8*1024*1024,MAX_DRAFTS_PER_TYPE:10,IMAGE_QUALITY:.7,MAX_IMAGE_DIMENSIONS:{width:1200,height:1200}},h=()=>{let t=0;const r=a.keys();for(const o of r){const e=a.getItem(o);e&&(t+=e.length+o.length)}return t},D=t=>new Promise((r,o)=>{const e=document.createElement("canvas"),s=e.getContext("2d"),n=new Image;n.onload=()=>{const{width:m,height:f}=d.MAX_IMAGE_DIMENSIONS;let{width:c,height:i}=n;if(c>m||i>f){const p=Math.min(m/c,f/i);c*=p,i*=p}e.width=c,e.height=i,s==null||s.drawImage(n,0,0,c,i);const A=e.toDataURL("image/jpeg",d.IMAGE_QUALITY);r(A)},n.onerror=o,n.src=URL.createObjectURL(t)}),w=(t,r)=>{try{const o={data:r,timestamp:Date.now()},e=JSON.stringify(o);if(e.length>d.MAX_DRAFT_SIZE){console.warn(`Draft too large (${Math.round(e.length/1024)}KB). Skipping save.`);return}if(h()+e.length>d.MAX_TOTAL_STORAGE&&(S(),h()+e.length>d.MAX_TOTAL_STORAGE)){console.warn("Storage limit reached. Cannot save draft.");return}a.setItem(t,e)}catch(o){if(console.error("Failed to save draft to localStorage:",o),o instanceof Error&&o.name==="QuotaExceededError"){S();try{a.setItem(t,JSON.stringify({data:r,timestamp:Date.now()}))}catch(e){console.error("Failed to save draft even after cleanup:",e)}}}},L=t=>{try{const r=a.getItem(t);if(!r)return null;const o=JSON.parse(r);return Date.now()-o.timestamp>10080*60*1e3?(a.removeItem(t),null):o.data}catch(r){return console.error("Failed to load draft from localStorage:",r),null}},O=t=>{try{a.removeItem(t)}catch(r){console.error("Failed to clear draft from localStorage:",r)}},S=()=>{try{const t=Date.now()-6048e5,r=[],o=a.keys();for(const e of o)if(e.startsWith("custodial-"))try{const s=a.getItem(e);if(s){const n=JSON.parse(s);n.timestamp&&n.timestamp<t&&r.push(e)}}catch{r.push(e)}r.forEach(e=>a.removeItem(e)),console.log(`Cleaned up ${r.length} old drafts`)}catch(t){console.error("Failed to cleanup old drafts:",t)}},F=()=>{try{a.getItem(g.LEGACY_INSPECTION_DRAFTS)&&(console.log("Migrating legacy inspection drafts..."),a.removeItem(g.LEGACY_INSPECTION_DRAFTS)),a.getItem(g.LEGACY_BUILDING_DRAFTS)&&(console.log("Migrating legacy building inspection drafts..."),a.removeItem(g.LEGACY_BUILDING_DRAFTS)),S()}catch(t){console.error("Failed to migrate legacy drafts:",t)}},x=async t=>{try{return t.size<500*1024?new Promise((r,o)=>{const e=new FileReader;e.onload=()=>r(e.result),e.onerror=o,e.readAsDataURL(t)}):await D(t)}catch(r){throw console.error("Failed to process image for storage:",r),r}},G=()=>{const t=h(),r=a.keys().filter(o=>o.startsWith("custodial-")).length;return{totalSizeKB:Math.round(t/1024),totalSizeMB:Math.round(t/(1024*1024)*100)/100,draftCount:r,limitMB:Math.round(d.MAX_TOTAL_STORAGE/(1024*1024)),usagePercent:Math.round(t/d.MAX_TOTAL_STORAGE*100)}};function u(...t){return t.filter(Boolean).join(" ")}function j({title:t,children:r,defaultCollapsed:o=!0,className:e,titleClassName:s,contentClassName:n,disabled:m=!1}){const[f,c]=_.useState(o),i=()=>{m||c(!f)};return l.jsxs("div",{className:u("border border-gray-200 rounded-lg overflow-hidden",e||""),children:[l.jsxs("button",{type:"button",onClick:i,disabled:m,className:u("w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer",m?"cursor-not-allowed opacity-50":"",s||""),children:[l.jsx("span",{className:"text-base",children:t}),f?l.jsx(E,{className:"w-5 h-5 transition-transform duration-200"}):l.jsx(T,{className:"w-5 h-5 transition-transform duration-200"})]}),l.jsx("div",{className:u("transition-all duration-300 ease-in-out overflow-hidden",f?"max-h-0":"max-h-[2000px]"),children:l.jsx("div",{className:u("p-4 pt-0",n||""),children:r})})]})}export{j as C,C as H,g as S,v as a,O as c,G as g,L as l,F as m,x as p,w as s};
//# sourceMappingURL=collapsible-section-BB7UCmQw-v6.js.map
