{"version":3,"file":"collapsible-section-S5iIaJr_-v6.js","sources":["../../../node_modules/lucide-react/dist/esm/icons/camera.js","../../../src/utils/storage.ts","../../../src/components/ui/collapsible-section.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.453.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Camera = createLucideIcon(\"Camera\", [\n  [\n    \"path\",\n    {\n      d: \"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z\",\n      key: \"1tc9qg\"\n    }\n  ],\n  [\"circle\", { cx: \"12\", cy: \"13\", r: \"3\", key: \"1vg3eu\" }]\n]);\n\nexport { Camera as default };\n//# sourceMappingURL=camera.js.map\n","\n// Local storage utilities for offline functionality\n\nexport const STORAGE_KEYS = {\n  DRAFT_INSPECTION: 'custodial-draft-inspection',\n  DRAFT_BUILDING_INSPECTION: 'custodial-draft-building-inspection',\n  DRAFT_CUSTODIAL_NOTE: 'custodial-draft-custodial-note',\n  USER_PREFERENCES: 'custodial-user-preferences',\n  // Legacy keys for migration\n  LEGACY_INSPECTION_DRAFTS: 'custodial_inspection_drafts',\n  LEGACY_BUILDING_DRAFTS: 'building_form_drafts'\n} as const;\n\n// Storage limits to prevent memory issues\nconst STORAGE_LIMITS = {\n  MAX_DRAFT_SIZE: 5 * 1024 * 1024, // 5MB per draft\n  MAX_TOTAL_STORAGE: 8 * 1024 * 1024, // 8MB total across all drafts\n  MAX_DRAFTS_PER_TYPE: 10, // Maximum drafts per inspection type\n  IMAGE_QUALITY: 0.7, // JPEG compression quality\n  MAX_IMAGE_DIMENSIONS: { width: 1200, height: 1200 } // Resize large images\n} as const;\n\n// Check storage usage\nconst getStorageSize = (): number => {\n  let total = 0;\n  for (const key in localStorage) {\n    if (localStorage.hasOwnProperty(key)) {\n      total += localStorage[key].length + key.length;\n    }\n  }\n  return total;\n};\n\n// Compress images before storage\nconst compressImage = (file: File): Promise<string> => {\n  return new Promise((resolve, reject) => {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    const img = new Image();\n    \n    img.onload = () => {\n      const { width: maxWidth, height: maxHeight } = STORAGE_LIMITS.MAX_IMAGE_DIMENSIONS;\n      let { width, height } = img;\n      \n      // Calculate new dimensions maintaining aspect ratio\n      if (width > maxWidth || height > maxHeight) {\n        const ratio = Math.min(maxWidth / width, maxHeight / height);\n        width *= ratio;\n        height *= ratio;\n      }\n      \n      canvas.width = width;\n      canvas.height = height;\n      ctx?.drawImage(img, 0, 0, width, height);\n      \n      const compressedDataUrl = canvas.toDataURL('image/jpeg', STORAGE_LIMITS.IMAGE_QUALITY);\n      resolve(compressedDataUrl);\n    };\n    \n    img.onerror = reject;\n    img.src = URL.createObjectURL(file);\n  });\n};\n\nexport const saveDraft = (key: string, data: any): void => {\n  try {\n    const draftData = { data, timestamp: Date.now() };\n    const serialized = JSON.stringify(draftData);\n    \n    // Check draft size limit\n    if (serialized.length > STORAGE_LIMITS.MAX_DRAFT_SIZE) {\n      console.warn(`Draft too large (${Math.round(serialized.length / 1024)}KB). Skipping save.`);\n      return;\n    }\n    \n    // Check total storage limit\n    const currentSize = getStorageSize();\n    if (currentSize + serialized.length > STORAGE_LIMITS.MAX_TOTAL_STORAGE) {\n      // Try to clean up old drafts\n      cleanupOldDrafts();\n      \n      // Check again after cleanup\n      if (getStorageSize() + serialized.length > STORAGE_LIMITS.MAX_TOTAL_STORAGE) {\n        console.warn('Storage limit reached. Cannot save draft.');\n        return;\n      }\n    }\n    \n    localStorage.setItem(key, serialized);\n  } catch (error) {\n    console.error('Failed to save draft to localStorage:', error);\n    // If quota exceeded, try cleaning up and retry once\n    if (error instanceof Error && error.name === 'QuotaExceededError') {\n      cleanupOldDrafts();\n      try {\n        localStorage.setItem(key, JSON.stringify({ data, timestamp: Date.now() }));\n      } catch (retryError) {\n        console.error('Failed to save draft even after cleanup:', retryError);\n      }\n    }\n  }\n};\n\nexport const loadDraft = (key: string): any | null => {\n  try {\n    const stored = localStorage.getItem(key);\n    if (!stored) return null;\n    \n    const parsed = JSON.parse(stored);\n    // Remove drafts older than 7 days\n    if (Date.now() - parsed.timestamp > 7 * 24 * 60 * 60 * 1000) {\n      localStorage.removeItem(key);\n      return null;\n    }\n    \n    return parsed.data;\n  } catch (error) {\n    console.error('Failed to load draft from localStorage:', error);\n    return null;\n  }\n};\n\nexport const clearDraft = (key: string): void => {\n  try {\n    localStorage.removeItem(key);\n  } catch (error) {\n    console.error('Failed to clear draft from localStorage:', error);\n  }\n};\n\n// Clean up old drafts and manage storage limits\nexport const cleanupOldDrafts = (): void => {\n  try {\n    const cutoffTime = Date.now() - (7 * 24 * 60 * 60 * 1000); // 7 days ago\n    const keysToRemove: string[] = [];\n    \n    // Find old drafts\n    for (const key in localStorage) {\n      if (localStorage.hasOwnProperty(key) && key.startsWith('custodial-')) {\n        try {\n          const stored = localStorage.getItem(key);\n          if (stored) {\n            const parsed = JSON.parse(stored);\n            if (parsed.timestamp && parsed.timestamp < cutoffTime) {\n              keysToRemove.push(key);\n            }\n          }\n        } catch (e) {\n          // Invalid JSON, remove it\n          keysToRemove.push(key);\n        }\n      }\n    }\n    \n    // Remove old drafts\n    keysToRemove.forEach(key => localStorage.removeItem(key));\n    \n    console.log(`Cleaned up ${keysToRemove.length} old drafts`);\n  } catch (error) {\n    console.error('Failed to cleanup old drafts:', error);\n  }\n};\n\n// Migrate legacy draft storage to new system\nexport const migrateLegacyDrafts = (): void => {\n  try {\n    // Migrate old inspection drafts\n    const oldInspectionDrafts = localStorage.getItem(STORAGE_KEYS.LEGACY_INSPECTION_DRAFTS);\n    if (oldInspectionDrafts) {\n      console.log('Migrating legacy inspection drafts...');\n      localStorage.removeItem(STORAGE_KEYS.LEGACY_INSPECTION_DRAFTS);\n    }\n    \n    // Migrate old building drafts\n    const oldBuildingDrafts = localStorage.getItem(STORAGE_KEYS.LEGACY_BUILDING_DRAFTS);\n    if (oldBuildingDrafts) {\n      console.log('Migrating legacy building inspection drafts...');\n      localStorage.removeItem(STORAGE_KEYS.LEGACY_BUILDING_DRAFTS);\n    }\n    \n    // Run initial cleanup\n    cleanupOldDrafts();\n  } catch (error) {\n    console.error('Failed to migrate legacy drafts:', error);\n  }\n};\n\n// Image processing utilities for drafts\nexport const processImageForStorage = async (file: File): Promise<string> => {\n  try {\n    // If image is small enough, use original\n    if (file.size < 500 * 1024) { // < 500KB\n      return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = () => resolve(reader.result as string);\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n      });\n    }\n    \n    // Compress larger images\n    return await compressImage(file);\n  } catch (error) {\n    console.error('Failed to process image for storage:', error);\n    throw error;\n  }\n};\n\n// Get storage statistics\nexport const getStorageStats = () => {\n  const totalSize = getStorageSize();\n  const draftCount = Object.keys(localStorage).filter(key => key.startsWith('custodial-')).length;\n  \n  return {\n    totalSizeKB: Math.round(totalSize / 1024),\n    totalSizeMB: Math.round(totalSize / (1024 * 1024) * 100) / 100,\n    draftCount,\n    limitMB: Math.round(STORAGE_LIMITS.MAX_TOTAL_STORAGE / (1024 * 1024)),\n    usagePercent: Math.round((totalSize / STORAGE_LIMITS.MAX_TOTAL_STORAGE) * 100)\n  };\n};\n\nexport const clearAllDrafts = (): void => {\n  Object.values(STORAGE_KEYS).forEach(key => {\n    clearDraft(key);\n  });\n};\n","import React, { useState } from 'react';\nimport { ChevronDown, ChevronRight } from 'lucide-react';\n\ninterface CollapsibleSectionProps {\n  title: string;\n  children: React.ReactNode;\n  defaultCollapsed?: boolean;\n  className?: string;\n  titleClassName?: string;\n  contentClassName?: string;\n  disabled?: boolean;\n}\n\nfunction classNames(...classes: string[]) {\n  return classes.filter(Boolean).join(' ');\n}\n\nexport function CollapsibleSection({\n  title,\n  children,\n  defaultCollapsed = true,\n  className,\n  titleClassName,\n  contentClassName,\n  disabled = false\n}: CollapsibleSectionProps) {\n  const [isCollapsed, setIsCollapsed] = useState(defaultCollapsed);\n\n  const toggleCollapsed = () => {\n    if (!disabled) {\n      setIsCollapsed(!isCollapsed);\n    }\n  };\n\n  return (\n    <div className={classNames(\"border border-gray-200 rounded-lg overflow-hidden\", className || \"\")}>\n      <button\n        type=\"button\"\n        onClick={toggleCollapsed}\n        disabled={disabled}\n        className={classNames(\n          \"w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer\",\n          disabled ? \"cursor-not-allowed opacity-50\" : \"\",\n          titleClassName || \"\"\n        )}\n      >\n        <span className=\"text-base\">{title}</span>\n        {isCollapsed ? (\n          <ChevronRight className=\"w-5 h-5 transition-transform duration-200\" />\n        ) : (\n          <ChevronDown className=\"w-5 h-5 transition-transform duration-200\" />\n        )}\n      </button>\n      \n      <div\n        className={classNames(\n          \"transition-all duration-300 ease-in-out overflow-hidden\",\n          isCollapsed ? \"max-h-0\" : \"max-h-[2000px]\"\n        )}\n      >\n        <div className={classNames(\"p-4 pt-0\", contentClassName || \"\")}>\n          {children}\n        </div>\n      </div>\n    </div>\n  );\n}"],"names":["Camera","createLucideIcon","STORAGE_KEYS","STORAGE_LIMITS","getStorageSize","total","key","compressImage","file","resolve","reject","canvas","ctx","img","maxWidth","maxHeight","width","height","ratio","compressedDataUrl","saveDraft","data","draftData","serialized","cleanupOldDrafts","error","retryError","loadDraft","stored","parsed","clearDraft","cutoffTime","keysToRemove","migrateLegacyDrafts","processImageForStorage","reader","getStorageStats","totalSize","draftCount","classNames","classes","CollapsibleSection","title","children","defaultCollapsed","className","titleClassName","contentClassName","disabled","isCollapsed","setIsCollapsed","useState","toggleCollapsed","jsxs","jsx","ChevronRight","ChevronDown"],"mappings":"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","x_google_ignoreList":[0]}