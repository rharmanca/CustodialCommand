var ls=Object.defineProperty,cs=Object.defineProperties;var ds=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable;var Te=(o,i,t)=>i in o?ls(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,T=(o,i)=>{for(var t in i||(i={}))Ie.call(i,t)&&Te(o,t,i[t]);if(ie)for(var t of ie(i))ke.call(i,t)&&Te(o,t,i[t]);return o},I=(o,i)=>cs(o,ds(i));var Y=(o,i)=>{var t={};for(var n in o)Ie.call(o,n)&&i.indexOf(n)<0&&(t[n]=o[n]);if(o!=null&&ie)for(var n of ie(o))i.indexOf(n)<0&&ke.call(o,n)&&(t[n]=o[n]);return t};var J=(o,i,t)=>new Promise((n,l)=>{var h=p=>{try{f(t.next(p))}catch(v){l(v)}},x=p=>{try{f(t.throw(p))}catch(v){l(v)}},f=p=>p.done?n(p.value):Promise.resolve(p.value).then(h,x);f((t=t.apply(o,i)).next())});import{r as m,j as e,w as ms,_ as Be,x as us,v as ps,$ as xs,B as qe,a0 as hs,b as fs,y as V,z as gs,a1 as bs,a2 as js,a3 as vs,a4 as Ns,a5 as ys}from"./ui-BqtzBtHj-v6.js";import{m as ws,g as Cs,s as Ss,e as Pe,S as Ts,a as Is,b as ks,c as Ps,d as Ds,C as De,f as Es}from"./collapsible-section-B7qixoUz-v6.js";import{c as _s,B as D,C as _,h as A,i as se,u as As,d as Os,e as G,f as U,g as W}from"./index-BaYUFHT0-v6.js";import{L as $,I as L}from"./LoadingOverlay-C66DN95D-v6.js";import{T as Ee}from"./textarea-goZqq0ZK-v6.js";import{S as Fs}from"./separator-3IPEVzVw-v6.js";import{P as he}from"./scores-dashboard-DuAQqHLo-v6.js";import{C as Rs,a as $s,b as zs}from"./collapsible-BPj4fPej-v6.js";import{i as _e,r as ne}from"./rating-criteria-DCg5BUcG-v6.js";import{P as He,a as Me,b as Ge}from"./popover-CTFYECxd-v6.js";import{l as le,i as ce,o as Ls,B as Bs,p as qs,A as Hs,q as Ms,P as Gs,r as Us,s as Ys,D as Js,t as Vs,a as fe,H as Ws,c as Ae,f as Oe,h as Fe,U as Re,j as $e,L as Qs,u as Xs,v as Ks}from"./icons-CP4MPgx_-v6.js";import"./vendor-oOSsakeb-v6.js";import"./charts-ChLs-CWD-v6.js";import"./utils-Cj9wHvoQ-v6.js";import"./forms-Ba_dyWLB-v6.js";var[de,zt]=ms("Tooltip",[Be]),me=Be(),Ue="TooltipProvider",Zs=700,ge="tooltip.open",[et,ve]=de(Ue),Ye=o=>{const{__scopeTooltip:i,delayDuration:t=Zs,skipDelayDuration:n=300,disableHoverableContent:l=!1,children:h}=o,x=m.useRef(!0),f=m.useRef(!1),p=m.useRef(0);return m.useEffect(()=>{const v=p.current;return()=>window.clearTimeout(v)},[]),e.jsx(et,{scope:i,isOpenDelayedRef:x,delayDuration:t,onOpen:m.useCallback(()=>{window.clearTimeout(p.current),x.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>x.current=!0,n)},[n]),isPointerInTransitRef:f,onPointerInTransitChange:m.useCallback(v=>{f.current=v},[]),disableHoverableContent:l,children:h})};Ye.displayName=Ue;var te="Tooltip",[st,ue]=de(te),Je=o=>{const{__scopeTooltip:i,children:t,open:n,defaultOpen:l,onOpenChange:h,disableHoverableContent:x,delayDuration:f}=o,p=ve(te,o.__scopeTooltip),v=me(i),[b,N]=m.useState(null),C=us(),y=m.useRef(0),S=x!=null?x:p.disableHoverableContent,O=f!=null?f:p.delayDuration,E=m.useRef(!1),[r,k]=ps({prop:n,defaultProp:l!=null?l:!1,onChange:P=>{P?(p.onOpen(),document.dispatchEvent(new CustomEvent(ge))):p.onClose(),h==null||h(P)},caller:te}),g=m.useMemo(()=>r?E.current?"delayed-open":"instant-open":"closed",[r]),B=m.useCallback(()=>{window.clearTimeout(y.current),y.current=0,E.current=!1,k(!0)},[k]),z=m.useCallback(()=>{window.clearTimeout(y.current),y.current=0,k(!1)},[k]),re=m.useCallback(()=>{window.clearTimeout(y.current),y.current=window.setTimeout(()=>{E.current=!0,k(!0),y.current=0},O)},[O,k]);return m.useEffect(()=>()=>{y.current&&(window.clearTimeout(y.current),y.current=0)},[]),e.jsx(xs,I(T({},v),{children:e.jsx(st,{scope:i,contentId:C,open:r,stateAttribute:g,trigger:b,onTriggerChange:N,onTriggerEnter:m.useCallback(()=>{p.isOpenDelayedRef.current?re():B()},[p.isOpenDelayedRef,re,B]),onTriggerLeave:m.useCallback(()=>{S?z():(window.clearTimeout(y.current),y.current=0)},[z,S]),onOpen:B,onClose:z,disableHoverableContent:S,children:t})}))};Je.displayName=te;var be="TooltipTrigger",Ve=m.forwardRef((o,i)=>{const C=o,{__scopeTooltip:t}=C,n=Y(C,["__scopeTooltip"]),l=ue(be,t),h=ve(be,t),x=me(t),f=m.useRef(null),p=qe(i,f,l.onTriggerChange),v=m.useRef(!1),b=m.useRef(!1),N=m.useCallback(()=>v.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",N),[N]),e.jsx(hs,I(T({asChild:!0},x),{children:e.jsx(fs.button,I(T({"aria-describedby":l.open?l.contentId:void 0,"data-state":l.stateAttribute},n),{ref:p,onPointerMove:V(o.onPointerMove,y=>{y.pointerType!=="touch"&&!b.current&&!h.isPointerInTransitRef.current&&(l.onTriggerEnter(),b.current=!0)}),onPointerLeave:V(o.onPointerLeave,()=>{l.onTriggerLeave(),b.current=!1}),onPointerDown:V(o.onPointerDown,()=>{l.open&&l.onClose(),v.current=!0,document.addEventListener("pointerup",N,{once:!0})}),onFocus:V(o.onFocus,()=>{v.current||l.onOpen()}),onBlur:V(o.onBlur,l.onClose),onClick:V(o.onClick,l.onClose)}))}))});Ve.displayName=be;var tt="TooltipPortal",[Lt,rt]=de(tt,{forceMount:void 0}),Q="TooltipContent",We=m.forwardRef((o,i)=>{const t=rt(Q,o.__scopeTooltip),f=o,{forceMount:n=t.forceMount,side:l="top"}=f,h=Y(f,["forceMount","side"]),x=ue(Q,o.__scopeTooltip);return e.jsx(gs,{present:n||x.open,children:x.disableHoverableContent?e.jsx(Qe,I(T({side:l},h),{ref:i})):e.jsx(ot,I(T({side:l},h),{ref:i}))})}),ot=m.forwardRef((o,i)=>{const t=ue(Q,o.__scopeTooltip),n=ve(Q,o.__scopeTooltip),l=m.useRef(null),h=qe(i,l),[x,f]=m.useState(null),{trigger:p,onClose:v}=t,b=l.current,{onPointerInTransitChange:N}=n,C=m.useCallback(()=>{f(null),N(!1)},[N]),y=m.useCallback((S,O)=>{const E=S.currentTarget,r={x:S.clientX,y:S.clientY},k=ct(r,E.getBoundingClientRect()),g=dt(r,k),B=mt(O.getBoundingClientRect()),z=pt([...g,...B]);f(z),N(!0)},[N]);return m.useEffect(()=>()=>C(),[C]),m.useEffect(()=>{if(p&&b){const S=E=>y(E,b),O=E=>y(E,p);return p.addEventListener("pointerleave",S),b.addEventListener("pointerleave",O),()=>{p.removeEventListener("pointerleave",S),b.removeEventListener("pointerleave",O)}}},[p,b,y,C]),m.useEffect(()=>{if(x){const S=O=>{const E=O.target,r={x:O.clientX,y:O.clientY},k=(p==null?void 0:p.contains(E))||(b==null?void 0:b.contains(E)),g=!ut(r,x);k?C():g&&(C(),v())};return document.addEventListener("pointermove",S),()=>document.removeEventListener("pointermove",S)}},[p,b,x,v,C]),e.jsx(Qe,I(T({},o),{ref:h}))}),[at,it]=de(te,{isInside:!1}),nt=vs("TooltipContent"),Qe=m.forwardRef((o,i)=>{const N=o,{__scopeTooltip:t,children:n,"aria-label":l,onEscapeKeyDown:h,onPointerDownOutside:x}=N,f=Y(N,["__scopeTooltip","children","aria-label","onEscapeKeyDown","onPointerDownOutside"]),p=ue(Q,t),v=me(t),{onClose:b}=p;return m.useEffect(()=>(document.addEventListener(ge,b),()=>document.removeEventListener(ge,b)),[b]),m.useEffect(()=>{if(p.trigger){const C=y=>{const S=y.target;S!=null&&S.contains(p.trigger)&&b()};return window.addEventListener("scroll",C,{capture:!0}),()=>window.removeEventListener("scroll",C,{capture:!0})}},[p.trigger,b]),e.jsx(bs,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:h,onPointerDownOutside:x,onFocusOutside:C=>C.preventDefault(),onDismiss:b,children:e.jsxs(js,I(T(T({"data-state":p.stateAttribute},v),f),{ref:i,style:I(T({},f.style),{"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}),children:[e.jsx(nt,{children:n}),e.jsx(at,{scope:t,isInside:!0,children:e.jsx(Ns,{id:p.contentId,role:"tooltip",children:l||n})})]}))})});We.displayName=Q;var Xe="TooltipArrow",lt=m.forwardRef((o,i)=>{const x=o,{__scopeTooltip:t}=x,n=Y(x,["__scopeTooltip"]),l=me(t);return it(Xe,t).isInside?null:e.jsx(ys,I(T(T({},l),n),{ref:i}))});lt.displayName=Xe;function ct(o,i){const t=Math.abs(i.top-o.y),n=Math.abs(i.bottom-o.y),l=Math.abs(i.right-o.x),h=Math.abs(i.left-o.x);switch(Math.min(t,n,l,h)){case h:return"left";case l:return"right";case t:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function dt(o,i,t=5){const n=[];switch(i){case"top":n.push({x:o.x-t,y:o.y+t},{x:o.x+t,y:o.y+t});break;case"bottom":n.push({x:o.x-t,y:o.y-t},{x:o.x+t,y:o.y-t});break;case"left":n.push({x:o.x+t,y:o.y-t},{x:o.x+t,y:o.y+t});break;case"right":n.push({x:o.x-t,y:o.y-t},{x:o.x-t,y:o.y+t});break}return n}function mt(o){const{top:i,right:t,bottom:n,left:l}=o;return[{x:l,y:i},{x:t,y:i},{x:t,y:n},{x:l,y:n}]}function ut(o,i){const{x:t,y:n}=o;let l=!1;for(let h=0,x=i.length-1;h<i.length;x=h++){const f=i[h],p=i[x],v=f.x,b=f.y,N=p.x,C=p.y;b>n!=C>n&&t<(N-v)*(n-b)/(C-b)+v&&(l=!l)}return l}function pt(o){const i=o.slice();return i.sort((t,n)=>t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0),xt(i)}function xt(o){if(o.length<=1)return o.slice();const i=[];for(let n=0;n<o.length;n++){const l=o[n];for(;i.length>=2;){const h=i[i.length-1],x=i[i.length-2];if((h.x-x.x)*(l.y-x.y)>=(h.y-x.y)*(l.x-x.x))i.pop();else break}i.push(l)}i.pop();const t=[];for(let n=o.length-1;n>=0;n--){const l=o[n];for(;t.length>=2;){const h=t[t.length-1],x=t[t.length-2];if((h.x-x.x)*(l.y-x.y)>=(h.y-x.y)*(l.x-x.x))t.pop();else break}t.push(l)}return t.pop(),i.length===1&&t.length===1&&i[0].x===t[0].x&&i[0].y===t[0].y?i:i.concat(t)}var ht=Ye,ft=Je,gt=Ve,Ke=We;const bt=ht,ze=ft,Le=gt,je=m.forwardRef((l,n)=>{var h=l,{className:o,sideOffset:i=4}=h,t=Y(h,["className","sideOffset"]);return e.jsx(Ke,T({ref:n,sideOffset:i,className:_s("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",o)},t))});je.displayName=Ke.displayName;function ee({children:o,className:i="",title:t}){return e.jsxs("div",{className:`w-full max-w-full bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mx-2 sm:mx-0 ${i}`,children:[t&&e.jsx("div",{className:"px-4 sm:px-6 py-4 bg-gradient-to-r from-amber-100 to-orange-100 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-amber-900 leading-tight",children:t})}),e.jsx("div",{className:"p-4 sm:p-6 space-y-4",children:o})]})}function jt({categoryLabel:o,criteria:i}){return e.jsxs(He,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(D,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 ml-2 hover:bg-blue-100 rounded-full",type:"button",children:[e.jsx(le,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"sr-only",children:["View criteria for ",o]})]})}),e.jsx(Ge,{className:"w-96 max-h-96 overflow-y-auto",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold text-sm border-b pb-2",children:[o," - Rating Criteria"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(t=>e.jsx(_,{className:"border-l-4",style:{borderLeftColor:t>=4?"#10B981":t>=3?"#F59E0B":"#EF4444"},children:e.jsxs(A,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:Array.from({length:5},(n,l)=>e.jsx(ce,{className:`w-3 h-3 ${l<t?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},l))}),e.jsxs(se,{variant:"secondary",className:"text-xs",children:["Rating ",t]})]}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:i[t]})]})},t))})]})})]})}function vt({categoryLabel:o,criteria:i}){return e.jsxs(He,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"w-full mt-2 text-xs",type:"button",children:[e.jsx(le,{className:"h-3 w-3 mr-2"}),"View Rating Guide"]})}),e.jsx(Ge,{className:"w-80 max-h-80 overflow-y-auto",align:"center",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold text-sm border-b pb-2",children:[o," - Rating Criteria"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(t=>e.jsx(_,{className:"border-l-4",style:{borderLeftColor:t>=4?"#10B981":t>=3?"#F59E0B":"#EF4444"},children:e.jsxs(A,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:Array.from({length:5},(n,l)=>e.jsx(ce,{className:`w-3 h-3 ${l<t?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},l))}),e.jsxs(se,{variant:"secondary",className:"text-xs",children:["Rating ",t]})]}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:i[t]})]})},t))})]})})]})}function Bt({onBack:o}){const{isMobile:i}=As(),{toast:t}=Os();m.useEffect(()=>{const s=a=>{const c=a.target;c&&typeof c.closest=="function"&&c.closest("[data-radix-select-content]")&&(a.preventDefault(),a.stopPropagation())};return document.addEventListener("scroll",s,{passive:!1}),()=>{document.removeEventListener("scroll",s)}},[]);const n={exterior:2,gym_bleachers:1,classroom:3,cafeteria:1,utility_storage:1,admin_office:2,hallway:3,stairwell:2,restroom:2,staff_single_restroom:1},l={exterior:"Exterior",gym_bleachers:"Gym and Bleachers",classroom:"Classroom",cafeteria:"Cafeteria",utility_storage:"Utility Or Storage",admin_office:"Admin or Office Area",hallway:"Hallway",stairwell:"Stairwell",restroom:"Restroom",staff_single_restroom:"Staff or Single Restroom"},h={exterior:Vs,gym_bleachers:Js,classroom:Ys,cafeteria:Us,utility_storage:Gs,admin_office:Ms,hallway:Hs,stairwell:qs,restroom:Bs,staff_single_restroom:Ls},x=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[f,p]=m.useState(()=>{const s={};return Object.keys(n).forEach(a=>{s[a]=0}),s}),[v,b]=m.useState([]),[N,C]=m.useState(!1),[y,S]=m.useState(!1);m.useState([]);const[O,E]=m.useState(!1),[r,k]=m.useState({inspectorName:"",school:"",date:new Date().toISOString().split("T")[0],inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}),[g,B]=m.useState(null),[z,re]=m.useState(!1),[P,oe]=m.useState(null),[X,Ne]=m.useState(!1),[q,K]=m.useState({}),[ae,ye]=m.useState(null),[we,Ce]=m.useState(!1),[Z,Se]=m.useState(null);m.useEffect(()=>{re(Object.entries(n).every(([a,c])=>f[a]>=c))},[f]);const H=m.useMemo(()=>{const s=Object.values(n).reduce((w,F)=>w+F,0),a=Object.values(f).reduce((w,F)=>w+F,0),c=Object.entries(n).filter(([w,F])=>f[w]>=F).length,d=Object.entries(n).filter(([w,F])=>f[w]>0&&f[w]<F).length,u=Object.keys(n).length-c-d,j=s>0?Math.round(a/s*100):0;return{totalRequired:s,totalCompleted:a,completedCategories:c,inProgressCategories:d,notStartedCategories:u,overallPercentage:j,totalCategories:Object.keys(n).length}},[f,n]);m.useEffect(()=>{J(null,null,function*(){try{const c=yield fetch("/api/inspections?type=whole_building&incomplete=true");if(c.ok){const d=yield c.json();b(d),d.length>0&&C(!0)}}catch(c){console.error("Error loading available inspections:",c)}}),ws(),ss();const a=Cs();console.log("Building inspection storage stats:",a)},[]),m.useEffect(()=>{if(P&&g&&(r.inspectorName||r.school||r.date)){const s=setTimeout(()=>{es()},2e3);return()=>clearTimeout(s)}},[r,g,P]);const Ze=()=>`building_form_${P}_${g}_${Date.now()}`,es=()=>J(null,null,function*(){if(!(!P||!g)){Ce(!0);try{const s=Z||Ze();Z||Se(s);const a={id:s,buildingInspectionId:P,selectedCategory:g,formData:T({},r),lastModified:new Date().toISOString(),title:`${r.school} - Building - ${l[g]||g}`};Ss(`${Pe.DRAFT_BUILDING_INSPECTION}_${s}`,a),ye(new Date)}catch(s){console.error("Error saving form draft:",s)}finally{Ce(!1)}}}),ss=()=>{try{const s=localStorage.getItem("building_form_drafts");if(s){const a=JSON.parse(s),c=a.filter(d=>{const u=new Date(d.lastModified),j=new Date;return j.setDate(j.getDate()-7),u>j});c.length!==a.length&&localStorage.setItem("building_form_drafts",JSON.stringify(c))}}catch(s){console.error("Error loading form drafts:",s)}},ts=()=>{if(Z){Es(`${Pe.DRAFT_BUILDING_INSPECTION}_${Z}`);const s=JSON.parse(localStorage.getItem("building_form_drafts")||"[]"),a=s.filter(c=>c.id!==Z);a.length!==s.length&&localStorage.setItem("building_form_drafts",JSON.stringify(a)),Se(null),ye(null)}},rs=s=>J(null,null,function*(){try{oe(s.id);const a={inspectorName:s.inspectorName||"",school:s.school,date:s.date,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""};k(a);const c=yield fetch(`/api/inspections/${s.id}/rooms`);if(c.ok){const d=yield c.json(),u={};Object.keys(n).forEach(j=>{u[j]=d.filter(w=>w.roomType===j).length}),p(u),S(!0),C(!1)}}catch(a){console.error("Error loading inspection:",a)}}),pe=()=>{C(!1),S(!1),oe(null),p(()=>{const s={};return Object.keys(n).forEach(a=>{s[a]=0}),s}),k(s=>I(T({},s),{inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}))},R=(s,a)=>{k(c=>I(T({},c),{[s]:a}))},os=(s,a,c)=>{var d,u;return e.jsxs("div",{className:"space-y-4",children:[e.jsx(vt,{categoryLabel:s.label,criteria:s.criteria}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"Rate this category:"}),e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:[1,2,3,4,5].map(j=>e.jsx("button",{type:"button",className:"p-2 rounded-md hover:bg-yellow-50 transition-colors touch-manipulation",onClick:()=>c(j),children:e.jsx(ce,{className:`w-6 h-6 ${j<=a&&a>0?"fill-yellow-400 text-yellow-400":"text-muted-foreground hover:text-yellow-300"}`})},j))}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:`px-4 py-2 rounded-md border text-sm font-medium transition-colors touch-manipulation ${a===-1?"bg-muted border-border text-foreground":"bg-card border-border text-muted-foreground hover:bg-muted"}`,onClick:()=>c(-1),children:"Not Rated"})})]}),e.jsx("div",{className:"text-center",children:a>0&&a!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-base font-semibold text-yellow-600",children:(d=ne[a-1])==null?void 0:d.label}),e.jsx("div",{className:"text-sm text-gray-600",children:(u=ne[a-1])==null?void 0:u.description})]}):e.jsx("div",{className:"text-base font-semibold text-gray-600",children:"No rating selected"})}),a>0&&a!==-1&&(s==null?void 0:s.criteria)&&s.criteria[a]&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-1",children:["Detailed Criteria for ",a," Star",a>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:s.criteria[a]})]})]})},as=(s,a,c)=>{var d,u;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select Rating:"}),e.jsx(jt,{categoryLabel:s.label,criteria:s.criteria})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(D,{type:"button",variant:a===-1?"default":"outline",size:"sm",className:"px-3 py-2 text-xs",onClick:()=>c(-1),children:"Not Rated"}),[1,2,3,4,5].map(j=>e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:()=>c(j),children:e.jsx(ce,{className:`w-6 h-6 ${j<=a&&a>0?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},j))]}),e.jsx("div",{className:"text-center",children:a>0&&a!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:(d=ne[a-1])==null?void 0:d.label}),e.jsx("div",{className:"text-sm text-gray-600",children:(u=ne[a-1])==null?void 0:u.description})]}):e.jsx("div",{className:"text-lg font-semibold text-gray-600",children:"No rating selected"})}),a>0&&a!==-1&&(s==null?void 0:s.criteria)&&s.criteria[a]&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-2",children:["Detailed Criteria for ",a," Star",a>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:s.criteria[a]})]})]})},xe=s=>{const a=window.scrollY;B(s),C(!1),k(c=>I(T({},c),{roomNumber:"",locationDescription:"",locationCategory:s,floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""})),requestAnimationFrame(()=>{window.scrollTo({top:a,behavior:"instant"})}),setTimeout(()=>{window.scrollTo({top:a,behavior:"instant"})},10),setTimeout(()=>{window.scrollTo({top:a,behavior:"instant"})},50)},is=s=>J(null,null,function*(){if(s.preventDefault(),K({}),!g){t({title:"Category Required",description:"Please select a category before submitting.",variant:"destructive"});return}const c=["inspectorName","school","date","roomNumber"].filter(d=>!r[d]);if(c.length>0){const d={};c.forEach(u=>{d[u]=!0}),K(d),t({title:"Missing Required Fields",description:"Please fill in the highlighted fields",variant:"destructive"});return}Ne(!0);try{const d={inspectorName:r.inspectorName,school:r.school,date:r.date,inspectionType:"whole_building",locationDescription:r.locationDescription||`Building inspection for ${g}`,roomNumber:r.roomNumber||null,locationCategory:g,buildingName:null,buildingInspectionId:P||null,floors:r.floors>=0?r.floors:null,verticalHorizontalSurfaces:r.verticalHorizontalSurfaces>=0?r.verticalHorizontalSurfaces:null,ceiling:r.ceiling>=0?r.ceiling:null,restrooms:r.restrooms>=0?r.restrooms:null,customerSatisfaction:r.customerSatisfaction>=0?r.customerSatisfaction:null,trash:r.trash>=0?r.trash:null,projectCleaning:r.projectCleaning>=0?r.projectCleaning:null,activitySupport:r.activitySupport>=0?r.activitySupport:null,safetyCompliance:r.safetyCompliance>=0?r.safetyCompliance:null,equipment:r.equipment>=0?r.equipment:null,monitoring:r.monitoring>=0?r.monitoring:null,notes:r.notes||null,images:[],verifiedRooms:[],isCompleted:!1};console.log("Submitting building inspection:",d);const u=yield fetch("/api/submit-building-inspection",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(d)}),j=u.headers.get("content-type")||"";let w=null,F=null;try{j.includes("application/json")?w=yield u.json():F=yield u.text()}catch(M){try{F=yield u.text()}catch(Nt){}}if(console.log("Submission response status:",u.status,"ctype:",j),w&&console.log("Submission response JSON:",w),!w&&F&&console.log("Submission response TEXT:",F.slice(0,300)),!u.ok){const M=w&&(w.message||w.error)||F||null;throw new Error(M||`HTTP error! status: ${u.status}`)}if(w&&(w.success||w.id)||u.ok)K({}),t({title:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ks,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Room Inspection Saved!"})]}),description:`${l[g]} room ${r.roomNumber} recorded successfully. Progress updated.`,className:"border-green-500 bg-green-50"}),w&&w.id&&!P&&(console.log("Setting buildingInspectionId from first submission:",w.id),oe(w.id)),g&&p(M=>I(T({},M),{[g]:(M[g]||0)+1})),ts(),k(M=>I(T({},M),{roomNumber:"",locationDescription:"",notes:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1})),B(null);else throw new Error(w.message||"Submission failed")}catch(d){console.error("Building inspection submission error:",d);let u="Failed to save inspection. Please check your connection and try again.";d instanceof TypeError&&d.message.includes("fetch")?u="Network error. Please check your internet connection.":d instanceof Error&&(d.message.includes("404")?u="Server endpoint not found. Please contact support.":d.message.includes("500")?u="Server error. Please try again later.":d.message&&d.message!=="Submission failed"&&(u=d.message)),t({title:"Submission Failed",description:u,variant:"destructive"})}finally{Ne(!1)}}),ns=()=>J(null,null,function*(){if(!z){console.error("Please complete all required inspections before finalizing.");return}if(console.log("Attempting to finalize building inspection:",{buildingInspectionId:P,isAllComplete:z}),!P){console.error("No building inspection ID available for finalization"),t({title:"Finalization Failed",description:"No building inspection ID found. Please start a new inspection.",variant:"destructive"});return}try{console.log(`Calling finalize endpoint: /api/inspections/${P}/finalize`);const s=yield fetch(`/api/inspections/${P}/finalize`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}});console.log("Finalize response status:",s.status);let a=s.ok,c=null;if(!a){try{const u=yield s.json();c=u.error||u.message,console.log("Finalize endpoint error:",u)}catch(u){const j=yield s.text();console.log("Finalize endpoint error (text):",j.slice(0,200)),c=j}console.log(`Trying PATCH fallback: /api/inspections/${P}`);const d=yield fetch(`/api/inspections/${P}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({isCompleted:!0})});if(console.log("PATCH response status:",d.status),a=d.ok,!a){try{const u=yield d.json();c=u.error||u.message||"Failed to finalize inspection",console.log("PATCH endpoint error:",u)}catch(u){const j=yield d.text();console.log("PATCH endpoint error (text):",j.slice(0,200)),c=j||"Failed to finalize inspection"}throw new Error(c)}}E(!0),t({title:"ðŸŽ‰ Building Inspection Complete! ðŸŽ‰",description:"Excellent work! All required inspections submitted successfully. The building inspection is now finalized.",duration:5e3,className:"border-green-500 bg-green-50"}),console.log("Whole building inspection completed successfully!"),setTimeout(()=>{o&&o()},3e3)}catch(s){console.error("Error finalizing inspection:",s),t({title:"Finalization Failed",description:"Failed to finalize building inspection. Please try again.",variant:"destructive"})}});return e.jsx(bt,{children:e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl space-y-6",children:[!N&&e.jsx(_,{className:"border-primary/30",children:e.jsxs(A,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Start New Building Inspection"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Guided, step-by-step workflow to complete all required areas"})]}),e.jsx(D,{onClick:pe,size:"lg",className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg transition-shadow min-h-[44px]",children:"ðŸ¢ Start New Building Inspection"})]})}),O&&e.jsx(_,{className:"border-green-300 bg-green-50",children:e.jsxs(A,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-800",children:"Building Inspection Finalized"}),e.jsx("div",{className:"text-sm text-green-700",children:"Your comprehensive inspection has been submitted successfully."})]}),e.jsx(D,{onClick:()=>{E(!1),pe()},className:"bg-green-600 hover:bg-green-700 text-white",children:"Start New Building Inspection"})]})}),e.jsxs("div",{className:"mb-6",children:[o&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx(D,{variant:"outline",onClick:o,className:"flex-shrink-0 back-button",children:"â† Back"})}),e.jsx("div",{className:"flex justify-center px-4",children:e.jsxs(Rs,{className:"w-full max-w-lg",children:[e.jsx($s,{asChild:!0,children:e.jsx(D,{variant:"ghost",className:"w-full p-3 h-auto font-normal text-center text-primary hover:text-primary/80 hover:bg-accent/10 border border-accent/30 rounded-lg text-sm sm:text-base leading-relaxed",children:"ðŸ“‹ How to conduct a whole building inspection â†“"})}),e.jsx(zs,{className:"mt-3 p-4 bg-accent/10 rounded-lg border border-accent/30",children:e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 1: Getting Started"}),e.jsx("p",{children:"Enter your inspector name, select the school, and choose the inspection date. This information will be saved automatically."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 2: Complete Required Inspections"}),e.jsx("p",{children:'Each category below shows how many inspections are required (e.g., 3 Classrooms, 2 Restrooms). Click "Select" on any incomplete category to start inspecting that area type.'})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 3: Rate Each Area"}),e.jsx("p",{children:"For each room/area, rate the custodial performance using the 1-5 star system you're familiar with. Add room numbers and notes as needed."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 4: Track Progress"}),e.jsx("p",{children:"Your progress is saved automatically. Green checkmarks show completed categories. Return anytime to continue where you left off."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 5: Finalize"}),e.jsx("p",{children:'Once all required inspections are complete, the "Finalize Building Inspection" button will become available to submit your comprehensive inspection.'})]})]})})]})})]}),N&&e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Building Inspection Options"}),e.jsx(W,{children:"You can continue a previous inspection or start a new one"})]}),e.jsxs(A,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-lg",children:"Start New Inspection:"}),e.jsx(D,{onClick:pe,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 border-2 border-green-600 hover:border-green-700 rounded-lg shadow-md hover:shadow-xl transition-all duration-200 text-lg min-h-[56px]",variant:"default",size:"lg",children:"ðŸ¢ Start New Building Inspection"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Begin a fresh comprehensive building inspection"})]}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Fs,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Or Continue Previous Inspection:"}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto border-2 border-amber-300 rounded-lg p-3 bg-amber-25 shadow-inner",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-amber-200",children:[e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Available Inspections"}),e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:[v.length," found"]})]}),v.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-amber-100 bg-amber-50 border-amber-200 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded-full font-medium",children:["#",a+1]}),e.jsx("div",{className:"font-medium text-amber-900",children:s.school})]}),e.jsxs("div",{className:"text-sm text-amber-700 mt-1",children:[new Date(s.date).toLocaleDateString(),s.inspectorName&&e.jsxs("span",{className:"block text-sm text-amber-800 font-medium",children:["Inspector: ",s.inspectorName]})]})]}),s.isCompleted?e.jsx(se,{variant:"default",className:"bg-green-500",children:"Completed âœ“"}):e.jsx(D,{onClick:()=>rs(s),variant:"outline",size:"sm",className:"border-amber-400 text-amber-700 hover:bg-amber-100 font-medium",children:"Continue"})]},s.id)),v.length>3&&e.jsx("div",{className:"text-center py-2 border-t border-amber-200 mt-2",children:e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-3 py-1 rounded-full",children:["â†• Scroll to see all ",v.length," ","inspections"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"These inspections were started but not completed"})]})]})]})]}),!y&&!N&&e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Building Information"}),e.jsx(W,{children:"Select the school and date for this inspection"})]}),e.jsx(A,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"inspectorName",children:"Inspector Name *"}),e.jsx(L,{id:"inspectorName",value:r.inspectorName,onChange:s=>R("inspectorName",s.target.value),placeholder:"Enter inspector name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"school",children:"School"}),e.jsxs(Ts,{value:r.school,onValueChange:s=>R("school",s),children:[e.jsx(Is,{children:e.jsx(ks,{placeholder:"Select school"})}),e.jsx(Ps,{children:x.map(s=>e.jsx(Ds,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"date",children:"Date"}),e.jsx(L,{id:"date",type:"date",value:r.date,onChange:s=>R("date",s.target.value),required:!0})]})]})})]}),y&&e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Current Inspection"}),e.jsx(W,{children:"Continuing inspection progress"})]}),e.jsxs(A,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Inspector:"}),e.jsx("span",{children:r.inspectorName||"Not specified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"School:"}),e.jsx("span",{children:r.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{children:new Date(r.date).toLocaleDateString()})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(D,{onClick:()=>{C(!0),S(!1),oe(null)},variant:"outline",size:"sm",children:"Switch to Different Inspection"})})]})]}),!N&&(r.school||r.date||y)&&e.jsx(_,{className:"border-primary/20 bg-gradient-to-r from-primary/5 to-primary/10 animate-in fade-in-0 slide-in-from-top-4 duration-500",children:e.jsx(A,{className:"py-4",children:e.jsxs("div",{className:"space-y-4",role:"region","aria-label":"Overall inspection progress summary",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"Overall Progress"}),e.jsxs(ze,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(le,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(je,{className:"max-w-xs",children:e.jsx("p",{children:"Tracks completion across all required room categories. Complete all rooms in a category to mark it complete."})})]})]}),e.jsxs("span",{className:"text-2xl font-bold text-primary",children:[H.overallPercentage,"%"]})]}),e.jsx(he,{value:H.overallPercentage,className:"h-3 bg-primary/10 transition-all duration-700 ease-out","aria-label":`Overall progress: ${H.overallPercentage}% complete`}),e.jsxs("p",{className:"text-sm text-muted-foreground text-center","aria-live":"polite","aria-atomic":"true",children:[H.totalCompleted," of ",H.totalRequired," rooms inspected"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-2 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Complete"})]}),e.jsx("p",{className:"text-xl font-bold text-green-700",children:H.completedCategories})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"In Progress"})]}),e.jsx("p",{className:"text-xl font-bold text-amber-700",children:H.inProgressCategories})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Not Started"})]}),e.jsx("p",{className:"text-xl font-bold text-gray-600",children:H.notStartedCategories})]})]})]})})}),!N&&(r.school||r.date||y)&&e.jsx(_,{className:"animate-in fade-in-0 slide-in-from-top-4 duration-500 delay-75",children:e.jsx(A,{className:"py-3",children:e.jsxs("div",{className:"space-y-2",role:"navigation","aria-label":"Category quick jump navigation",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Quick Jump"}),e.jsxs(ze,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(le,{className:"w-3.5 h-3.5 text-muted-foreground cursor-help"})}),e.jsx(je,{className:"max-w-xs",children:e.jsx("p",{children:"Quickly switch between room categories. Green = complete, Amber = in progress, Gray = not started."})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Object.entries(n).map(([s,a])=>{const c=f[s],d=c>=a,u=c>0&&!d,j=h[s];return e.jsxs("button",{onClick:()=>{xe(s),window.scrollTo({top:0,behavior:"smooth"})},className:`flex-shrink-0 flex flex-col items-center gap-1 px-3 py-2 rounded-lg border-2 transition-all duration-200 ease-in-out hover:scale-105 active:scale-95 min-w-[80px] ${g===s?"border-blue-500 bg-blue-50 shadow-sm":d?"border-green-300 bg-green-50 hover:border-green-400":u?"border-amber-300 bg-amber-50 hover:border-amber-400":"border-gray-200 bg-white hover:border-gray-300"}`,disabled:!r.school||!r.date||!r.inspectorName.trim(),"aria-label":`Select ${l[s]} category. ${c} of ${a} rooms completed. ${d?"Complete":u?"In progress":"Not started"}.`,children:[j&&e.jsx(j,{className:`w-5 h-5 ${d?"text-green-600":u?"text-amber-600":"text-gray-500"}`}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:l[s].split(" ")[0]}),d&&e.jsx(fe,{className:"w-3 h-3 text-green-600"})]},s)})})]})})}),!N&&(i?e.jsxs(ee,{title:"Inspection Progress","data-inspection-progress":!0,children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Complete the required number of inspections for each category",r.school&&r.date&&e.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"(Progress is automatically saved)"})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(n).map(([s,a])=>{const c=f[s],d=c>=a,u=h[s];return e.jsx("div",{className:`p-4 rounded-lg border-l-4 border-y border-r ${d?"bg-green-50 border-l-green-500 border-y-green-200 border-r-green-200":g===s?"bg-blue-50 border-l-blue-500 border-y-blue-300 border-r-blue-300":c>0?"bg-amber-50 border-l-amber-500 border-y-amber-200 border-r-amber-200":"bg-gray-50 border-l-gray-300 border-y-gray-200 border-r-gray-200"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center flex-shrink-0 mt-0.5 ${d?"bg-green-500 border-green-500":"border-gray-400"}`,children:d&&e.jsx(fe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx(u,{className:`w-4 h-4 flex-shrink-0 ${d?"text-green-700":"text-gray-600"}`}),e.jsx("span",{className:`font-medium text-sm leading-tight ${d?"text-green-800":"text-gray-700"}`,children:l[s]})]}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(se,{variant:d?"default":"secondary",className:"text-xs",children:[c,"/",a," Done"]}),e.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[Math.round(c/a*100),"%"]})]}),e.jsx(he,{value:c/a*100,className:"h-2"}),!d&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(D,{size:"sm",variant:"outline",onClick:()=>xe(s),className:`text-xs px-3 min-h-[44px] w-full ${g===s?"border-blue-500 bg-blue-50 shadow-sm":""}`,children:"Select"})]})]})]})})},s)})})]}):e.jsxs(_,{"data-inspection-progress":!0,children:[e.jsxs(G,{children:[e.jsx(U,{children:"Inspection Progress"}),e.jsxs(W,{children:["Complete the required number of inspections for each category",r.school&&r.date&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Progress is automatically saved)"})]})]}),e.jsx(A,{className:"space-y-4",children:Object.entries(n).map(([s,a])=>{const c=f[s],d=c>=a,u=h[s];return e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border-l-4 border-y border-r ${d?"bg-green-50 border-l-green-500 border-y-green-200 border-r-green-200":g===s?"bg-blue-50 border-l-blue-500 border-y-blue-300 border-r-blue-300":c>0?"bg-amber-50 border-l-amber-500 border-y-amber-200 border-r-amber-200":"bg-gray-50 border-l-gray-300 border-y-gray-200 border-r-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center flex-shrink-0 ${d?"bg-green-500 border-green-500":"border-gray-400"}`,children:d&&e.jsx(fe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx(u,{className:`w-4 h-4 flex-shrink-0 ${d?"text-green-700":"text-gray-600"}`}),e.jsx("span",{className:`font-medium ${d?"text-green-800":"text-gray-700"}`,children:l[s]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(he,{value:c/a*100,className:"h-2 flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground font-medium whitespace-nowrap",children:[Math.round(c/a*100),"%"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs(se,{variant:d?"default":"secondary",children:[c,"/",a," Completed"]}),!d&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(D,{size:"sm",variant:"outline",onClick:()=>xe(s),className:`min-h-[44px] px-4 ${g===s?"border-blue-500 bg-blue-50 shadow-sm":""}`,children:"Select"})]})]},s)})})]})),!N&&g&&!(r.school&&r.date&&r.inspectorName.trim())&&e.jsx(_,{className:"border-amber-200 bg-amber-50",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:"Complete Required Information"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Please fill in all required fields above before you can start rating this category:"}),e.jsxs("ul",{className:"text-sm text-amber-700 mt-2 space-y-1",children:[!r.inspectorName.trim()&&e.jsx("li",{children:"â€¢ Inspector Name is required"}),!r.school&&e.jsx("li",{children:"â€¢ School selection is required"}),!r.date&&e.jsx("li",{children:"â€¢ Inspection date is required"})]})]})]})})}),!N&&g&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(_,{className:"bg-muted/30",children:e.jsx(A,{className:"py-3",children:e.jsxs("nav",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-medium text-foreground",children:r.school}),e.jsx(Ae,{className:"w-4 h-4 mx-2"}),e.jsx("span",{className:"font-medium text-foreground",children:l[g]}),r.roomNumber&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mx-2"}),e.jsxs("span",{className:"text-primary font-semibold",children:["Room ",r.roomNumber]})]})]})})}),!N&&g&&r.school&&r.date&&r.inspectorName.trim()&&e.jsxs("form",{onSubmit:is,className:`space-y-4 ${i?"":"space-y-6"}`,children:[i?e.jsxs(ee,{title:`Inspecting: ${l[g]}`,children:[ae&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-muted-foreground",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",ae.toLocaleTimeString()]})]}),we&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-blue-600",children:[e.jsx(Fe,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"roomNumber",className:`text-base font-medium ${q.roomNumber?"text-destructive":""}`,children:"Room Number *"}),e.jsx(L,{id:"roomNumber",className:`h-12 text-base ${q.roomNumber?"border-destructive focus-visible:ring-destructive":""}`,value:r.roomNumber,onChange:s=>{R("roomNumber",s.target.value),q.roomNumber&&K(a=>I(T({},a),{roomNumber:!1}))},placeholder:"Enter room number",required:!0}),q.roomNumber&&e.jsx("p",{className:"text-sm text-destructive",children:"Room number is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"locationDescription",className:"text-base font-medium",children:"Location Description"}),e.jsx(L,{id:"locationDescription",className:"h-12 text-base",value:r.locationDescription,onChange:s=>R("locationDescription",s.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})]}):e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsxs(U,{children:["Inspecting: ",l[g]]}),e.jsxs(W,{children:["Complete the inspection for this category",ae&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",ae.toLocaleTimeString()]})]}),we&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-blue-600",children:[e.jsx(Fe,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]})]})]}),e.jsx(A,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"roomNumber",className:q.roomNumber?"text-destructive":"",children:"Room Number *"}),e.jsx(L,{id:"roomNumber",className:q.roomNumber?"border-destructive focus-visible:ring-destructive":"",value:r.roomNumber,onChange:s=>{R("roomNumber",s.target.value),q.roomNumber&&K(a=>I(T({},a),{roomNumber:!1}))},placeholder:"Enter room number",required:!0}),q.roomNumber&&e.jsx("p",{className:"text-sm text-destructive",children:"Room number is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"locationDescription",children:"Location Description"}),e.jsx(L,{id:"locationDescription",value:r.locationDescription,onChange:s=>R("locationDescription",s.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})})]}),i?e.jsx(ee,{title:"Rate Each Category",children:e.jsx("div",{className:"space-y-4",children:_e.map((s,a)=>e.jsx(De,{title:s.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:os(s,r[s.key],c=>R(s.key,c))},s.key))})}):e.jsx("div",{className:"grid gap-4 grid-cols-1 lg:grid-cols-2",children:_e.map((s,a)=>{const c=s.key;return e.jsx(De,{title:s.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:as(s,r[c],d=>R(c,d))},s.key)})}),i?e.jsx(ee,{title:"Additional Notes",children:e.jsx(Ee,{value:r.notes,onChange:s=>R("notes",s.target.value),placeholder:"Enter any additional observations...",rows:4,className:"text-base min-h-[120px]"})}):e.jsxs(_,{children:[e.jsx(G,{children:e.jsx(U,{children:"Additional Notes"})}),e.jsx(A,{children:e.jsx(Ee,{value:r.notes,onChange:s=>R("notes",s.target.value),placeholder:"Enter any additional observations...",rows:4})})]}),i?e.jsx(ee,{title:"Photo Documentation",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs($,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Re,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Upload Images"})]}),e.jsx(L,{id:"image-upload",type:"file",multiple:!0,accept:"image/*",onChange:s=>{s.target.files&&s.target.files.length>0&&(t({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${s.target.files.length} photo${s.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",s.target.files.length,"files"),s.target.value="")},className:"hidden"})]}),e.jsxs($,{htmlFor:"camera-capture",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx($e,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Take Photo"})]}),e.jsx(L,{id:"camera-capture",type:"file",accept:"image/*",capture:"environment",onChange:s=>{s.target.files&&s.target.files.length>0&&(t({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",s.target.files[0].name),s.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload existing images or take new photos to document the inspection"})]})}):e.jsxs(_,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Photo Documentation"}),e.jsx(W,{children:"Upload images or take photos to document the inspection"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{htmlFor:"image-upload-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{children:"Upload Images"})]}),e.jsx(L,{id:"image-upload-desktop",type:"file",multiple:!0,accept:"image/*",onChange:s=>{s.target.files&&s.target.files.length>0&&(t({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${s.target.files.length} photo${s.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",s.target.files.length,"files"),s.target.value="")},className:"hidden"})]}),e.jsxs($,{htmlFor:"camera-capture-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),e.jsx("span",{children:"Take Photo"})]}),e.jsx(L,{id:"camera-capture-desktop",type:"file",accept:"image/*",capture:"environment",onChange:s=>{s.target.files&&s.target.files.length>0&&(t({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",s.target.files[0].name),s.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select multiple images from your device or take new photos with your camera"})]})]}),e.jsx(D,{type:"submit",size:"lg",className:`w-full bg-blue-600 hover:bg-blue-700 shadow-md hover:shadow-lg transition-shadow ${i?"min-h-[56px] text-lg":"min-h-[48px]"}`,disabled:X,children:X?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(Qs,{className:"w-5 h-5 animate-spin"}),"Saving inspection..."]}):`Submit ${l[g]} Inspection`})]}),!N&&e.jsxs("div",{className:`border-t ${i?"pt-4":"pt-6"}`,children:[e.jsx(D,{onClick:ns,size:"lg",className:`w-full bg-green-600 hover:bg-green-700 shadow-md hover:shadow-xl transition-all ${i?"min-h-[56px] text-base":"min-h-[48px]"}`,disabled:!z,children:i?"Finalize Building Inspection":"Finalize Whole Building Inspection"}),!z&&e.jsx("p",{className:`text-center text-gray-500 mt-2 ${i?"text-xs px-2":"text-sm"}`,children:i?"Complete all required inspections first":"Complete all required inspections to enable this button"})]}),!N&&g&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50 animate-in fade-in-0 zoom-in-95 duration-300",children:e.jsx(D,{type:"button",onClick:s=>{const a=document.querySelector("form");if(a){const c=new Event("submit",{bubbles:!0,cancelable:!0});a.dispatchEvent(c)}},disabled:X,className:`rounded-full shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 ${i?"w-14 h-14":"w-16 h-16"} bg-blue-600 hover:bg-blue-700 text-white`,title:"Quick Submit Room","aria-label":X?"Submitting room inspection":`Quick submit ${l[g]} inspection`,children:X?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Xs,{className:"w-6 h-6"})})})]})})}export{Bt as default};
