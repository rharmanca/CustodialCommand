import{j as e,r as c}from"./ui-C40ArZlv-v6.js";import{m as ye,g as Se,s as Ce,S as Z,C as ee,a as se,c as we}from"./collapsible-section-S5iIaJr_-v6.js";import{u as Ie,C as f,g as b,B as h,d as y,e as S,f as D,h as M,b as te,U as ie}from"./index-BSmjchPe-v6.js";import{L as g,I as j}from"./label-BbwW0rT_-v6.js";import{T as ae}from"./textarea-TkGUltd2-v6.js";import{S as De,a as ke,b as Te,c as Fe,d as ze,e as re}from"./select-5ylEU5UJ-v6.js";import{S as Ae}from"./separator-DafDMzwk-v6.js";import{C as $e,a as Ee,b as Pe}from"./collapsible-D4SRr0xh-v6.js";import{u as _e}from"./use-mobile-aAX3j1Rq-v6.js";import{i as oe,r as O}from"./custodial-criteria-aPNJLI_7-v6.js";import{S as le}from"./save-C1kzqbF--v6.js";import{S as ne}from"./star-BzeSHEkx-v6.js";import"./vendor-Dvwkxfce-v6.js";import"./chevron-right-C7ge3pXJ-v6.js";function $({children:C,className:m="",title:p}){return e.jsxs("div",{className:`w-full max-w-full bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mx-2 sm:mx-0 ${m}`,children:[p&&e.jsx("div",{className:"px-4 sm:px-6 py-4 bg-gradient-to-r from-amber-100 to-orange-100 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-amber-900 leading-tight",children:p})}),e.jsx("div",{className:"p-4 sm:p-6 space-y-4",children:C})]})}function Ze({onBack:C}){const{isMobile:m}=_e(),{toast:p}=Ie();c.useEffect(()=>{const s=t=>{const a=t.target;a&&typeof a.closest=="function"&&a.closest("[data-radix-select-content]")&&(t.preventDefault(),t.stopPropagation())};return document.addEventListener("scroll",s,{passive:!1}),()=>{document.removeEventListener("scroll",s)}},[]);const w={exterior:2,gym_bleachers:1,classroom:3,cafeteria:1,utility_storage:1,admin_office:2,hallway:3,stairwell:2,restroom:2,staff_single_restroom:1},I={exterior:"Exterior",gym_bleachers:"Gym and Bleachers",classroom:"Classroom",cafeteria:"Cafeteria",utility_storage:"Utility Or Storage",admin_office:"Admin or Office Area",hallway:"Hallway",stairwell:"Stairwell",restroom:"Restroom",staff_single_restroom:"Staff or Single Restroom"},ce=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[E,B]=c.useState(()=>{const s={};return Object.keys(w).forEach(t=>{s[t]=0}),s}),[k,de]=c.useState([]),[N,T]=c.useState(!1),[U,L]=c.useState(!1),[qe,Oe]=c.useState([]),[me,Y]=c.useState(!1),[i,F]=c.useState({inspectorName:"",school:"",date:"",inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}),[n,G]=c.useState(null),[P,pe]=c.useState(!1),[u,_]=c.useState(null),[J,W]=c.useState(!1),[q,R]=c.useState(null),[V,K]=c.useState(!1),[z,X]=c.useState(null);c.useEffect(()=>{pe(Object.entries(w).every(([t,a])=>E[t]>=a))},[E]),c.useEffect(()=>{(async()=>{try{const a=await fetch("/api/inspections?type=whole_building&incomplete=true");if(a.ok){const r=await a.json();de(r),r.length>0&&T(!0)}}catch(a){console.error("Error loading available inspections:",a)}})(),ye(),xe();const t=Se();console.log("Building inspection storage stats:",t)},[]),c.useEffect(()=>{if(u&&n&&(i.inspectorName||i.school||i.date)){const s=setTimeout(()=>{he()},2e3);return()=>clearTimeout(s)}},[i,n,u]);const ue=()=>`building_form_${u}_${n}_${Date.now()}`,he=async()=>{if(!(!u||!n)){K(!0);try{const s=z||ue();z||X(s);const t={id:s,buildingInspectionId:u,selectedCategory:n,formData:{...i},lastModified:new Date().toISOString(),title:`${i.school} - Building - ${I[n]||n}`};Ce(`${Z.DRAFT_BUILDING_INSPECTION}_${s}`,t),R(new Date)}catch(s){console.error("Error saving form draft:",s)}finally{K(!1)}}},xe=()=>{try{const s=localStorage.getItem("building_form_drafts");if(s){const t=JSON.parse(s),a=t.filter(r=>{const o=new Date(r.lastModified),l=new Date;return l.setDate(l.getDate()-7),o>l});a.length!==t.length&&localStorage.setItem("building_form_drafts",JSON.stringify(a))}}catch(s){console.error("Error loading form drafts:",s)}},ge=()=>{if(z){we(`${Z.DRAFT_BUILDING_INSPECTION}_${z}`);const s=JSON.parse(localStorage.getItem("building_form_drafts")||"[]"),t=s.filter(a=>a.id!==z);t.length!==s.length&&localStorage.setItem("building_form_drafts",JSON.stringify(t)),X(null),R(null)}},fe=async s=>{try{_(s.id);const t={inspectorName:s.inspectorName||"",school:s.school,date:s.date,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""};F(t);const a=await fetch(`/api/inspections/${s.id}/rooms`);if(a.ok){const r=await a.json(),o={};Object.keys(w).forEach(l=>{o[l]=r.filter(d=>d.roomType===l).length}),B(o),L(!0),T(!1)}}catch(t){console.error("Error loading inspection:",t)}},H=()=>{T(!1),L(!1),_(null),B(()=>{const s={};return Object.keys(w).forEach(t=>{s[t]=0}),s}),F(s=>({...s,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}))},x=(s,t)=>{F(a=>({...a,[s]:t}))},be=(s,t,a)=>{var r,o;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"Rate this category:"}),e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:[1,2,3,4,5].map(l=>e.jsx("button",{type:"button",className:"p-2 rounded-md hover:bg-yellow-50 transition-colors touch-manipulation",onClick:()=>a(l),children:e.jsx(ne,{className:`w-6 h-6 ${l<=t&&t>0?"fill-yellow-400 text-yellow-400":"text-muted-foreground hover:text-yellow-300"}`})},l))}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:`px-4 py-2 rounded-md border text-sm font-medium transition-colors touch-manipulation ${t===-1?"bg-muted border-border text-foreground":"bg-card border-border text-muted-foreground hover:bg-muted"}`,onClick:()=>a(-1),children:"Not Rated"})})]}),e.jsx("div",{className:"text-center",children:t>0&&t!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-base font-semibold text-yellow-600",children:(r=O[t-1])==null?void 0:r.label}),e.jsx("div",{className:"text-sm text-gray-600",children:(o=O[t-1])==null?void 0:o.description})]}):e.jsx("div",{className:"text-base font-semibold text-gray-600",children:"No rating selected"})}),t>0&&t!==-1&&(s==null?void 0:s.criteria)&&s.criteria[t]&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-1",children:["Detailed Criteria for ",t," Star",t>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:s.criteria[t]})]})]})},je=(s,t,a)=>{var r,o;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(h,{type:"button",variant:t===-1?"default":"outline",size:"sm",className:"px-3 py-2 text-xs",onClick:()=>a(-1),children:"Not Rated"}),[1,2,3,4,5].map(l=>e.jsx(h,{type:"button",variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:()=>a(l),children:e.jsx(ne,{className:`w-6 h-6 ${l<=t&&t>0?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},l))]}),e.jsx("div",{className:"text-center",children:t>0&&t!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:(r=O[t-1])==null?void 0:r.label}),e.jsx("div",{className:"text-sm text-gray-600",children:(o=O[t-1])==null?void 0:o.description})]}):e.jsx("div",{className:"text-lg font-semibold text-gray-600",children:"No rating selected"})}),t>0&&t!==-1&&(s==null?void 0:s.criteria)&&s.criteria[t]&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-2",children:["Detailed Criteria for ",t," Star",t>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:s.criteria[t]})]})]})},Q=s=>{const t=window.scrollY;G(s),T(!1),F(a=>({...a,roomNumber:"",locationDescription:"",locationCategory:s,floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""})),requestAnimationFrame(()=>{window.scrollTo({top:t,behavior:"instant"})}),setTimeout(()=>{window.scrollTo({top:t,behavior:"instant"})},10),setTimeout(()=>{window.scrollTo({top:t,behavior:"instant"})},50)},Ne=async s=>{if(s.preventDefault(),!n){p({title:"Category Required",description:"Please select a category before submitting.",variant:"destructive"});return}const a=["inspectorName","school","date"].filter(r=>!i[r]);if(a.length>0){p({title:"Missing Required Fields",description:`Please fill in: ${a.join(", ")}`,variant:"destructive"});return}W(!0);try{const r={inspectorName:i.inspectorName,school:i.school,date:i.date,inspectionType:"whole_building",locationDescription:i.locationDescription||`Building inspection for ${n}`,roomNumber:i.roomNumber||null,locationCategory:n,buildingName:null,buildingInspectionId:u||null,floors:i.floors>=0?i.floors:null,verticalHorizontalSurfaces:i.verticalHorizontalSurfaces>=0?i.verticalHorizontalSurfaces:null,ceiling:i.ceiling>=0?i.ceiling:null,restrooms:i.restrooms>=0?i.restrooms:null,customerSatisfaction:i.customerSatisfaction>=0?i.customerSatisfaction:null,trash:i.trash>=0?i.trash:null,projectCleaning:i.projectCleaning>=0?i.projectCleaning:null,activitySupport:i.activitySupport>=0?i.activitySupport:null,safetyCompliance:i.safetyCompliance>=0?i.safetyCompliance:null,equipment:i.equipment>=0?i.equipment:null,monitoring:i.monitoring>=0?i.monitoring:null,notes:i.notes||null,images:[],verifiedRooms:[],isCompleted:!1};console.log("Submitting building inspection:",r);const o=await fetch("/api/submit-building-inspection",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)}),l=o.headers.get("content-type")||"";let d=null,A=null;try{l.includes("application/json")?d=await o.json():A=await o.text()}catch{try{A=await o.text()}catch{}}if(console.log("Submission response status:",o.status,"ctype:",l),d&&console.log("Submission response JSON:",d),!d&&A&&console.log("Submission response TEXT:",A.slice(0,300)),!o.ok){const v=d&&(d.message||d.error)||A||null;throw new Error(v||`HTTP error! status: ${o.status}`)}if(d&&(d.success||d.id)||o.ok)p({title:"Success",description:"Building inspection submitted successfully!"}),d&&d.id&&!u&&(console.log("Setting buildingInspectionId from first submission:",d.id),_(d.id)),n&&B(v=>({...v,[n]:(v[n]||0)+1})),ge(),F(v=>({...v,roomNumber:"",locationDescription:"",notes:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1})),G(null);else throw new Error(d.message||"Submission failed")}catch(r){console.error("Building inspection submission error:",r);let o="Failed to save inspection. Please check your connection and try again.";r instanceof TypeError&&r.message.includes("fetch")?o="Network error. Please check your internet connection.":r instanceof Error&&(r.message.includes("404")?o="Server endpoint not found. Please contact support.":r.message.includes("500")?o="Server error. Please try again later.":r.message&&r.message!=="Submission failed"&&(o=r.message)),p({title:"Submission Failed",description:o,variant:"destructive"})}finally{W(!1)}},ve=async()=>{if(!P){console.error("Please complete all required inspections before finalizing.");return}if(console.log("Attempting to finalize building inspection:",{buildingInspectionId:u,isAllComplete:P}),!u){console.error("No building inspection ID available for finalization"),p({title:"Finalization Failed",description:"No building inspection ID found. Please start a new inspection.",variant:"destructive"});return}try{console.log(`Calling finalize endpoint: /api/inspections/${u}/finalize`);const s=await fetch(`/api/inspections/${u}/finalize`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}});console.log("Finalize response status:",s.status);let t=s.ok,a=null;if(!t){try{const o=await s.json();a=o.error||o.message,console.log("Finalize endpoint error:",o)}catch{const l=await s.text();console.log("Finalize endpoint error (text):",l.slice(0,200)),a=l}console.log(`Trying PATCH fallback: /api/inspections/${u}`);const r=await fetch(`/api/inspections/${u}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({isCompleted:!0})});if(console.log("PATCH response status:",r.status),t=r.ok,!t){try{const o=await r.json();a=o.error||o.message||"Failed to finalize inspection",console.log("PATCH endpoint error:",o)}catch{const l=await r.text();console.log("PATCH endpoint error (text):",l.slice(0,200)),a=l||"Failed to finalize inspection"}throw new Error(a)}}Y(!0),p({title:"ðŸŽ‰ You Did Your Duty, Thank You! ðŸŽ‰",description:"Outstanding work! Your complete building inspection has been submitted successfully. Ready to start a new inspection when you return home.",duration:5e3}),console.log("Whole building inspection completed successfully!"),setTimeout(()=>{C&&C()},3e3)}catch(s){console.error("Error finalizing inspection:",s),p({title:"Finalization Failed",description:"Failed to finalize building inspection. Please try again.",variant:"destructive"})}};return e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl space-y-6",children:[!N&&e.jsx(f,{className:"border-primary/30",children:e.jsxs(b,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Start New Building Inspection"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Guided, step-by-step workflow to complete all required areas"})]}),e.jsx(h,{onClick:H,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:"ðŸ¢ Start New Building Inspection"})]})}),me&&e.jsx(f,{className:"border-green-300 bg-green-50",children:e.jsxs(b,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-800",children:"Building Inspection Finalized"}),e.jsx("div",{className:"text-sm text-green-700",children:"Your comprehensive inspection has been submitted successfully."})]}),e.jsx(h,{onClick:()=>{Y(!1),H()},className:"bg-green-600 hover:bg-green-700 text-white",children:"Start New Building Inspection"})]})}),e.jsxs("div",{className:"mb-6",children:[C&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx(h,{variant:"outline",onClick:C,className:"flex-shrink-0 back-button",children:"â† Back"})}),e.jsx("div",{className:"flex justify-center px-4",children:e.jsxs($e,{className:"w-full max-w-lg",children:[e.jsx(Ee,{asChild:!0,children:e.jsx(h,{variant:"ghost",className:"w-full p-3 h-auto font-normal text-center text-primary hover:text-primary/80 hover:bg-accent/10 border border-accent/30 rounded-lg text-sm sm:text-base leading-relaxed",children:"ðŸ“‹ How to conduct a whole building inspection â†“"})}),e.jsx(Pe,{className:"mt-3 p-4 bg-accent/10 rounded-lg border border-accent/30",children:e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 1: Getting Started"}),e.jsx("p",{children:"Enter your inspector name, select the school, and choose the inspection date. This information will be saved automatically."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 2: Complete Required Inspections"}),e.jsx("p",{children:'Each category below shows how many inspections are required (e.g., 3 Classrooms, 2 Restrooms). Click "Select" on any incomplete category to start inspecting that area type.'})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 3: Rate Each Area"}),e.jsx("p",{children:"For each room/area, rate the custodial performance using the 1-5 star system you're familiar with. Add room numbers and notes as needed."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 4: Track Progress"}),e.jsx("p",{children:"Your progress is saved automatically. Green checkmarks show completed categories. Return anytime to continue where you left off."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 5: Finalize"}),e.jsx("p",{children:'Once all required inspections are complete, the "Finalize Building Inspection" button will become available to submit your comprehensive inspection.'})]})]})})]})})]}),N&&e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(S,{children:"Building Inspection Options"}),e.jsx(D,{children:"You can continue a previous inspection or start a new one"})]}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-lg",children:"Start New Inspection:"}),e.jsx(h,{onClick:H,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 border-2 border-green-600 hover:border-green-700 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 text-lg",variant:"default",size:"lg",children:"ðŸ¢ Start New Building Inspection"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Begin a fresh comprehensive building inspection"})]}),k.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Or Continue Previous Inspection:"}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto border-2 border-amber-300 rounded-lg p-3 bg-amber-25 shadow-inner",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-amber-200",children:[e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Available Inspections"}),e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:[k.length," found"]})]}),k.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-amber-100 bg-amber-50 border-amber-200 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded-full font-medium",children:["#",t+1]}),e.jsx("div",{className:"font-medium text-amber-900",children:s.school})]}),e.jsxs("div",{className:"text-sm text-amber-700 mt-1",children:[new Date(s.date).toLocaleDateString(),s.inspectorName&&e.jsxs("span",{className:"block text-sm text-amber-800 font-medium",children:["Inspector: ",s.inspectorName]})]})]}),s.isCompleted?e.jsx(M,{variant:"default",className:"bg-green-500",children:"Completed âœ“"}):e.jsx(h,{onClick:()=>fe(s),variant:"outline",size:"sm",className:"border-amber-400 text-amber-700 hover:bg-amber-100 font-medium",children:"Continue"})]},s.id)),k.length>3&&e.jsx("div",{className:"text-center py-2 border-t border-amber-200 mt-2",children:e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-3 py-1 rounded-full",children:["â†• Scroll to see all ",k.length," ","inspections"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"These inspections were started but not completed"})]})]})]})]}),!U&&!N&&e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(S,{children:"Building Information"}),e.jsx(D,{children:"Select the school and date for this inspection"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"inspectorName",children:"Inspector Name *"}),e.jsx(j,{id:"inspectorName",value:i.inspectorName,onChange:s=>x("inspectorName",s.target.value),placeholder:"Enter inspector name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"school",children:"School"}),e.jsxs(De,{value:i.school,onValueChange:s=>x("school",s),children:[e.jsx(ke,{children:e.jsx(Te,{placeholder:"Select school"})}),e.jsx(Fe,{children:ce.map(s=>e.jsx(ze,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"date",children:"Date"}),e.jsx(j,{id:"date",type:"date",value:i.date,onChange:s=>x("date",s.target.value),required:!0})]})]})})]}),U&&e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(S,{children:"Current Inspection"}),e.jsx(D,{children:"Continuing inspection progress"})]}),e.jsxs(b,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Inspector:"}),e.jsx("span",{children:i.inspectorName||"Not specified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"School:"}),e.jsx("span",{children:i.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{children:new Date(i.date).toLocaleDateString()})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(h,{onClick:()=>{T(!0),L(!1),_(null)},variant:"outline",size:"sm",children:"Switch to Different Inspection"})})]})]}),!N&&(m?e.jsxs($,{title:"Inspection Progress","data-inspection-progress":!0,children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Complete the required number of inspections for each category",i.school&&i.date&&e.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"(Progress is automatically saved)"})]}),e.jsx("div",{className:"space-y-3",children:Object.entries(w).map(([s,t])=>{const a=E[s],r=a>=t;return e.jsx("div",{className:`p-3 rounded-lg border ${r?"bg-green-50 border-green-200":n===s?"bg-blue-50 border-blue-300 border-2":"bg-gray-50 border-gray-200"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center flex-shrink-0 mt-0.5 ${r?"bg-green-500 border-green-500":"border-gray-400"}`,children:r&&e.jsx(re,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:`font-medium text-sm block leading-tight ${r?"text-green-800":"text-gray-700"}`,children:I[s]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs(M,{variant:r?"default":"secondary",className:"text-xs",children:[a,"/",t," Done"]}),!r&&i.school&&i.date&&i.inspectorName.trim()&&e.jsx(h,{size:"sm",variant:"outline",onClick:()=>Q(s),className:`text-xs px-3 py-1 h-7 ${n===s?"border-blue-500 bg-blue-50":""}`,children:"Select"})]})]})]})})},s)})})]}):e.jsxs(f,{"data-inspection-progress":!0,children:[e.jsxs(y,{children:[e.jsx(S,{children:"Inspection Progress"}),e.jsxs(D,{children:["Complete the required number of inspections for each category",i.school&&i.date&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Progress is automatically saved)"})]})]}),e.jsx(b,{className:"space-y-3",children:Object.entries(w).map(([s,t])=>{const a=E[s],r=a>=t;return e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${r?"bg-green-50 border-green-200":n===s?"bg-blue-50 border-blue-300 border-2":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center ${r?"bg-green-500 border-green-500":"border-gray-400"}`,children:r&&e.jsx(re,{className:"w-4 h-4 text-white"})}),e.jsx("span",{className:`font-medium ${r?"text-green-800":"text-gray-700"}`,children:I[s]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(M,{variant:r?"default":"secondary",children:[a,"/",t," Completed"]}),!r&&i.school&&i.date&&i.inspectorName.trim()&&e.jsx(h,{size:"sm",variant:"outline",onClick:()=>Q(s),className:n===s?"border-blue-500":"",children:"Select"})]})]},s)})})]})),!N&&n&&!(i.school&&i.date&&i.inspectorName.trim())&&e.jsx(f,{className:"border-amber-200 bg-amber-50",children:e.jsx(b,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:"Complete Required Information"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Please fill in all required fields above before you can start rating this category:"}),e.jsxs("ul",{className:"text-sm text-amber-700 mt-2 space-y-1",children:[!i.inspectorName.trim()&&e.jsx("li",{children:"â€¢ Inspector Name is required"}),!i.school&&e.jsx("li",{children:"â€¢ School selection is required"}),!i.date&&e.jsx("li",{children:"â€¢ Inspection date is required"})]})]})]})})}),!N&&n&&i.school&&i.date&&i.inspectorName.trim()&&e.jsxs("form",{onSubmit:Ne,className:`space-y-4 ${m?"":"space-y-6"}`,children:[m?e.jsxs($,{title:`Inspecting: ${I[n]}`,children:[q&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-muted-foreground",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",q.toLocaleTimeString()]})]}),V&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-blue-600",children:[e.jsx(le,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"roomNumber",className:"text-base font-medium",children:"Room Number"}),e.jsx(j,{id:"roomNumber",className:"h-12 text-base",value:i.roomNumber,onChange:s=>x("roomNumber",s.target.value),placeholder:"Enter room number",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"locationDescription",className:"text-base font-medium",children:"Location Description"}),e.jsx(j,{id:"locationDescription",className:"h-12 text-base",value:i.locationDescription,onChange:s=>x("locationDescription",s.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})]}):e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsxs(S,{children:["Inspecting: ",I[n]]}),e.jsxs(D,{children:["Complete the inspection for this category",q&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",children:[e.jsx(te,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",q.toLocaleTimeString()]})]}),V&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-blue-600",children:[e.jsx(le,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]})]})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"roomNumber",children:"Room Number"}),e.jsx(j,{id:"roomNumber",value:i.roomNumber,onChange:s=>x("roomNumber",s.target.value),placeholder:"Enter room number",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"locationDescription",children:"Location Description"}),e.jsx(j,{id:"locationDescription",value:i.locationDescription,onChange:s=>x("locationDescription",s.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})})]}),m?e.jsx($,{title:"Rate Each Category",children:e.jsx("div",{className:"space-y-4",children:oe.map((s,t)=>e.jsx(ee,{title:s.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:be(s,i[s.key],a=>x(s.key,a))},s.key))})}):e.jsx("div",{className:"grid gap-4 grid-cols-1 lg:grid-cols-2",children:oe.map((s,t)=>{const a=s.key;return e.jsx(ee,{title:s.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:je(s,i[a],r=>x(a,r))},s.key)})}),m?e.jsx($,{title:"Additional Notes",children:e.jsx(ae,{value:i.notes,onChange:s=>x("notes",s.target.value),placeholder:"Enter any additional observations...",rows:4,className:"text-base min-h-[120px]"})}):e.jsxs(f,{children:[e.jsx(y,{children:e.jsx(S,{children:"Additional Notes"})}),e.jsx(b,{children:e.jsx(ae,{value:i.notes,onChange:s=>x("notes",s.target.value),placeholder:"Enter any additional observations...",rows:4})})]}),m?e.jsx($,{title:"Photo Documentation",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(g,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Upload Images"})]}),e.jsx(j,{id:"image-upload",type:"file",multiple:!0,accept:"image/*",onChange:s=>{s.target.files&&s.target.files.length>0&&(p({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${s.target.files.length} photo${s.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",s.target.files.length,"files"),s.target.value="")},className:"hidden"})]}),e.jsxs(g,{htmlFor:"camera-capture",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(se,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Take Photo"})]}),e.jsx(j,{id:"camera-capture",type:"file",accept:"image/*",capture:"environment",onChange:s=>{s.target.files&&s.target.files.length>0&&(p({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",s.target.files[0].name),s.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload existing images or take new photos to document the inspection"})]})}):e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(S,{children:"Photo Documentation"}),e.jsx(D,{children:"Upload images or take photos to document the inspection"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{htmlFor:"image-upload-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(ie,{className:"w-4 h-4"}),e.jsx("span",{children:"Upload Images"})]}),e.jsx(j,{id:"image-upload-desktop",type:"file",multiple:!0,accept:"image/*",onChange:s=>{s.target.files&&s.target.files.length>0&&(p({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${s.target.files.length} photo${s.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",s.target.files.length,"files"),s.target.value="")},className:"hidden"})]}),e.jsxs(g,{htmlFor:"camera-capture-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"Take Photo"})]}),e.jsx(j,{id:"camera-capture-desktop",type:"file",accept:"image/*",capture:"environment",onChange:s=>{s.target.files&&s.target.files.length>0&&(p({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",s.target.files[0].name),s.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select multiple images from your device or take new photos with your camera"})]})]}),e.jsx(h,{type:"submit",size:"lg",className:`w-full bg-blue-600 hover:bg-blue-700 ${m?"h-14 text-lg":""}`,disabled:J,children:J?"Submitting...":`Submit ${I[n]} Inspection`})]}),!N&&e.jsxs("div",{className:`border-t ${m?"pt-4":"pt-6"}`,children:[e.jsx(h,{onClick:ve,size:"lg",className:`w-full bg-green-600 hover:bg-green-700 ${m?"h-14 text-base":""}`,disabled:!P,children:m?"Finalize Building Inspection":"Finalize Whole Building Inspection"}),!P&&e.jsx("p",{className:`text-center text-gray-500 mt-2 ${m?"text-xs px-2":"text-sm"}`,children:m?"Complete all required inspections first":"Complete all required inspections to enable this button"})]})]})}export{Ze as default};
//# sourceMappingURL=whole-building-inspection-CkTAsoYj-v6.js.map
