var xe=Object.defineProperty,me=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var U=(t,s,r)=>s in t?xe(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,D=(t,s)=>{for(var r in s||(s={}))z.call(s,r)&&U(t,r,s[r]);if(C)for(var r of C(s))G.call(s,r)&&U(t,r,s[r]);return t},P=(t,s)=>me(t,he(s));var R=(t,s)=>{var r={};for(var n in t)z.call(t,n)&&s.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&C)for(var n of C(t))s.indexOf(n)<0&&G.call(t,n)&&(r[n]=t[n]);return r};var X=(t,s,r)=>new Promise((n,c)=>{var d=o=>{try{i(r.next(o))}catch(l){c(l)}},m=o=>{try{i(r.throw(o))}catch(l){c(l)}},i=o=>o.done?n(o.value):Promise.resolve(o.value).then(d,m);i((r=r.apply(t,s)).next())});import{r as h,j as e,w as ge,b as Z}from"./ui-BqtzBtHj-v6.js";import{c as ue,C as g,e as u,f as j,i as H,g as p,h as f,d as je,u as fe,B}from"./index-BaYUFHT0-v6.js";import{a as pe,L as Q,I as q}from"./LoadingOverlay-C66DN95D-v6.js";import{w as E,g as F,p as ee,Q as ve,E as Ne,a8 as we,t as J,O as K}from"./icons-CP4MPgx_-v6.js";var M="Progress",$=100,[be,Me]=ge(M),[ye,Se]=be(M),se=h.forwardRef((t,s)=>{const v=t,{__scopeProgress:r,value:n=null,max:c,getValueLabel:d=Ce}=v,m=R(v,["__scopeProgress","value","max","getValueLabel"]);(c||c===0)&&!W(c)&&console.error(De(`${c}`,"Progress"));const i=W(c)?c:$;n!==null&&!Y(n,i)&&console.error(Pe(`${n}`,"Progress"));const o=Y(n,i)?n:null,l=A(o)?d(o,i):void 0;return e.jsx(ye,{scope:r,value:o,max:i,children:e.jsx(Z.div,P(D({"aria-valuemax":i,"aria-valuemin":0,"aria-valuenow":A(o)?o:void 0,"aria-valuetext":l,role:"progressbar","data-state":re(o,i),"data-value":o!=null?o:void 0,"data-max":i},m),{ref:s}))})});se.displayName=M;var te="ProgressIndicator",ae=h.forwardRef((t,s)=>{var m;const d=t,{__scopeProgress:r}=d,n=R(d,["__scopeProgress"]),c=Se(te,r);return e.jsx(Z.div,P(D({"data-state":re(c.value,c.max),"data-value":(m=c.value)!=null?m:void 0,"data-max":c.max},n),{ref:s}))});ae.displayName=te;function Ce(t,s){return`${Math.round(t/s*100)}%`}function re(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function A(t){return typeof t=="number"}function W(t){return A(t)&&!isNaN(t)&&t>0}function Y(t,s){return A(t)&&!isNaN(t)&&t<=s&&t>=0}function De(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${$}\`.`}function Pe(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${$} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var le=se,Re=ae;const I=h.forwardRef((c,n)=>{var d=c,{className:t,value:s}=d,r=R(d,["className","value"]);return e.jsx(le,P(D({ref:n,className:ue("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t)},r),{children:e.jsx(Re,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}))});I.displayName=le.displayName;function L({school:t,score:s,complianceStatus:r,dateRange:n,compact:c=!1}){const d=s.overallScore/5*100,m=l=>l>=4?"text-green-700":l>=3?"text-green-600":l>=2?"text-yellow-600":"text-red-600",i=l=>l>=4?"bg-green-600":l>=3?"bg-green-500":l>=2?"bg-yellow-500":"bg-red-500",o=l=>{switch(l){case"green":return"default";case"yellow":return"secondary";case"red":return"destructive";default:return"outline"}};return c?e.jsxs(g,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(u,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{className:"text-lg",children:t}),e.jsxs(H,{variant:o(r.color),children:[s.level2Compliant?e.jsx(E,{className:"w-3 h-3 mr-1"}):e.jsx(F,{className:"w-3 h-3 mr-1"}),r.text]})]}),n&&e.jsxs(p,{className:"text-xs",children:[n.start," to ",n.end]})]}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-2xl font-bold",style:{color:m(s.overallScore)},children:s.overallScore.toFixed(2)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"/ 5.0"})]}),e.jsx(I,{value:d,className:i(s.overallScore)}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Inspections"}),e.jsx("div",{className:"font-semibold",children:s.inspectionCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Notes"}),e.jsx("div",{className:"font-semibold",children:s.notesCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Avg Rating"}),e.jsx("div",{className:"font-semibold",children:s.inspectionScore.toFixed(1)})]})]})]})})]}):e.jsxs(g,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-2xl",children:t}),n&&e.jsxs(p,{children:["Period: ",n.start," to ",n.end]})]}),e.jsxs(H,{variant:o(r.color),className:"text-sm px-3 py-1",children:[s.level2Compliant?e.jsx(E,{className:"w-4 h-4 mr-1"}):e.jsx(F,{className:"w-4 h-4 mr-1"}),r.text]})]})}),e.jsxs(f,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-6xl font-bold",style:{color:m(s.overallScore)},children:s.overallScore.toFixed(2)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Overall Building Score (out of 5.0)"}),e.jsx(I,{value:d,className:`h-3 ${i(s.overallScore)}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Inspection Average"}),e.jsx("div",{className:"text-2xl font-bold",children:s.inspectionScore.toFixed(2)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["75% weight • ",s.inspectionCount," inspections"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Notes Impact"}),e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-1",children:[s.notesModifier>0?e.jsx(ee,{className:"w-5 h-5 text-green-600"}):s.notesModifier<0?e.jsx(ve,{className:"w-5 h-5 text-red-600"}):null,s.notesModifier>0?"+":"",s.notesModifier.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["25% weight • ",s.notesCount," notes"]})]})]}),s.categoryBreakdown&&s.categoryBreakdown.length>0&&e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx("div",{className:"text-sm font-medium",children:"Category Breakdown"}),e.jsx("div",{className:"space-y-2",children:s.categoryBreakdown.filter(l=>l.count>0).sort((l,v)=>v.averageRating-l.averageRating).slice(0,5).map(l=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:l.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{value:l.averageRating/5*100,className:"w-24 h-2"}),e.jsx("span",{className:"text-sm font-semibold w-12 text-right",children:l.averageRating.toFixed(1)})]})]},l.category))}),s.categoryBreakdown.filter(l=>l.count>0).length>5&&e.jsx("div",{className:"text-xs text-muted-foreground text-center",children:"Showing top 5 categories"})]}),e.jsx("div",{className:`p-3 rounded-lg border ${s.level2Compliant?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.level2Compliant?e.jsx(E,{className:"w-5 h-5 text-green-600"}):e.jsx(F,{className:"w-5 h-5 text-yellow-600"}),e.jsx("div",{className:"text-sm",children:s.level2Compliant?e.jsx("span",{className:"font-semibold text-green-800",children:"Meets Level 2 Standards (≥3.0)"}):e.jsx("span",{className:"font-semibold text-yellow-800",children:"Below Level 2 Standards (target: ≥3.0)"})})]})})]})]})}function Ie({onBack:t}){const{toast:s}=je(),{isMobile:r}=fe(),[n,c]=h.useState(!0),[d,m]=h.useState(!1),[i,o]=h.useState([]),[l,v]=h.useState(""),[N,T]=h.useState(""),[Ae,ne]=h.useState([]);h.useEffect(()=>{const a=new Date,x=new Date(a);x.setDate(a.getDate()-30),T(a.toISOString().split("T")[0]),v(x.toISOString().split("T")[0])},[]);const k=(a,x)=>X(null,null,function*(){try{c(!0);const y=new URLSearchParams;a&&y.append("startDate",a),x&&y.append("endDate",x);const _=yield fetch(`/api/scores?${y.toString()}`);if(!_.ok)throw new Error("Failed to fetch scores");const V=yield _.json();o(V.scores||[]),ne(V.scores||[])}catch(y){console.error("Error fetching scores:",y),s({title:"Error",description:"Failed to load building scores. Please try again.",variant:"destructive"})}finally{c(!1),m(!1)}});h.useEffect(()=>{l&&N&&k(l,N)},[l,N]);const ie=()=>{m(!0),k(l,N)},oe=()=>{const a=new Date,x=new Date(a);x.setDate(a.getDate()-30),T(a.toISOString().split("T")[0]),v(x.toISOString().split("T")[0])},O=i.filter(a=>a.score.level2Compliant).length,S=i.length,ce=S>0?O/S*100:0,de=i.length>0?i.reduce((a,x)=>a+x.score.overallScore,0)/i.length:0,w=i.length>0?i.reduce((a,x)=>x.score.overallScore>a.score.overallScore?x:a):null,b=i.filter(a=>a.score.overallScore<3);return n&&!d?e.jsx(pe,{message:"Loading building scores..."}):e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Building Scores Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track custodial performance across all campuses"})]}),t&&e.jsx(B,{variant:"outline",onClick:t,children:"← Back"})]}),e.jsxs(g,{children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Filter by Date Range"]}),e.jsx(p,{children:"View scores for a specific time period"})]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:ie,disabled:d,children:[e.jsx(we,{className:`w-4 h-4 mr-2 ${d?"animate-spin":""}`}),"Refresh"]})]})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"startDate",children:"Start Date"}),e.jsx(q,{id:"startDate",type:"date",value:l,onChange:a=>v(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{htmlFor:"endDate",children:"End Date"}),e.jsx(q,{id:"endDate",type:"date",value:N,onChange:a=>T(a.target.value)})]}),e.jsx("div",{className:"space-y-2 flex items-end",children:e.jsx(B,{variant:"secondary",onClick:oe,className:"w-full",children:"Last 30 Days"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(g,{children:[e.jsxs(u,{className:"pb-3",children:[e.jsx(p,{children:"Total Schools"}),e.jsx(j,{className:"text-3xl",children:S})]}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{children:"Monitored campuses"})]})})]}),e.jsxs(g,{children:[e.jsxs(u,{className:"pb-3",children:[e.jsx(p,{children:"Level 2 Compliance"}),e.jsxs(j,{className:"text-3xl text-green-600",children:[ce.toFixed(0),"%"]})]}),e.jsx(f,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[O," of ",S," schools ≥3.0"]})})]}),e.jsxs(g,{children:[e.jsxs(u,{className:"pb-3",children:[e.jsx(p,{children:"Network Average"}),e.jsx(j,{className:"text-3xl",children:de.toFixed(2)})]}),e.jsx(f,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Across all schools"})})]}),e.jsxs(g,{children:[e.jsxs(u,{className:"pb-3",children:[e.jsx(p,{children:"Needs Attention"}),e.jsx(j,{className:"text-3xl text-yellow-600",children:b.length})]}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Below Level 2"})]})})]})]}),w&&e.jsxs(g,{className:"bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-green-600"}),e.jsx(j,{className:"text-lg",children:"Top Performer"})]})}),e.jsx(f,{children:e.jsx(L,{school:w.school,score:w.score,complianceStatus:w.complianceStatus,dateRange:w.dateRange,compact:r})})]}),b.length>0&&e.jsxs(g,{className:"bg-yellow-50 border-yellow-200",children:[e.jsxs(u,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-yellow-600"}),e.jsx(j,{className:"text-lg",children:"Schools Needing Attention"})]}),e.jsxs(p,{children:[b.length," ",b.length===1?"school is":"schools are"," below Level 2 standards"]})]}),e.jsx(f,{children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:b.map(a=>e.jsx(L,{school:a.school,score:a.score,complianceStatus:a.complianceStatus,dateRange:a.dateRange,compact:!0},a.school))})})]}),e.jsxs(g,{children:[e.jsxs(u,{children:[e.jsx(j,{children:"All School Scores"}),e.jsxs(p,{children:["Showing ",i.length," schools sorted by overall score"]})]}),e.jsxs(f,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:i.map(a=>e.jsx(L,{school:a.school,score:a.score,complianceStatus:a.complianceStatus,dateRange:a.dateRange,compact:!0},a.school))}),i.length===0&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(J,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No scores available for the selected date range."}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your date filters or refresh the page."})]})]})]})]})}const $e=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));export{I as P,$e as s};
