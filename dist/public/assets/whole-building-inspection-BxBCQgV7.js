import{k as V,r as m,j as e,t as ot,s as nt,v as $e,P as it,w as Y,x as lt,F as ct,G as dt,I as mt,c as ut,f as I,d as P,e as D,B as ee,u as pt,b as xt,g as G,h as U,i as J,q as ht,H as gt,C as Se,U as Te}from"./index-Dj6S0Vds.js";import{m as ft,g as bt,s as jt,S as ke,C as Ie,a as Pe,c as vt}from"./collapsible-section-Bnn3AWIT.js";import{L as F,I as $}from"./label-DPKhZwfT.js";import{T as De}from"./textarea-DP_IwbRP.js";import{S as yt,a as Nt,b as wt,c as Ct,d as St}from"./select-olGfu5F2.js";import{S as Tt}from"./separator-gDqqdXgc.js";import{P as pe,T as kt}from"./progress-DBHkj_-y.js";import{c as Re,b as It,R as Pt,A as Dt,d as Et,e as At,C as xe}from"./Combination-FhtnMJpQ.js";import{C as _t,a as Ot,b as Ft,A as $t}from"./collapsible-CQAsPlbz.js";import{i as Ee,r as oe}from"./custodial-criteria-aPNJLI_7.js";import{P as ze,a as Le,b as Me}from"./popover-Bm6fPu5U.js";import{C as ne}from"./circle-help-DBE5ENyc.js";import{S as ie}from"./star-B-GlVxnp.js";import{B as Rt}from"./book-open-C1jdYrs7.js";import{B as zt}from"./building-2-Cr9uGgar.js";import{C as Ae}from"./chevron-right-BslRAeqH.js";import{S as _e}from"./save-FgjQvX-c.js";import{L as Lt}from"./loader-circle-DGpEz2xU.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=V("Bath",[["path",{d:"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"1r8yf5"}],["line",{x1:"10",x2:"8",y1:"5",y2:"7",key:"h5g8z4"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"7",x2:"7",y1:"19",y2:"21",key:"16jp00"}],["line",{x1:"17",x2:"17",y1:"19",y2:"21",key:"1pxrnk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=V("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=V("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=V("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=V("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=V("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=V("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]);var[le,_s]=ot("Tooltip",[Re]),ce=Re(),Be="TooltipProvider",Yt=700,he="tooltip.open",[Jt,be]=le(Be),qe=o=>{const{__scopeTooltip:n,delayDuration:s=Yt,skipDelayDuration:c=300,disableHoverableContent:d=!1,children:g}=o,x=m.useRef(!0),C=m.useRef(!1),p=m.useRef(0);return m.useEffect(()=>{const b=p.current;return()=>window.clearTimeout(b)},[]),e.jsx(Jt,{scope:n,isOpenDelayedRef:x,delayDuration:s,onOpen:m.useCallback(()=>{window.clearTimeout(p.current),x.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>x.current=!0,c)},[c]),isPointerInTransitRef:C,onPointerInTransitChange:m.useCallback(b=>{C.current=b},[]),disableHoverableContent:d,children:g})};qe.displayName=Be;var te="Tooltip",[Wt,de]=le(te),He=o=>{const{__scopeTooltip:n,children:s,open:c,defaultOpen:d,onOpenChange:g,disableHoverableContent:x,delayDuration:C}=o,p=be(te,o.__scopeTooltip),b=ce(n),[j,y]=m.useState(null),S=It(),f=m.useRef(0),w=x??p.disableHoverableContent,T=C??p.delayDuration,k=m.useRef(!1),[R,_]=nt({prop:c,defaultProp:d??!1,onChange:h=>{h?(p.onOpen(),document.dispatchEvent(new CustomEvent(he))):p.onClose(),g?.(h)},caller:te}),q=m.useMemo(()=>R?k.current?"delayed-open":"instant-open":"closed",[R]),z=m.useCallback(()=>{window.clearTimeout(f.current),f.current=0,k.current=!1,_(!0)},[_]),r=m.useCallback(()=>{window.clearTimeout(f.current),f.current=0,_(!1)},[_]),L=m.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{k.current=!0,_(!0),f.current=0},T)},[T,_]);return m.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),e.jsx(Pt,{...b,children:e.jsx(Wt,{scope:n,contentId:S,open:R,stateAttribute:q,trigger:j,onTriggerChange:y,onTriggerEnter:m.useCallback(()=>{p.isOpenDelayedRef.current?L():z()},[p.isOpenDelayedRef,L,z]),onTriggerLeave:m.useCallback(()=>{w?r():(window.clearTimeout(f.current),f.current=0)},[r,w]),onOpen:z,onClose:r,disableHoverableContent:w,children:s})})};He.displayName=te;var ge="TooltipTrigger",Ge=m.forwardRef((o,n)=>{const{__scopeTooltip:s,...c}=o,d=de(ge,s),g=be(ge,s),x=ce(s),C=m.useRef(null),p=$e(n,C,d.onTriggerChange),b=m.useRef(!1),j=m.useRef(!1),y=m.useCallback(()=>b.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",y),[y]),e.jsx(Dt,{asChild:!0,...x,children:e.jsx(it.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...c,ref:p,onPointerMove:Y(o.onPointerMove,S=>{S.pointerType!=="touch"&&!j.current&&!g.isPointerInTransitRef.current&&(d.onTriggerEnter(),j.current=!0)}),onPointerLeave:Y(o.onPointerLeave,()=>{d.onTriggerLeave(),j.current=!1}),onPointerDown:Y(o.onPointerDown,()=>{d.open&&d.onClose(),b.current=!0,document.addEventListener("pointerup",y,{once:!0})}),onFocus:Y(o.onFocus,()=>{b.current||d.onOpen()}),onBlur:Y(o.onBlur,d.onClose),onClick:Y(o.onClick,d.onClose)})})});Ge.displayName=ge;var Qt="TooltipPortal",[Os,Xt]=le(Qt,{forceMount:void 0}),W="TooltipContent",Ue=m.forwardRef((o,n)=>{const s=Xt(W,o.__scopeTooltip),{forceMount:c=s.forceMount,side:d="top",...g}=o,x=de(W,o.__scopeTooltip);return e.jsx(lt,{present:c||x.open,children:x.disableHoverableContent?e.jsx(Ve,{side:d,...g,ref:n}):e.jsx(Kt,{side:d,...g,ref:n})})}),Kt=m.forwardRef((o,n)=>{const s=de(W,o.__scopeTooltip),c=be(W,o.__scopeTooltip),d=m.useRef(null),g=$e(n,d),[x,C]=m.useState(null),{trigger:p,onClose:b}=s,j=d.current,{onPointerInTransitChange:y}=c,S=m.useCallback(()=>{C(null),y(!1)},[y]),f=m.useCallback((w,T)=>{const k=w.currentTarget,R={x:w.clientX,y:w.clientY},_=rs(R,k.getBoundingClientRect()),q=as(R,_),z=os(T.getBoundingClientRect()),r=is([...q,...z]);C(r),y(!0)},[y]);return m.useEffect(()=>()=>S(),[S]),m.useEffect(()=>{if(p&&j){const w=k=>f(k,j),T=k=>f(k,p);return p.addEventListener("pointerleave",w),j.addEventListener("pointerleave",T),()=>{p.removeEventListener("pointerleave",w),j.removeEventListener("pointerleave",T)}}},[p,j,f,S]),m.useEffect(()=>{if(x){const w=T=>{const k=T.target,R={x:T.clientX,y:T.clientY},_=p?.contains(k)||j?.contains(k),q=!ns(R,x);_?S():q&&(S(),b())};return document.addEventListener("pointermove",w),()=>document.removeEventListener("pointermove",w)}},[p,j,x,b,S]),e.jsx(Ve,{...o,ref:g})}),[Zt,es]=le(te,{isInside:!1}),ts=dt("TooltipContent"),Ve=m.forwardRef((o,n)=>{const{__scopeTooltip:s,children:c,"aria-label":d,onEscapeKeyDown:g,onPointerDownOutside:x,...C}=o,p=de(W,s),b=ce(s),{onClose:j}=p;return m.useEffect(()=>(document.addEventListener(he,j),()=>document.removeEventListener(he,j)),[j]),m.useEffect(()=>{if(p.trigger){const y=S=>{S.target?.contains(p.trigger)&&j()};return window.addEventListener("scroll",y,{capture:!0}),()=>window.removeEventListener("scroll",y,{capture:!0})}},[p.trigger,j]),e.jsx(ct,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:g,onPointerDownOutside:x,onFocusOutside:y=>y.preventDefault(),onDismiss:j,children:e.jsxs(Et,{"data-state":p.stateAttribute,...b,...C,ref:n,style:{...C.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(ts,{children:c}),e.jsx(Zt,{scope:s,isInside:!0,children:e.jsx(mt,{id:p.contentId,role:"tooltip",children:d||c})})]})})});Ue.displayName=W;var Ye="TooltipArrow",ss=m.forwardRef((o,n)=>{const{__scopeTooltip:s,...c}=o,d=ce(s);return es(Ye,s).isInside?null:e.jsx(At,{...d,...c,ref:n})});ss.displayName=Ye;function rs(o,n){const s=Math.abs(n.top-o.y),c=Math.abs(n.bottom-o.y),d=Math.abs(n.right-o.x),g=Math.abs(n.left-o.x);switch(Math.min(s,c,d,g)){case g:return"left";case d:return"right";case s:return"top";case c:return"bottom";default:throw new Error("unreachable")}}function as(o,n,s=5){const c=[];switch(n){case"top":c.push({x:o.x-s,y:o.y+s},{x:o.x+s,y:o.y+s});break;case"bottom":c.push({x:o.x-s,y:o.y-s},{x:o.x+s,y:o.y-s});break;case"left":c.push({x:o.x+s,y:o.y-s},{x:o.x+s,y:o.y+s});break;case"right":c.push({x:o.x-s,y:o.y-s},{x:o.x-s,y:o.y+s});break}return c}function os(o){const{top:n,right:s,bottom:c,left:d}=o;return[{x:d,y:n},{x:s,y:n},{x:s,y:c},{x:d,y:c}]}function ns(o,n){const{x:s,y:c}=o;let d=!1;for(let g=0,x=n.length-1;g<n.length;x=g++){const C=n[g],p=n[x],b=C.x,j=C.y,y=p.x,S=p.y;j>c!=S>c&&s<(y-b)*(c-j)/(S-j)+b&&(d=!d)}return d}function is(o){const n=o.slice();return n.sort((s,c)=>s.x<c.x?-1:s.x>c.x?1:s.y<c.y?-1:s.y>c.y?1:0),ls(n)}function ls(o){if(o.length<=1)return o.slice();const n=[];for(let c=0;c<o.length;c++){const d=o[c];for(;n.length>=2;){const g=n[n.length-1],x=n[n.length-2];if((g.x-x.x)*(d.y-x.y)>=(g.y-x.y)*(d.x-x.x))n.pop();else break}n.push(d)}n.pop();const s=[];for(let c=o.length-1;c>=0;c--){const d=o[c];for(;s.length>=2;){const g=s[s.length-1],x=s[s.length-2];if((g.x-x.x)*(d.y-x.y)>=(g.y-x.y)*(d.x-x.x))s.pop();else break}s.push(d)}return s.pop(),n.length===1&&s.length===1&&n[0].x===s[0].x&&n[0].y===s[0].y?n:n.concat(s)}var cs=qe,ds=He,ms=Ge,Je=Ue;const us=cs,Oe=ds,Fe=ms,fe=m.forwardRef(({className:o,sideOffset:n=4,...s},c)=>e.jsx(Je,{ref:c,sideOffset:n,className:ut("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",o),...s}));fe.displayName=Je.displayName;function Z({children:o,className:n="",title:s}){return e.jsxs("div",{className:`w-full max-w-full bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mx-2 sm:mx-0 ${n}`,children:[s&&e.jsx("div",{className:"px-4 sm:px-6 py-4 bg-gradient-to-r from-amber-100 to-orange-100 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-amber-900 leading-tight",children:s})}),e.jsx("div",{className:"p-4 sm:p-6 space-y-4",children:o})]})}function ps({categoryLabel:o,criteria:n}){return e.jsxs(ze,{children:[e.jsx(Le,{asChild:!0,children:e.jsxs(I,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 ml-2 hover:bg-blue-100 rounded-full",type:"button",children:[e.jsx(ne,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"sr-only",children:["View criteria for ",o]})]})}),e.jsx(Me,{className:"w-96 max-h-96 overflow-y-auto",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold text-sm border-b pb-2",children:[o," - Rating Criteria"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>e.jsx(P,{className:"border-l-4",style:{borderLeftColor:s>=4?"#10B981":s>=3?"#F59E0B":"#EF4444"},children:e.jsxs(D,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:Array.from({length:5},(c,d)=>e.jsx(ie,{className:`w-3 h-3 ${d<s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},d))}),e.jsxs(ee,{variant:"secondary",className:"text-xs",children:["Rating ",s]})]}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:n[s]})]})},s))})]})})]})}function xs({categoryLabel:o,criteria:n}){return e.jsxs(ze,{children:[e.jsx(Le,{asChild:!0,children:e.jsxs(I,{variant:"outline",size:"sm",className:"w-full mt-2 text-xs",type:"button",children:[e.jsx(ne,{className:"h-3 w-3 mr-2"}),"View Rating Guide"]})}),e.jsx(Me,{className:"w-80 max-h-80 overflow-y-auto",align:"center",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold text-sm border-b pb-2",children:[o," - Rating Criteria"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>e.jsx(P,{className:"border-l-4",style:{borderLeftColor:s>=4?"#10B981":s>=3?"#F59E0B":"#EF4444"},children:e.jsxs(D,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:Array.from({length:5},(c,d)=>e.jsx(ie,{className:`w-3 h-3 ${d<s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},d))}),e.jsxs(ee,{variant:"secondary",className:"text-xs",children:["Rating ",s]})]}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:n[s]})]})},s))})]})})]})}function Fs({onBack:o}){const{isMobile:n}=pt(),{toast:s}=xt();m.useEffect(()=>{const t=a=>{const l=a.target;l&&typeof l.closest=="function"&&l.closest("[data-radix-select-content]")&&(a.preventDefault(),a.stopPropagation())};return document.addEventListener("scroll",t,{passive:!1}),()=>{document.removeEventListener("scroll",t)}},[]);const c={exterior:2,gym_bleachers:1,classroom:3,cafeteria:1,utility_storage:1,admin_office:2,hallway:3,stairwell:2,restroom:2,staff_single_restroom:1},d={exterior:"Exterior",gym_bleachers:"Gym and Bleachers",classroom:"Classroom",cafeteria:"Cafeteria",utility_storage:"Utility Or Storage",admin_office:"Admin or Office Area",hallway:"Hallway",stairwell:"Stairwell",restroom:"Restroom",staff_single_restroom:"Staff or Single Restroom"},g={exterior:zt,gym_bleachers:Ht,classroom:Rt,cafeteria:Vt,utility_storage:Gt,admin_office:Bt,hallway:$t,stairwell:kt,restroom:Mt,staff_single_restroom:ht},x=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[C,p]=m.useState(!1),[b,j]=m.useState(()=>{const t={};return Object.keys(c).forEach(a=>{t[a]=0}),t}),[y,S]=m.useState([]),[f,w]=m.useState(!1),[T,k]=m.useState(!1),[R,_]=m.useState([]),[q,z]=m.useState(!1),[r,L]=m.useState({inspectorName:"",school:"",date:`${new Date().getFullYear()}-${String(new Date().getMonth()+1).padStart(2,"0")}-${String(new Date().getDate()).padStart(2,"0")}`,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}),[h,je]=m.useState(null),[se,We]=m.useState(!1),[E,re]=m.useState(null),[Q,ve]=m.useState(!1),[M,X]=m.useState({}),[ae,ye]=m.useState(null),[Ne,we]=m.useState(!1),[K,Ce]=m.useState(null);m.useEffect(()=>{We(Object.entries(c).every(([a,l])=>b[a]>=l))},[b]);const B=m.useMemo(()=>{const t=Object.values(c).reduce((v,A)=>v+A,0),a=Object.values(b).reduce((v,A)=>v+A,0),l=Object.entries(c).filter(([v,A])=>b[v]>=A).length,i=Object.entries(c).filter(([v,A])=>b[v]>0&&b[v]<A).length,u=Object.keys(c).length-l-i,N=t>0?Math.round(a/t*100):0;return{totalRequired:t,totalCompleted:a,completedCategories:l,inProgressCategories:i,notStartedCategories:u,overallPercentage:N,totalCategories:Object.keys(c).length}},[b,c]);m.useEffect(()=>{p(!0),(async()=>{try{const l=await fetch("/api/inspections?type=whole_building&incomplete=true");if(l.ok){const i=await l.json();S(i),i.length>0&&w(!0)}}catch(l){console.error("Error loading available inspections:",l)}})(),ft(),Ke();const a=bt();console.log("Building inspection storage stats:",a)},[]),m.useEffect(()=>{if(E&&h&&(r.inspectorName||r.school||r.date)){const t=setTimeout(()=>{Xe()},2e3);return()=>clearTimeout(t)}},[r,h,E]);const Qe=()=>`building_form_${E}_${h}_${Date.now()}`,Xe=async()=>{if(!(!E||!h)){we(!0);try{const t=K||Qe();K||Ce(t);const a={id:t,buildingInspectionId:E,selectedCategory:h,formData:{...r},lastModified:new Date().toISOString(),title:`${r.school} - Building - ${d[h]||h}`};jt(`${ke.DRAFT_BUILDING_INSPECTION}_${t}`,a),ye(new Date)}catch(t){console.error("Error saving form draft:",t)}finally{we(!1)}}},Ke=()=>{try{const t=localStorage.getItem("building_form_drafts");if(t){const a=JSON.parse(t),l=a.filter(i=>{const u=new Date(i.lastModified),N=new Date;return N.setDate(N.getDate()-7),u>N});l.length!==a.length&&localStorage.setItem("building_form_drafts",JSON.stringify(l))}}catch(t){console.error("Error loading form drafts:",t)}},Ze=()=>{if(K){vt(`${ke.DRAFT_BUILDING_INSPECTION}_${K}`);const t=JSON.parse(localStorage.getItem("building_form_drafts")||"[]"),a=t.filter(l=>l.id!==K);a.length!==t.length&&localStorage.setItem("building_form_drafts",JSON.stringify(a)),Ce(null),ye(null)}},et=async t=>{try{re(t.id);const a={inspectorName:t.inspectorName||"",school:t.school,date:t.date,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""};L(a);const l=await fetch(`/api/inspections/${t.id}/rooms`);if(l.ok){const i=await l.json(),u={};Object.keys(c).forEach(N=>{u[N]=i.filter(v=>v.roomType===N).length}),j(u),k(!0),w(!1)}}catch(a){console.error("Error loading inspection:",a)}},me=()=>{w(!1),k(!1),re(null),j(()=>{const t={};return Object.keys(c).forEach(a=>{t[a]=0}),t}),L(t=>({...t,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}))},O=(t,a)=>{L(l=>({...l,[t]:a}))},tt=(t,a,l)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(xs,{categoryLabel:t.label,criteria:t.criteria}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"Rate this category:"}),e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:[1,2,3,4,5].map(i=>e.jsx("button",{type:"button",className:"p-2 rounded-md hover:bg-yellow-50 transition-colors touch-manipulation",onClick:()=>l(i),children:e.jsx(ie,{className:`w-6 h-6 ${i<=a&&a>0?"fill-yellow-400 text-yellow-400":"text-muted-foreground hover:text-yellow-300"}`})},i))}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:`px-4 py-2 rounded-md border text-sm font-medium transition-colors touch-manipulation ${a===-1?"bg-muted border-border text-foreground":"bg-card border-border text-muted-foreground hover:bg-muted"}`,onClick:()=>l(-1),children:"Not Rated"})})]}),e.jsx("div",{className:"text-center",children:a>0&&a!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-base font-semibold text-yellow-600",children:oe[a-1]?.label}),e.jsx("div",{className:"text-sm text-gray-600",children:oe[a-1]?.description})]}):e.jsx("div",{className:"text-base font-semibold text-gray-600",children:"No rating selected"})}),a>0&&a!==-1&&t?.criteria&&t.criteria[a]&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-1",children:["Detailed Criteria for ",a," Star",a>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:t.criteria[a]})]})]}),st=(t,a,l)=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select Rating:"}),e.jsx(ps,{categoryLabel:t.label,criteria:t.criteria})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(I,{type:"button",variant:a===-1?"default":"outline",size:"sm",className:"px-3 py-2 text-xs",onClick:()=>l(-1),children:"Not Rated"}),[1,2,3,4,5].map(i=>e.jsx(I,{type:"button",variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:()=>l(i),children:e.jsx(ie,{className:`w-6 h-6 ${i<=a&&a>0?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},i))]}),e.jsx("div",{className:"text-center",children:a>0&&a!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:oe[a-1]?.label}),e.jsx("div",{className:"text-sm text-gray-600",children:oe[a-1]?.description})]}):e.jsx("div",{className:"text-lg font-semibold text-gray-600",children:"No rating selected"})}),a>0&&a!==-1&&t?.criteria&&t.criteria[a]&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-2",children:["Detailed Criteria for ",a," Star",a>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:t.criteria[a]})]})]}),ue=t=>{const a=window.scrollY;je(t),w(!1),L(l=>({...l,roomNumber:"",locationDescription:"",locationCategory:t,floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""})),requestAnimationFrame(()=>{window.scrollTo({top:a,behavior:"instant"})}),setTimeout(()=>{window.scrollTo({top:a,behavior:"instant"})},10),setTimeout(()=>{window.scrollTo({top:a,behavior:"instant"})},50)},rt=async t=>{if(t.preventDefault(),X({}),!h){s({title:"Category Required",description:"Please select a category before submitting.",variant:"destructive"});return}const l=["inspectorName","school","date","roomNumber"].filter(i=>!r[i]);if(l.length>0){const i={};l.forEach(u=>{i[u]=!0}),X(i),s({title:"Missing Required Fields",description:"Please fill in the highlighted fields",variant:"destructive"});return}ve(!0);try{const i={inspectorName:r.inspectorName,school:r.school,date:r.date,inspectionType:"whole_building",locationDescription:r.locationDescription||`Building inspection for ${h}`,roomNumber:r.roomNumber||null,locationCategory:h,buildingName:null,buildingInspectionId:E||null,floors:r.floors>=0?r.floors:null,verticalHorizontalSurfaces:r.verticalHorizontalSurfaces>=0?r.verticalHorizontalSurfaces:null,ceiling:r.ceiling>=0?r.ceiling:null,restrooms:r.restrooms>=0?r.restrooms:null,customerSatisfaction:r.customerSatisfaction>=0?r.customerSatisfaction:null,trash:r.trash>=0?r.trash:null,projectCleaning:r.projectCleaning>=0?r.projectCleaning:null,activitySupport:r.activitySupport>=0?r.activitySupport:null,safetyCompliance:r.safetyCompliance>=0?r.safetyCompliance:null,equipment:r.equipment>=0?r.equipment:null,monitoring:r.monitoring>=0?r.monitoring:null,notes:r.notes||null,images:[],verifiedRooms:[],isCompleted:!1};console.log("Submitting building inspection:",i);const u=await fetch("/api/submit-building-inspection",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}),N=u.headers.get("content-type")||"";let v=null,A=null;try{N.includes("application/json")?v=await u.json():A=await u.text()}catch{try{A=await u.text()}catch{}}if(console.log("Submission response status:",u.status,"ctype:",N),v&&console.log("Submission response JSON:",v),!v&&A&&console.log("Submission response TEXT:",A.slice(0,300)),!u.ok){const H=v&&(v.message||v.error)||A||null;throw new Error(H||`HTTP error! status: ${u.status}`)}if(v&&(v.success||v.id)||u.ok)X({}),s({title:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(qt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Room Inspection Saved!"})]}),description:`${d[h]} room ${r.roomNumber} recorded successfully. Progress updated.`,className:"border-green-500 bg-green-50"}),v&&v.id&&!E&&(console.log("Setting buildingInspectionId from first submission:",v.id),re(v.id)),h&&j(H=>({...H,[h]:(H[h]||0)+1})),Ze(),L(H=>({...H,roomNumber:"",locationDescription:"",notes:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1})),je(null);else throw new Error(v.message||"Submission failed")}catch(i){console.error("Building inspection submission error:",i);let u="Failed to save inspection. Please check your connection and try again.";i instanceof TypeError&&i.message.includes("fetch")?u="Network error. Please check your internet connection.":i instanceof Error&&(i.message.includes("404")?u="Server endpoint not found. Please contact support.":i.message.includes("500")?u="Server error. Please try again later.":i.message&&i.message!=="Submission failed"&&(u=i.message)),s({title:"Submission Failed",description:u,variant:"destructive"})}finally{ve(!1)}},at=async()=>{if(!se){console.error("Please complete all required inspections before finalizing.");return}if(console.log("Attempting to finalize building inspection:",{buildingInspectionId:E,isAllComplete:se}),!E){console.error("No building inspection ID available for finalization"),s({title:"Finalization Failed",description:"No building inspection ID found. Please start a new inspection.",variant:"destructive"});return}try{console.log(`Calling finalize endpoint: /api/inspections/${E}/finalize`);const t=await fetch(`/api/inspections/${E}/finalize`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}});console.log("Finalize response status:",t.status);let a=t.ok,l=null;if(!a){try{const u=await t.json();l=u.error||u.message,console.log("Finalize endpoint error:",u)}catch{const N=await t.text();console.log("Finalize endpoint error (text):",N.slice(0,200)),l=N}console.log(`Trying PATCH fallback: /api/inspections/${E}`);const i=await fetch(`/api/inspections/${E}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({isCompleted:!0})});if(console.log("PATCH response status:",i.status),a=i.ok,!a){try{const u=await i.json();l=u.error||u.message||"Failed to finalize inspection",console.log("PATCH endpoint error:",u)}catch{const N=await i.text();console.log("PATCH endpoint error (text):",N.slice(0,200)),l=N||"Failed to finalize inspection"}throw new Error(l)}}z(!0),s({title:"ðŸŽ‰ Building Inspection Complete! ðŸŽ‰",description:"Excellent work! All required inspections submitted successfully. The building inspection is now finalized.",duration:5e3,className:"border-green-500 bg-green-50"}),console.log("Whole building inspection completed successfully!"),setTimeout(()=>{o&&o()},3e3)}catch(t){console.error("Error finalizing inspection:",t),s({title:"Finalization Failed",description:"Failed to finalize building inspection. Please try again.",variant:"destructive"})}};return e.jsx(us,{children:e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl space-y-6","data-loaded":C?"true":void 0,children:[!f&&e.jsx(P,{className:"border-primary/30",children:e.jsxs(D,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Start New Building Inspection"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Guided, step-by-step workflow to complete all required areas"})]}),e.jsx(I,{onClick:me,size:"lg",className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg transition-shadow min-h-[44px]",children:"ðŸ¢ Start New Building Inspection"})]})}),q&&e.jsx(P,{className:"border-green-300 bg-green-50",children:e.jsxs(D,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-800",children:"Building Inspection Finalized"}),e.jsx("div",{className:"text-sm text-green-700",children:"Your comprehensive inspection has been submitted successfully."})]}),e.jsx(I,{onClick:()=>{z(!1),me()},className:"bg-green-600 hover:bg-green-700 text-white",children:"Start New Building Inspection"})]})}),e.jsxs("div",{className:"mb-6",children:[o&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx(I,{variant:"outline",onClick:o,className:"flex-shrink-0 back-button",children:"â† Back"})}),e.jsx("div",{className:"flex justify-center px-4",children:e.jsxs(_t,{className:"w-full max-w-lg",children:[e.jsx(Ot,{asChild:!0,children:e.jsx(I,{variant:"ghost",className:"w-full p-3 h-auto font-normal text-center text-primary hover:text-primary/80 hover:bg-accent/10 border border-accent/30 rounded-lg text-sm sm:text-base leading-relaxed",children:"ðŸ“‹ How to conduct a whole building inspection â†“"})}),e.jsx(Ft,{className:"mt-3 p-4 bg-accent/10 rounded-lg border border-accent/30",children:e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 1: Getting Started"}),e.jsx("p",{children:"Enter your inspector name, select the school, and choose the inspection date. This information will be saved automatically."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 2: Complete Required Inspections"}),e.jsx("p",{children:'Each category below shows how many inspections are required (e.g., 3 Classrooms, 2 Restrooms). Click "Select" on any incomplete category to start inspecting that area type.'})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 3: Rate Each Area"}),e.jsx("p",{children:"For each room/area, rate the custodial performance using the 1-5 star system you're familiar with. Add room numbers and notes as needed."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 4: Track Progress"}),e.jsx("p",{children:"Your progress is saved automatically. Green checkmarks show completed categories. Return anytime to continue where you left off."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 5: Finalize"}),e.jsx("p",{children:'Once all required inspections are complete, the "Finalize Building Inspection" button will become available to submit your comprehensive inspection.'})]})]})})]})})]}),f&&e.jsxs(P,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Building Inspection Options"}),e.jsx(J,{children:"You can continue a previous inspection or start a new one"})]}),e.jsxs(D,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-lg",children:"Start New Inspection:"}),e.jsx(I,{onClick:me,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 border-2 border-green-600 hover:border-green-700 rounded-lg shadow-md hover:shadow-xl transition-all duration-200 text-lg min-h-[56px]",variant:"default",size:"lg",children:"ðŸ¢ Start New Building Inspection"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Begin a fresh comprehensive building inspection"})]}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Tt,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Or Continue Previous Inspection:"}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto border-2 border-amber-300 rounded-lg p-3 bg-amber-25 shadow-inner",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-amber-200",children:[e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Available Inspections"}),e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:[y.length," found"]})]}),y.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-amber-100 bg-amber-50 border-amber-200 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded-full font-medium",children:["#",a+1]}),e.jsx("div",{className:"font-medium text-amber-900",children:t.school})]}),e.jsxs("div",{className:"text-sm text-amber-700 mt-1",children:[new Date(t.date).toLocaleDateString(),t.inspectorName&&e.jsxs("span",{className:"block text-sm text-amber-800 font-medium",children:["Inspector: ",t.inspectorName]})]})]}),t.isCompleted?e.jsx(ee,{variant:"default",className:"bg-green-500",children:"Completed âœ“"}):e.jsx(I,{onClick:()=>et(t),variant:"outline",size:"sm",className:"border-amber-400 text-amber-700 hover:bg-amber-100 font-medium",children:"Continue"})]},t.id)),y.length>3&&e.jsx("div",{className:"text-center py-2 border-t border-amber-200 mt-2",children:e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-3 py-1 rounded-full",children:["â†• Scroll to see all ",y.length," ","inspections"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"These inspections were started but not completed"})]})]})]})]}),!T&&!f&&e.jsxs(P,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Building Information"}),e.jsx(J,{children:"Select the school and date for this inspection"})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"inspectorName",children:"Inspector Name *"}),e.jsx($,{id:"inspectorName",value:r.inspectorName,onChange:t=>O("inspectorName",t.target.value),placeholder:"Enter inspector name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"school",children:"School"}),e.jsxs(yt,{value:r.school,onValueChange:t=>O("school",t),children:[e.jsx(Nt,{children:e.jsx(wt,{placeholder:"Select school"})}),e.jsx(Ct,{children:x.map(t=>e.jsx(St,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"date",children:"Date"}),e.jsx($,{id:"date",type:"date",value:r.date,onChange:t=>O("date",t.target.value),required:!0})]})]})})]}),T&&e.jsxs(P,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Current Inspection"}),e.jsx(J,{children:"Continuing inspection progress"})]}),e.jsxs(D,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Inspector:"}),e.jsx("span",{children:r.inspectorName||"Not specified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"School:"}),e.jsx("span",{children:r.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{children:new Date(r.date).toLocaleDateString()})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(I,{onClick:()=>{w(!0),k(!1),re(null)},variant:"outline",size:"sm",children:"Switch to Different Inspection"})})]})]}),!f&&(r.school||r.date||T)&&e.jsx(P,{className:"border-primary/20 bg-gradient-to-r from-primary/5 to-primary/10 animate-in fade-in-0 slide-in-from-top-4 duration-500",children:e.jsx(D,{className:"py-4",children:e.jsxs("div",{className:"space-y-4",role:"region","aria-label":"Overall inspection progress summary",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"Overall Progress"}),e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(ne,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(fe,{className:"max-w-xs",children:e.jsx("p",{children:"Tracks completion across all required room categories. Complete all rooms in a category to mark it complete."})})]})]}),e.jsxs("span",{className:"text-2xl font-bold text-primary",children:[B.overallPercentage,"%"]})]}),e.jsx(pe,{value:B.overallPercentage,className:"h-3 bg-primary/10 transition-all duration-700 ease-out","aria-label":`Overall progress: ${B.overallPercentage}% complete`,"data-testid":"multi-progress"}),e.jsxs("p",{className:"text-sm text-muted-foreground text-center","aria-live":"polite","aria-atomic":"true",children:[B.totalCompleted," of ",B.totalRequired," rooms inspected"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-2 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Complete"})]}),e.jsx("p",{className:"text-xl font-bold text-green-700",children:B.completedCategories})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"In Progress"})]}),e.jsx("p",{className:"text-xl font-bold text-amber-700",children:B.inProgressCategories})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Not Started"})]}),e.jsx("p",{className:"text-xl font-bold text-gray-600",children:B.notStartedCategories})]})]})]})})}),!f&&(r.school||r.date||T)&&e.jsx(P,{className:"animate-in fade-in-0 slide-in-from-top-4 duration-500 delay-75",children:e.jsx(D,{className:"py-3",children:e.jsxs("div",{className:"space-y-2",role:"navigation","aria-label":"Category quick jump navigation",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Quick Jump"}),e.jsxs(Oe,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(ne,{className:"w-3.5 h-3.5 text-muted-foreground cursor-help"})}),e.jsx(fe,{className:"max-w-xs",children:e.jsx("p",{children:"Quickly switch between room categories. Green = complete, Amber = in progress, Gray = not started."})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Object.entries(c).map(([t,a])=>{const l=b[t],i=l>=a,u=l>0&&!i,N=g[t];return e.jsxs("button",{onClick:()=>{ue(t),window.scrollTo({top:0,behavior:"smooth"})},className:`flex-shrink-0 flex flex-col items-center gap-1 px-3 py-2 rounded-lg border-2 transition-all duration-200 ease-in-out hover:scale-105 active:scale-95 min-w-[80px] ${h===t?"border-blue-500 bg-blue-50 shadow-sm":i?"border-green-300 bg-green-50 hover:border-green-400":u?"border-amber-300 bg-amber-50 hover:border-amber-400":"border-gray-200 bg-white hover:border-gray-300"}`,disabled:!r.school||!r.date||!r.inspectorName.trim(),"aria-label":`Select ${d[t]} category. ${l} of ${a} rooms completed. ${i?"Complete":u?"In progress":"Not started"}.`,children:[N&&e.jsx(N,{className:`w-5 h-5 ${i?"text-green-600":u?"text-amber-600":"text-gray-500"}`}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:d[t].split(" ")[0]}),i&&e.jsx(xe,{className:"w-3 h-3 text-green-600"})]},t)})})]})})}),!f&&(n?e.jsxs(Z,{title:"Inspection Progress","data-inspection-progress":!0,children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Complete the required number of inspections for each category",r.school&&r.date&&e.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"(Progress is automatically saved)"})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(c).map(([t,a])=>{const l=b[t],i=l>=a,u=g[t];return e.jsx("div",{className:`p-4 rounded-lg border-l-4 border-y border-r ${i?"bg-green-50 border-l-green-500 border-y-green-200 border-r-green-200":h===t?"bg-blue-50 border-l-blue-500 border-y-blue-300 border-r-blue-300":l>0?"bg-amber-50 border-l-amber-500 border-y-amber-200 border-r-amber-200":"bg-gray-50 border-l-gray-300 border-y-gray-200 border-r-gray-200"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center flex-shrink-0 mt-0.5 ${i?"bg-green-500 border-green-500":"border-gray-400"}`,children:i&&e.jsx(xe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx(u,{className:`w-4 h-4 flex-shrink-0 ${i?"text-green-700":"text-gray-600"}`}),e.jsx("span",{className:`font-medium text-sm leading-tight ${i?"text-green-800":"text-gray-700"}`,children:d[t]})]}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ee,{variant:i?"default":"secondary",className:"text-xs",children:[l,"/",a," Done"]}),e.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[Math.round(l/a*100),"%"]})]}),e.jsx(pe,{value:l/a*100,className:"h-2"}),!i&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(I,{size:"sm",variant:"outline",onClick:()=>ue(t),className:`text-xs px-3 min-h-[44px] w-full ${h===t?"border-blue-500 bg-blue-50 shadow-sm":""}`,children:"Select"})]})]})]})})},t)})})]}):e.jsxs(P,{"data-inspection-progress":!0,children:[e.jsxs(G,{children:[e.jsx(U,{children:"Inspection Progress"}),e.jsxs(J,{children:["Complete the required number of inspections for each category",r.school&&r.date&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Progress is automatically saved)"})]})]}),e.jsx(D,{className:"space-y-4",children:Object.entries(c).map(([t,a])=>{const l=b[t],i=l>=a,u=g[t];return e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border-l-4 border-y border-r ${i?"bg-green-50 border-l-green-500 border-y-green-200 border-r-green-200":h===t?"bg-blue-50 border-l-blue-500 border-y-blue-300 border-r-blue-300":l>0?"bg-amber-50 border-l-amber-500 border-y-amber-200 border-r-amber-200":"bg-gray-50 border-l-gray-300 border-y-gray-200 border-r-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center flex-shrink-0 ${i?"bg-green-500 border-green-500":"border-gray-400"}`,children:i&&e.jsx(xe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx(u,{className:`w-4 h-4 flex-shrink-0 ${i?"text-green-700":"text-gray-600"}`}),e.jsx("span",{className:`font-medium ${i?"text-green-800":"text-gray-700"}`,children:d[t]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(pe,{value:l/a*100,className:"h-2 flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground font-medium whitespace-nowrap",children:[Math.round(l/a*100),"%"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs(ee,{variant:i?"default":"secondary",children:[l,"/",a," Completed"]}),!i&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(I,{size:"sm",variant:"outline",onClick:()=>ue(t),className:`min-h-[44px] px-4 ${h===t?"border-blue-500 bg-blue-50 shadow-sm":""}`,children:"Select"})]})]},t)})})]})),!f&&h&&!(r.school&&r.date&&r.inspectorName.trim())&&e.jsx(P,{className:"border-amber-200 bg-amber-50",children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:"Complete Required Information"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Please fill in all required fields above before you can start rating this category:"}),e.jsxs("ul",{className:"text-sm text-amber-700 mt-2 space-y-1",children:[!r.inspectorName.trim()&&e.jsx("li",{children:"â€¢ Inspector Name is required"}),!r.school&&e.jsx("li",{children:"â€¢ School selection is required"}),!r.date&&e.jsx("li",{children:"â€¢ Inspection date is required"})]})]})]})})}),!f&&h&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(P,{className:"bg-muted/30",children:e.jsx(D,{className:"py-3",children:e.jsxs("nav",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(gt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-medium text-foreground",children:r.school}),e.jsx(Ae,{className:"w-4 h-4 mx-2"}),e.jsx("span",{className:"font-medium text-foreground",children:d[h]}),r.roomNumber&&e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4 mx-2"}),e.jsxs("span",{className:"text-primary font-semibold",children:["Room ",r.roomNumber]})]})]})})}),!f&&h&&r.school&&r.date&&r.inspectorName.trim()&&e.jsxs("form",{onSubmit:rt,className:`space-y-4 ${n?"":"space-y-6"}`,children:[n?e.jsxs(Z,{title:`Inspecting: ${d[h]}`,children:[ae&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-muted-foreground",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",ae.toLocaleTimeString()]})]}),Ne&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-blue-600",children:[e.jsx(_e,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"roomNumber",className:`text-base font-medium ${M.roomNumber?"text-destructive":""}`,children:"Room Number *"}),e.jsx($,{id:"roomNumber",className:`h-12 text-base ${M.roomNumber?"border-destructive focus-visible:ring-destructive":""}`,value:r.roomNumber,onChange:t=>{O("roomNumber",t.target.value),M.roomNumber&&X(a=>({...a,roomNumber:!1}))},placeholder:"Enter room number",required:!0}),M.roomNumber&&e.jsx("p",{className:"text-sm text-destructive",children:"Room number is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"locationDescription",className:"text-base font-medium",children:"Location Description"}),e.jsx($,{id:"locationDescription",className:"h-12 text-base",value:r.locationDescription,onChange:t=>O("locationDescription",t.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})]}):e.jsxs(P,{children:[e.jsxs(G,{children:[e.jsxs(U,{children:["Inspecting: ",d[h]]}),e.jsxs(J,{children:["Complete the inspection for this category",ae&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",ae.toLocaleTimeString()]})]}),Ne&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-blue-600",children:[e.jsx(_e,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]})]})]}),e.jsx(D,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"roomNumber",className:M.roomNumber?"text-destructive":"",children:"Room Number *"}),e.jsx($,{id:"roomNumber",className:M.roomNumber?"border-destructive focus-visible:ring-destructive":"",value:r.roomNumber,onChange:t=>{O("roomNumber",t.target.value),M.roomNumber&&X(a=>({...a,roomNumber:!1}))},placeholder:"Enter room number",required:!0}),M.roomNumber&&e.jsx("p",{className:"text-sm text-destructive",children:"Room number is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"locationDescription",children:"Location Description"}),e.jsx($,{id:"locationDescription",value:r.locationDescription,onChange:t=>O("locationDescription",t.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})})]}),n?e.jsx(Z,{title:"Rate Each Category",children:e.jsx("div",{className:"space-y-4",children:Ee.map((t,a)=>e.jsx(Ie,{title:t.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:tt(t,r[t.key],l=>O(t.key,l))},t.key))})}):e.jsx("div",{className:"grid gap-4 grid-cols-1 lg:grid-cols-2",children:Ee.map((t,a)=>{const l=t.key;return e.jsx(Ie,{title:t.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:st(t,r[l],i=>O(l,i))},t.key)})}),n?e.jsx(Z,{title:"Additional Notes",children:e.jsx(De,{value:r.notes,onChange:t=>O("notes",t.target.value),placeholder:"Enter any additional observations...",rows:4,className:"text-base min-h-[120px]"})}):e.jsxs(P,{children:[e.jsx(G,{children:e.jsx(U,{children:"Additional Notes"})}),e.jsx(D,{children:e.jsx(De,{value:r.notes,onChange:t=>O("notes",t.target.value),placeholder:"Enter any additional observations...",rows:4})})]}),n?e.jsx(Z,{title:"Photo Documentation",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(F,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Upload Images"})]}),e.jsx($,{id:"image-upload",type:"file",multiple:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${t.target.files.length} photo${t.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",t.target.files.length,"files"),t.target.value="")},className:"hidden"})]}),e.jsxs(F,{htmlFor:"camera-capture",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Pe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Take Photo"})]}),e.jsx($,{id:"camera-capture",type:"file",accept:"image/*",capture:"environment",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",t.target.files[0].name),t.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload existing images or take new photos to document the inspection"})]})}):e.jsxs(P,{children:[e.jsxs(G,{children:[e.jsx(U,{children:"Photo Documentation"}),e.jsx(J,{children:"Upload images or take photos to document the inspection"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{htmlFor:"image-upload-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"Upload Images"})]}),e.jsx($,{id:"image-upload-desktop",type:"file",multiple:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${t.target.files.length} photo${t.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",t.target.files.length,"files"),t.target.value="")},className:"hidden"})]}),e.jsxs(F,{htmlFor:"camera-capture-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Take Photo"})]}),e.jsx($,{id:"camera-capture-desktop",type:"file",accept:"image/*",capture:"environment",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",t.target.files[0].name),t.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select multiple images from your device or take new photos with your camera"})]})]}),e.jsx(I,{type:"submit",size:"lg",className:`w-full bg-blue-600 hover:bg-blue-700 shadow-md hover:shadow-lg transition-shadow ${n?"min-h-[56px] text-lg":"min-h-[48px]"}`,disabled:Q,children:Q?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(Lt,{className:"w-5 h-5 animate-spin"}),"Saving inspection..."]}):`Submit ${d[h]} Inspection`})]}),!f&&e.jsxs("div",{className:`border-t ${n?"pt-4":"pt-6"}`,children:[e.jsx(I,{onClick:at,size:"lg",className:`w-full bg-green-600 hover:bg-green-700 shadow-md hover:shadow-xl transition-all ${n?"min-h-[56px] text-base":"min-h-[48px]"}`,disabled:!se,children:n?"Finalize Building Inspection":"Finalize Whole Building Inspection"}),!se&&e.jsx("p",{className:`text-center text-gray-500 mt-2 ${n?"text-xs px-2":"text-sm"}`,children:n?"Complete all required inspections first":"Complete all required inspections to enable this button"})]}),!f&&h&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50 animate-in fade-in-0 zoom-in-95 duration-300",children:e.jsx(I,{type:"button",onClick:t=>{const a=document.querySelector("form");if(a){const l=new Event("submit",{bubbles:!0,cancelable:!0});a.dispatchEvent(l)}},disabled:Q,className:`rounded-full shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 ${n?"w-14 h-14":"w-16 h-16"} bg-blue-600 hover:bg-blue-700 text-white`,title:"Quick Submit Room","aria-label":Q?"Submitting room inspection":`Quick submit ${d[h]} inspection`,children:Q?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ut,{className:"w-6 h-6"})})})]})})}export{Fs as default};
