import{k as X,j as e,d as c,g as o,h as d,B as E,p as F,a as L,i as h,e as x,b as Y,u as Z,r as m,f as A}from"./index-Dj6S0Vds.js";import{L as O,I as $}from"./label-DPKhZwfT.js";import{P as R,T as H}from"./progress-DBHkj_-y.js";import{a as _,T as U}from"./triangle-alert-CBsF3DUH.js";import{L as V}from"./LoadingOverlay-WhG99yva.js";import{C as ee}from"./calendar-QUPaxMV6.js";import{B as q}from"./building-2-Cr9uGgar.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=X("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);function M({school:N,score:s,complianceStatus:k,dateRange:g,compact:C=!1}){const j=k??{text:s.level2Compliant?"Meets Standards":"Below Standards",color:s.overallScore>=3?"green":s.overallScore>=2?"yellow":"red"},w=s.overallScore/5*100,r=a=>a>=4?"text-green-700":a>=3?"text-green-600":a>=2?"text-yellow-600":"text-red-600",D=a=>a>=4?"bg-green-600":a>=3?"bg-green-500":a>=2?"bg-yellow-500":"bg-red-500",u=a=>{switch(a){case"green":return"default";case"yellow":return"secondary";case"red":return"destructive";default:return"outline"}};return C?e.jsxs(c,{className:"hover:shadow-md transition-shadow",children:[e.jsxs(o,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"text-lg",children:N}),e.jsxs(E,{variant:u(j.color),children:[s.level2Compliant?e.jsx(F,{className:"w-3 h-3 mr-1"}):e.jsx(L,{className:"w-3 h-3 mr-1"}),j.text]})]}),g&&e.jsxs(h,{className:"text-xs",children:[g.start," to ",g.end]})]}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-2xl font-bold",style:{color:r(s.overallScore)},children:s.overallScore.toFixed(2)}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"/ 5.0"})]}),e.jsx(R,{value:w,className:D(s.overallScore)}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Inspections"}),e.jsx("div",{className:"font-semibold",children:s.inspectionCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Notes"}),e.jsx("div",{className:"font-semibold",children:s.notesCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground",children:"Avg Rating"}),e.jsx("div",{className:"font-semibold",children:s.inspectionScore.toFixed(1)})]})]})]})})]}):e.jsxs(c,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-2xl",children:N}),g&&e.jsxs(h,{children:["Period: ",g.start," to ",g.end]})]}),e.jsxs(E,{variant:u(j.color),className:"text-sm px-3 py-1",children:[s.level2Compliant?e.jsx(F,{className:"w-4 h-4 mr-1"}):e.jsx(L,{className:"w-4 h-4 mr-1"}),j.text]})]})}),e.jsxs(x,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("div",{className:"text-6xl font-bold",style:{color:r(s.overallScore)},children:s.overallScore.toFixed(2)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Overall Building Score (out of 5.0)"}),e.jsx(R,{value:w,className:`h-3 ${D(s.overallScore)}`})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Inspection Average"}),e.jsx("div",{className:"text-2xl font-bold",children:s.inspectionScore.toFixed(2)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["75% weight • ",s.inspectionCount," inspections"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium text-muted-foreground",children:"Notes Impact"}),e.jsxs("div",{className:"text-2xl font-bold flex items-center gap-1",children:[s.notesModifier>0?e.jsx(H,{className:"w-5 h-5 text-green-600"}):s.notesModifier<0?e.jsx(_,{className:"w-5 h-5 text-red-600"}):null,s.notesModifier>0?"+":"",s.notesModifier.toFixed(2)]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["25% weight • ",s.notesCount," notes"]})]})]}),s.categoryBreakdown&&s.categoryBreakdown.length>0&&e.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[e.jsx("div",{className:"text-sm font-medium",children:"Category Breakdown"}),e.jsx("div",{className:"space-y-2",children:s.categoryBreakdown.filter(a=>a.count>0).sort((a,f)=>f.averageRating-a.averageRating).slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:a.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{value:a.averageRating/5*100,className:"w-24 h-2"}),e.jsx("span",{className:"text-sm font-semibold w-12 text-right",children:a.averageRating.toFixed(1)})]})]},a.category))}),s.categoryBreakdown.filter(a=>a.count>0).length>5&&e.jsx("div",{className:"text-xs text-muted-foreground text-center",children:"Showing top 5 categories"})]}),e.jsx("div",{className:`p-3 rounded-lg border ${s.level2Compliant?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.level2Compliant?e.jsx(F,{className:"w-5 h-5 text-green-600"}):e.jsx(L,{className:"w-5 h-5 text-yellow-600"}),e.jsx("div",{className:"text-sm",children:s.level2Compliant?e.jsx("span",{className:"font-semibold text-green-800",children:"Meets Level 2 Standards (≥3.0)"}):e.jsx("span",{className:"font-semibold text-yellow-800",children:"Below Level 2 Standards (target: ≥3.0)"})})]})})]})]})}function de({onBack:N}){const{toast:s}=Y(),{isMobile:k}=Z(),[g,C]=m.useState(!0),[j,w]=m.useState(!1),[r,D]=m.useState([]),[u,a]=m.useState(""),[f,B]=m.useState(""),[te,z]=m.useState([]);m.useEffect(()=>{const t=new Date,l=new Date(t);l.setDate(t.getDate()-30),B(t.toISOString().split("T")[0]),a(l.toISOString().split("T")[0])},[]);const P=async(t,l)=>{try{C(!0);const i=new URLSearchParams;t&&i.append("startDate",t),l&&i.append("endDate",l);const p=new AbortController,T=setTimeout(()=>p.abort(),15e3),b=await fetch(`/api/scores?${i.toString()}`,{signal:p.signal});if(clearTimeout(T),!b.ok){const v=await b.json().catch(()=>({message:"Failed to fetch scores"}));throw new Error(v.message||"Failed to fetch scores")}const n=await b.json();D(n.scores||[]),z(n.scores||[])}catch(i){console.error("Error fetching scores:",i);let p="Failed to load building scores. Please try again.";i instanceof Error&&(i.name==="AbortError"?p="Request timed out. Please check your connection and try again.":i.message.includes("fetch")&&(p="Unable to connect to the server. Please check your internet connection.")),s({title:"Error",description:p,variant:"destructive",duration:5e3})}finally{C(!1),w(!1)}};m.useEffect(()=>{u&&f&&P(u,f)},[u,f]);const G=()=>{w(!0),P(u,f)},J=()=>{const t=new Date,l=new Date(t);l.setDate(t.getDate()-30),B(t.toISOString().split("T")[0]),a(l.toISOString().split("T")[0])},{compliantCount:K,totalSchools:I,compliancePercentage:Q,averageScore:W,topPerformer:y,needsAttention:S}=m.useMemo(()=>{const t=r.filter(n=>n.score.level2Compliant).length,l=r.length,i=l>0?t/l*100:0,p=r.length>0?r.reduce((n,v)=>n+v.score.overallScore,0)/r.length:0,T=r.length>0?r.reduce((n,v)=>v.score.overallScore>n.score.overallScore?v:n):null,b=r.filter(n=>n.score.overallScore<3);return{compliantCount:t,totalSchools:l,compliancePercentage:i,averageScore:p,topPerformer:T,needsAttention:b}},[r]);return g&&!j?e.jsx(V,{message:"Loading building scores..."}):e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Building Scores Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track custodial performance across all campuses"})]}),N&&e.jsx(A,{variant:"outline",onClick:N,children:"← Back"})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(d,{className:"text-lg flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Filter by Date Range"]}),e.jsx(h,{children:"View scores for a specific time period"})]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:G,disabled:j,children:[e.jsx(se,{className:`w-4 h-4 mr-2 ${j?"animate-spin":""}`}),"Refresh"]})]})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"startDate",children:"Start Date"}),e.jsx($,{id:"startDate",type:"date",value:u,onChange:t=>a(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{htmlFor:"endDate",children:"End Date"}),e.jsx($,{id:"endDate",type:"date",value:f,onChange:t=>B(t.target.value)})]}),e.jsx("div",{className:"space-y-2 flex items-end",children:e.jsx(A,{variant:"secondary",onClick:J,className:"w-full",children:"Last 30 Days"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsxs(o,{className:"pb-3",children:[e.jsx(h,{children:"Total Schools"}),e.jsx(d,{className:"text-3xl",children:I})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Monitored campuses"})]})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"pb-3",children:[e.jsx(h,{children:"Level 2 Compliance"}),e.jsxs(d,{className:"text-3xl text-green-600",children:[Q.toFixed(0),"%"]})]}),e.jsx(x,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[K," of ",I," schools ≥3.0"]})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"pb-3",children:[e.jsx(h,{children:"Network Average"}),e.jsx(d,{className:"text-3xl",children:W.toFixed(2)})]}),e.jsx(x,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Across all schools"})})]}),e.jsxs(c,{children:[e.jsxs(o,{className:"pb-3",children:[e.jsx(h,{children:"Needs Attention"}),e.jsx(d,{className:"text-3xl text-yellow-600",children:S.length})]}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{children:"Below Level 2"})]})})]})]}),y&&e.jsxs(c,{className:"bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:[e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-green-600"}),e.jsx(d,{className:"text-lg",children:"Top Performer"})]})}),e.jsx(x,{children:e.jsx(M,{school:y.school,score:y.score,complianceStatus:y.complianceStatus,dateRange:y.dateRange,compact:k})})]}),S.length>0&&e.jsxs(c,{className:"bg-yellow-50 border-yellow-200",children:[e.jsxs(o,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-600"}),e.jsx(d,{className:"text-lg",children:"Schools Needing Attention"})]}),e.jsxs(h,{children:[S.length," ",S.length===1?"school is":"schools are"," below Level 2 standards"]})]}),e.jsx(x,{children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:S.map(t=>e.jsx(M,{school:t.school,score:t.score,complianceStatus:t.complianceStatus,dateRange:t.dateRange,compact:!0},t.school))})})]}),e.jsxs(c,{children:[e.jsxs(o,{children:[e.jsx(d,{children:"All School Scores"}),e.jsxs(h,{children:["Showing ",r.length," schools sorted by overall score"]})]}),e.jsxs(x,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:r.map(t=>e.jsx(M,{school:t.school,score:t.score,complianceStatus:t.complianceStatus,dateRange:t.dateRange,compact:!0},t.school))}),r.length===0&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No scores available for the selected date range."}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your date filters or refresh the page."})]})]})]})]})}export{de as default};
