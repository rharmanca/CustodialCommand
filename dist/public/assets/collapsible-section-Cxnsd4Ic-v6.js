var G=Object.defineProperty,B=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var y=(e,s,t)=>s in e?G(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,u=(e,s)=>{for(var t in s||(s={}))_.call(s,t)&&y(e,t,s[t]);if(b)for(var t of b(s))I.call(s,t)&&y(e,t,s[t]);return e},g=(e,s)=>B(e,P(s));var f=(e,s)=>{var t={};for(var a in e)_.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(e!=null&&b)for(var a of b(e))s.indexOf(a)<0&&I.call(e,a)&&(t[a]=e[a]);return t};var w=(e,s,t)=>new Promise((a,r)=>{var n=l=>{try{d(t.next(l))}catch(c){r(c)}},m=l=>{try{d(t.throw(l))}catch(c){r(c)}},d=l=>l.done?a(l.value):Promise.resolve(l.value).then(n,m);d((t=t.apply(e,s)).next())});import{S as i,j as o,c as p}from"./index-DZ3U2-uZ-v6.js";import{F as k,r as N,V as z,G as A,I as X,H as Y,J as T,K as J,M as U,N as K,Q,S as R,U as j,W as V,X as M}from"./ui-DdZ73ZY3-v6.js";import{C as v,a as W,b as H,c as Z}from"./icons-JPeedV9x-v6.js";const x={DRAFT_INSPECTION:"custodial-draft-inspection",DRAFT_BUILDING_INSPECTION:"custodial-draft-building-inspection",DRAFT_CUSTODIAL_NOTE:"custodial-draft-custodial-note",USER_PREFERENCES:"custodial-user-preferences",LEGACY_INSPECTION_DRAFTS:"custodial_inspection_drafts",LEGACY_BUILDING_DRAFTS:"building_form_drafts"},h={MAX_DRAFT_SIZE:5*1024*1024,MAX_TOTAL_STORAGE:8*1024*1024,MAX_DRAFTS_PER_TYPE:10,IMAGE_QUALITY:.7,MAX_IMAGE_DIMENSIONS:{width:1200,height:1200}},S=()=>{let e=0;const s=i.keys();for(const t of s){const a=i.getItem(t);a&&(e+=a.length+t.length)}return e},$=e=>new Promise((s,t)=>{const a=document.createElement("canvas"),r=a.getContext("2d"),n=new Image;n.onload=()=>{const{width:m,height:d}=h.MAX_IMAGE_DIMENSIONS;let{width:l,height:c}=n;if(l>m||c>d){const D=Math.min(m/l,d/c);l*=D,c*=D}a.width=l,a.height=c,r==null||r.drawImage(n,0,0,l,c);const F=a.toDataURL("image/jpeg",h.IMAGE_QUALITY);s(F)},n.onerror=t,n.src=URL.createObjectURL(e)}),ie=(e,s)=>{try{const t={data:s,timestamp:Date.now()},a=JSON.stringify(t);if(a.length>h.MAX_DRAFT_SIZE){console.warn(`Draft too large (${Math.round(a.length/1024)}KB). Skipping save.`);return}if(S()+a.length>h.MAX_TOTAL_STORAGE&&(E(),S()+a.length>h.MAX_TOTAL_STORAGE)){console.warn("Storage limit reached. Cannot save draft.");return}i.setItem(e,a)}catch(t){if(console.error("Failed to save draft to localStorage:",t),t instanceof Error&&t.name==="QuotaExceededError"){E();try{i.setItem(e,JSON.stringify({data:s,timestamp:Date.now()}))}catch(a){console.error("Failed to save draft even after cleanup:",a)}}}},me=e=>{try{const s=i.getItem(e);if(!s)return null;const t=JSON.parse(s);return Date.now()-t.timestamp>10080*60*1e3?(i.removeItem(e),null):t.data}catch(s){return console.error("Failed to load draft from localStorage:",s),null}},ce=e=>{try{i.removeItem(e)}catch(s){console.error("Failed to clear draft from localStorage:",s)}},E=()=>{try{const e=Date.now()-6048e5,s=[],t=i.keys();for(const a of t)if(a.startsWith("custodial-"))try{const r=i.getItem(a);if(r){const n=JSON.parse(r);n.timestamp&&n.timestamp<e&&s.push(a)}}catch(r){s.push(a)}s.forEach(a=>i.removeItem(a)),console.log(`Cleaned up ${s.length} old drafts`)}catch(e){console.error("Failed to cleanup old drafts:",e)}},de=()=>{try{i.getItem(x.LEGACY_INSPECTION_DRAFTS)&&(console.log("Migrating legacy inspection drafts..."),i.removeItem(x.LEGACY_INSPECTION_DRAFTS)),i.getItem(x.LEGACY_BUILDING_DRAFTS)&&(console.log("Migrating legacy building inspection drafts..."),i.removeItem(x.LEGACY_BUILDING_DRAFTS)),E()}catch(e){console.error("Failed to migrate legacy drafts:",e)}},ue=e=>w(null,null,function*(){try{return e.size<500*1024?new Promise((s,t)=>{const a=new FileReader;a.onload=()=>s(a.result),a.onerror=t,a.readAsDataURL(e)}):yield $(e)}catch(s){throw console.error("Failed to process image for storage:",s),s}}),fe=()=>{const e=S(),s=i.keys().filter(t=>t.startsWith("custodial-")).length;return{totalSizeKB:Math.round(e/1024),totalSizeMB:Math.round(e/(1024*1024)*100)/100,draftCount:s,limitMB:Math.round(h.MAX_TOTAL_STORAGE/(1024*1024)),usagePercent:Math.round(e/h.MAX_TOTAL_STORAGE*100)}},pe=k,Ne=z,q=N.forwardRef((r,a)=>{var n=r,{className:e,children:s}=n,t=f(n,["className","children"]);return o.jsxDEV(A,g(u({ref:a,className:p("flex h-10 w-full items-center justify-between rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground","transition-all duration-200 ease-out","border-3 border-[hsl(var(--border))] bg-[hsl(var(--card))] text-[hsl(var(--card-foreground))]","focus:outline-none focus:ring-0 focus:border-[hsl(var(--primary))] focus:shadow-[0_0_0_4px_hsl(var(--primary)_/_0.2)] focus:bg-[hsl(var(--background))]","hover:border-[hsl(var(--primary)_/_0.8)] hover:shadow-[0_0_0_2px_hsl(var(--primary)_/_0.1)]","disabled:cursor-not-allowed disabled:opacity-50","transform-gpu will-change-auto","[&>span]:line-clamp-1",e)},t),{children:[s,o.jsxDEV(X,{asChild:!0,children:o.jsxDEV(v,{className:"h-4 w-4 opacity-50"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:39,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:38,columnNumber:5},void 0)]}),void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:16,columnNumber:3},void 0)});q.displayName=A.displayName;const L=N.forwardRef((a,t)=>{var r=a,{className:e}=r,s=f(r,["className"]);return o.jsxDEV(R,g(u({ref:t,className:p("flex cursor-default items-center justify-center py-1",e)},s),{children:o.jsxDEV(H,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:57,columnNumber:5},void 0)}),void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:49,columnNumber:3},void 0)});L.displayName=R.displayName;const O=N.forwardRef((a,t)=>{var r=a,{className:e}=r,s=f(r,["className"]);return o.jsxDEV(j,g(u({ref:t,className:p("flex cursor-default items-center justify-center py-1",e)},s),{children:o.jsxDEV(v,{className:"h-4 w-4"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:74,columnNumber:5},void 0)}),void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:66,columnNumber:3},void 0)});O.displayName=j.displayName;const ee=N.forwardRef((n,r)=>{var m=n,{className:e,children:s,position:t="popper"}=m,a=f(m,["className","children","position"]);return o.jsxDEV(Y,{children:o.jsxDEV(T,g(u({ref:r,className:p("relative z-[9999] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-white text-gray-900 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t},a),{children:[o.jsxDEV(L,{},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:96,columnNumber:7},void 0),o.jsxDEV(J,{className:p("p-1 bg-white",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:97,columnNumber:7},void 0),o.jsxDEV(O,{},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:106,columnNumber:7},void 0)]}),void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:85,columnNumber:5},void 0)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:84,columnNumber:3},void 0)});ee.displayName=T.displayName;const se=N.forwardRef((a,t)=>{var r=a,{className:e}=r,s=f(r,["className"]);return o.jsxDEV(V,u({ref:t,className:p("py-1.5 pl-8 pr-2 text-sm font-semibold",e)},s),void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:116,columnNumber:3},void 0)});se.displayName=V.displayName;const te=N.forwardRef((r,a)=>{var n=r,{className:e,children:s}=n,t=f(n,["className","children"]);return o.jsxDEV(U,g(u({ref:a,className:p("relative flex w-full cursor-pointer select-none items-center rounded-sm py-2 pl-8 pr-4 text-sm bg-white text-gray-900 outline-none hover:bg-gray-100 focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e)},t),{children:[o.jsxDEV("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsxDEV(K,{children:o.jsxDEV(W,{className:"h-4 w-4 text-blue-600"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:138,columnNumber:9},void 0)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:137,columnNumber:7},void 0)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:136,columnNumber:5},void 0),o.jsxDEV(Q,{className:"truncate",children:s},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:142,columnNumber:5},void 0)]}),void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:128,columnNumber:3},void 0)});te.displayName=U.displayName;const ae=N.forwardRef((a,t)=>{var r=a,{className:e}=r,s=f(r,["className"]);return o.jsxDEV(M,u({ref:t,className:p("-mx-1 my-1 h-px bg-muted",e)},s),void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/select.tsx",lineNumber:151,columnNumber:3},void 0)});ae.displayName=M.displayName;function C(...e){return e.filter(Boolean).join(" ")}function he({title:e,children:s,defaultCollapsed:t=!0,className:a,titleClassName:r,contentClassName:n,disabled:m=!1}){const[d,l]=N.useState(t),c=()=>{m||l(!d)};return o.jsxDEV("div",{className:C("border border-gray-200 rounded-lg overflow-hidden",a||""),children:[o.jsxDEV("button",{type:"button",onClick:c,disabled:m,className:C("w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer",m?"cursor-not-allowed opacity-50":"",r||""),children:[o.jsxDEV("span",{className:"text-base",children:e},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:47,columnNumber:9},this),d?o.jsxDEV(Z,{className:"w-5 h-5 transition-transform duration-200"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:49,columnNumber:11},this):o.jsxDEV(v,{className:"w-5 h-5 transition-transform duration-200"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:51,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:37,columnNumber:7},this),o.jsxDEV("div",{className:C("transition-all duration-300 ease-in-out overflow-hidden",d?"max-h-0":"max-h-[2000px]"),children:o.jsxDEV("div",{className:C("p-4 pt-0",n||""),children:s},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:61,columnNumber:9},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:55,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:36,columnNumber:5},this)}export{he as C,pe as S,q as a,Ne as b,ee as c,te as d,x as e,ce as f,fe as g,me as l,de as m,ue as p,ie as s};
