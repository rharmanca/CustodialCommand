var B=Object.defineProperty,P=Object.defineProperties;var k=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var b=(e,t,a)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,f=(e,t)=>{for(var a in t||(t={}))T.call(t,a)&&b(e,a,t[a]);if(y)for(var a of y(t))E.call(t,a)&&b(e,a,t[a]);return e},S=(e,t)=>P(e,k(t));var u=(e,t)=>{var a={};for(var r in e)T.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(e!=null&&y)for(var r of y(e))t.indexOf(r)<0&&E.call(e,r)&&(a[r]=e[r]);return a};var v=(e,t,a)=>new Promise((r,s)=>{var n=l=>{try{m(a.next(l))}catch(d){s(d)}},c=l=>{try{m(a.throw(l))}catch(d){s(d)}},m=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,c);m((a=a.apply(e,t)).next())});import{S as i,c as p}from"./index-BaYUFHT0-v6.js";import{F as z,r as g,V as X,j as o,G as D,I as Y,H as J,J as R,K,M as j,N as Q,Q as V,S as C,U as M,W as L,X as O}from"./ui-BqtzBtHj-v6.js";import{C as w,a as W,b as H,c as Z}from"./icons-CP4MPgx_-v6.js";const x={DRAFT_INSPECTION:"custodial-draft-inspection",DRAFT_BUILDING_INSPECTION:"custodial-draft-building-inspection",DRAFT_CUSTODIAL_NOTE:"custodial-draft-custodial-note",USER_PREFERENCES:"custodial-user-preferences",LEGACY_INSPECTION_DRAFTS:"custodial_inspection_drafts",LEGACY_BUILDING_DRAFTS:"building_form_drafts"},h={MAX_DRAFT_SIZE:5*1024*1024,MAX_TOTAL_STORAGE:8*1024*1024,MAX_DRAFTS_PER_TYPE:10,IMAGE_QUALITY:.7,MAX_IMAGE_DIMENSIONS:{width:1200,height:1200}},_=()=>{let e=0;const t=i.keys();for(const a of t){const r=i.getItem(a);r&&(e+=r.length+a.length)}return e},$=e=>new Promise((t,a)=>{const r=document.createElement("canvas"),s=r.getContext("2d"),n=new Image;n.onload=()=>{const{width:c,height:m}=h.MAX_IMAGE_DIMENSIONS;let{width:l,height:d}=n;if(l>c||d>m){const A=Math.min(c/l,m/d);l*=A,d*=A}r.width=l,r.height=d,s==null||s.drawImage(n,0,0,l,d);const U=r.toDataURL("image/jpeg",h.IMAGE_QUALITY);t(U)},n.onerror=a,n.src=URL.createObjectURL(e)}),ie=(e,t)=>{try{const a={data:t,timestamp:Date.now()},r=JSON.stringify(a);if(r.length>h.MAX_DRAFT_SIZE){console.warn(`Draft too large (${Math.round(r.length/1024)}KB). Skipping save.`);return}if(_()+r.length>h.MAX_TOTAL_STORAGE&&(I(),_()+r.length>h.MAX_TOTAL_STORAGE)){console.warn("Storage limit reached. Cannot save draft.");return}i.setItem(e,r)}catch(a){if(console.error("Failed to save draft to localStorage:",a),a instanceof Error&&a.name==="QuotaExceededError"){I();try{i.setItem(e,JSON.stringify({data:t,timestamp:Date.now()}))}catch(r){console.error("Failed to save draft even after cleanup:",r)}}}},ce=e=>{try{const t=i.getItem(e);if(!t)return null;const a=JSON.parse(t);return Date.now()-a.timestamp>10080*60*1e3?(i.removeItem(e),null):a.data}catch(t){return console.error("Failed to load draft from localStorage:",t),null}},de=e=>{try{i.removeItem(e)}catch(t){console.error("Failed to clear draft from localStorage:",t)}},I=()=>{try{const e=Date.now()-6048e5,t=[],a=i.keys();for(const r of a)if(r.startsWith("custodial-"))try{const s=i.getItem(r);if(s){const n=JSON.parse(s);n.timestamp&&n.timestamp<e&&t.push(r)}}catch(s){t.push(r)}t.forEach(r=>i.removeItem(r)),console.log(`Cleaned up ${t.length} old drafts`)}catch(e){console.error("Failed to cleanup old drafts:",e)}},me=()=>{try{i.getItem(x.LEGACY_INSPECTION_DRAFTS)&&(console.log("Migrating legacy inspection drafts..."),i.removeItem(x.LEGACY_INSPECTION_DRAFTS)),i.getItem(x.LEGACY_BUILDING_DRAFTS)&&(console.log("Migrating legacy building inspection drafts..."),i.removeItem(x.LEGACY_BUILDING_DRAFTS)),I()}catch(e){console.error("Failed to migrate legacy drafts:",e)}},fe=e=>v(null,null,function*(){try{return e.size<500*1024?new Promise((t,a)=>{const r=new FileReader;r.onload=()=>t(r.result),r.onerror=a,r.readAsDataURL(e)}):yield $(e)}catch(t){throw console.error("Failed to process image for storage:",t),t}}),ue=()=>{const e=_(),t=i.keys().filter(a=>a.startsWith("custodial-")).length;return{totalSizeKB:Math.round(e/1024),totalSizeMB:Math.round(e/(1024*1024)*100)/100,draftCount:t,limitMB:Math.round(h.MAX_TOTAL_STORAGE/(1024*1024)),usagePercent:Math.round(e/h.MAX_TOTAL_STORAGE*100)}},pe=z,ge=X,q=g.forwardRef((s,r)=>{var n=s,{className:e,children:t}=n,a=u(n,["className","children"]);return o.jsxs(D,S(f({ref:r,className:p("flex h-10 w-full items-center justify-between rounded-md bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground","transition-all duration-200 ease-out","border-3 border-[hsl(var(--border))] bg-[hsl(var(--card))] text-[hsl(var(--card-foreground))]","focus:outline-none focus:ring-0 focus:border-[hsl(var(--primary))] focus:shadow-[0_0_0_4px_hsl(var(--primary)_/_0.2)] focus:bg-[hsl(var(--background))]","hover:border-[hsl(var(--primary)_/_0.8)] hover:shadow-[0_0_0_2px_hsl(var(--primary)_/_0.1)]","disabled:cursor-not-allowed disabled:opacity-50","transform-gpu will-change-auto","[&>span]:line-clamp-1",e)},a),{children:[t,o.jsx(Y,{asChild:!0,children:o.jsx(w,{className:"h-4 w-4 opacity-50"})})]}))});q.displayName=D.displayName;const F=g.forwardRef((r,a)=>{var s=r,{className:e}=s,t=u(s,["className"]);return o.jsx(C,S(f({ref:a,className:p("flex cursor-default items-center justify-center py-1",e)},t),{children:o.jsx(H,{className:"h-4 w-4"})}))});F.displayName=C.displayName;const G=g.forwardRef((r,a)=>{var s=r,{className:e}=s,t=u(s,["className"]);return o.jsx(M,S(f({ref:a,className:p("flex cursor-default items-center justify-center py-1",e)},t),{children:o.jsx(w,{className:"h-4 w-4"})}))});G.displayName=M.displayName;const ee=g.forwardRef((n,s)=>{var c=n,{className:e,children:t,position:a="popper"}=c,r=u(c,["className","children","position"]);return o.jsx(J,{children:o.jsxs(R,S(f({ref:s,className:p("relative z-[9999] max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-white text-gray-900 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:a},r),{children:[o.jsx(F,{}),o.jsx(K,{className:p("p-1 bg-white",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),o.jsx(G,{})]}))})});ee.displayName=R.displayName;const te=g.forwardRef((r,a)=>{var s=r,{className:e}=s,t=u(s,["className"]);return o.jsx(L,f({ref:a,className:p("py-1.5 pl-8 pr-2 text-sm font-semibold",e)},t))});te.displayName=L.displayName;const ae=g.forwardRef((s,r)=>{var n=s,{className:e,children:t}=n,a=u(n,["className","children"]);return o.jsxs(j,S(f({ref:r,className:p("relative flex w-full cursor-pointer select-none items-center rounded-sm py-2 pl-8 pr-4 text-sm bg-white text-gray-900 outline-none hover:bg-gray-100 focus:bg-gray-100 focus:text-gray-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e)},a),{children:[o.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:o.jsx(Q,{children:o.jsx(W,{className:"h-4 w-4 text-blue-600"})})}),o.jsx(V,{className:"truncate",children:t})]}))});ae.displayName=j.displayName;const re=g.forwardRef((r,a)=>{var s=r,{className:e}=s,t=u(s,["className"]);return o.jsx(O,f({ref:a,className:p("-mx-1 my-1 h-px bg-muted",e)},t))});re.displayName=O.displayName;function N(...e){return e.filter(Boolean).join(" ")}function he({title:e,children:t,defaultCollapsed:a=!0,className:r,titleClassName:s,contentClassName:n,disabled:c=!1}){const[m,l]=g.useState(a),d=()=>{c||l(!m)};return o.jsxs("div",{className:N("border border-gray-200 rounded-lg overflow-hidden",r||""),children:[o.jsxs("button",{type:"button",onClick:d,disabled:c,className:N("w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer",c?"cursor-not-allowed opacity-50":"",s||""),children:[o.jsx("span",{className:"text-base",children:e}),m?o.jsx(Z,{className:"w-5 h-5 transition-transform duration-200"}):o.jsx(w,{className:"w-5 h-5 transition-transform duration-200"})]}),o.jsx("div",{className:N("transition-all duration-300 ease-in-out overflow-hidden",m?"max-h-0":"max-h-[2000px]"),children:o.jsx("div",{className:N("p-4 pt-0",n||""),children:t})})]})}export{he as C,pe as S,q as a,ge as b,ee as c,ae as d,x as e,de as f,ue as g,ce as l,me as m,fe as p,ie as s};
