import{r as x,j as e}from"./ui-C40ArZlv-v6.js";import{u as L,B as f,C as N,d as y,e as C,f as w,g as S}from"./index-BSmjchPe-v6.js";import{L as l,I as m}from"./label-BbwW0rT_-v6.js";import{T as M}from"./textarea-TkGUltd2-v6.js";import"./vendor-Dvwkxfce-v6.js";function B({onBack:g}){const{toast:r}=L(),[i,U]=x.useState({inspectorName:"",school:"",date:"",location:"",locationDescription:"",notes:""}),[u,v]=x.useState([]),[h,j]=x.useState([]),[b,D]=x.useState(!1),c=(t,s)=>{U(o=>({...o,[t]:s}))},I=t=>{const s=t.target.files;if(s&&s.length>0){const a=Array.from(s).filter(n=>n.size>5242880?(r({variant:"destructive",title:"File Too Large",description:`File "${n.name}" is too large. Maximum size is 5MB per file.`}),!1):!0);if(a.length>0){const R=5-u.length,d=a.slice(0,R);d.length<a.length&&r({title:"Maximum Images Reached",description:`Only ${d.length} images were added. Maximum of 5 images allowed.`}),v(p=>[...p,...d]);const k=d.map(p=>URL.createObjectURL(p));j(p=>[...p,...k]),r({title:"üì∏ Photos Uploaded Successfully!",description:`Successfully added ${d.length} photo${d.length>1?"s":""} to your custodial note documentation.`,duration:3e3})}}t.target.value=""},P=()=>{if(u.length>=5){r({variant:"destructive",title:"Maximum Images Reached",description:"Maximum of 5 images allowed. Please remove some images first."});return}const t=document.createElement("input");t.type="file",t.accept="image/*",t.capture="environment",t.onchange=s=>{const o=s;o.target.files&&o.target.files.length>0&&r({title:"üì∑ Photo Captured Successfully!",description:"Camera photo is being processed and added to your documentation.",duration:2e3}),I(o)},t.click()},F=t=>{const s=u.filter((a,n)=>n!==t),o=h.filter((a,n)=>n!==t);URL.revokeObjectURL(h[t]),v(s),j(o)},E=async t=>{if(t.preventDefault(),!b){if(!i.inspectorName.trim()||!i.school||!i.date){r({variant:"destructive",title:"Missing Required Fields",description:"Please fill in Inspector Name, School, and Date before submitting.",duration:6e3});return}if(!i.location.trim()){r({variant:"destructive",title:"Location Required",description:"Please provide the location of the custodial concern.",duration:6e3});return}D(!0);try{const s=new FormData;Object.entries(i).forEach(([a,n])=>{s.append(a,n)}),u.forEach(a=>{s.append("images",a)});const o=await fetch("/api/custodial-notes",{method:"POST",body:s});if(o.ok)r({title:"‚úÖ Custodial Note Submitted Successfully!",description:"Your custodial concern has been recorded and will be reviewed.",variant:"default",duration:5e3}),U({inspectorName:"",school:"",date:"",location:"",locationDescription:"",notes:""}),v([]),h.forEach(a=>URL.revokeObjectURL(a)),j([]),setTimeout(()=>{g&&g()},3e3);else{const a=await o.json().catch(()=>({message:"Unknown error"}));r({variant:"destructive",title:"Submission Failed",description:`Error: ${a.message||"Unable to submit custodial note. Please try again."}`,duration:7e3})}}catch(s){console.error("Error submitting custodial note:",s),r({variant:"destructive",title:"Network Error",description:"Unable to connect to the server. Please check your connection and try again.",duration:7e3})}finally{D(!1)}}};return e.jsxs("div",{className:"max-w-3xl mx-auto p-6 space-y-6",children:[g&&e.jsx(f,{onClick:g,variant:"outline",className:"mb-4 back-button",children:"‚Üê Back to Custodial"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-800 mb-2",children:"Submit Custodial Note"}),e.jsx("p",{className:"text-gray-600",children:"Report maintenance issues, concerns, or general observations"})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Basic Information"}),e.jsx(w,{children:"Enter the basic details for this custodial note"})]}),e.jsxs(S,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"inspectorName",children:["Inspector Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"inspectorName",value:i.inspectorName,onChange:t=>c("inspectorName",t.target.value),placeholder:"Enter your name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"school",children:["School ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"school",value:i.school,onChange:t=>c("school",t.target.value),placeholder:"Enter school name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(l,{htmlFor:"date",children:["Date ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"date",type:"date",value:i.date,onChange:t=>c("date",t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"location",children:"Location"}),e.jsx(m,{id:"location",value:i.location,onChange:t=>c("location",t.target.value),placeholder:"e.g., Room 105, Gymnasium, Cafeteria",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"locationDescription",children:"Location Description"}),e.jsx(m,{id:"locationDescription",value:i.locationDescription,onChange:t=>c("locationDescription",t.target.value),placeholder:"e.g., Main Building, East Wing, 2nd Floor"})]})]})]}),e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Issue Description & Notes"}),e.jsx(w,{children:"Provide detailed information about the custodial issue or observation"})]}),e.jsx(S,{children:e.jsx(M,{value:i.notes,onChange:t=>c("notes",t.target.value),placeholder:`Describe the issue, maintenance need, or observation...

Examples:
‚Ä¢ Broken equipment or fixtures
‚Ä¢ Cleaning supply needs
‚Ä¢ Safety concerns
‚Ä¢ Maintenance requests
‚Ä¢ General observations
‚Ä¢ Follow-up needed`,rows:10,className:"min-h-[250px]"})})]}),e.jsxs(N,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Photos & Documentation"}),e.jsx(w,{children:"Upload images or capture photos to document the issue"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{htmlFor:"imageUpload",className:"block mb-2",children:"Upload Images"}),e.jsx(m,{id:"imageUpload",type:"file",accept:"image/*",multiple:!0,onChange:I,className:"cursor-pointer"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(f,{type:"button",onClick:P,variant:"outline",className:"w-full sm:w-auto",children:"üì∑ Capture Photo"})})]}),h.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs(l,{className:"block mb-2",children:["Uploaded Images (",u.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:h.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,alt:`Upload ${s+1}`,className:"w-full h-24 object-cover rounded-lg border"}),e.jsx(f,{type:"button",onClick:()=>F(s),variant:"destructive",size:"sm",className:"absolute top-1 right-1 w-6 h-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity",children:"√ó"})]},s))})]})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(f,{type:"submit",size:"lg",disabled:b,className:"w-full md:w-auto disabled:bg-gray-400 disabled:cursor-not-allowed",children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"‚è≥"}),"Submitting..."]}):"Report a Problem"})})]})]})}export{B as default};
//# sourceMappingURL=custodial-notes-Dg_wBeMu-v6.js.map
