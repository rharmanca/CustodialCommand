var k=(u,o,r)=>new Promise((C,h)=>{var p=t=>{try{i(r.next(t))}catch(m){h(m)}},g=t=>{try{i(r.throw(t))}catch(m){h(m)}},i=t=>t.done?C(t.value):Promise.resolve(t.value).then(p,g);i((r=r.apply(u,o)).next())});import{r as l,j as e,F as M,G as K}from"./vendor-CMBJxBzW-v6.js";import{a as Q,B as I,T as X,g as Z,h as O,i as B,I as _,S as D,p as E,q as V,r as U,s as n,bi as ee,bj as ae,bk as se}from"./index-Bmw8JvtW-v6.js";import"./ui-BA32w1ww-v6.js";import"./utils-Cj9wHvoQ-v6.js";import"./forms-HLAU01A5-v6.js";import"./charts-core-BWDZW6UT-v6.js";import"./pdf-export-BdvsPuIF-v6.js";const re=["ASA","LCA","GWC","OA","CBR","WLC"],le=["January","February","March","April","May","June","July","August","September","October","November","December"];function be({onBack:u}){const{toast:o}=Q(),[r,C]=l.useState([]),[h,p]=l.useState(!0),[g,i]=l.useState(null),[t,m]=l.useState(!1),[Y,P]=l.useState(!1),[b,j]=l.useState(""),[f,S]=l.useState("all"),[N,w]=l.useState("all"),[x,F]=l.useState("all");l.useEffect(()=>{y(),R()},[]);const R=()=>{const a=localStorage.getItem("admin-session-token");P(!!a)},y=()=>k(null,null,function*(){try{const a=yield fetch("/api/monthly-feedback");if(a.ok){const s=yield a.json();Array.isArray(s)?C(s):(console.error("Invalid data format from API"),o({variant:"destructive",title:"Data Error",description:"Received invalid data format from server."}))}else throw new Error("Failed to fetch feedback")}catch(a){console.error("Error fetching feedback:",a),o({variant:"destructive",title:"Failed to Load",description:"Unable to load monthly feedback. Please try again."})}finally{p(!1)}}),v=l.useMemo(()=>Array.isArray(r)?r.filter(a=>{var s,d,A,L,T;if(!a||typeof a!="object"||f!=="all"&&a.school!==f||N!=="all"&&a.year!==parseInt(N)||x!=="all"&&a.month!==x)return!1;if(b){const c=b.toLowerCase();if(!(((s=a.school)==null?void 0:s.toLowerCase().includes(c))||((d=a.month)==null?void 0:d.toLowerCase().includes(c))||((A=a.year)==null?void 0:A.toString().includes(c))||((L=a.extractedText)==null?void 0:L.toLowerCase().includes(c))||((T=a.notes)==null?void 0:T.toLowerCase().includes(c))))return!1}return!0}):[],[r,f,N,x,b]),$=()=>{j(""),S("all"),w("all"),F("all")},J=a=>a,z=l.useMemo(()=>{if(!Array.isArray(r))return[];const a=r.map(s=>s.year).filter(s=>typeof s=="number").sort((s,d)=>d-s);return Array.from(new Set(a))},[r]),G=a=>{i(a),m(!0)},W=a=>{const s=document.createElement("a");s.href=a.pdfUrl,s.download=a.pdfFileName||`feedback-${a.month}-${a.year}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},q=a=>k(null,null,function*(){try{const s=localStorage.getItem("admin-session-token");if((yield fetch(`/api/monthly-feedback/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok)o({title:"Deleted Successfully",description:"Monthly feedback has been deleted."}),m(!1),y();else throw new Error("Delete failed")}catch(s){o({variant:"destructive",title:"Delete Failed",description:"Failed to delete feedback. Please try again."})}}),H=()=>{y()};return e.jsxDEV("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[u&&e.jsxDEV(I,{onClick:u,variant:"outline",className:"mb-4 back-button",children:"← Back to Home"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:185,columnNumber:9},this),e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Monthly Feedback Reports"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:191,columnNumber:9},this),e.jsxDEV("p",{className:"text-muted-foreground",children:"Upload and manage monthly custodial feedback emails"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:192,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:190,columnNumber:7},this),e.jsxDEV(X,{defaultValue:"browse",className:"w-full",children:[e.jsxDEV(Z,{className:"grid w-full grid-cols-2",children:[e.jsxDEV(O,{value:"browse",children:[e.jsxDEV(M,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:198,columnNumber:13},this),"Browse Feedback"]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:197,columnNumber:11},this),e.jsxDEV(O,{value:"upload",children:"Upload New Feedback"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:201,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:196,columnNumber:9},this),e.jsxDEV(B,{value:"browse",className:"space-y-6",children:[e.jsxDEV("div",{className:"space-y-4",role:"search",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxDEV("div",{className:"space-y-2",children:e.jsxDEV(_,{placeholder:"Search by title, uploader, notes or month…",value:b,onChange:a=>j(a.target.value),className:"w-full","aria-label":"Search feedback by title, uploader, notes or month"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:209,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:208,columnNumber:15},this),e.jsxDEV(D,{value:f,onValueChange:S,children:[e.jsxDEV(E,{"aria-label":"Filter by school",children:e.jsxDEV(V,{placeholder:"All Schools"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:220,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:219,columnNumber:15},this),e.jsxDEV(U,{children:[e.jsxDEV(n,{value:"all",children:"All Schools"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:223,columnNumber:17},this),re.map(a=>e.jsxDEV(n,{value:a,title:J(a),children:a},a,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:225,columnNumber:19},this))]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:222,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:218,columnNumber:13},this),e.jsxDEV(D,{value:N,onValueChange:w,children:[e.jsxDEV(E,{"aria-label":"Filter by year",children:e.jsxDEV(V,{placeholder:"All Years"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:232,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:231,columnNumber:15},this),e.jsxDEV(U,{children:[e.jsxDEV(n,{value:"all",children:"All Years"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:235,columnNumber:17},this),z.map(a=>e.jsxDEV(n,{value:a.toString(),children:a},a,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:237,columnNumber:19},this))]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:234,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:230,columnNumber:13},this),e.jsxDEV(D,{value:x,onValueChange:F,children:[e.jsxDEV(E,{"aria-label":"Filter by month",children:e.jsxDEV(V,{placeholder:"All Months"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:244,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:243,columnNumber:15},this),e.jsxDEV(U,{children:[e.jsxDEV(n,{value:"all",children:"All Months"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:247,columnNumber:17},this),le.map(a=>e.jsxDEV(n,{value:a,children:a},a,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:249,columnNumber:19},this))]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:246,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:242,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:207,columnNumber:13},this),e.jsxDEV("div",{className:"flex justify-end",children:e.jsxDEV(I,{onClick:$,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsxDEV(K,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:263,columnNumber:17},this),"Clear Filters"]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:257,columnNumber:15},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:256,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:206,columnNumber:11},this),h?e.jsxDEV("div",{className:"text-center py-12",children:e.jsxDEV("p",{className:"text-muted-foreground",children:"Loading feedback..."},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:272,columnNumber:15},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:271,columnNumber:13},this):v.length===0?e.jsxDEV("div",{className:"text-center py-12",children:[e.jsxDEV(M,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:276,columnNumber:15},this),e.jsxDEV("h3",{className:"text-lg font-medium mb-2",children:"No Feedback Found"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:277,columnNumber:15},this),e.jsxDEV("p",{className:"text-muted-foreground",children:r.length===0?"No monthly feedback has been uploaded yet.":"No feedback matches your search criteria."},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:278,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:275,columnNumber:13},this):e.jsxDEV(e.Fragment,{children:[e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:["Showing ",v.length," of ",r.length," feedback report",r.length!==1?"s":""]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:286,columnNumber:15},this),e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(a=>e.jsxDEV(ee,{feedback:a,onView:G,onDownload:W},a.id,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:291,columnNumber:19},this))},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:289,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:285,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:204,columnNumber:9},this),e.jsxDEV(B,{value:"upload",children:e.jsxDEV(ae,{onUploadSuccess:H},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:304,columnNumber:11},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:303,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:195,columnNumber:7},this),e.jsxDEV(se,{feedback:g,isOpen:t,onClose:()=>m(!1),onDelete:q,isAdmin:Y},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:308,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:183,columnNumber:5},this)}export{be as default};
