import{k as se,j as e,c as M,u as ye,b as Ne,r as l,d as f,g as S,h as k,i as w,e as v,f as n,B as I}from"./index-GKxhZO_L.js";import{L as r,I as d}from"./label-CvlsU2fj.js";import{T as H}from"./textarea-lCue8RB5.js";import{S as $,a as _,b as B,c as V,d as E}from"./select-CKTagLCK.js";import{D as W,e as U,a as G,b as J,c as K,d as Q}from"./dialog-BX9W4XVJ.js";import{A as Ce,h as be,a as Se,b as ke,c as we,d as De,e as Te,f as Ae,g as Ie}from"./alert-dialog-C0DAypte.js";import{T as Ee,a as Le,b as X,d as Y}from"./tabs-BVyrBRgY.js";import{i as Fe}from"./custodial-criteria-aPNJLI_7.js";import{L as Oe}from"./loader-circle-fQjYq6p4.js";import{S as Z}from"./settings-5xAkIPcs.js";import{T as ze}from"./trash-2-Cv4CNQbM.js";import"./Combination-r3vHoB5T.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=se("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=se("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Re=({size:u="md",className:m,text:p="Loading..."})=>{const g={sm:"w-4 h-4",md:"w-6 h-6",lg:"w-8 h-8"};return e.jsxs("div",{className:M("flex flex-col items-center justify-center p-8",m),children:[e.jsx(Oe,{className:M("animate-spin text-primary",g[u])}),p&&e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:p})]})},qe=Re;function Xe({onBack:u}){ye();const{toast:m}=Ne(),[p,g]=l.useState([]),[ae,L]=l.useState(!0),[y,F]=l.useState(null),[te,O]=l.useState(!1),[ie,h]=l.useState(!1),[N,D]=l.useState({username:"",password:""}),[z,j]=l.useState(""),[le,re]=l.useState("inspections"),[ne,P]=l.useState(null),[R,T]=l.useState({}),[oe,C]=l.useState(!1),[ce,b]=l.useState(null),de=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[o,c]=l.useState({inspectorName:"",school:"",date:"",inspectionType:"",locationDescription:"",roomNumber:"",locationCategory:"",floors:null,verticalHorizontalSurfaces:null,ceiling:null,restrooms:null,customerSatisfaction:null,trash:null,projectCleaning:null,activitySupport:null,safetyCompliance:null,equipment:null,monitoring:null,notes:"",isCompleted:!1});l.useEffect(()=>{localStorage.getItem("admin-session-token")?(h(!0),q()):L(!1)},[]);const me=async s=>{s.preventDefault(),j("");try{const t=await(await fetch("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:N.username,password:N.password})})).json();t.success?(h(!0),localStorage.setItem("admin-session-token",t.sessionToken),q()):j(t.message||"Invalid username or password")}catch(a){console.error("Login error:",a),j("Network error. Please try again.")}},he=()=>{h(!1),localStorage.removeItem("admin-session-token"),D({username:"",password:""})},xe=s=>{P(s),T({label:s.label,criteria:{...s.criteria}}),C(!0)},ue=()=>{m({title:"✅ Criteria Updated",description:"Criteria updated successfully! (Note: This is a demo - changes are not persisted)"}),C(!1),P(null)},q=async()=>{try{const s=localStorage.getItem("admin-session-token");if(!s){h(!1);return}const a=await fetch("/api/admin/inspections",{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=await a.json();g(t.data||t)}else a.status===401?(h(!1),localStorage.removeItem("admin-session-token"),j("Session expired. Please login again.")):console.error("Failed to fetch inspections")}catch(s){console.error("Error fetching inspections:",s)}finally{L(!1)}},pe=async s=>{try{const a=localStorage.getItem("admin-session-token");if(!a){h(!1);return}const t=await fetch(`/api/admin/inspections/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});t.ok?(g(i=>i.filter(x=>x.id!==s)),m({title:"✅ Inspection Deleted",description:"Inspection deleted successfully"})):t.status===401?(h(!1),localStorage.removeItem("admin-session-token"),j("Session expired. Please login again.")):m({variant:"destructive",title:"Deletion Failed",description:"Failed to delete inspection"})}catch(a){console.error("Error deleting inspection:",a),m({variant:"destructive",title:"Network Error",description:"Error deleting inspection. Please check your connection and try again."})}},ge=s=>{F(s),c({inspectorName:s.inspectorName||"",school:s.school,date:s.date,inspectionType:s.inspectionType,locationDescription:s.locationDescription,roomNumber:s.roomNumber||"",locationCategory:s.locationCategory||"",floors:s.floors,verticalHorizontalSurfaces:s.verticalHorizontalSurfaces,ceiling:s.ceiling,restrooms:s.restrooms,customerSatisfaction:s.customerSatisfaction,trash:s.trash,projectCleaning:s.projectCleaning,activitySupport:s.activitySupport,safetyCompliance:s.safetyCompliance,equipment:s.equipment,monitoring:s.monitoring,notes:s.notes||"",isCompleted:s.isCompleted||!1}),O(!0)},A=()=>{O(!1),F(null)},je=async()=>{if(y)try{const s=await fetch(`/api/inspections/${y.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(s.ok){const a=await s.json();g(t=>t.map(i=>i.id===y.id?a:i)),A(),m({title:"✅ Inspection Updated",description:"Inspection updated successfully"})}else{const a=await s.json();alert(`Failed to update inspection: ${a.error}`)}}catch(s){console.error("Error updating inspection:",s),alert("Error updating inspection")}},fe=s=>new Date(s).toLocaleDateString(),ve=s=>s===null?"bg-gray-100 text-gray-800":s<=2?"bg-red-100 text-red-800":s<=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return ie?ae?e.jsx(qe,{text:"Loading inspections..."}):e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[u&&e.jsx(n,{variant:"outline",onClick:u,className:"flex-shrink-0",children:"← Back"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-gray-900",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage inspections and criteria"})]}),e.jsxs(n,{variant:"outline",onClick:he,className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(Pe,{className:"w-4 h-4"}),"Logout"]})]}),e.jsxs(Ee,{value:le,onValueChange:re,children:[e.jsxs(Le,{className:"grid w-full grid-cols-2",children:[e.jsx(X,{value:"inspections",children:"Manage Inspections"}),e.jsx(X,{value:"criteria",children:"Edit Criteria"})]}),e.jsx(Y,{value:"inspections",className:"space-y-4 mt-6",children:e.jsx("div",{className:"grid gap-4",children:p.length===0?e.jsx(f,{children:e.jsx(v,{className:"pt-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"No inspections found"})})}):p.map(s=>e.jsxs(f,{className:"overflow-hidden",children:[e.jsx(S,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"text-lg",children:[s.school," - ",s.locationDescription]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Date: ",fe(s.date)]}),s.inspectorName&&e.jsxs("div",{children:["Inspector: ",s.inspectorName]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",children:s.inspectionType}),s.isCompleted&&e.jsx(I,{variant:"default",children:"Completed"})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{open:te&&y?.id===s.id,onOpenChange:a=>{a||A()},children:[e.jsx(U,{asChild:!0,children:e.jsx(n,{variant:"outline",size:"sm",onClick:()=>ge(s),children:e.jsx(ee,{className:"w-4 h-4"})})}),e.jsxs(G,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsx(K,{children:"Edit Inspection"}),e.jsx(Q,{children:"Make changes to the inspection details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-inspector",children:"Inspector Name"}),e.jsx(d,{id:"edit-inspector",value:o.inspectorName,onChange:a=>c(t=>({...t,inspectorName:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-school",children:"School"}),e.jsxs($,{value:o.school,onValueChange:a=>c(t=>({...t,school:a})),children:[e.jsx(_,{children:e.jsx(B,{})}),e.jsx(V,{children:de.map(a=>e.jsx(E,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-date",children:"Date"}),e.jsx(d,{id:"edit-date",type:"date",value:o.date,onChange:a=>c(t=>({...t,date:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-type",children:"Inspection Type"}),e.jsxs($,{value:o.inspectionType,onValueChange:a=>c(t=>({...t,inspectionType:a})),children:[e.jsx(_,{children:e.jsx(B,{})}),e.jsxs(V,{children:[e.jsx(E,{value:"single_room",children:"Single Room"}),e.jsx(E,{value:"whole_building",children:"Whole Building"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-location",children:"Location Description"}),e.jsx(d,{id:"edit-location",value:o.locationDescription,onChange:a=>c(t=>({...t,locationDescription:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-room",children:"Room Number"}),e.jsx(d,{id:"edit-room",value:o.roomNumber,onChange:a=>c(t=>({...t,roomNumber:a.target.value}))})]})]}),o.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Categories (1-5, or leave empty for no rating)"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>e.jsxs("div",{children:[e.jsx(r,{htmlFor:`edit-${a}`,children:t}),e.jsx(d,{id:`edit-${a}`,type:"number",min:"1",max:"5",value:o[a]||"",onChange:i=>c(x=>({...x,[a]:i.target.value?parseInt(i.target.value):null}))})]},a))})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(H,{id:"edit-notes",value:o.notes,onChange:a=>c(t=>({...t,notes:a.target.value})),rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{variant:"outline",onClick:A,children:"Cancel"}),e.jsx(n,{onClick:je,children:"Save Changes"})]})]})]}),e.jsxs(Ce,{open:ce===s.id,onOpenChange:a=>{b(a?s.id:null)},children:[e.jsx(be,{asChild:!0,children:e.jsx(n,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(ze,{className:"w-4 h-4"})})}),e.jsxs(Se,{children:[e.jsxs(ke,{children:[e.jsx(we,{children:"Delete Inspection"}),e.jsx(De,{children:"Are you sure you want to delete this inspection? This action cannot be undone."})]}),e.jsxs(Te,{children:[e.jsx(Ae,{onClick:()=>b(null),children:"Cancel"}),e.jsx(Ie,{onClick:()=>{pe(s.id),b(null)},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})}),e.jsxs(v,{children:[s.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Ratings:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>{const i=s[a];return e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-gray-600",children:t}),e.jsx(I,{variant:"secondary",className:`text-xs ${ve(i)}`,children:i||"N/A"})]},a)})})]}),s.notes&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]})]})]},s.id))})}),e.jsx(Y,{value:"criteria",className:"space-y-4 mt-6",children:e.jsxs(f,{children:[e.jsxs(S,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5"}),"Inspection Criteria Management"]}),e.jsx(w,{children:"View and edit the criteria used for rating inspections. Each category has specific criteria for ratings 1-5."})]}),e.jsx(v,{className:"space-y-4",children:Fe.map(s=>e.jsxs(f,{className:"border-l-4 border-l-blue-500",children:[e.jsx(S,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{className:"text-lg",children:s.label}),e.jsxs(w,{className:"mt-1",children:[Object.keys(s.criteria).length," rating levels defined"]})]}),e.jsxs(W,{open:oe&&ne?.key===s.key,onOpenChange:C,children:[e.jsx(U,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>xe(s),children:[e.jsx(ee,{className:"w-4 h-4"}),"Edit"]})}),e.jsxs(G,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(J,{children:[e.jsxs(K,{children:["Edit Criteria: ",s.label]}),e.jsx(Q,{children:"Modify the criteria descriptions for each rating level (1-5 stars)"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"criteria-label",children:"Category Label"}),e.jsx(d,{id:"criteria-label",value:R.label||"",onChange:a=>T(t=>({...t,label:a.target.value})),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Criteria"}),[5,4,3,2,1].map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["Rating ",a,":"]}),e.jsxs("div",{className:"flex",children:[Array.from({length:a},(t,i)=>e.jsx("span",{className:"text-yellow-400",children:"★"},i)),Array.from({length:5-a},(t,i)=>e.jsx("span",{className:"text-gray-300",children:"★"},i))]})]}),e.jsx(H,{value:R.criteria?.[a]||"",onChange:t=>T(i=>({...i,criteria:{...i.criteria,[a]:t.target.value}})),rows:3,className:"text-sm",placeholder:`Enter criteria description for ${a} star rating...`})]},a))]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(n,{variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(n,{onClick:ue,children:"Save Changes"})]})]})]})]})}),e.jsx(v,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(s.criteria).map(([a,t])=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:parseInt(a)},(i,x)=>e.jsx("span",{className:"text-yellow-400 text-sm",children:"★"},x)),Array.from({length:5-parseInt(a)},(i,x)=>e.jsx("span",{className:"text-gray-300 text-sm",children:"★"},x))]}),e.jsx("div",{className:"flex-1 text-sm text-gray-700",children:t})]},a))})})]},s.key))})]})})]})]}):e.jsx("div",{className:"flex flex-col items-center justify-center min-h-[60vh] py-12",children:e.jsxs("div",{className:"w-full max-w-md relative",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-primary/20 to-secondary/20 rounded-2xl blur-xl opacity-50"}),e.jsxs(f,{className:"relative border-2 shadow-xl",children:[e.jsxs(S,{className:"space-y-1 pb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Z,{className:"w-6 h-6 text-primary"})}),e.jsx(k,{className:"text-2xl text-center font-bold",children:"Admin Access"}),e.jsx(w,{className:"text-center text-base",children:"Enter your credentials to manage inspections"})]}),e.jsx(v,{className:"pb-8 px-8",children:e.jsxs("form",{onSubmit:me,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"username",children:"Username"}),e.jsx(d,{id:"username",name:"username",type:"text",autoComplete:"username",value:N.username,onChange:s=>D(a=>({...a,username:s.target.value})),placeholder:"Enter username",required:!0,className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"password",children:"Password"}),e.jsx(d,{id:"password",name:"password",type:"password",autoComplete:"current-password",value:N.password,onChange:s=>D(a=>({...a,password:s.target.value})),placeholder:"Enter password",required:!0,className:"h-11"})]}),z&&e.jsx("div",{className:"p-3 text-sm text-red-600 bg-red-50 border border-red-100 rounded-md text-center font-medium animate-in fade-in slide-in-from-top-1",children:z}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[u&&e.jsx(n,{type:"button",variant:"outline",onClick:u,className:"flex-1 h-11",children:"Back"}),e.jsx(n,{type:"submit",className:"flex-1 h-11 modern-button",children:"Login"})]})]})})]})]})})}export{Xe as default};
