var Ne=Object.defineProperty,be=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var U=(r,l,i)=>l in r?Ne(r,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[l]=i,o=(r,l)=>{for(var i in l||(l={}))ke.call(l,i)&&U(r,i,l[i]);if(W)for(var i of W(l))we.call(l,i)&&U(r,i,l[i]);return r},d=(r,l)=>be(r,Se(l));var S=(r,l,i)=>new Promise((N,D)=>{var T=p=>{try{y(i.next(p))}catch(C){D(C)}},j=p=>{try{y(i.throw(p))}catch(C){D(C)}},y=p=>p.done?N(p.value):Promise.resolve(p.value).then(T,j);y((i=i.apply(r,l)).next())});import{r as m,j as e,L as De,S as G,T as Te,a as Ae}from"./vendor-yOkX1T9n-v6.js";import{u as Ee,a as Ie,C as k,b as F,c as L,d as O,e as w,L as h,I as v,B as x,f as Fe,T as Le,g as Oe,h as J,i as K,j as H,D as Q,k as X,l as Y,m as Z,n as ee,o as se,S as ae,p as te,q as le,r as ie,s as $,t as re,A as Pe,v as Re,w as qe,x as ze,y as He,z as $e,E as Me,F as _e,G as Be,H as Ve}from"./index-DdeSxun1-v6.js";import"./ui-BA32w1ww-v6.js";import"./utils-Cj9wHvoQ-v6.js";import"./forms-BJ8Awwap-v6.js";import"./charts-core-ghokHKd6-v6.js";import"./pdf-export-JyY94Pcb-v6.js";function Ze({onBack:r}){Ee();const{toast:l}=Ie(),[i,N]=m.useState([]),[D,T]=m.useState(!0),[j,y]=m.useState(null),[p,C]=m.useState(!1),[ne,f]=m.useState(!1),[A,P]=m.useState({username:"",password:""}),[M,b]=m.useState(""),[oe,ce]=m.useState("inspections"),[R,_]=m.useState(null),[B,q]=m.useState({}),[de,E]=m.useState(!1),[me,I]=m.useState(null),he=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[u,g]=m.useState({inspectorName:"",school:"",date:"",inspectionType:"",locationDescription:"",roomNumber:"",locationCategory:"",floors:null,verticalHorizontalSurfaces:null,ceiling:null,restrooms:null,customerSatisfaction:null,trash:null,projectCleaning:null,activitySupport:null,safetyCompliance:null,equipment:null,monitoring:null,notes:"",isCompleted:!1});m.useEffect(()=>{localStorage.getItem("admin-session-token")?(f(!0),V()):T(!1)},[]);const xe=s=>S(null,null,function*(){s.preventDefault(),b("");try{const t=yield(yield fetch("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:A.username,password:A.password})})).json();t.success?(f(!0),localStorage.setItem("admin-session-token",t.sessionToken),V()):b(t.message||"Invalid username or password")}catch(a){console.error("Login error:",a),b("Network error. Please try again.")}}),ue=()=>{f(!1),localStorage.removeItem("admin-session-token"),P({username:"",password:""})},pe=s=>{_(s),q({label:s.label,criteria:o({},s.criteria)}),E(!0)},ge=()=>{l({title:"✅ Criteria Updated",description:"Criteria updated successfully! (Note: This is a demo - changes are not persisted)"}),E(!1),_(null)},V=()=>S(null,null,function*(){try{const s=localStorage.getItem("admin-session-token");if(!s){f(!1);return}const a=yield fetch("/api/admin/inspections",{headers:{Authorization:`Bearer ${s}`}});if(a.ok){const t=yield a.json();N(t.data||t)}else a.status===401?(f(!1),localStorage.removeItem("admin-session-token"),b("Session expired. Please login again.")):console.error("Failed to fetch inspections")}catch(s){console.error("Error fetching inspections:",s)}finally{T(!1)}}),je=s=>S(null,null,function*(){try{const a=localStorage.getItem("admin-session-token");if(!a){f(!1);return}const t=yield fetch(`/api/admin/inspections/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});t.ok?(N(n=>n.filter(c=>c.id!==s)),l({title:"✅ Inspection Deleted",description:"Inspection deleted successfully"})):t.status===401?(f(!1),localStorage.removeItem("admin-session-token"),b("Session expired. Please login again.")):l({variant:"destructive",title:"Deletion Failed",description:"Failed to delete inspection"})}catch(a){console.error("Error deleting inspection:",a),l({variant:"destructive",title:"Network Error",description:"Error deleting inspection. Please check your connection and try again."})}}),ve=s=>{y(s),g({inspectorName:s.inspectorName||"",school:s.school,date:s.date,inspectionType:s.inspectionType,locationDescription:s.locationDescription,roomNumber:s.roomNumber||"",locationCategory:s.locationCategory||"",floors:s.floors,verticalHorizontalSurfaces:s.verticalHorizontalSurfaces,ceiling:s.ceiling,restrooms:s.restrooms,customerSatisfaction:s.customerSatisfaction,trash:s.trash,projectCleaning:s.projectCleaning,activitySupport:s.activitySupport,safetyCompliance:s.safetyCompliance,equipment:s.equipment,monitoring:s.monitoring,notes:s.notes||"",isCompleted:s.isCompleted||!1}),C(!0)},z=()=>{C(!1),y(null)},fe=()=>S(null,null,function*(){if(j)try{const s=yield fetch(`/api/inspections/${j.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(s.ok){const a=yield s.json();N(t=>t.map(n=>n.id===j.id?a:n)),z(),l({title:"✅ Inspection Updated",description:"Inspection updated successfully"})}else{const a=yield s.json();alert(`Failed to update inspection: ${a.error}`)}}catch(s){console.error("Error updating inspection:",s),alert("Error updating inspection")}}),ye=s=>new Date(s).toLocaleDateString(),Ce=s=>s===null?"bg-gray-100 text-gray-800":s<=2?"bg-red-100 text-red-800":s<=3?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800";return ne?D?e.jsx(Fe,{text:"Loading inspections..."}):e.jsxs("div",{className:"container mx-auto p-6 max-w-6xl space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[r&&e.jsx(x,{variant:"outline",onClick:r,className:"flex-shrink-0",children:"← Back"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-gray-900",children:"Admin Panel"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage inspections and criteria"})]}),e.jsxs(x,{variant:"outline",onClick:ue,className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx(De,{className:"w-4 h-4"}),"Logout"]})]}),e.jsxs(Le,{value:oe,onValueChange:ce,children:[e.jsxs(Oe,{className:"grid w-full grid-cols-2",children:[e.jsx(J,{value:"inspections",children:"Manage Inspections"}),e.jsx(J,{value:"criteria",children:"Edit Criteria"})]}),e.jsx(K,{value:"inspections",className:"space-y-4 mt-6",children:e.jsx("div",{className:"grid gap-4",children:i.length===0?e.jsx(k,{children:e.jsx(w,{className:"pt-6",children:e.jsx("div",{className:"text-center text-gray-500",children:"No inspections found"})})}):i.map(s=>e.jsxs(k,{className:"overflow-hidden",children:[e.jsx(F,{className:"pb-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs(L,{className:"text-lg",children:[s.school," - ",s.locationDescription]}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Date: ",ye(s.date)]}),s.inspectorName&&e.jsxs("div",{children:["Inspector: ",s.inspectorName]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"outline",children:s.inspectionType}),s.isCompleted&&e.jsx(H,{variant:"default",children:"Completed"})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Q,{open:p&&(j==null?void 0:j.id)===s.id,onOpenChange:a=>{a||z()},children:[e.jsx(X,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",onClick:()=>ve(s),children:e.jsx(G,{className:"w-4 h-4"})})}),e.jsxs(Y,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Edit Inspection"}),e.jsx(se,{children:"Make changes to the inspection details"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-inspector",children:"Inspector Name"}),e.jsx(v,{id:"edit-inspector",value:u.inspectorName,onChange:a=>g(t=>d(o({},t),{inspectorName:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-school",children:"School"}),e.jsxs(ae,{value:u.school,onValueChange:a=>g(t=>d(o({},t),{school:a})),children:[e.jsx(te,{children:e.jsx(le,{})}),e.jsx(ie,{children:he.map(a=>e.jsx($,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-date",children:"Date"}),e.jsx(v,{id:"edit-date",type:"date",value:u.date,onChange:a=>g(t=>d(o({},t),{date:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-type",children:"Inspection Type"}),e.jsxs(ae,{value:u.inspectionType,onValueChange:a=>g(t=>d(o({},t),{inspectionType:a})),children:[e.jsx(te,{children:e.jsx(le,{})}),e.jsxs(ie,{children:[e.jsx($,{value:"single_room",children:"Single Room"}),e.jsx($,{value:"whole_building",children:"Whole Building"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-location",children:"Location Description"}),e.jsx(v,{id:"edit-location",value:u.locationDescription,onChange:a=>g(t=>d(o({},t),{locationDescription:a.target.value}))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-room",children:"Room Number"}),e.jsx(v,{id:"edit-room",value:u.roomNumber,onChange:a=>g(t=>d(o({},t),{roomNumber:a.target.value}))})]})]}),u.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Categories (1-5, or leave empty for no rating)"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>e.jsxs("div",{children:[e.jsx(h,{htmlFor:`edit-${a}`,children:t}),e.jsx(v,{id:`edit-${a}`,type:"number",min:"1",max:"5",value:u[a]||"",onChange:n=>g(c=>d(o({},c),{[a]:n.target.value?parseInt(n.target.value):null}))})]},a))})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(re,{id:"edit-notes",value:u.notes,onChange:a=>g(t=>d(o({},t),{notes:a.target.value})),rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"outline",onClick:z,children:"Cancel"}),e.jsx(x,{onClick:fe,children:"Save Changes"})]})]})]}),e.jsxs(Pe,{open:me===s.id,onOpenChange:a=>{I(a?s.id:null)},children:[e.jsx(Re,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",children:e.jsx(Te,{className:"w-4 h-4"})})}),e.jsxs(qe,{children:[e.jsxs(ze,{children:[e.jsx(He,{children:"Delete Inspection"}),e.jsx($e,{children:"Are you sure you want to delete this inspection? This action cannot be undone."})]}),e.jsxs(Me,{children:[e.jsx(_e,{onClick:()=>I(null),children:"Cancel"}),e.jsx(Be,{onClick:()=>{je(s.id),I(null)},className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]})}),e.jsxs(w,{children:[s.inspectionType==="single_room"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"Ratings:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}].map(({key:a,label:t})=>{const n=s[a];return e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-gray-600",children:t}),e.jsx(H,{variant:"secondary",className:`text-xs ${Ce(n)}`,children:n||"N/A"})]},a)})})]}),s.notes&&e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Notes:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})]})]})]},s.id))})}),e.jsx(K,{value:"criteria",className:"space-y-4 mt-6",children:e.jsxs(k,{children:[e.jsxs(F,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),"Inspection Criteria Management"]}),e.jsx(O,{children:"View and edit the criteria used for rating inspections. Each category has specific criteria for ratings 1-5."})]}),e.jsx(w,{className:"space-y-4",children:Ve.map(s=>e.jsxs(k,{className:"border-l-4 border-l-blue-500",children:[e.jsx(F,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(L,{className:"text-lg",children:s.label}),e.jsxs(O,{className:"mt-1",children:[Object.keys(s.criteria).length," rating levels defined"]})]}),e.jsxs(Q,{open:de&&(R==null?void 0:R.key)===s.key,onOpenChange:E,children:[e.jsx(X,{asChild:!0,children:e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>pe(s),children:[e.jsx(G,{className:"w-4 h-4"}),"Edit"]})}),e.jsxs(Y,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsxs(ee,{children:["Edit Criteria: ",s.label]}),e.jsx(se,{children:"Modify the criteria descriptions for each rating level (1-5 stars)"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"criteria-label",children:"Category Label"}),e.jsx(v,{id:"criteria-label",value:B.label||"",onChange:a=>q(t=>d(o({},t),{label:a.target.value})),className:"mt-1"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Rating Criteria"}),[5,4,3,2,1].map(a=>{var t;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["Rating ",a,":"]}),e.jsxs("div",{className:"flex",children:[Array.from({length:a},(n,c)=>e.jsx("span",{className:"text-yellow-400",children:"★"},c)),Array.from({length:5-a},(n,c)=>e.jsx("span",{className:"text-gray-300",children:"★"},c))]})]}),e.jsx(re,{value:((t=B.criteria)==null?void 0:t[a])||"",onChange:n=>q(c=>d(o({},c),{criteria:d(o({},c.criteria),{[a]:n.target.value})})),rows:3,className:"text-sm",placeholder:`Enter criteria description for ${a} star rating...`})]},a)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(x,{variant:"outline",onClick:()=>E(!1),children:"Cancel"}),e.jsx(x,{onClick:ge,children:"Save Changes"})]})]})]})]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(s.criteria).map(([a,t])=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:parseInt(a)},(n,c)=>e.jsx("span",{className:"text-yellow-400 text-sm",children:"★"},c)),Array.from({length:5-parseInt(a)},(n,c)=>e.jsx("span",{className:"text-gray-300 text-sm",children:"★"},c))]}),e.jsx("div",{className:"flex-1 text-sm text-gray-700",children:t})]},a))})})]},s.key))})]})})]})]}):e.jsx("div",{className:"container mx-auto p-6 max-w-md",children:e.jsxs(k,{children:[e.jsxs(F,{children:[e.jsx(L,{className:"text-center",children:"Admin Login"}),e.jsx(O,{className:"text-center",children:"Enter your credentials to access the admin panel"})]}),e.jsx(w,{children:e.jsxs("form",{onSubmit:xe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"username",children:"Username"}),e.jsx(v,{id:"username",name:"username",type:"text",autoComplete:"username",value:A.username,onChange:s=>P(a=>d(o({},a),{username:s.target.value})),placeholder:"Enter username",required:!0})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(v,{id:"password",name:"password",type:"password",autoComplete:"current-password",value:A.password,onChange:s=>P(a=>d(o({},a),{password:s.target.value})),placeholder:"Enter password",required:!0})]}),M&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:M}),e.jsxs("div",{className:"flex gap-2",children:[r&&e.jsx(x,{type:"button",variant:"outline",onClick:r,className:"flex-1",children:"Back"}),e.jsx(x,{type:"submit",className:"flex-1",children:"Login"})]})]})})]})})}export{Ze as default};
