import{c as I}from"./index-BSmjchPe-v6.js";import{r as A,j as l}from"./ui-C40ArZlv-v6.js";import{C as _}from"./chevron-right-C7ge3pXJ-v6.js";import{C as E}from"./select-5ylEU5UJ-v6.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=I("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),m={DRAFT_INSPECTION:"custodial-draft-inspection",DRAFT_BUILDING_INSPECTION:"custodial-draft-building-inspection",DRAFT_CUSTODIAL_NOTE:"custodial-draft-custodial-note",USER_PREFERENCES:"custodial-user-preferences",LEGACY_INSPECTION_DRAFTS:"custodial_inspection_drafts",LEGACY_BUILDING_DRAFTS:"building_form_drafts"},i={MAX_DRAFT_SIZE:5*1024*1024,MAX_TOTAL_STORAGE:8*1024*1024,MAX_DRAFTS_PER_TYPE:10,IMAGE_QUALITY:.7,MAX_IMAGE_DIMENSIONS:{width:1200,height:1200}},u=()=>{let t=0;for(const e in localStorage)localStorage.hasOwnProperty(e)&&(t+=localStorage[e].length+e.length);return t},T=t=>new Promise((e,o)=>{const r=document.createElement("canvas"),a=r.getContext("2d"),s=new Image;s.onload=()=>{const{width:d,height:g}=i.MAX_IMAGE_DIMENSIONS;let{width:n,height:c}=s;if(n>d||c>g){const h=Math.min(d/n,g/c);n*=h,c*=h}r.width=n,r.height=c,a==null||a.drawImage(s,0,0,n,c);const p=r.toDataURL("image/jpeg",i.IMAGE_QUALITY);e(p)},s.onerror=o,s.src=URL.createObjectURL(t)}),y=(t,e)=>{try{const o={data:e,timestamp:Date.now()},r=JSON.stringify(o);if(r.length>i.MAX_DRAFT_SIZE){console.warn(`Draft too large (${Math.round(r.length/1024)}KB). Skipping save.`);return}if(u()+r.length>i.MAX_TOTAL_STORAGE&&(S(),u()+r.length>i.MAX_TOTAL_STORAGE)){console.warn("Storage limit reached. Cannot save draft.");return}localStorage.setItem(t,r)}catch(o){if(console.error("Failed to save draft to localStorage:",o),o instanceof Error&&o.name==="QuotaExceededError"){S();try{localStorage.setItem(t,JSON.stringify({data:e,timestamp:Date.now()}))}catch(r){console.error("Failed to save draft even after cleanup:",r)}}}},M=t=>{try{const e=localStorage.getItem(t);if(!e)return null;const o=JSON.parse(e);return Date.now()-o.timestamp>10080*60*1e3?(localStorage.removeItem(t),null):o.data}catch(e){return console.error("Failed to load draft from localStorage:",e),null}},w=t=>{try{localStorage.removeItem(t)}catch(e){console.error("Failed to clear draft from localStorage:",e)}},S=()=>{try{const t=Date.now()-6048e5,e=[];for(const o in localStorage)if(localStorage.hasOwnProperty(o)&&o.startsWith("custodial-"))try{const r=localStorage.getItem(o);if(r){const a=JSON.parse(r);a.timestamp&&a.timestamp<t&&e.push(o)}}catch{e.push(o)}e.forEach(o=>localStorage.removeItem(o)),console.log(`Cleaned up ${e.length} old drafts`)}catch(t){console.error("Failed to cleanup old drafts:",t)}},L=()=>{try{localStorage.getItem(m.LEGACY_INSPECTION_DRAFTS)&&(console.log("Migrating legacy inspection drafts..."),localStorage.removeItem(m.LEGACY_INSPECTION_DRAFTS)),localStorage.getItem(m.LEGACY_BUILDING_DRAFTS)&&(console.log("Migrating legacy building inspection drafts..."),localStorage.removeItem(m.LEGACY_BUILDING_DRAFTS)),S()}catch(t){console.error("Failed to migrate legacy drafts:",t)}},v=async t=>{try{return t.size<500*1024?new Promise((e,o)=>{const r=new FileReader;r.onload=()=>e(r.result),r.onerror=o,r.readAsDataURL(t)}):await T(t)}catch(e){throw console.error("Failed to process image for storage:",e),e}},F=()=>{const t=u(),e=Object.keys(localStorage).filter(o=>o.startsWith("custodial-")).length;return{totalSizeKB:Math.round(t/1024),totalSizeMB:Math.round(t/(1024*1024)*100)/100,draftCount:e,limitMB:Math.round(i.MAX_TOTAL_STORAGE/(1024*1024)),usagePercent:Math.round(t/i.MAX_TOTAL_STORAGE*100)}};function f(...t){return t.filter(Boolean).join(" ")}function x({title:t,children:e,defaultCollapsed:o=!0,className:r,titleClassName:a,contentClassName:s,disabled:d=!1}){const[g,n]=A.useState(o),c=()=>{d||n(!g)};return l.jsxs("div",{className:f("border border-gray-200 rounded-lg overflow-hidden",r||""),children:[l.jsxs("button",{type:"button",onClick:c,disabled:d,className:f("w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer",d?"cursor-not-allowed opacity-50":"",a||""),children:[l.jsx("span",{className:"text-base",children:t}),g?l.jsx(_,{className:"w-5 h-5 transition-transform duration-200"}):l.jsx(E,{className:"w-5 h-5 transition-transform duration-200"})]}),l.jsx("div",{className:f("transition-all duration-300 ease-in-out overflow-hidden",g?"max-h-0":"max-h-[2000px]"),children:l.jsx("div",{className:f("p-4 pt-0",s||""),children:e})})]})}export{x as C,m as S,C as a,w as c,F as g,M as l,L as m,v as p,y as s};
//# sourceMappingURL=collapsible-section-S5iIaJr_-v6.js.map
