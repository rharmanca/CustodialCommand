var re=Object.defineProperty,oe=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var G=(d,c,o)=>c in d?re(d,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):d[c]=o,q=(d,c)=>{for(var o in c||(c={}))ce.call(c,o)&&G(d,o,c[o]);if(W)for(var o of W(c))de.call(c,o)&&G(d,o,c[o]);return d},K=(d,c)=>oe(d,ie(c));var U=(d,c,o)=>new Promise((I,m)=>{var A=n=>{try{y(o.next(n))}catch(p){m(p)}},B=n=>{try{y(o.throw(n))}catch(p){m(p)}},y=n=>n.done?I(n.value):Promise.resolve(n.value).then(A,B);y((o=o.apply(d,c)).next())});import{r as u,j as e,x as L,y as me,F as b,p as J,i as he,w as ge,z as ue,E as xe}from"./vendor-yOkX1T9n-v6.js";import{a as pe,b4 as x,B as T,C as R,b as _,c as $,d as je,e as S,U as z,b5 as fe,b6 as ve,T as Ne,g as be,h as v,i as N,b7 as ye,b8 as we,b9 as k,j as V,ba as Ce,bb as De,bc as Te,bd as Re,be as Se,bf as ke,bg as Ie,bh as Ae}from"./index-DdeSxun1-v6.js";import"./ui-BA32w1ww-v6.js";import"./utils-Cj9wHvoQ-v6.js";import"./forms-BJ8Awwap-v6.js";import"./charts-core-ghokHKd6-v6.js";import"./pdf-export-JyY94Pcb-v6.js";function ze({onBack:d}){const{toast:c}=pe(),[o,I]=u.useState([]),[m,A]=u.useState([]),[B,y]=u.useState(!0),[n,p]=u.useState(null);u.useState("school");const[r,M]=u.useState({search:"",dateRange:{from:null,to:null},schools:[],severityLevels:[],categories:[],inspectors:[],ratingThreshold:0,inspectionType:"all",showProblemsOnly:!1,hasCustodialNotes:!1}),[H,Q]=u.useState(!1),X={1:"Unacceptable",2:"Below Standard",3:"Acceptable",4:"Ordinary Tidiness",5:"Orderly Spotlessness"},w=[{key:"floors",label:"Floors"},{key:"verticalHorizontalSurfaces",label:"Vertical and Horizontal Surfaces"},{key:"ceiling",label:"Ceiling"},{key:"restrooms",label:"Restrooms"},{key:"customerSatisfaction",label:"Customer Satisfaction and Coordination"},{key:"trash",label:"Trash"},{key:"projectCleaning",label:"Project Cleaning"},{key:"activitySupport",label:"Activity Support"},{key:"safetyCompliance",label:"Safety and Compliance"},{key:"equipment",label:"Equipment"},{key:"monitoring",label:"Monitoring"}];u.useEffect(()=>{Z()},[]);const Z=()=>U(null,null,function*(){try{const[s,t]=yield Promise.all([fetch("/api/inspections"),fetch("/api/custodial-notes")]);if(s.ok){const a=yield s.json();I(a)}if(t.ok){const a=yield t.json();A(a)}}catch(s){console.error("Error fetching data:",s)}finally{y(!1)}}),h=s=>{const t=w.map(l=>s[l.key]).filter(l=>typeof l=="number");if(t.length===0)return null;const a=t.reduce((l,g)=>l+g,0)/t.length;return Math.round(a*10)/10},P=s=>e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(t=>e.jsx(J,{className:`w-4 h-4 ${t<=s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},t)),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:X[s]})]}),Y=u.useMemo(()=>{const s=new Set(o.map(t=>t.school).filter(Boolean));return Array.from(s).sort()},[o]),i=u.useMemo(()=>o.filter(s=>{var t;if(r.search&&![s.school,(t=s.roomNumber)==null?void 0:t.toString(),s.locationDescription,s.buildingName,s.notes].filter(Boolean).join(" ").toLowerCase().includes(r.search.toLowerCase()))return!1;if(r.dateRange.from||r.dateRange.to){const a=new Date(s.date);if(r.dateRange.from&&a<r.dateRange.from||r.dateRange.to&&a>r.dateRange.to)return!1}if(r.schools.length>0&&!r.schools.includes(s.school)||r.inspectors.length>0&&s.inspectorName&&!r.inspectors.includes(s.inspectorName)||r.inspectionType!=="all"&&(r.inspectionType==="single_room"&&s.inspectionType!=="single_room"||r.inspectionType==="whole_building"&&s.inspectionType!=="whole_building"))return!1;if(r.ratingThreshold>0){const a=h(s);if(a===null||a<r.ratingThreshold)return!1}if(r.severityLevels.length>0){const a=h(s);if(a===null)return!1;const l=a<2?"critical":a<3?"needs-attention":"acceptable";if(!r.severityLevels.includes(l))return!1}if(r.showProblemsOnly){const a=h(s);if(a===null||a>=3)return!1}return!(r.hasCustodialNotes&&!m.some(l=>l.school===s.school))}),[o,m,r]),C=(()=>{const s=new Date,t=new Date(s.getFullYear(),s.getMonth()-1,s.getDate());new Date(s.getFullYear(),s.getMonth()-2,s.getDate());const a=i.filter(j=>new Date(j.date)>=new Date(s.getFullYear(),s.getMonth(),1)),l=i.filter(j=>{const f=new Date(j.date);return f>=new Date(t.getFullYear(),t.getMonth(),1)&&f<new Date(s.getFullYear(),s.getMonth(),1)}),g=l.length>0?(a.length-l.length)/l.length*100:0,F=a.length>0?a.reduce((j,f)=>{const O=h(f);return j+(O||0)},0)/a.length:0,E=l.length>0?l.reduce((j,f)=>{const O=h(f);return j+(O||0)},0)/l.length:0,ne=E>0?(F-E)/E*100:0;return{inspectionTrend:Math.round(g*10)/10,ratingTrend:Math.round(ne*10)/10}})(),ee=s=>{const t=h(s);return t===null?null:t<2?{level:"critical",color:"#EF4444",icon:ge,label:"Critical"}:t<3?{level:"needs-attention",color:"#F59E0B",icon:ue,label:"Needs Attention"}:{level:"acceptable",color:"#10B981",icon:xe,label:"Acceptable"}},se=()=>{const s=i.reduce((t,a)=>{const l=new Date(a.date).toISOString().slice(0,7);t[l]||(t[l]={date:l,ratings:[],totalInspections:0});const g=h(a);return g!==null&&(t[l].ratings.push(g),t[l].totalInspections++),t},{});return Object.values(s).map(t=>({date:t.date,averageRating:t.ratings.length>0?Math.round(t.ratings.reduce((a,l)=>a+l,0)/t.ratings.length*10)/10:0,totalInspections:t.totalInspections})).sort((t,a)=>t.date.localeCompare(a.date))},te=()=>{const s=i.reduce((t,a)=>{t[a.school]||(t[a.school]={school:a.school,ratings:[],totalInspections:0,singleRoomCount:0,wholeBuildingCount:0});const l=h(a);return l!==null&&t[a.school].ratings.push(l),t[a.school].totalInspections++,a.inspectionType==="single_room"?t[a.school].singleRoomCount++:t[a.school].wholeBuildingCount++,t},{});return Object.values(s).map(t=>K(q({},t),{averageRating:t.ratings.length>0?Math.round(t.ratings.reduce((a,l)=>a+l,0)/t.ratings.length*10)/10:0}))},ae=()=>{const s=w.reduce((t,a)=>(t[a.key]={category:a.label,ratings:[],totalRatings:0},t),{});return i.forEach(t=>{w.forEach(a=>{const l=t[a.key];typeof l=="number"&&(s[a.key].ratings.push(l),s[a.key].totalRatings++)})}),Object.values(s).map(t=>({category:t.category,rating:t.ratings.length>0?Math.round(t.ratings.reduce((a,l)=>a+l,0)/t.ratings.length*10)/10:0,fullMark:5}))},le=()=>i.filter(s=>s.inspectionType==="single_room"&&s.roomNumber).map(s=>({number:s.roomNumber,rating:h(s)||0,school:s.school,lastInspection:s.date})),D=u.useMemo(()=>{const s=i.length,t=m.length,a=i.length>0?Math.round(i.map(h).filter(g=>g!==null).reduce((g,F)=>g+F,0)/i.length*10)/10:0,l=new Set(i.map(g=>g.school)).size;return{totalInspections:s,totalNotes:t,avgRating:a,schools:l}},[i,m]);return B?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(x,{className:"h-10 w-32"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(x,{className:"h-24 w-full"}),e.jsx(x,{className:"h-24 w-full"}),e.jsx(x,{className:"h-24 w-full"}),e.jsx(x,{className:"h-24 w-full"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(x,{className:"h-64 w-full"}),e.jsx(x,{className:"h-64 w-full"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(x,{className:"h-12 w-full"}),e.jsx(x,{className:"h-12 w-full"}),e.jsx(x,{className:"h-12 w-full"}),e.jsx(x,{className:"h-12 w-full"})]})]}):n?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(T,{onClick:()=>p(null),variant:"outline",children:"← Back to Inspections"})}),e.jsxs(R,{className:"max-w-4xl mx-auto",children:[e.jsxs(_,{children:[e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-6 h-6"}),"Inspection Details"]}),e.jsx(je,{children:n.inspectionType==="single_room"?`Room ${n.roomNumber} at ${n.school}`:`Building: ${n.buildingName||n.locationDescription||"Whole Building"} at ${n.school}`})]}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Inspection Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(n.date).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"School:"})," ",n.school]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",n.inspectionType==="single_room"?"Single Room":"Whole Building"]}),n.roomNumber&&e.jsxs("p",{children:[e.jsx("strong",{children:"Room:"})," ",n.roomNumber]}),n.buildingName&&e.jsxs("p",{children:[e.jsx("strong",{children:"Building:"})," ",n.buildingName]}),!n.buildingName&&n.inspectionType==="whole_building"&&e.jsxs("p",{children:[e.jsx("strong",{children:"Building:"})," ",n.locationDescription||"Whole Building"]}),n.locationDescription&&e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ",n.locationDescription]}),n.inspectorName&&e.jsxs("p",{children:[e.jsx("strong",{children:"Inspector:"})," ",n.inspectorName]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Overall Rating"}),(()=>{const s=h(n);return s!==null?P(Math.round(s)):e.jsx("span",{className:"text-gray-500",children:"No ratings available"})})()]})]}),e.jsx(z,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Category Ratings"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.map(s=>{const t=n[s.key];return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsx("span",{className:"font-medium",children:s.label}),typeof t=="number"?e.jsx("div",{className:"flex items-center gap-2",children:P(t)}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Not rated"})]},s.key)})})]}),n.notes&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Additional Notes"}),e.jsx("p",{className:"text-gray-700",children:n.notes})]})]}),n.images&&n.images.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Images"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.images.map((s,t)=>e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("img",{src:s,alt:`Inspection image ${t+1}`,className:"w-full h-48 object-cover"})},t))})]})]})]})})]})]}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 py-6 content-visibility-auto layout-contained",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(T,{onClick:s=>{s.preventDefault(),s.stopPropagation(),d&&d()},variant:"outline",className:"mb-4 back-button",children:"← Back to Main Menu"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Enhanced Data & Reports"}),e.jsx("p",{className:"text-muted-foreground",children:"Advanced analytics and visualizations for custodial data"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(fe,{filters:r,onApplyPreset:M,schools:Y})}),e.jsx("div",{className:"mb-6",children:e.jsx(ve,{inspections:o,custodialNotes:m,filters:r,onFiltersChange:M,onClearFilters:()=>M({search:"",dateRange:{from:null,to:null},schools:[],severityLevels:[],categories:[],inspectors:[],ratingThreshold:0,inspectionType:"all",showProblemsOnly:!1,hasCustodialNotes:!1}),isOpen:H,onToggle:()=>Q(!H)})}),e.jsxs(Ne,{defaultValue:"overview",className:"w-full",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-background border-b",children:e.jsxs(be,{className:"grid w-full grid-cols-7",children:[e.jsx(v,{value:"overview",children:"Overview"}),e.jsx(v,{value:"problems",children:"Problem Areas"}),e.jsx(v,{value:"charts",children:"Charts"}),e.jsx(v,{value:"school",children:"By School"}),e.jsx(v,{value:"date",children:"By Date"}),e.jsx(v,{value:"inspector",children:"By Inspector"}),e.jsx(v,{value:"notes",children:"Custodial Notes"})]})}),e.jsx(N,{value:"overview",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Overview"}),e.jsx("p",{className:"text-muted-foreground",children:"Key performance indicators and recent inspections"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ye,{inspections:i,custodialNotes:m,trigger:e.jsxs(T,{variant:"outline",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Export Overview"]})}),e.jsx(we,{inspections:i,custodialNotes:m,availableSchools:Y,availableCategories:w,trigger:e.jsxs(T,{type:"button",variant:"outline",className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Export PDF Report"]}),onExportComplete:()=>{c({title:"Export Complete",description:"Your PDF report has been generated successfully."})}})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(k,{title:"Total Inspections",value:D.totalInspections,description:"All time inspections",icon:b,color:"primary",trend:C.inspectionTrend!==0?{value:C.inspectionTrend,period:"vs last month"}:void 0}),e.jsx(k,{title:"Average Rating",value:`${D.avgRating}/5`,description:"Overall performance",icon:J,color:"success",trend:C.ratingTrend!==0?{value:C.ratingTrend,period:"vs last month"}:void 0}),e.jsx(k,{title:"Schools",value:D.schools,description:"Active locations",icon:L,color:"secondary"}),e.jsx(k,{title:"Custodial Notes",value:D.totalNotes,description:"Issues reported",icon:b,color:"warning"})]}),e.jsxs(R,{children:[e.jsx(_,{children:e.jsxs($,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5 text-primary"}),"Recent Activity"]})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-4",children:i.slice(0,5).map(s=>{var a;const t=ee(s);return e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-foreground",children:s.school}),t&&t.level!=="acceptable"&&e.jsxs(V,{variant:t.level==="critical"?"destructive":"secondary",className:"text-xs",children:[e.jsx(t.icon,{className:"w-3 h-3 mr-1"}),t.label]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.inspectionType==="single_room"?`Room ${(a=s.roomNumber)!=null?a:"Not specified"}`:`Building: ${s.buildingName||s.locationDescription||"Whole Building"}`})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(()=>{const l=h(s);return l!==null?P(Math.round(l)):e.jsx("span",{className:"text-xs text-muted-foreground",children:"N/A"})})(),e.jsx(V,{variant:"outline",children:new Date(s.date).toLocaleDateString()})]})]},s.id)})})})]})]})}),e.jsx(N,{value:"problems",className:"mt-6",children:e.jsx(Ce,{inspections:i,custodialNotes:m,onInspectionClick:p,onExportReport:()=>{}})}),e.jsx(N,{value:"charts",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(De,{data:se(),title:"Performance Trends Over Time",description:"Average ratings and inspection volume by month"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Te,{data:te(),title:"School Performance Comparison",description:"Average ratings and inspection counts by school"}),e.jsx(Re,{data:ae(),title:"Category Performance Analysis",description:"Performance ratings across all inspection categories"})]}),e.jsx(Se,{data:le(),title:"Room Performance Heatmap",description:"Visual overview of room performance ratings",maxRoomsPerRow:8})]})}),e.jsx(N,{value:"school",className:"mt-6",children:e.jsx(ke,{inspections:i,onInspectionClick:p})}),e.jsx(N,{value:"date",className:"mt-6",children:e.jsx(Ie,{inspections:i,onInspectionClick:p})}),e.jsx(N,{value:"inspector",className:"mt-6",children:e.jsx(Ae,{inspections:i,onInspectionClick:p})}),e.jsx(N,{value:"notes",className:"mt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(b,{className:"w-6 h-6"}),"Custodial Notes (",m.length,")"]})}),m.length===0?e.jsx(R,{children:e.jsxs(S,{className:"text-center py-8",children:[e.jsx(b,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-muted-foreground mb-2",children:"No Custodial Notes"}),e.jsx("p",{className:"text-muted-foreground",children:"No custodial notes have been submitted yet."})]})}):e.jsx("div",{className:"grid gap-4",children:m.map(s=>e.jsxs(R,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(_,{children:e.jsxs($,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),s.school]}),e.jsx(V,{variant:"outline",children:new Date(s.createdAt).toLocaleDateString()})]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Location:"}),e.jsxs("p",{className:"text-foreground",children:[s.location," - ",s.locationDescription]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Notes:"}),e.jsx("p",{className:"text-foreground",children:s.notes})]}),e.jsx("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:e.jsxs("span",{children:["Created: ",new Date(s.createdAt).toLocaleString()]})})]})})]},s.id))})]})})]})]})})}export{ze as default};
