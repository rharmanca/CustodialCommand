import{k as U,r as m,j as e,t as rt,s as at,v as Oe,P as ot,w as V,x as nt,F as it,G as lt,I as ct,c as dt,f as T,d as k,e as I,B as ee,u as mt,b as ut,g as H,h as G,i as Y,q as pt,H as xt,C as we,U as Ce}from"./index-GKxhZO_L.js";import{m as ht,g as gt,s as ft,S as Se,C as Te,a as ke,c as bt}from"./collapsible-section-B5tPVOkl.js";import{L as R,I as z}from"./label-CvlsU2fj.js";import{T as Ie}from"./textarea-lCue8RB5.js";import{S as jt,a as vt,b as yt,c as Nt,d as wt}from"./select-CKTagLCK.js";import{S as Ct}from"./separator-BRfc8w01.js";import{P as ue,T as St}from"./progress-Djnpfc1o.js";import{c as Fe,b as Tt,R as kt,A as It,d as Pt,e as Dt,C as pe}from"./Combination-r3vHoB5T.js";import{C as Et,a as At,b as _t,A as Ot}from"./collapsible-CZzkC_ev.js";import{i as Pe,r as ae}from"./custodial-criteria-aPNJLI_7.js";import{P as Re,a as $e,b as ze}from"./popover-BpYh7vta.js";import{C as oe}from"./circle-help-B9mNE7W7.js";import{S as ne}from"./star-qYyIXEBv.js";import{B as Ft}from"./book-open-kbSIGAm_.js";import{B as Rt}from"./building-2-CYUOABj4.js";import{C as De}from"./chevron-right-CaOKIrm7.js";import{S as Ee}from"./save-BTBlV0wr.js";import{L as $t}from"./loader-circle-fQjYq6p4.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=U("Bath",[["path",{d:"M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"1r8yf5"}],["line",{x1:"10",x2:"8",y1:"5",y2:"7",key:"h5g8z4"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"7",x2:"7",y1:"19",y2:"21",key:"16jp00"}],["line",{x1:"17",x2:"17",y1:"19",y2:"21",key:"1pxrnk"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=U("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=U("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bt=U("Dumbbell",[["path",{d:"M14.4 14.4 9.6 9.6",key:"ic80wn"}],["path",{d:"M18.657 21.485a2 2 0 1 1-2.829-2.828l-1.767 1.768a2 2 0 1 1-2.829-2.829l6.364-6.364a2 2 0 1 1 2.829 2.829l-1.768 1.767a2 2 0 1 1 2.828 2.829z",key:"nnl7wr"}],["path",{d:"m21.5 21.5-1.4-1.4",key:"1f1ice"}],["path",{d:"M3.9 3.9 2.5 2.5",key:"1evmna"}],["path",{d:"M6.404 12.768a2 2 0 1 1-2.829-2.829l1.768-1.767a2 2 0 1 1-2.828-2.829l2.828-2.828a2 2 0 1 1 2.829 2.828l1.767-1.768a2 2 0 1 1 2.829 2.829z",key:"yhosts"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=U("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["path",{d:"m3.3 7 7.703 4.734a2 2 0 0 0 1.994 0L20.7 7",key:"yx3hmr"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=U("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gt=U("Utensils",[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]]);var[ie,Es]=rt("Tooltip",[Fe]),le=Fe(),Le="TooltipProvider",Ut=700,xe="tooltip.open",[Vt,fe]=ie(Le),Me=o=>{const{__scopeTooltip:n,delayDuration:s=Ut,skipDelayDuration:c=300,disableHoverableContent:d=!1,children:g}=o,h=m.useRef(!0),b=m.useRef(!1),p=m.useRef(0);return m.useEffect(()=>{const y=p.current;return()=>window.clearTimeout(y)},[]),e.jsx(Vt,{scope:n,isOpenDelayedRef:h,delayDuration:s,onOpen:m.useCallback(()=>{window.clearTimeout(p.current),h.current=!1},[]),onClose:m.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>h.current=!0,c)},[c]),isPointerInTransitRef:b,onPointerInTransitChange:m.useCallback(y=>{b.current=y},[]),disableHoverableContent:d,children:g})};Me.displayName=Le;var te="Tooltip",[Yt,ce]=ie(te),Be=o=>{const{__scopeTooltip:n,children:s,open:c,defaultOpen:d,onOpenChange:g,disableHoverableContent:h,delayDuration:b}=o,p=fe(te,o.__scopeTooltip),y=le(n),[j,f]=m.useState(null),w=Tt(),N=m.useRef(0),S=h??p.disableHoverableContent,_=b??p.delayDuration,P=m.useRef(!1),[$,D]=at({prop:c,defaultProp:d??!1,onChange:B=>{B?(p.onOpen(),document.dispatchEvent(new CustomEvent(xe))):p.onClose(),g?.(B)},caller:te}),r=m.useMemo(()=>$?P.current?"delayed-open":"instant-open":"closed",[$]),O=m.useCallback(()=>{window.clearTimeout(N.current),N.current=0,P.current=!1,D(!0)},[D]),x=m.useCallback(()=>{window.clearTimeout(N.current),N.current=0,D(!1)},[D]),W=m.useCallback(()=>{window.clearTimeout(N.current),N.current=window.setTimeout(()=>{P.current=!0,D(!0),N.current=0},_)},[_,D]);return m.useEffect(()=>()=>{N.current&&(window.clearTimeout(N.current),N.current=0)},[]),e.jsx(kt,{...y,children:e.jsx(Yt,{scope:n,contentId:w,open:$,stateAttribute:r,trigger:j,onTriggerChange:f,onTriggerEnter:m.useCallback(()=>{p.isOpenDelayedRef.current?W():O()},[p.isOpenDelayedRef,W,O]),onTriggerLeave:m.useCallback(()=>{S?x():(window.clearTimeout(N.current),N.current=0)},[x,S]),onOpen:O,onClose:x,disableHoverableContent:S,children:s})})};Be.displayName=te;var he="TooltipTrigger",qe=m.forwardRef((o,n)=>{const{__scopeTooltip:s,...c}=o,d=ce(he,s),g=fe(he,s),h=le(s),b=m.useRef(null),p=Oe(n,b,d.onTriggerChange),y=m.useRef(!1),j=m.useRef(!1),f=m.useCallback(()=>y.current=!1,[]);return m.useEffect(()=>()=>document.removeEventListener("pointerup",f),[f]),e.jsx(It,{asChild:!0,...h,children:e.jsx(ot.button,{"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute,...c,ref:p,onPointerMove:V(o.onPointerMove,w=>{w.pointerType!=="touch"&&!j.current&&!g.isPointerInTransitRef.current&&(d.onTriggerEnter(),j.current=!0)}),onPointerLeave:V(o.onPointerLeave,()=>{d.onTriggerLeave(),j.current=!1}),onPointerDown:V(o.onPointerDown,()=>{d.open&&d.onClose(),y.current=!0,document.addEventListener("pointerup",f,{once:!0})}),onFocus:V(o.onFocus,()=>{y.current||d.onOpen()}),onBlur:V(o.onBlur,d.onClose),onClick:V(o.onClick,d.onClose)})})});qe.displayName=he;var Jt="TooltipPortal",[As,Wt]=ie(Jt,{forceMount:void 0}),J="TooltipContent",He=m.forwardRef((o,n)=>{const s=Wt(J,o.__scopeTooltip),{forceMount:c=s.forceMount,side:d="top",...g}=o,h=ce(J,o.__scopeTooltip);return e.jsx(nt,{present:c||h.open,children:h.disableHoverableContent?e.jsx(Ge,{side:d,...g,ref:n}):e.jsx(Qt,{side:d,...g,ref:n})})}),Qt=m.forwardRef((o,n)=>{const s=ce(J,o.__scopeTooltip),c=fe(J,o.__scopeTooltip),d=m.useRef(null),g=Oe(n,d),[h,b]=m.useState(null),{trigger:p,onClose:y}=s,j=d.current,{onPointerInTransitChange:f}=c,w=m.useCallback(()=>{b(null),f(!1)},[f]),N=m.useCallback((S,_)=>{const P=S.currentTarget,$={x:S.clientX,y:S.clientY},D=ts($,P.getBoundingClientRect()),r=ss($,D),O=rs(_.getBoundingClientRect()),x=os([...r,...O]);b(x),f(!0)},[f]);return m.useEffect(()=>()=>w(),[w]),m.useEffect(()=>{if(p&&j){const S=P=>N(P,j),_=P=>N(P,p);return p.addEventListener("pointerleave",S),j.addEventListener("pointerleave",_),()=>{p.removeEventListener("pointerleave",S),j.removeEventListener("pointerleave",_)}}},[p,j,N,w]),m.useEffect(()=>{if(h){const S=_=>{const P=_.target,$={x:_.clientX,y:_.clientY},D=p?.contains(P)||j?.contains(P),r=!as($,h);D?w():r&&(w(),y())};return document.addEventListener("pointermove",S),()=>document.removeEventListener("pointermove",S)}},[p,j,h,y,w]),e.jsx(Ge,{...o,ref:g})}),[Xt,Kt]=ie(te,{isInside:!1}),Zt=lt("TooltipContent"),Ge=m.forwardRef((o,n)=>{const{__scopeTooltip:s,children:c,"aria-label":d,onEscapeKeyDown:g,onPointerDownOutside:h,...b}=o,p=ce(J,s),y=le(s),{onClose:j}=p;return m.useEffect(()=>(document.addEventListener(xe,j),()=>document.removeEventListener(xe,j)),[j]),m.useEffect(()=>{if(p.trigger){const f=w=>{w.target?.contains(p.trigger)&&j()};return window.addEventListener("scroll",f,{capture:!0}),()=>window.removeEventListener("scroll",f,{capture:!0})}},[p.trigger,j]),e.jsx(it,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:g,onPointerDownOutside:h,onFocusOutside:f=>f.preventDefault(),onDismiss:j,children:e.jsxs(Pt,{"data-state":p.stateAttribute,...y,...b,ref:n,style:{...b.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(Zt,{children:c}),e.jsx(Xt,{scope:s,isInside:!0,children:e.jsx(ct,{id:p.contentId,role:"tooltip",children:d||c})})]})})});He.displayName=J;var Ue="TooltipArrow",es=m.forwardRef((o,n)=>{const{__scopeTooltip:s,...c}=o,d=le(s);return Kt(Ue,s).isInside?null:e.jsx(Dt,{...d,...c,ref:n})});es.displayName=Ue;function ts(o,n){const s=Math.abs(n.top-o.y),c=Math.abs(n.bottom-o.y),d=Math.abs(n.right-o.x),g=Math.abs(n.left-o.x);switch(Math.min(s,c,d,g)){case g:return"left";case d:return"right";case s:return"top";case c:return"bottom";default:throw new Error("unreachable")}}function ss(o,n,s=5){const c=[];switch(n){case"top":c.push({x:o.x-s,y:o.y+s},{x:o.x+s,y:o.y+s});break;case"bottom":c.push({x:o.x-s,y:o.y-s},{x:o.x+s,y:o.y-s});break;case"left":c.push({x:o.x+s,y:o.y-s},{x:o.x+s,y:o.y+s});break;case"right":c.push({x:o.x-s,y:o.y-s},{x:o.x-s,y:o.y+s});break}return c}function rs(o){const{top:n,right:s,bottom:c,left:d}=o;return[{x:d,y:n},{x:s,y:n},{x:s,y:c},{x:d,y:c}]}function as(o,n){const{x:s,y:c}=o;let d=!1;for(let g=0,h=n.length-1;g<n.length;h=g++){const b=n[g],p=n[h],y=b.x,j=b.y,f=p.x,w=p.y;j>c!=w>c&&s<(f-y)*(c-j)/(w-j)+y&&(d=!d)}return d}function os(o){const n=o.slice();return n.sort((s,c)=>s.x<c.x?-1:s.x>c.x?1:s.y<c.y?-1:s.y>c.y?1:0),ns(n)}function ns(o){if(o.length<=1)return o.slice();const n=[];for(let c=0;c<o.length;c++){const d=o[c];for(;n.length>=2;){const g=n[n.length-1],h=n[n.length-2];if((g.x-h.x)*(d.y-h.y)>=(g.y-h.y)*(d.x-h.x))n.pop();else break}n.push(d)}n.pop();const s=[];for(let c=o.length-1;c>=0;c--){const d=o[c];for(;s.length>=2;){const g=s[s.length-1],h=s[s.length-2];if((g.x-h.x)*(d.y-h.y)>=(g.y-h.y)*(d.x-h.x))s.pop();else break}s.push(d)}return s.pop(),n.length===1&&s.length===1&&n[0].x===s[0].x&&n[0].y===s[0].y?n:n.concat(s)}var is=Me,ls=Be,cs=qe,Ve=He;const ds=is,Ae=ls,_e=cs,ge=m.forwardRef(({className:o,sideOffset:n=4,...s},c)=>e.jsx(Ve,{ref:c,sideOffset:n,className:dt("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",o),...s}));ge.displayName=Ve.displayName;function Z({children:o,className:n="",title:s}){return e.jsxs("div",{className:`w-full max-w-full bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mx-2 sm:mx-0 ${n}`,children:[s&&e.jsx("div",{className:"px-4 sm:px-6 py-4 bg-gradient-to-r from-amber-100 to-orange-100 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-amber-900 leading-tight",children:s})}),e.jsx("div",{className:"p-4 sm:p-6 space-y-4",children:o})]})}function ms({categoryLabel:o,criteria:n}){return e.jsxs(Re,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(T,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 ml-2 hover:bg-blue-100 rounded-full",type:"button",children:[e.jsx(oe,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"sr-only",children:["View criteria for ",o]})]})}),e.jsx(ze,{className:"w-96 max-h-96 overflow-y-auto",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold text-sm border-b pb-2",children:[o," - Rating Criteria"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>e.jsx(k,{className:"border-l-4",style:{borderLeftColor:s>=4?"#10B981":s>=3?"#F59E0B":"#EF4444"},children:e.jsxs(I,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:Array.from({length:5},(c,d)=>e.jsx(ne,{className:`w-3 h-3 ${d<s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},d))}),e.jsxs(ee,{variant:"secondary",className:"text-xs",children:["Rating ",s]})]}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:n[s]})]})},s))})]})})]})}function us({categoryLabel:o,criteria:n}){return e.jsxs(Re,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"w-full mt-2 text-xs",type:"button",children:[e.jsx(oe,{className:"h-3 w-3 mr-2"}),"View Rating Guide"]})}),e.jsx(ze,{className:"w-80 max-h-80 overflow-y-auto",align:"center",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"font-semibold text-sm border-b pb-2",children:[o," - Rating Criteria"]}),e.jsx("div",{className:"space-y-3",children:[5,4,3,2,1].map(s=>e.jsx(k,{className:"border-l-4",style:{borderLeftColor:s>=4?"#10B981":s>=3?"#F59E0B":"#EF4444"},children:e.jsxs(I,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex",children:Array.from({length:5},(c,d)=>e.jsx(ne,{className:`w-3 h-3 ${d<s?"fill-yellow-400 text-yellow-400":"text-gray-300"}`},d))}),e.jsxs(ee,{variant:"secondary",className:"text-xs",children:["Rating ",s]})]}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:n[s]})]})},s))})]})})]})}function _s({onBack:o}){const{isMobile:n}=mt(),{toast:s}=ut();m.useEffect(()=>{const t=a=>{const l=a.target;l&&typeof l.closest=="function"&&l.closest("[data-radix-select-content]")&&(a.preventDefault(),a.stopPropagation())};return document.addEventListener("scroll",t,{passive:!1}),()=>{document.removeEventListener("scroll",t)}},[]);const c={exterior:2,gym_bleachers:1,classroom:3,cafeteria:1,utility_storage:1,admin_office:2,hallway:3,stairwell:2,restroom:2,staff_single_restroom:1},d={exterior:"Exterior",gym_bleachers:"Gym and Bleachers",classroom:"Classroom",cafeteria:"Cafeteria",utility_storage:"Utility Or Storage",admin_office:"Admin or Office Area",hallway:"Hallway",stairwell:"Stairwell",restroom:"Restroom",staff_single_restroom:"Staff or Single Restroom"},g={exterior:Rt,gym_bleachers:Bt,classroom:Ft,cafeteria:Gt,utility_storage:qt,admin_office:Lt,hallway:Ot,stairwell:St,restroom:zt,staff_single_restroom:pt},h=[{value:"ASA",label:"ASA"},{value:"LCA",label:"LCA"},{value:"GWC",label:"GWC"},{value:"OA",label:"OA"},{value:"CBR",label:"CBR"},{value:"WLC",label:"WLC"}],[b,p]=m.useState(()=>{const t={};return Object.keys(c).forEach(a=>{t[a]=0}),t}),[y,j]=m.useState([]),[f,w]=m.useState(!1),[N,S]=m.useState(!1),[_,P]=m.useState([]),[$,D]=m.useState(!1),[r,O]=m.useState({inspectorName:"",school:"",date:new Date().toISOString().split("T")[0],inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}),[x,W]=m.useState(null),[B,Ye]=m.useState(!1),[E,se]=m.useState(null),[Q,be]=m.useState(!1),[L,X]=m.useState({}),[re,je]=m.useState(null),[ve,ye]=m.useState(!1),[K,Ne]=m.useState(null);m.useEffect(()=>{Ye(Object.entries(c).every(([a,l])=>b[a]>=l))},[b]);const M=m.useMemo(()=>{const t=Object.values(c).reduce((v,A)=>v+A,0),a=Object.values(b).reduce((v,A)=>v+A,0),l=Object.entries(c).filter(([v,A])=>b[v]>=A).length,i=Object.entries(c).filter(([v,A])=>b[v]>0&&b[v]<A).length,u=Object.keys(c).length-l-i,C=t>0?Math.round(a/t*100):0;return{totalRequired:t,totalCompleted:a,completedCategories:l,inProgressCategories:i,notStartedCategories:u,overallPercentage:C,totalCategories:Object.keys(c).length}},[b,c]);m.useEffect(()=>{(async()=>{try{const l=await fetch("/api/inspections?type=whole_building&incomplete=true");if(l.ok){const i=await l.json();j(i),i.length>0&&w(!0)}}catch(l){console.error("Error loading available inspections:",l)}})(),ht(),Qe();const a=gt();console.log("Building inspection storage stats:",a)},[]),m.useEffect(()=>{if(E&&x&&(r.inspectorName||r.school||r.date)){const t=setTimeout(()=>{We()},2e3);return()=>clearTimeout(t)}},[r,x,E]);const Je=()=>`building_form_${E}_${x}_${Date.now()}`,We=async()=>{if(!(!E||!x)){ye(!0);try{const t=K||Je();K||Ne(t);const a={id:t,buildingInspectionId:E,selectedCategory:x,formData:{...r},lastModified:new Date().toISOString(),title:`${r.school} - Building - ${d[x]||x}`};ft(`${Se.DRAFT_BUILDING_INSPECTION}_${t}`,a),je(new Date)}catch(t){console.error("Error saving form draft:",t)}finally{ye(!1)}}},Qe=()=>{try{const t=localStorage.getItem("building_form_drafts");if(t){const a=JSON.parse(t),l=a.filter(i=>{const u=new Date(i.lastModified),C=new Date;return C.setDate(C.getDate()-7),u>C});l.length!==a.length&&localStorage.setItem("building_form_drafts",JSON.stringify(l))}}catch(t){console.error("Error loading form drafts:",t)}},Xe=()=>{if(K){bt(`${Se.DRAFT_BUILDING_INSPECTION}_${K}`);const t=JSON.parse(localStorage.getItem("building_form_drafts")||"[]"),a=t.filter(l=>l.id!==K);a.length!==t.length&&localStorage.setItem("building_form_drafts",JSON.stringify(a)),Ne(null),je(null)}},Ke=async t=>{try{se(t.id);const a={inspectorName:t.inspectorName||"",school:t.school,date:t.date,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""};O(a);const l=await fetch(`/api/inspections/${t.id}/rooms`);if(l.ok){const i=await l.json(),u={};Object.keys(c).forEach(C=>{u[C]=i.filter(v=>v.roomType===C).length}),p(u),S(!0),w(!1)}}catch(a){console.error("Error loading inspection:",a)}},de=()=>{w(!1),S(!1),se(null),p(()=>{const t={};return Object.keys(c).forEach(a=>{t[a]=0}),t}),O(t=>({...t,inspectionType:"whole_building",locationCategory:"",roomNumber:"",locationDescription:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""}))},F=(t,a)=>{O(l=>({...l,[t]:a}))},Ze=(t,a,l)=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(us,{categoryLabel:t.label,criteria:t.criteria}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-3 text-center",children:"Rate this category:"}),e.jsx("div",{className:"flex justify-center gap-2 mb-4",children:[1,2,3,4,5].map(i=>e.jsx("button",{type:"button",className:"p-2 rounded-md hover:bg-yellow-50 transition-colors touch-manipulation",onClick:()=>l(i),children:e.jsx(ne,{className:`w-6 h-6 ${i<=a&&a>0?"fill-yellow-400 text-yellow-400":"text-muted-foreground hover:text-yellow-300"}`})},i))}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{type:"button",className:`px-4 py-2 rounded-md border text-sm font-medium transition-colors touch-manipulation ${a===-1?"bg-muted border-border text-foreground":"bg-card border-border text-muted-foreground hover:bg-muted"}`,onClick:()=>l(-1),children:"Not Rated"})})]}),e.jsx("div",{className:"text-center",children:a>0&&a!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-base font-semibold text-yellow-600",children:ae[a-1]?.label}),e.jsx("div",{className:"text-sm text-gray-600",children:ae[a-1]?.description})]}):e.jsx("div",{className:"text-base font-semibold text-gray-600",children:"No rating selected"})}),a>0&&a!==-1&&t?.criteria&&t.criteria[a]&&e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-1",children:["Detailed Criteria for ",a," Star",a>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:t.criteria[a]})]})]}),et=(t,a,l)=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Select Rating:"}),e.jsx(ms,{categoryLabel:t.label,criteria:t.criteria})]}),e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx(T,{type:"button",variant:a===-1?"default":"outline",size:"sm",className:"px-3 py-2 text-xs",onClick:()=>l(-1),children:"Not Rated"}),[1,2,3,4,5].map(i=>e.jsx(T,{type:"button",variant:"ghost",size:"sm",className:"p-2 h-auto",onClick:()=>l(i),children:e.jsx(ne,{className:`w-6 h-6 ${i<=a&&a>0?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},i))]}),e.jsx("div",{className:"text-center",children:a>0&&a!==-1?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-lg font-semibold text-yellow-600",children:ae[a-1]?.label}),e.jsx("div",{className:"text-sm text-gray-600",children:ae[a-1]?.description})]}):e.jsx("div",{className:"text-lg font-semibold text-gray-600",children:"No rating selected"})}),a>0&&a!==-1&&t?.criteria&&t.criteria[a]&&e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-2",children:["Detailed Criteria for ",a," Star",a>1?"s":"",":"]}),e.jsx("div",{className:"text-sm text-blue-800",children:t.criteria[a]})]})]}),me=t=>{const a=window.scrollY;W(t),w(!1),O(l=>({...l,roomNumber:"",locationDescription:"",locationCategory:t,floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1,notes:"",comments:""})),requestAnimationFrame(()=>{window.scrollTo({top:a,behavior:"instant"})}),setTimeout(()=>{window.scrollTo({top:a,behavior:"instant"})},10),setTimeout(()=>{window.scrollTo({top:a,behavior:"instant"})},50)},tt=async t=>{if(t.preventDefault(),X({}),!x){s({title:"Category Required",description:"Please select a category before submitting.",variant:"destructive"});return}const l=["inspectorName","school","date","roomNumber"].filter(i=>!r[i]);if(l.length>0){const i={};l.forEach(u=>{i[u]=!0}),X(i),s({title:"Missing Required Fields",description:"Please fill in the highlighted fields",variant:"destructive"});return}be(!0);try{const i={inspectorName:r.inspectorName,school:r.school,date:r.date,inspectionType:"whole_building",locationDescription:r.locationDescription||`Building inspection for ${x}`,roomNumber:r.roomNumber||null,locationCategory:x,buildingName:null,buildingInspectionId:E||null,floors:r.floors>=0?r.floors:null,verticalHorizontalSurfaces:r.verticalHorizontalSurfaces>=0?r.verticalHorizontalSurfaces:null,ceiling:r.ceiling>=0?r.ceiling:null,restrooms:r.restrooms>=0?r.restrooms:null,customerSatisfaction:r.customerSatisfaction>=0?r.customerSatisfaction:null,trash:r.trash>=0?r.trash:null,projectCleaning:r.projectCleaning>=0?r.projectCleaning:null,activitySupport:r.activitySupport>=0?r.activitySupport:null,safetyCompliance:r.safetyCompliance>=0?r.safetyCompliance:null,equipment:r.equipment>=0?r.equipment:null,monitoring:r.monitoring>=0?r.monitoring:null,notes:r.notes||null,images:[],verifiedRooms:[],isCompleted:!1};console.log("Submitting building inspection:",i);const u=await fetch("/api/submit-building-inspection",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}),C=u.headers.get("content-type")||"";let v=null,A=null;try{C.includes("application/json")?v=await u.json():A=await u.text()}catch{try{A=await u.text()}catch{}}if(console.log("Submission response status:",u.status,"ctype:",C),v&&console.log("Submission response JSON:",v),!v&&A&&console.log("Submission response TEXT:",A.slice(0,300)),!u.ok){const q=v&&(v.message||v.error)||A||null;throw new Error(q||`HTTP error! status: ${u.status}`)}if(v&&(v.success||v.id)||u.ok)X({}),s({title:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{children:"Room Inspection Saved!"})]}),description:`${d[x]} room ${r.roomNumber} recorded successfully. Progress updated.`,className:"border-green-500 bg-green-50"}),v&&v.id&&!E&&(console.log("Setting buildingInspectionId from first submission:",v.id),se(v.id)),x&&p(q=>({...q,[x]:(q[x]||0)+1})),Xe(),O(q=>({...q,roomNumber:"",locationDescription:"",notes:"",floors:-1,verticalHorizontalSurfaces:-1,ceiling:-1,restrooms:-1,customerSatisfaction:-1,trash:-1,projectCleaning:-1,activitySupport:-1,safetyCompliance:-1,equipment:-1,monitoring:-1})),W(null);else throw new Error(v.message||"Submission failed")}catch(i){console.error("Building inspection submission error:",i);let u="Failed to save inspection. Please check your connection and try again.";i instanceof TypeError&&i.message.includes("fetch")?u="Network error. Please check your internet connection.":i instanceof Error&&(i.message.includes("404")?u="Server endpoint not found. Please contact support.":i.message.includes("500")?u="Server error. Please try again later.":i.message&&i.message!=="Submission failed"&&(u=i.message)),s({title:"Submission Failed",description:u,variant:"destructive"})}finally{be(!1)}},st=async()=>{if(!B){console.error("Please complete all required inspections before finalizing.");return}if(console.log("Attempting to finalize building inspection:",{buildingInspectionId:E,isAllComplete:B}),!E){console.error("No building inspection ID available for finalization"),s({title:"Finalization Failed",description:"No building inspection ID found. Please start a new inspection.",variant:"destructive"});return}try{console.log(`Calling finalize endpoint: /api/inspections/${E}/finalize`);const t=await fetch(`/api/inspections/${E}/finalize`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}});console.log("Finalize response status:",t.status);let a=t.ok,l=null;if(!a){try{const u=await t.json();l=u.error||u.message,console.log("Finalize endpoint error:",u)}catch{const C=await t.text();console.log("Finalize endpoint error (text):",C.slice(0,200)),l=C}console.log(`Trying PATCH fallback: /api/inspections/${E}`);const i=await fetch(`/api/inspections/${E}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({isCompleted:!0})});if(console.log("PATCH response status:",i.status),a=i.ok,!a){try{const u=await i.json();l=u.error||u.message||"Failed to finalize inspection",console.log("PATCH endpoint error:",u)}catch{const C=await i.text();console.log("PATCH endpoint error (text):",C.slice(0,200)),l=C||"Failed to finalize inspection"}throw new Error(l)}}D(!0),s({title:"ðŸŽ‰ Building Inspection Complete! ðŸŽ‰",description:"Excellent work! All required inspections submitted successfully. The building inspection is now finalized.",duration:5e3,className:"border-green-500 bg-green-50"}),console.log("Whole building inspection completed successfully!"),setTimeout(()=>{o&&o()},3e3)}catch(t){console.error("Error finalizing inspection:",t),s({title:"Finalization Failed",description:"Failed to finalize building inspection. Please try again.",variant:"destructive"})}};return e.jsx(ds,{children:e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl space-y-6",children:[!f&&e.jsx(k,{className:"border-primary/30",children:e.jsxs(I,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"Start New Building Inspection"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Guided, step-by-step workflow to complete all required areas"})]}),e.jsx(T,{onClick:de,size:"lg",className:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg transition-shadow min-h-[44px]",children:"ðŸ¢ Start New Building Inspection"})]})}),$&&e.jsx(k,{className:"border-green-300 bg-green-50",children:e.jsxs(I,{className:"py-4 flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-green-800",children:"Building Inspection Finalized"}),e.jsx("div",{className:"text-sm text-green-700",children:"Your comprehensive inspection has been submitted successfully."})]}),e.jsx(T,{onClick:()=>{D(!1),de()},className:"bg-green-600 hover:bg-green-700 text-white",children:"Start New Building Inspection"})]})}),e.jsxs("div",{className:"mb-6",children:[o&&e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx(T,{variant:"outline",onClick:o,className:"flex-shrink-0 back-button",children:"â† Back"})}),e.jsx("div",{className:"flex justify-center px-4",children:e.jsxs(Et,{className:"w-full max-w-lg",children:[e.jsx(At,{asChild:!0,children:e.jsx(T,{variant:"ghost",className:"w-full p-3 h-auto font-normal text-center text-primary hover:text-primary/80 hover:bg-accent/10 border border-accent/30 rounded-lg text-sm sm:text-base leading-relaxed",children:"ðŸ“‹ How to conduct a whole building inspection â†“"})}),e.jsx(_t,{className:"mt-3 p-4 bg-accent/10 rounded-lg border border-accent/30",children:e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 1: Getting Started"}),e.jsx("p",{children:"Enter your inspector name, select the school, and choose the inspection date. This information will be saved automatically."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 2: Complete Required Inspections"}),e.jsx("p",{children:'Each category below shows how many inspections are required (e.g., 3 Classrooms, 2 Restrooms). Click "Select" on any incomplete category to start inspecting that area type.'})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 3: Rate Each Area"}),e.jsx("p",{children:"For each room/area, rate the custodial performance using the 1-5 star system you're familiar with. Add room numbers and notes as needed."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 4: Track Progress"}),e.jsx("p",{children:"Your progress is saved automatically. Green checkmarks show completed categories. Return anytime to continue where you left off."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-1",children:"Step 5: Finalize"}),e.jsx("p",{children:'Once all required inspections are complete, the "Finalize Building Inspection" button will become available to submit your comprehensive inspection.'})]})]})})]})})]}),f&&e.jsxs(k,{children:[e.jsxs(H,{children:[e.jsx(G,{children:"Building Inspection Options"}),e.jsx(Y,{children:"You can continue a previous inspection or start a new one"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-lg",children:"Start New Inspection:"}),e.jsx(T,{onClick:de,className:"w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-8 border-2 border-green-600 hover:border-green-700 rounded-lg shadow-md hover:shadow-xl transition-all duration-200 text-lg min-h-[56px]",variant:"default",size:"lg",children:"ðŸ¢ Start New Building Inspection"}),e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Begin a fresh comprehensive building inspection"})]}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ct,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Or Continue Previous Inspection:"}),e.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto border-2 border-amber-300 rounded-lg p-3 bg-amber-25 shadow-inner",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 pb-2 border-b border-amber-200",children:[e.jsx("span",{className:"text-sm font-medium text-amber-800",children:"Available Inspections"}),e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-2 py-1 rounded-full",children:[y.length," found"]})]}),y.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-amber-100 bg-amber-50 border-amber-200 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs bg-amber-200 text-amber-800 px-2 py-0.5 rounded-full font-medium",children:["#",a+1]}),e.jsx("div",{className:"font-medium text-amber-900",children:t.school})]}),e.jsxs("div",{className:"text-sm text-amber-700 mt-1",children:[new Date(t.date).toLocaleDateString(),t.inspectorName&&e.jsxs("span",{className:"block text-sm text-amber-800 font-medium",children:["Inspector: ",t.inspectorName]})]})]}),t.isCompleted?e.jsx(ee,{variant:"default",className:"bg-green-500",children:"Completed âœ“"}):e.jsx(T,{onClick:()=>Ke(t),variant:"outline",size:"sm",className:"border-amber-400 text-amber-700 hover:bg-amber-100 font-medium",children:"Continue"})]},t.id)),y.length>3&&e.jsx("div",{className:"text-center py-2 border-t border-amber-200 mt-2",children:e.jsxs("span",{className:"text-xs text-amber-600 bg-amber-100 px-3 py-1 rounded-full",children:["â†• Scroll to see all ",y.length," ","inspections"]})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"These inspections were started but not completed"})]})]})]})]}),!N&&!f&&e.jsxs(k,{children:[e.jsxs(H,{children:[e.jsx(G,{children:"Building Information"}),e.jsx(Y,{children:"Select the school and date for this inspection"})]}),e.jsx(I,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"inspectorName",children:"Inspector Name *"}),e.jsx(z,{id:"inspectorName",value:r.inspectorName,onChange:t=>F("inspectorName",t.target.value),placeholder:"Enter inspector name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"school",children:"School"}),e.jsxs(jt,{value:r.school,onValueChange:t=>F("school",t),children:[e.jsx(vt,{children:e.jsx(yt,{placeholder:"Select school"})}),e.jsx(Nt,{children:h.map(t=>e.jsx(wt,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"date",children:"Date"}),e.jsx(z,{id:"date",type:"date",value:r.date,onChange:t=>F("date",t.target.value),required:!0})]})]})})]}),N&&e.jsxs(k,{children:[e.jsxs(H,{children:[e.jsx(G,{children:"Current Inspection"}),e.jsx(Y,{children:"Continuing inspection progress"})]}),e.jsxs(I,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Inspector:"}),e.jsx("span",{children:r.inspectorName||"Not specified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"School:"}),e.jsx("span",{children:r.school})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Date:"}),e.jsx("span",{children:new Date(r.date).toLocaleDateString()})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(T,{onClick:()=>{w(!0),S(!1),se(null)},variant:"outline",size:"sm",children:"Switch to Different Inspection"})})]})]}),!f&&(r.school||r.date||N)&&e.jsx(k,{className:"border-primary/20 bg-gradient-to-r from-primary/5 to-primary/10 animate-in fade-in-0 slide-in-from-top-4 duration-500",children:e.jsx(I,{className:"py-4",children:e.jsxs("div",{className:"space-y-4",role:"region","aria-label":"Overall inspection progress summary",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary",children:"Overall Progress"}),e.jsxs(Ae,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(oe,{className:"w-4 h-4 text-muted-foreground cursor-help"})}),e.jsx(ge,{className:"max-w-xs",children:e.jsx("p",{children:"Tracks completion across all required room categories. Complete all rooms in a category to mark it complete."})})]})]}),e.jsxs("span",{className:"text-2xl font-bold text-primary",children:[M.overallPercentage,"%"]})]}),e.jsx(ue,{value:M.overallPercentage,className:"h-3 bg-primary/10 transition-all duration-700 ease-out","aria-label":`Overall progress: ${M.overallPercentage}% complete`}),e.jsxs("p",{className:"text-sm text-muted-foreground text-center","aria-live":"polite","aria-atomic":"true",children:[M.totalCompleted," of ",M.totalRequired," rooms inspected"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 pt-2 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Complete"})]}),e.jsx("p",{className:"text-xl font-bold text-green-700",children:M.completedCategories})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"In Progress"})]}),e.jsx("p",{className:"text-xl font-bold text-amber-700",children:M.inProgressCategories})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Not Started"})]}),e.jsx("p",{className:"text-xl font-bold text-gray-600",children:M.notStartedCategories})]})]})]})})}),!f&&(r.school||r.date||N)&&e.jsx(k,{className:"animate-in fade-in-0 slide-in-from-top-4 duration-500 delay-75",children:e.jsx(I,{className:"py-3",children:e.jsxs("div",{className:"space-y-2",role:"navigation","aria-label":"Category quick jump navigation",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Quick Jump"}),e.jsxs(Ae,{children:[e.jsx(_e,{asChild:!0,children:e.jsx(oe,{className:"w-3.5 h-3.5 text-muted-foreground cursor-help"})}),e.jsx(ge,{className:"max-w-xs",children:e.jsx("p",{children:"Quickly switch between room categories. Green = complete, Amber = in progress, Gray = not started."})})]})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:Object.entries(c).map(([t,a])=>{const l=b[t],i=l>=a,u=l>0&&!i,C=g[t];return e.jsxs("button",{onClick:()=>{me(t),window.scrollTo({top:0,behavior:"smooth"})},className:`flex-shrink-0 flex flex-col items-center gap-1 px-3 py-2 rounded-lg border-2 transition-all duration-200 ease-in-out hover:scale-105 active:scale-95 min-w-[80px] ${x===t?"border-blue-500 bg-blue-50 shadow-sm":i?"border-green-300 bg-green-50 hover:border-green-400":u?"border-amber-300 bg-amber-50 hover:border-amber-400":"border-gray-200 bg-white hover:border-gray-300"}`,disabled:!r.school||!r.date||!r.inspectorName.trim(),"aria-label":`Select ${d[t]} category. ${l} of ${a} rooms completed. ${i?"Complete":u?"In progress":"Not started"}.`,children:[C&&e.jsx(C,{className:`w-5 h-5 ${i?"text-green-600":u?"text-amber-600":"text-gray-500"}`}),e.jsx("span",{className:"text-xs font-medium text-center leading-tight",children:d[t].split(" ")[0]}),i&&e.jsx(pe,{className:"w-3 h-3 text-green-600"})]},t)})})]})})}),!f&&(n?e.jsxs(Z,{title:"Inspection Progress","data-inspection-progress":!0,children:[e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Complete the required number of inspections for each category",r.school&&r.date&&e.jsx("span",{className:"block text-xs text-gray-500 mt-1",children:"(Progress is automatically saved)"})]}),e.jsx("div",{className:"space-y-4",children:Object.entries(c).map(([t,a])=>{const l=b[t],i=l>=a,u=g[t];return e.jsx("div",{className:`p-4 rounded-lg border-l-4 border-y border-r ${i?"bg-green-50 border-l-green-500 border-y-green-200 border-r-green-200":x===t?"bg-blue-50 border-l-blue-500 border-y-blue-300 border-r-blue-300":l>0?"bg-amber-50 border-l-amber-500 border-y-amber-200 border-r-amber-200":"bg-gray-50 border-l-gray-300 border-y-gray-200 border-r-gray-200"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center flex-shrink-0 mt-0.5 ${i?"bg-green-500 border-green-500":"border-gray-400"}`,children:i&&e.jsx(pe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx(u,{className:`w-4 h-4 flex-shrink-0 ${i?"text-green-700":"text-gray-600"}`}),e.jsx("span",{className:`font-medium text-sm leading-tight ${i?"text-green-800":"text-gray-700"}`,children:d[t]})]}),e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ee,{variant:i?"default":"secondary",className:"text-xs",children:[l,"/",a," Done"]}),e.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[Math.round(l/a*100),"%"]})]}),e.jsx(ue,{value:l/a*100,className:"h-2"}),!i&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(T,{size:"sm",variant:"outline",onClick:()=>me(t),className:`text-xs px-3 min-h-[44px] w-full ${x===t?"border-blue-500 bg-blue-50 shadow-sm":""}`,children:"Select"})]})]})]})})},t)})})]}):e.jsxs(k,{"data-inspection-progress":!0,children:[e.jsxs(H,{children:[e.jsx(G,{children:"Inspection Progress"}),e.jsxs(Y,{children:["Complete the required number of inspections for each category",r.school&&r.date&&e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Progress is automatically saved)"})]})]}),e.jsx(I,{className:"space-y-4",children:Object.entries(c).map(([t,a])=>{const l=b[t],i=l>=a,u=g[t];return e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg border-l-4 border-y border-r ${i?"bg-green-50 border-l-green-500 border-y-green-200 border-r-green-200":x===t?"bg-blue-50 border-l-blue-500 border-y-blue-300 border-r-blue-300":l>0?"bg-amber-50 border-l-amber-500 border-y-amber-200 border-r-amber-200":"bg-gray-50 border-l-gray-300 border-y-gray-200 border-r-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:`w-6 h-6 rounded-sm border-2 flex items-center justify-center flex-shrink-0 ${i?"bg-green-500 border-green-500":"border-gray-400"}`,children:i&&e.jsx(pe,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsx(u,{className:`w-4 h-4 flex-shrink-0 ${i?"text-green-700":"text-gray-600"}`}),e.jsx("span",{className:`font-medium ${i?"text-green-800":"text-gray-700"}`,children:d[t]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ue,{value:l/a*100,className:"h-2 flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground font-medium whitespace-nowrap",children:[Math.round(l/a*100),"%"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[e.jsxs(ee,{variant:i?"default":"secondary",children:[l,"/",a," Completed"]}),!i&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(T,{size:"sm",variant:"outline",onClick:()=>me(t),className:`min-h-[44px] px-4 ${x===t?"border-blue-500 bg-blue-50 shadow-sm":""}`,children:"Select"})]})]},t)})})]})),!f&&x&&!(r.school&&r.date&&r.inspectorName.trim())&&e.jsx(k,{className:"border-amber-200 bg-amber-50",children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-amber-500 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"!"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-amber-800 mb-1",children:"Complete Required Information"}),e.jsx("p",{className:"text-sm text-amber-700",children:"Please fill in all required fields above before you can start rating this category:"}),e.jsxs("ul",{className:"text-sm text-amber-700 mt-2 space-y-1",children:[!r.inspectorName.trim()&&e.jsx("li",{children:"â€¢ Inspector Name is required"}),!r.school&&e.jsx("li",{children:"â€¢ School selection is required"}),!r.date&&e.jsx("li",{children:"â€¢ Inspection date is required"})]})]})]})})}),!f&&x&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx(k,{className:"bg-muted/30",children:e.jsx(I,{className:"py-3",children:e.jsxs("nav",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(xt,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"font-medium text-foreground",children:r.school}),e.jsx(De,{className:"w-4 h-4 mx-2"}),e.jsx("span",{className:"font-medium text-foreground",children:d[x]}),r.roomNumber&&e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 mx-2"}),e.jsxs("span",{className:"text-primary font-semibold",children:["Room ",r.roomNumber]})]})]})})}),!f&&x&&r.school&&r.date&&r.inspectorName.trim()&&e.jsxs("form",{onSubmit:tt,className:`space-y-4 ${n?"":"space-y-6"}`,children:[n?e.jsxs(Z,{title:`Inspecting: ${d[x]}`,children:[re&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",re.toLocaleTimeString()]})]}),ve&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 text-sm text-blue-600",children:[e.jsx(Ee,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"roomNumber",className:`text-base font-medium ${L.roomNumber?"text-destructive":""}`,children:"Room Number *"}),e.jsx(z,{id:"roomNumber",className:`h-12 text-base ${L.roomNumber?"border-destructive focus-visible:ring-destructive":""}`,value:r.roomNumber,onChange:t=>{F("roomNumber",t.target.value),L.roomNumber&&X(a=>({...a,roomNumber:!1}))},placeholder:"Enter room number",required:!0}),L.roomNumber&&e.jsx("p",{className:"text-sm text-destructive",children:"Room number is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"locationDescription",className:"text-base font-medium",children:"Location Description"}),e.jsx(z,{id:"locationDescription",className:"h-12 text-base",value:r.locationDescription,onChange:t=>F("locationDescription",t.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})]}):e.jsxs(k,{children:[e.jsxs(H,{children:[e.jsxs(G,{children:["Inspecting: ",d[x]]}),e.jsxs(Y,{children:["Complete the inspection for this category",re&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("span",{children:["Auto-saved at ",re.toLocaleTimeString()]})]}),ve&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-blue-600",children:[e.jsx(Ee,{className:"w-4 h-4 animate-pulse"}),e.jsx("span",{children:"Saving..."})]})]})]}),e.jsx(I,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"roomNumber",className:L.roomNumber?"text-destructive":"",children:"Room Number *"}),e.jsx(z,{id:"roomNumber",className:L.roomNumber?"border-destructive focus-visible:ring-destructive":"",value:r.roomNumber,onChange:t=>{F("roomNumber",t.target.value),L.roomNumber&&X(a=>({...a,roomNumber:!1}))},placeholder:"Enter room number",required:!0}),L.roomNumber&&e.jsx("p",{className:"text-sm text-destructive",children:"Room number is required"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(R,{htmlFor:"locationDescription",children:"Location Description"}),e.jsx(z,{id:"locationDescription",value:r.locationDescription,onChange:t=>F("locationDescription",t.target.value),placeholder:"e.g., Main Building, Second Floor"})]})]})})]}),n?e.jsx(Z,{title:"Rate Each Category",children:e.jsx("div",{className:"space-y-4",children:Pe.map((t,a)=>e.jsx(Te,{title:t.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:Ze(t,r[t.key],l=>F(t.key,l))},t.key))})}):e.jsx("div",{className:"grid gap-4 grid-cols-1 lg:grid-cols-2",children:Pe.map((t,a)=>{const l=t.key;return e.jsx(Te,{title:t.label,defaultCollapsed:!0,className:"border border-gray-200",titleClassName:"text-left font-medium",contentClassName:"space-y-3",children:et(t,r[l],i=>F(l,i))},t.key)})}),n?e.jsx(Z,{title:"Additional Notes",children:e.jsx(Ie,{value:r.notes,onChange:t=>F("notes",t.target.value),placeholder:"Enter any additional observations...",rows:4,className:"text-base min-h-[120px]"})}):e.jsxs(k,{children:[e.jsx(H,{children:e.jsx(G,{children:"Additional Notes"})}),e.jsx(I,{children:e.jsx(Ie,{value:r.notes,onChange:t=>F("notes",t.target.value),placeholder:"Enter any additional observations...",rows:4})})]}),n?e.jsx(Z,{title:"Photo Documentation",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(R,{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Ce,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Upload Images"})]}),e.jsx(z,{id:"image-upload",type:"file",multiple:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${t.target.files.length} photo${t.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",t.target.files.length,"files"),t.target.value="")},className:"hidden"})]}),e.jsxs(R,{htmlFor:"camera-capture",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(ke,{className:"w-5 h-5"}),e.jsx("span",{className:"text-base",children:"Take Photo"})]}),e.jsx(z,{id:"camera-capture",type:"file",accept:"image/*",capture:"environment",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",t.target.files[0].name),t.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Upload existing images or take new photos to document the inspection"})]})}):e.jsxs(k,{children:[e.jsxs(H,{children:[e.jsx(G,{children:"Photo Documentation"}),e.jsx(Y,{children:"Upload images or take photos to document the inspection"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{htmlFor:"image-upload-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Upload Images"})]}),e.jsx(z,{id:"image-upload-desktop",type:"file",multiple:!0,accept:"image/*",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“¸ Photos Uploaded Successfully!",description:`Added ${t.target.files.length} photo${t.target.files.length>1?"s":""} to room inspection documentation.`,duration:3e3}),console.log("Files selected:",t.target.files.length,"files"),t.target.value="")},className:"hidden"})]}),e.jsxs(R,{htmlFor:"camera-capture-desktop",className:"cursor-pointer",children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border border-dashed border-gray-300 rounded-lg hover:border-gray-400 transition-colors",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{children:"Take Photo"})]}),e.jsx(z,{id:"camera-capture-desktop",type:"file",accept:"image/*",capture:"environment",onChange:t=>{t.target.files&&t.target.files.length>0&&(s({title:"ðŸ“· Photo Captured Successfully!",description:"Camera photo has been added to your inspection documentation.",duration:3e3}),console.log("Camera photo taken:",t.target.files[0].name),t.target.value="")},className:"hidden"})]})]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Select multiple images from your device or take new photos with your camera"})]})]}),e.jsx(T,{type:"submit",size:"lg",className:`w-full bg-blue-600 hover:bg-blue-700 shadow-md hover:shadow-lg transition-shadow ${n?"min-h-[56px] text-lg":"min-h-[48px]"}`,disabled:Q,children:Q?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx($t,{className:"w-5 h-5 animate-spin"}),"Saving inspection..."]}):`Submit ${d[x]} Inspection`})]}),!f&&e.jsxs("div",{className:`border-t ${n?"pt-4":"pt-6"}`,children:[e.jsx(T,{onClick:st,size:"lg",className:`w-full bg-green-600 hover:bg-green-700 shadow-md hover:shadow-xl transition-all ${n?"min-h-[56px] text-base":"min-h-[48px]"}`,disabled:!B,children:n?"Finalize Building Inspection":"Finalize Whole Building Inspection"}),!B&&e.jsx("p",{className:`text-center text-gray-500 mt-2 ${n?"text-xs px-2":"text-sm"}`,children:n?"Complete all required inspections first":"Complete all required inspections to enable this button"})]}),!f&&x&&r.school&&r.date&&r.inspectorName.trim()&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50 animate-in fade-in-0 zoom-in-95 duration-300",children:e.jsx(T,{type:"button",onClick:t=>{const a=document.querySelector("form");if(a){const l=new Event("submit",{bubbles:!0,cancelable:!0});a.dispatchEvent(l)}},disabled:Q,className:`rounded-full shadow-xl hover:shadow-2xl hover:scale-110 active:scale-95 transition-all duration-200 ${n?"w-14 h-14":"w-16 h-16"} bg-blue-600 hover:bg-blue-700 text-white`,title:"Quick Submit Room","aria-label":Q?"Submitting room inspection":`Quick submit ${d[x]} inspection`,children:Q?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):e.jsx(Ht,{className:"w-6 h-6"})})})]})})}export{_s as default};
