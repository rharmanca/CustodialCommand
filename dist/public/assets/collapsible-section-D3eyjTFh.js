import{k as N,F as a,r as E,j as c}from"./index-CUq15lq8.js";import{C as A}from"./chevron-right-BLAgX9bk.js";import{a as _}from"./Combination-Cxk4k8Ab.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=N("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),f={DRAFT_INSPECTION:"custodial-draft-inspection",DRAFT_BUILDING_INSPECTION:"custodial-draft-building-inspection",DRAFT_CUSTODIAL_NOTE:"custodial-draft-custodial-note",USER_PREFERENCES:"custodial-user-preferences",LEGACY_INSPECTION_DRAFTS:"custodial_inspection_drafts",LEGACY_BUILDING_DRAFTS:"building_form_drafts"},m={MAX_DRAFT_SIZE:5*1024*1024,MAX_TOTAL_STORAGE:8*1024*1024,MAX_DRAFTS_PER_TYPE:10,IMAGE_QUALITY:.7,MAX_IMAGE_DIMENSIONS:{width:1200,height:1200}},g=()=>{let e=0;const o=a.keys();for(const r of o){const t=a.getItem(r);t&&(e+=t.length+r.length)}return e},D=e=>new Promise((o,r)=>{const t=document.createElement("canvas"),n=t.getContext("2d"),s=new Image;s.onload=()=>{const{width:d,height:u}=m.MAX_IMAGE_DIMENSIONS;let{width:i,height:l}=s;if(i>d||l>u){const S=Math.min(d/i,u/l);i*=S,l*=S}t.width=i,t.height=l,n?.drawImage(s,0,0,i,l);const I=t.toDataURL("image/jpeg",m.IMAGE_QUALITY);o(I)},s.onerror=r,s.src=URL.createObjectURL(e)}),R=(e,o)=>{try{const r={data:o,timestamp:Date.now()},t=JSON.stringify(r);if(t.length>m.MAX_DRAFT_SIZE){console.warn(`Draft too large (${Math.round(t.length/1024)}KB). Skipping save.`);return}if(g()+t.length>m.MAX_TOTAL_STORAGE&&(p(),g()+t.length>m.MAX_TOTAL_STORAGE)){console.warn("Storage limit reached. Cannot save draft.");return}a.setItem(e,t)}catch(r){if(console.error("Failed to save draft to localStorage:",r),r instanceof Error&&r.name==="QuotaExceededError"){p();try{a.setItem(e,JSON.stringify({data:o,timestamp:Date.now()}))}catch(t){console.error("Failed to save draft even after cleanup:",t)}}}},x=e=>{try{const o=a.getItem(e);if(!o)return null;const r=JSON.parse(o);return Date.now()-r.timestamp>10080*60*1e3?(a.removeItem(e),null):r.data}catch(o){return console.error("Failed to load draft from localStorage:",o),null}},y=e=>{try{a.removeItem(e)}catch(o){console.error("Failed to clear draft from localStorage:",o)}},p=()=>{try{const e=Date.now()-6048e5,o=[],r=a.keys();for(const t of r)if(t.startsWith("custodial-"))try{const n=a.getItem(t);if(n){const s=JSON.parse(n);s.timestamp&&s.timestamp<e&&o.push(t)}}catch{o.push(t)}o.forEach(t=>a.removeItem(t)),console.log(`Cleaned up ${o.length} old drafts`)}catch(e){console.error("Failed to cleanup old drafts:",e)}},M=()=>{try{a.getItem(f.LEGACY_INSPECTION_DRAFTS)&&(console.log("Migrating legacy inspection drafts..."),a.removeItem(f.LEGACY_INSPECTION_DRAFTS)),a.getItem(f.LEGACY_BUILDING_DRAFTS)&&(console.log("Migrating legacy building inspection drafts..."),a.removeItem(f.LEGACY_BUILDING_DRAFTS)),p()}catch(e){console.error("Failed to migrate legacy drafts:",e)}},L=async e=>{try{return e.size<500*1024?new Promise((o,r)=>{const t=new FileReader;t.onload=()=>o(t.result),t.onerror=r,t.readAsDataURL(e)}):await D(e)}catch(o){throw console.error("Failed to process image for storage:",o),o}},O=()=>{const e=g(),o=a.keys().filter(r=>r.startsWith("custodial-")).length;return{totalSizeKB:Math.round(e/1024),totalSizeMB:Math.round(e/(1024*1024)*100)/100,draftCount:o,limitMB:Math.round(m.MAX_TOTAL_STORAGE/(1024*1024)),usagePercent:Math.round(e/m.MAX_TOTAL_STORAGE*100)}};function h(...e){return e.filter(Boolean).join(" ")}function w({title:e,children:o,defaultCollapsed:r=!0,className:t,titleClassName:n,contentClassName:s,disabled:d=!1}){const[u,i]=E.useState(r),l=()=>{d||i(!u)};return c.jsxDEV("div",{className:h("border border-gray-200 rounded-lg overflow-hidden",t||""),children:[c.jsxDEV("button",{type:"button",onClick:l,disabled:d,className:h("w-full justify-between p-4 h-auto font-medium text-left hover:bg-gray-50 border-none rounded-none flex items-center bg-transparent cursor-pointer",d?"cursor-not-allowed opacity-50":"",n||""),children:[c.jsxDEV("span",{className:"text-base",children:e},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:47,columnNumber:9},this),u?c.jsxDEV(A,{className:"w-5 h-5 transition-transform duration-200"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:49,columnNumber:11},this):c.jsxDEV(_,{className:"w-5 h-5 transition-transform duration-200"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:51,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:37,columnNumber:7},this),c.jsxDEV("div",{className:h("transition-all duration-300 ease-in-out overflow-hidden",u?"max-h-0":"max-h-[2000px]"),children:c.jsxDEV("div",{className:h("p-4 pt-0",s||""),children:o},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:61,columnNumber:9},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:55,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/components/ui/collapsible-section.tsx",lineNumber:36,columnNumber:5},this)}export{w as C,f as S,v as a,y as c,O as g,x as l,M as m,L as p,R as s};
