import{r,j as e,F as D,G as z}from"./vendor-1jRaonge-v6.js";import{a as G,B as E,T as W,g as q,h as V,i as U,I as H,S as f,p as N,q as x,r as C,s as t,bi as K,bj as Q,bk as X}from"./index-DUq3a8zQ-v6.js";import"./ui-BQCqNqg0-v6.js";import"./utils-DvvWCVwA-v6.js";import"./forms-qrEI1HMw-v6.js";import"./charts-core-Ci00SAtp-v6.js";import"./pdf-export-DLkp0oRl-v6.js";const Z=["ASA","LCA","GWC","OA","CBR","WLC"],_=["January","February","March","April","May","June","July","August","September","October","November","December"];function oe({onBack:p}){const{toast:m}=G(),[l,j]=r.useState([]),[S,w]=r.useState(!0),[F,A]=r.useState(null),[L,c]=r.useState(!1),[T,M]=r.useState(!1),[o,g]=r.useState(""),[n,y]=r.useState("all"),[i,v]=r.useState("all"),[d,k]=r.useState("all");r.useEffect(()=>{u(),I()},[]);const I=()=>{const a=localStorage.getItem("admin-session-token");M(!!a)},u=async()=>{try{const a=await fetch("/api/monthly-feedback");if(a.ok){const s=await a.json();Array.isArray(s)?j(s):(console.error("Invalid data format from API"),m({variant:"destructive",title:"Data Error",description:"Received invalid data format from server."}))}else throw new Error("Failed to fetch feedback")}catch(a){console.error("Error fetching feedback:",a),m({variant:"destructive",title:"Failed to Load",description:"Unable to load monthly feedback. Please try again."})}finally{w(!1)}},h=r.useMemo(()=>Array.isArray(l)?l.filter(a=>{if(!a||typeof a!="object"||n!=="all"&&a.school!==n||i!=="all"&&a.year!==parseInt(i)||d!=="all"&&a.month!==d)return!1;if(o){const s=o.toLowerCase();if(!(a.school?.toLowerCase().includes(s)||a.month?.toLowerCase().includes(s)||a.year?.toString().includes(s)||a.extractedText?.toLowerCase().includes(s)||a.notes?.toLowerCase().includes(s)))return!1}return!0}):[],[l,n,i,d,o]),O=()=>{g(""),y("all"),v("all"),k("all")},B=a=>a,Y=r.useMemo(()=>{if(!Array.isArray(l))return[];const a=l.map(s=>s.year).filter(s=>typeof s=="number").sort((s,b)=>b-s);return Array.from(new Set(a))},[l]),P=a=>{A(a),c(!0)},R=a=>{const s=document.createElement("a");s.href=a.pdfUrl,s.download=a.pdfFileName||`feedback-${a.month}-${a.year}.pdf`,document.body.appendChild(s),s.click(),document.body.removeChild(s)},$=async a=>{try{const s=localStorage.getItem("admin-session-token");if((await fetch(`/api/monthly-feedback/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok)m({title:"Deleted Successfully",description:"Monthly feedback has been deleted."}),c(!1),u();else throw new Error("Delete failed")}catch{m({variant:"destructive",title:"Delete Failed",description:"Failed to delete feedback. Please try again."})}},J=()=>{u()};return e.jsxDEV("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[p&&e.jsxDEV(E,{onClick:p,variant:"outline",className:"mb-4 back-button",children:"← Back to Home"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:185,columnNumber:9},this),e.jsxDEV("div",{className:"text-center",children:[e.jsxDEV("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"Monthly Feedback Reports"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:191,columnNumber:9},this),e.jsxDEV("p",{className:"text-muted-foreground",children:"Upload and manage monthly custodial feedback emails"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:192,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:190,columnNumber:7},this),e.jsxDEV(W,{defaultValue:"browse",className:"w-full",children:[e.jsxDEV(q,{className:"grid w-full grid-cols-2",children:[e.jsxDEV(V,{value:"browse",children:[e.jsxDEV(D,{className:"w-4 h-4 mr-2"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:198,columnNumber:13},this),"Browse Feedback"]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:197,columnNumber:11},this),e.jsxDEV(V,{value:"upload",children:"Upload New Feedback"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:201,columnNumber:11},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:196,columnNumber:9},this),e.jsxDEV(U,{value:"browse",className:"space-y-6",children:[e.jsxDEV("div",{className:"space-y-4",role:"search",children:[e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxDEV("div",{className:"space-y-2",children:e.jsxDEV(H,{placeholder:"Search by title, uploader, notes or month…",value:o,onChange:a=>g(a.target.value),className:"w-full","aria-label":"Search feedback by title, uploader, notes or month"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:209,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:208,columnNumber:15},this),e.jsxDEV(f,{value:n,onValueChange:y,children:[e.jsxDEV(N,{"aria-label":"Filter by school",children:e.jsxDEV(x,{placeholder:"All Schools"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:220,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:219,columnNumber:15},this),e.jsxDEV(C,{children:[e.jsxDEV(t,{value:"all",children:"All Schools"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:223,columnNumber:17},this),Z.map(a=>e.jsxDEV(t,{value:a,title:B(a),children:a},a,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:225,columnNumber:19},this))]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:222,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:218,columnNumber:13},this),e.jsxDEV(f,{value:i,onValueChange:v,children:[e.jsxDEV(N,{"aria-label":"Filter by year",children:e.jsxDEV(x,{placeholder:"All Years"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:232,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:231,columnNumber:15},this),e.jsxDEV(C,{children:[e.jsxDEV(t,{value:"all",children:"All Years"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:235,columnNumber:17},this),Y.map(a=>e.jsxDEV(t,{value:a.toString(),children:a},a,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:237,columnNumber:19},this))]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:234,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:230,columnNumber:13},this),e.jsxDEV(f,{value:d,onValueChange:k,children:[e.jsxDEV(N,{"aria-label":"Filter by month",children:e.jsxDEV(x,{placeholder:"All Months"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:244,columnNumber:17},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:243,columnNumber:15},this),e.jsxDEV(C,{children:[e.jsxDEV(t,{value:"all",children:"All Months"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:247,columnNumber:17},this),_.map(a=>e.jsxDEV(t,{value:a,children:a},a,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:249,columnNumber:19},this))]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:246,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:242,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:207,columnNumber:13},this),e.jsxDEV("div",{className:"flex justify-end",children:e.jsxDEV(E,{onClick:O,variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsxDEV(z,{className:"w-4 h-4"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:263,columnNumber:17},this),"Clear Filters"]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:257,columnNumber:15},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:256,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:206,columnNumber:11},this),S?e.jsxDEV("div",{className:"text-center py-12",children:e.jsxDEV("p",{className:"text-muted-foreground",children:"Loading feedback..."},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:272,columnNumber:15},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:271,columnNumber:13},this):h.length===0?e.jsxDEV("div",{className:"text-center py-12",children:[e.jsxDEV(D,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:276,columnNumber:15},this),e.jsxDEV("h3",{className:"text-lg font-medium mb-2",children:"No Feedback Found"},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:277,columnNumber:15},this),e.jsxDEV("p",{className:"text-muted-foreground",children:l.length===0?"No monthly feedback has been uploaded yet.":"No feedback matches your search criteria."},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:278,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:275,columnNumber:13},this):e.jsxDEV(e.Fragment,{children:[e.jsxDEV("p",{className:"text-sm text-muted-foreground",children:["Showing ",h.length," of ",l.length," feedback report",l.length!==1?"s":""]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:286,columnNumber:15},this),e.jsxDEV("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(a=>e.jsxDEV(K,{feedback:a,onView:P,onDownload:R},a.id,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:291,columnNumber:19},this))},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:289,columnNumber:15},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:285,columnNumber:13},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:204,columnNumber:9},this),e.jsxDEV(U,{value:"upload",children:e.jsxDEV(Q,{onUploadSuccess:J},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:304,columnNumber:11},this)},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:303,columnNumber:9},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:195,columnNumber:7},this),e.jsxDEV(X,{feedback:F,isOpen:L,onClose:()=>c(!1),onDelete:$,isAdmin:T},void 0,!1,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:308,columnNumber:7},this)]},void 0,!0,{fileName:"/Users/rharman/CustodialCommand/src/pages/monthly-feedback.tsx",lineNumber:183,columnNumber:5},this)}export{oe as default};
