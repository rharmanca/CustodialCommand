var F=(N,w,h)=>new Promise((y,m)=>{var g=r=>{try{t(h.next(r))}catch(l){m(l)}},v=r=>{try{t(h.throw(r))}catch(l){m(l)}},t=r=>r.done?y(r.value):Promise.resolve(r.value).then(g,v);t((h=h.apply(N,w)).next())});import{r as c,j as e,u as H,v as V,f as I,w as k,b as q}from"./vendor-yOkX1T9n-v6.js";import{a as G,u as J,b2 as K,B as C,C as n,b as i,c as o,d as x,e as d,L as B,I as O,b3 as R}from"./index-DdeSxun1-v6.js";import"./ui-BA32w1ww-v6.js";import"./utils-Cj9wHvoQ-v6.js";import"./forms-BJ8Awwap-v6.js";import"./charts-core-ghokHKd6-v6.js";import"./pdf-export-JyY94Pcb-v6.js";function ae({onBack:N}){const{toast:w}=G(),{isMobile:h}=J(),[y,m]=c.useState(!0),[g,v]=c.useState(!1),[t,r]=c.useState([]),[l,b]=c.useState(""),[j,D]=c.useState(""),[Q,P]=c.useState([]);c.useEffect(()=>{const s=new Date,a=new Date(s);a.setDate(s.getDate()-30),D(s.toISOString().split("T")[0]),b(a.toISOString().split("T")[0])},[]);const T=(s,a)=>F(null,null,function*(){try{m(!0);const f=new URLSearchParams;s&&f.append("startDate",s),a&&f.append("endDate",a);const A=yield fetch(`/api/scores?${f.toString()}`);if(!A.ok)throw new Error("Failed to fetch scores");const E=yield A.json();r(E.scores||[]),P(E.scores||[])}catch(f){console.error("Error fetching scores:",f),w({title:"Error",description:"Failed to load building scores. Please try again.",variant:"destructive"})}finally{m(!1),v(!1)}});c.useEffect(()=>{l&&j&&T(l,j)},[l,j]);const M=()=>{v(!0),T(l,j)},U=()=>{const s=new Date,a=new Date(s);a.setDate(s.getDate()-30),D(s.toISOString().split("T")[0]),b(a.toISOString().split("T")[0])},L=t.filter(s=>s.score.level2Compliant).length,S=t.length,$=S>0?L/S*100:0,z=t.length>0?t.reduce((s,a)=>s+a.score.overallScore,0)/t.length:0,p=t.length>0?t.reduce((s,a)=>a.score.overallScore>s.score.overallScore?a:s):null,u=t.filter(s=>s.score.overallScore<3);return y&&!g?e.jsx(K,{message:"Loading building scores..."}):e.jsxs("div",{className:"container mx-auto p-6 max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Building Scores Dashboard"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track custodial performance across all campuses"})]}),N&&e.jsx(C,{variant:"outline",onClick:N,children:"← Back"})]}),e.jsxs(n,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(o,{className:"text-lg flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Filter by Date Range"]}),e.jsx(x,{children:"View scores for a specific time period"})]}),e.jsxs(C,{variant:"outline",size:"sm",onClick:M,disabled:g,children:[e.jsx(V,{className:`w-4 h-4 mr-2 ${g?"animate-spin":""}`}),"Refresh"]})]})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"startDate",children:"Start Date"}),e.jsx(O,{id:"startDate",type:"date",value:l,onChange:s=>b(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"endDate",children:"End Date"}),e.jsx(O,{id:"endDate",type:"date",value:j,onChange:s=>D(s.target.value)})]}),e.jsx("div",{className:"space-y-2 flex items-end",children:e.jsx(C,{variant:"secondary",onClick:U,className:"w-full",children:"Last 30 Days"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(n,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsx(x,{children:"Total Schools"}),e.jsx(o,{className:"text-3xl",children:S})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Monitored campuses"})]})})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsx(x,{children:"Level 2 Compliance"}),e.jsxs(o,{className:"text-3xl text-green-600",children:[$.toFixed(0),"%"]})]}),e.jsx(d,{children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:[L," of ",S," schools ≥3.0"]})})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsx(x,{children:"Network Average"}),e.jsx(o,{className:"text-3xl",children:z.toFixed(2)})]}),e.jsx(d,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Across all schools"})})]}),e.jsxs(n,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsx(x,{children:"Needs Attention"}),e.jsx(o,{className:"text-3xl text-yellow-600",children:u.length})]}),e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"Below Level 2"})]})})]})]}),p&&e.jsxs(n,{className:"bg-gradient-to-r from-green-50 to-blue-50 border-green-200",children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-green-600"}),e.jsx(o,{className:"text-lg",children:"Top Performer"})]})}),e.jsx(d,{children:e.jsx(R,{school:p.school,score:p.score,complianceStatus:p.complianceStatus,dateRange:p.dateRange,compact:h})})]}),u.length>0&&e.jsxs(n,{className:"bg-yellow-50 border-yellow-200",children:[e.jsxs(i,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5 text-yellow-600"}),e.jsx(o,{className:"text-lg",children:"Schools Needing Attention"})]}),e.jsxs(x,{children:[u.length," ",u.length===1?"school is":"schools are"," below Level 2 standards"]})]}),e.jsx(d,{children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:u.map(s=>e.jsx(R,{school:s.school,score:s.score,complianceStatus:s.complianceStatus,dateRange:s.dateRange,compact:!0},s.school))})})]}),e.jsxs(n,{children:[e.jsxs(i,{children:[e.jsx(o,{children:"All School Scores"}),e.jsxs(x,{children:["Showing ",t.length," schools sorted by overall score"]})]}),e.jsxs(d,{children:[e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:t.map(s=>e.jsx(R,{school:s.school,score:s.score,complianceStatus:s.complianceStatus,dateRange:s.dateRange,compact:!0},s.school))}),t.length===0&&e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(I,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No scores available for the selected date range."}),e.jsx("p",{className:"text-sm mt-2",children:"Try adjusting your date filters or refresh the page."})]})]})]})]})}export{ae as default};
