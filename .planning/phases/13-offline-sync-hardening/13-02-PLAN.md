---
phase: 13-offline-sync-hardening
plan: 02
type: execute
wave: 2
depends_on: [13-01]
files_modified:
  - src/components/ui/network-indicator.tsx
  - src/pages/Dashboard.tsx
  - src/pages/QuickCapture.tsx
  - src/hooks/useNetworkStatus.ts
autonomous: false
must_haves:
  truths:
    - User can immediately identify online/offline status from Dashboard
    - Network status indicator is visible during Quick Capture
    - Status transitions are smooth and noticeable
    - Indicator placement is optimal for mobile field use
  artifacts:
    - path: src/components/ui/network-indicator.tsx
      provides: Network status indicator component
      exports: ["NetworkIndicator"]
    - path: src/hooks/useNetworkStatus.ts
      provides: Network status hook
      exports: ["useNetworkStatus"]
    - path: src/pages/Dashboard.tsx
      provides: Dashboard with integrated network indicator
      contains: "NetworkIndicator"
    - path: src/pages/QuickCapture.tsx
      provides: Quick Capture with network status
      contains: "NetworkIndicator"
  key_links:
    - from: src/components/ui/network-indicator.tsx
      to: src/hooks/useNetworkStatus.ts
      via: hook consumption
      pattern: "useNetworkStatus"
    - from: src/pages/Dashboard.tsx
      to: src/components/ui/network-indicator.tsx
      via: component import
      pattern: "import.*NetworkIndicator"
user_setup:
  - service: PWA
    why: "Network indicator requires Service Worker for offline detection"
---

<objective>
Integrate online/offline status indicators into Dashboard and Quick Capture for immediate visibility of network connectivity.

Purpose: Custodial staff need to know their connectivity status while walking facilities. Clear indicators prevent confusion about whether captures are being synced or stored offline. This plan adds prominent, mobile-optimized network status to key screens.

Output: Network status indicators integrated into Dashboard and Quick Capture with smooth transitions.
</objective>

<execution_context>
@C:/Users/veloc/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/veloc/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-offline-sync-hardening/13-CONTEXT.md
@src/components/ui/offline-status.tsx
@src/pages/Dashboard.tsx
@src/pages/QuickCapture.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useNetworkStatus hook</name>
  <files>src/hooks/useNetworkStatus.ts</files>
  <action>Create useNetworkStatus custom hook:

1. Track navigator.onLine state
2. Add event listeners for online/offline events
3. Return state: { isOnline: boolean, wasOffline: boolean }
4. Add transition tracking (wasOffline indicates just came back online)
5. Clear wasOffline flag after 3 seconds (for transition animations)
6. Handle iOS Safari quirks (navigator.onLine can be unreliable)
7. Add polling fallback: check online status every 5 seconds
8. Return lastChecked timestamp

Hook signature:
```typescript
interface NetworkStatus {
  isOnline: boolean;
  wasOffline: boolean;  // true for 3s after coming back online
  lastChecked: Date;
}

export function useNetworkStatus(): NetworkStatus
```

Follow existing hook patterns in src/hooks/ directory.</action>
  <verify>npm run check passes, hook type-safe</verify>
  <done>Hook created with online/offline tracking, transition detection, iOS fallback</done>
</task>

<task type="auto">
  <name>Task 2: Create NetworkIndicator component</name>
  <files>src/components/ui/network-indicator.tsx</files>
  <action>Create NetworkIndicator React component:

1. Display states:
   - Online: Green dot with "Online" text, checkmark icon
   - Offline: Red dot with "Offline" text, wifi-off icon
   - Syncing: Amber dot with spinner, sync icon
   - Just reconnected: Green pulse animation, "Back Online" text

2. Size variants:
   - compact: Icon + colored dot only (for Quick Capture header)
   - full: Icon + text + status badge (for Dashboard)
   - minimal: Just colored dot (for nav bars)

3. Visual design:
   - Mobile-optimized: 44px touch target
   - High contrast for outdoor visibility
   - Amber/red/green color scheme per existing patterns
   - Smooth transition animations (300ms ease)

4. Accessibility:
   - aria-live="polite" for status changes
   - aria-label describing current status
   - role="status"

5. Props:
   ```typescript
   interface NetworkIndicatorProps {
     variant?: 'compact' | 'full' | 'minimal';
     showSyncStatus?: boolean;  // Show "Syncing..." when applicable
   }
   ```

6. Integration with existing offline-status.tsx patterns</action>
  <verify>npm run check passes, all variants render</verify>
  <done>Component created with 3 size variants, 4 display states, animations, accessibility</done>
</task>

<task type="auto">
  <name>Task 3: Integrate into Dashboard</name>
  <files>src/pages/Dashboard.tsx</files>
  <action>Add NetworkIndicator to Dashboard:

1. Place indicator in header area:
   - Top right of dashboard header
   - Next to user menu or standalone
   - Ensure visibility on both mobile and desktop

2. Implementation:
   - Import NetworkIndicator
   - Use 'compact' variant on mobile, 'full' on desktop
   - Show sync status (pending uploads count) when offline

3. Update Dashboard layout:
   - Add indicator to header row
   - Ensure proper spacing (gap-4)
   - Maintain existing card layout below

4. Reference existing Dashboard structure from Phase 12

Example placement:
```tsx
<header className="flex items-center justify-between mb-6">
  <h1>Dashboard</h1>
  <div className="flex items-center gap-4">
    <NetworkIndicator variant={isMobile ? 'compact' : 'full'} showSyncStatus />
    <UserMenu />
  </div>
</header>
```</action>
  <verify>npm run check passes, Dashboard renders</verify>
  <done>NetworkIndicator added to Dashboard header, responsive sizing</done>
</task>

<task type="auto">
  <name>Task 4: Integrate into Quick Capture</name>
  <files>src/pages/QuickCapture.tsx</files>
  <action>Add NetworkIndicator to Quick Capture:

1. Place indicator in header:
   - Top of Quick Capture page
   - Left side next to back button or title
   - Ensure 44px touch target

2. Show offline indicator prominently:
   - Full variant when offline
   - Show "Photos saved locally" subtitle when offline
   - Amber warning styling for visibility

3. Add offline banner when offline:
   - Below header, above camera
   - Full-width amber banner
   - "You're offline. Photos will sync when connection is restored."

4. Reference existing Quick Capture from Phase 12

Example:
```tsx
<div className="flex items-center justify-between p-4 border-b">
  <NetworkIndicator variant="full" showSyncStatus />
  <SaveButton />
</div>
{!isOnline && <OfflineBanner />}
```</action>
  <verify>npm run check passes, QuickCapture renders</verify>
  <done>NetworkIndicator added to Quick Capture with offline banner</done>
</task>

</tasks>

<checkpoint:human-verify gate="blocking">
  <what-built>Network status indicators integrated into Dashboard and Quick Capture with online/offline/syncing states</what-built>
  <how-to-verify>
    1. Open Dashboard and verify network indicator visible in header
    2. Open Quick Capture and verify indicator in header
    3. Turn off WiFi and verify:
       - Indicator changes to red/offline state
       - Offline banner appears in Quick Capture
       - Status text updates appropriately
    4. Turn WiFi back on and verify:
       - Indicator changes to green
       - Brief "Back Online" animation
       - Sync status shows if pending items
    5. Check mobile view: indicator is visible and touchable
    6. Check contrast: indicator visible in outdoor lighting
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</checkpoint:human-verify>

<verification>
- [ ] NetworkIndicator shows correct status (online/offline)
- [ ] Dashboard displays indicator in header
- [ ] Quick Capture displays indicator with offline banner
- [ ] Status transitions are smooth (animations)
- [ ] Mobile view: indicator visible and accessible
- [ ] Accessibility: screen reader announces changes
- [ ] npm run check passes
</verification>

<success_criteria>
1. User can immediately see network status from Dashboard
2. Quick Capture shows clear offline indication
3. Status transitions are smooth and noticeable
4. Indicator works on mobile devices
5. Visual contrast sufficient for field use
</success_criteria>

<output>
After completion, create `.planning/phases/13-offline-sync-hardening/13-02-SUMMARY.md`
</output>
