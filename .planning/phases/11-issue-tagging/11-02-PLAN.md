---
phase: 11-issue-tagging
plan: 02
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - src/components/TagSelector.tsx
  - src/components/TagBadge.tsx
  - src/pages/quick-capture.tsx
  - src/pages/photo-first-review.tsx
  - src/pages/inspection-data.tsx
autonomous: true

must_haves:
  truths:
    - "Inspector can select tags in Quick Capture workflow"
    - "Inspector can select tags in Photo-First Review completion form"
    - "Selected tags are submitted with API requests"
    - "Tags display as badges in inspection list"
    - "Manager can filter inspections by one or more tags"
    - "Tag filter persists in URL query parameters"
  artifacts:
    - path: "src/components/TagSelector.tsx"
      provides: "Multi-select tag picker component"
      exports: ["TagSelector", "TagSelectorProps"]
    - path: "src/components/TagBadge.tsx"
      provides: "Tag display badge component"
      exports: ["TagBadge", "TagBadgeList"]
    - path: "src/pages/quick-capture.tsx"
      provides: "Quick capture with tag selection"
      contains: ["<TagSelector", "tags:", "setTags"]
    - path: "src/pages/photo-first-review.tsx"
      provides: "Photo-first review with tag selection"
      contains: ["<TagSelector", "completeInspection.*tags"]
    - path: "src/pages/inspection-data.tsx"
      provides: "Inspection list with tag filtering"
      contains: ["tags filter", "<TagBadge"]
  key_links:
    - from: "src/components/TagSelector.tsx"
      to: "src/pages/quick-capture.tsx"
      via: "component import and usage"
    - from: "src/pages/quick-capture.tsx"
      to: "POST /api/inspections/quick-capture"
      via: "fetch with tags in request body"
    - from: "src/pages/photo-first-review.tsx"
      to: "PATCH /api/inspections/:id/complete"
      via: "completeInspection mutation with tags"
    - from: "src/pages/inspection-data.tsx"
      to: "GET /api/inspections?tags="
      via: "tag filter query parameter"
---

<objective>
Build UI components and integrate tagging into inspection workflows.

Purpose: Enable inspectors to tag issues during capture/completion and allow managers to filter by tags.
Output: TagSelector component, badge displays, and integration in Quick Capture, Photo-First Review, and Inspection Data pages.
</objective>

<execution_context>
@C:/Users/veloc/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/veloc/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@shared/tags.ts
@shared/schema.ts
@src/pages/quick-capture.tsx
@src/pages/photo-first-review.tsx
@src/pages/inspection-data.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TagSelector component</name>
  <files>src/components/TagSelector.tsx</files>
  <action>
    Create reusable TagSelector component in src/components/TagSelector.tsx:
    
    1. Import INSPECTION_TAGS from shared/tags
    2. Create TagSelectorProps interface:
       - selected: string[]
       - onChange: (tags: string[]) => void
       - maxSelection?: number (default: 3)
       - disabled?: boolean
    
    3. Component features:
       - Grid layout of tag buttons (2 columns on mobile, 4 on desktop)
       - Each tag shows icon + label + description
       - Toggle selection on click
       - Visual selected state (amber background for selected)
       - Show "X of Y selected" count
       - Disable when maxSelection reached (show tooltip)
    
    4. Styling:
       - Use existing Button component for consistency
       - min-h-[44px] for touch targets
       - Gap spacing between items
       - Border changes on selection
    
    5. Export TagSelector component
  </action>
  <verify>
    grep -q "export.*TagSelector" src/components/TagSelector.tsx &&
    grep -q "INSPECTION_TAGS" src/components/TagSelector.tsx &&
    grep -q "selected.*onChange" src/components/TagSelector.tsx
  </verify>
  <done>TagSelector component exports with proper props, renders all 8 tags, handles selection</done>
</task>

<task type="auto">
  <name>Task 2: Create TagBadge and TagBadgeList components</name>
  <files>src/components/TagBadge.tsx</files>
  <action>
    Create badge components in src/components/TagBadge.tsx:
    
    1. TagBadge component:
       - Props: tagId: string, size?: 'sm' | 'md' (default: 'md')
       - Renders colored badge with icon
       - Use INSPECTION_TAGS to get label/icon
       - Color coding by category:
         * floors, surfaces: blue
         * restrooms, trash: amber
         * safety: red
         * equipment, hvac, lighting: slate
    
    2. TagBadgeList component:
       - Props: tags: string[], maxVisible?: number
       - Renders horizontal flex wrap of TagBadge components
       - Show "+N more" if tags exceed maxVisible
       - Gap-1 spacing between badges
    
    3. Export both components
  </action>
  <verify>
    grep -q "export.*TagBadge" src/components/TagBadge.tsx &&
    grep -q "export.*TagBadgeList" src/components/TagBadgeList.tsx || grep -q "TagBadgeList" src/components/TagBadge.tsx &&
    grep -q "INSPECTION_TAGS" src/components/TagBadge.tsx
  </verify>
  <done>Both TagBadge and TagBadgeList components exported, render tags with colors and icons</done>
</task>

<task type="auto">
  <name>Task 3: Integrate TagSelector into Quick Capture</name>
  <files>src/pages/quick-capture.tsx</files>
  <action>
    Update Quick Capture page to support tags:
    
    1. Import TagSelector from @/components/TagSelector
    2. Add state: const [selectedTags, setSelectedTags] = useState<string[]>([])
    3. Add TagSelector section after QuickNoteInput, before save button:
       - Section header with "Issue Tags" label
       - TagSelector component with selected={selectedTags} onChange={setSelectedTags}
       - Helper text: "Select up to 3 tags to categorize this issue"
    4. Update handleSubmit to include tags in request body:
       - Add tags: selectedTags to requestBody
    5. Reset tags in resetForm: setSelectedTags([])
    
    Place tags section between QuickNoteInput and the save button div.
  </action>
  <verify>
    grep -q "import.*TagSelector" src/pages/quick-capture.tsx &&
    grep -q "selectedTags.*setSelectedTags" src/pages/quick-capture.tsx &&
    grep -q "<TagSelector" src/pages/quick-capture.tsx &&
    grep -q "tags: selectedTags" src/pages/quick-capture.tsx
  </verify>
  <done>Quick Capture has TagSelector integrated, submits tags with capture, clears on reset</done>
</task>

<task type="auto">
  <name>Task 4: Integrate TagSelector into Photo-First Review</name>
  <files>src/pages/photo-first-review.tsx</files>
  <action>
    Update Photo-First Review page to support tags:
    
    1. Import TagSelector from @/components/TagSelector
    2. Add state: const [selectedTags, setSelectedTags] = useState<string[]>([])
    3. Initialize tags from selectedInspection when loading:
       - In useEffect that sets selectedInspection, also setSelectedTags(inspection.tags || [])
    4. Add TagSelector to completion form UI (before submit button):
       - Section with "Issue Tags" header
       - TagSelector with selected={selectedTags} onChange={setSelectedTags}
    5. Update handleComplete to include tags:
       - Spread selectedTags into data passed to completeInspection
    6. Reset tags after completion: setSelectedTags([])
    
    Place tags section in the completion form area, grouped with other metadata.
  </action>
  <verify>
    grep -q "import.*TagSelector" src/pages/photo-first-review.tsx &&
    grep -q "selectedTags.*setSelectedTags" src/pages/photo-first-review.tsx &&
    grep -q "<TagSelector" src/pages/photo-first-review.tsx &&
    grep -q "completeInspection.*selectedTags\|...data, tags: selectedTags" src/pages/photo-first-review.tsx
  </verify>
  <done>Photo-First Review has TagSelector, initializes from existing tags, submits on complete</done>
</task>

<task type="auto">
  <name>Task 5: Add tag filtering to Inspection Data page</name>
  <files>src/pages/inspection-data.tsx</files>
  <action>
    Update Inspection Data page with tag filtering:
    
    1. Import TagBadgeList from @/components/TagBadge and INSPECTION_TAGS from @shared/tags
    2. Add state: const [selectedTagFilters, setSelectedTagFilters] = useState<string[]>([])
    3. Sync with URL params:
       - Read tags from URL on mount: url.searchParams.get('tags')?.split(',')
       - Update URL when filters change
    4. Add tag filter UI:
       - Filter section with "Filter by Tags" label
       - Horizontal scrollable list of all tags as toggle buttons
       - Show active state for selected filters
       - "Clear Filters" button when any selected
    5. Pass tags to API query:
       - Update fetch URL to include tags param when selected
    6. Show tags in inspection rows:
       - Add TagBadgeList in table/grid rows showing inspection.tags
    7. Update useInspections hook or inline fetch to accept tags filter
    
    Place filter UI alongside existing date/school filters.
  </action>
  <verify>
    grep -q "import.*TagBadgeList" src/pages/inspection-data.tsx &&
    grep -q "selectedTagFilters.*setSelectedTagFilters" src/pages/inspection-data.tsx &&
    grep -q "tags=.*selectedTagFilters\|tags.*filter" src/pages/inspection-data.tsx &&
    grep -q "<TagBadgeList" src/pages/inspection-data.tsx
  </verify>
  <done>Inspection Data page has tag filter UI, syncs to URL, fetches filtered results, shows tags on rows</done>
</task>

</tasks>

<verification>
1. TypeScript compilation: npm run check passes
2. TagSelector renders all 8 taxonomy tags
3. TagBadge shows correct colors/icons
4. Quick Capture submits tags with form data
5. Photo-First Review loads existing tags and submits updates
6. Inspection Data tag filter works and updates URL
7. Tag badges display in inspection list
</verification>

<success_criteria>
- TagSelector.tsx exports multi-select component
- TagBadge.tsx exports display components
- Quick Capture integrates TagSelector and submits tags
- Photo-First Review integrates TagSelector and handles existing tags
- Inspection Data has tag filtering UI and displays badges
- All 4 requirements (TAG-01 through TAG-04) satisfied
- npm run check passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-issue-tagging/11-02-SUMMARY.md`
</output>
