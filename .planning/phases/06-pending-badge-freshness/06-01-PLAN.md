---
phase: 06-pending-badge-freshness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/usePendingCount.ts
autonomous: true
must_haves:
  truths:
    - API response contract between frontend and backend is aligned
    - Pending count displays correctly with accurate total
  artifacts:
    - path: src/hooks/usePendingCount.ts
      provides: Fixed pending count hook using correct API response field
  key_links:
    - from: /api/inspections/pending endpoint
      to: usePendingCount hook
      via: Aligned pagination field name (totalRecords vs totalCount)
---

<objective>
Fix the API contract mismatch where frontend expects `pagination.totalCount` but backend returns `pagination.totalRecords`.
</objective>

<context>
**Current Issue:**
- Frontend (`usePendingCount.ts` line 30): `const total = data?.pagination?.totalCount ?? 0;`
- Backend (`server/storage.ts` lines 226, 389, etc.): returns `totalRecords: totalCount`

This causes the pending count to always show 0, even when there are pending inspections.
</context>

<implementation>
**Option A (Preferred):** Update frontend to use `totalRecords`
- Change line 30 in `usePendingCount.ts` to: `const total = data?.pagination?.totalRecords ?? 0;`

**Option B:** Update backend to return `totalCount`
- Would require changes in multiple places in storage.ts

**Decision:** Use Option A - it's a single line change and backend already consistently uses `totalRecords` across all endpoints.
</implementation>

<tasks>

<task name="Update usePendingCount to use totalRecords" type="auto">
<description>Change the pagination field from totalCount to totalRecords in usePendingCount hook</description>
<files>
- src/hooks/usePendingCount.ts
</files>
<action>
1. Read current usePendingCount.ts
2. Update line 30: change `data?.pagination?.totalCount` to `data?.pagination?.totalRecords`
3. Save file
</action>
<verify>
- Line 30 now reads: `const total = data?.pagination?.totalRecords ?? 0;`
- TypeScript compilation passes (`npm run check`)
</verify>
<done>Frontend now correctly reads totalRecords from API response</done>
</task>

<task name="Verify fix with test" type="auto">
<description>Run type check and verify the contract is aligned</description>
<action>
1. Run `npm run check` to verify TypeScript compiles
2. Verify the file change is correct
</action>
<verify>
- `npm run check` passes with no errors
- No TypeScript type errors related to pagination field
</verify>
<done>Contract fix verified and passing type checks</done>
</task>

</tasks>

<verification>
- usePendingCount.ts line 30 uses `totalRecords` instead of `totalCount`
- TypeScript compilation passes
- No other files need modification
</verification>

<success_criteria>
- [ ] usePendingCount.ts updated to use totalRecords
- [ ] TypeScript compilation passes
- [ ] Commit includes clear description of the contract fix
</success_criteria>
