---
phase: 06-pending-badge-freshness
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/quick-capture.tsx
  - src/hooks/usePendingInspections.ts
autonomous: true
must_haves:
  truths:
    - Quick capture success emits pending count refresh event
    - Dashboard badge updates immediately after capture
    - Event emission follows existing patterns in codebase
  artifacts:
    - path: src/pages/quick-capture.tsx
      provides: Quick capture page emitting refresh event on save
    - path: src/hooks/usePendingInspections.ts
      provides: Reference implementation of event emission
  key_links:
    - from: Quick capture save success
      to: PENDING_COUNT_UPDATED_EVENT
      via: window.dispatchEvent with custom event
---

<objective>
Emit `PENDING_COUNT_UPDATED_EVENT` when quick capture saves successfully, so dashboard badge refreshes immediately.
</objective>

<context>
**Current Issue:**
- Event `PENDING_COUNT_UPDATED_EVENT` is emitted in `usePendingInspections.ts` only on complete/discard
- Quick capture success does NOT emit this event
- Dashboard badge stays stale until next poll/focus

**Existing Pattern:**
- `usePendingInspections.ts` lines 157-159 show event emission pattern:
  ```typescript
  window.dispatchEvent(new CustomEvent(PENDING_COUNT_UPDATED_EVENT));
  ```

**Target:**
- Add event emission in `quick-capture.tsx` after successful save
</context>

<implementation>
**Location:** `src/pages/quick-capture.tsx`
**Trigger:** After successful POST to `/api/inspections/quick-capture`
**Action:** Dispatch `PENDING_COUNT_UPDATED_EVENT` custom event
</implementation>

<tasks>

<task name="Add event emission to quick capture success" type="auto">
<description>Emit PENDING_COUNT_UPDATED_EVENT after successful quick capture save</description>
<files>
- src/pages/quick-capture.tsx
- src/hooks/usePendingCount.ts (for event name reference)
</files>
<action>
1. Read quick-capture.tsx to find save success handler
2. Locate where POST /api/inspections/quick-capture succeeds
3. Add event dispatch after successful save:
   ```typescript
   import { PENDING_COUNT_UPDATED_EVENT } from '@/hooks/usePendingCount';
   window.dispatchEvent(new CustomEvent(PENDING_COUNT_UPDATED_EVENT));
   ```
4. Save file
</action>
<verify>
- Event is imported from usePendingCount
- Event dispatch occurs after successful API response
- TypeScript compilation passes (`npm run check`)
</verify>
<done>Quick capture now emits refresh event on successful save</done>
</task>

<task name="Verify event emission pattern" type="auto">
<description>Confirm the event emission matches existing patterns</description>
<action>
1. Check usePendingInspections.ts for event emission pattern
2. Verify quick-capture.tsx follows same pattern
3. Run type check to ensure no errors
</action>
<verify>
- Pattern matches usePendingInspections.ts implementation
- No lint or type errors
- Event name constant is used (not hardcoded string)
</verify>
<done>Event emission pattern verified and consistent</done>
</task>

</tasks>

<verification>
- quick-capture.tsx imports PENDING_COUNT_UPDATED_EVENT from usePendingCount
- Event is dispatched after successful quick capture save
- Pattern matches existing implementation in usePendingInspections.ts
</verification>

<success_criteria>
- [ ] Quick capture emits PENDING_COUNT_UPDATED_EVENT on save success
- [ ] Event follows existing codebase patterns
- [ ] TypeScript compilation passes
- [ ] Commit includes clear description of the freshness fix
</success_criteria>
