---
phase: 03-workflow-improvements
plan: 05
type: execute
wave: 3
depends_on:
  - 03-02
  - 03-03
files_modified:
  - src/pages/photo-first-review.tsx
  - src/components/review/PendingInspectionList.tsx
  - src/components/review/PhotoReviewPane.tsx
  - src/components/review/InspectionCompletionForm.tsx
  - src/hooks/usePendingInspections.ts
autonomous: true

must_haves:
  truths:
    - Desktop users can view list of pending review inspections
    - Pending inspection photos display prominently alongside form
    - Photos remain visible while scrolling through form fields
    - User can complete inspection with full ratings and detailed notes
    - Completion timestamp tracked separately from capture timestamp
    - User can discard pending inspection if no longer relevant
  artifacts:
    - path: src/pages/photo-first-review.tsx
      provides: Photo-first review page with split-pane layout
      min_lines: 200
    - path: src/components/review/PendingInspectionList.tsx
      provides: Filterable list of pending inspections with thumbnails
      exports: ["PendingInspectionList"]
    - path: src/components/review/PhotoReviewPane.tsx
      provides: Sticky photo panel with progressive loading
      exports: ["PhotoReviewPane"]
    - path: src/components/review/InspectionCompletionForm.tsx
      provides: Full inspection form with all rating fields
      exports: ["InspectionCompletionForm"]
  key_links:
    - from: PhotoReviewPane
      to: photo thumbnails
      via: thumbnailUrl field from API
      pattern: thumbnailUrl.*progressive.*loading
---

<objective>
Build Photo-First Review page for desktop completion of pending inspections.

Purpose: Enable office staff to complete full inspections using photos captured in the field, without revisiting physical locations.

Output: Complete photo-first review flow with split-pane layout, progressive photo loading, and full form completion.
</objective>

<execution_context>
@C:/Users/veloc/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/veloc/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-workflow-improvements/03-RESEARCH.md

## Key Research Findings
- Split-pane layout: photos sticky on left, form scrollable on right (400px sidebar)
- Progressive photo loading: blur placeholder -> thumbnail -> full image
- Photos should remain visible while scrolling through long forms
- Desktop-optimized (larger screens for detailed assessment)
- Use existing full inspection form patterns
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create usePendingInspections hook and PendingInspectionList</name>
  <files>src/hooks/usePendingInspections.ts, src/components/review/PendingInspectionList.tsx</files>
  <action>
    Create data fetching hook and list component:

    1. src/hooks/usePendingInspections.ts:
       - usePendingInspections(options): fetch pending inspections from API
       - useCompleteInspection(id, data): complete a pending inspection
       - useDiscardInspection(id): discard a pending inspection
       - Include loading, error, and refetch states
       - Use existing API hook patterns (useApiQuery, etc.)

    2. src/components/review/PendingInspectionList.tsx:
       - Display pending inspections in card or table format
       - Show: capture date, school, location, photo count, quick notes preview
       - Use thumbnails (200x200) from thumbnailUrl for fast loading
       - Filter by school (dropdown)
       - Sort by capture date (newest first)
       - Click to open inspection for review
       - Each item has "Review" and "Discard" actions
       - Empty state when no pending inspections

    Follow existing list component patterns in src/components/.
  </action>
  <verify>Hook fetches data; list displays pending inspections with thumbnails</verify>
  <done>Data layer and list component ready</done>
</task>

<task type="auto">
  <name>Task 2: Create PhotoReviewPane with progressive loading</name>
  <files>src/components/review/PhotoReviewPane.tsx</files>
  <action>
    Create src/components/review/PhotoReviewPane.tsx:

    1. Props interface:
       - photos: array of { thumbnailUrl, fullUrl, alt }
       - selectedIndex: number (optional, for highlighting)

    2. Progressive loading implementation:
       - Start with blur placeholder (CSS blur filter)
       - Load thumbnail first (200x200, already cached from list)
       - Load full image in background
       - Transition from blur -> thumbnail -> full with fade
       - Use onLoad event to trigger transitions

    3. Layout:
       - Vertical stack of photos
       - Sticky positioning (top: 0)
       - Max-height: 100vh with overflow-y: auto
       - Photo container: aspect-video or maintained ratio
       - Click to enlarge (optional modal or lightbox)

    4. Responsive:
       - Desktop: full sidebar width (400px)
       - Tablet: collapsible or smaller

    Pattern from research:
    const ProgressiveImage = ({ src, placeholderSrc, alt }) => {
      const [imageSrc, setImageSrc] = useState(placeholderSrc);
      useEffect(() => {
        const img = new Image();
        img.src = src;
        img.onload = () => setImageSrc(src);
      }, [src]);
      return <img src={imageSrc} alt={alt} style={{ filter: imageSrc === placeholderSrc ? 'blur(10px)' : 'none', transition: 'filter 0.3s ease' }} />;
    };
  </action>
  <verify>Photos load progressively; sticky positioning works while scrolling</verify>
  <done>Photo review pane with progressive loading ready</done>
</task>

<task type="auto">
  <name>Task 3: Create InspectionCompletionForm and photo-first review page</name>
  <files>src/components/review/InspectionCompletionForm.tsx, src/pages/photo-first-review.tsx</files>
  <action>
    Create form component and main review page:

    1. InspectionCompletionForm.tsx:
       - Accepts pendingInspection and onComplete callback
       - Form fields for all inspection ratings (1-5 scale):
         - floors, verticalHorizontalSurfaces, ceiling, restrooms
         - customerSatisfaction, trash, projectCleaning
         - activitySupport, safetyCompliance, equipment, monitoring
       - Detailed notes textarea (full notes, not quick notes)
       - Pre-populate any existing data from pending inspection
       - Validation: all ratings required, notes optional
       - Submit button: "Complete Inspection"
       - Use existing form patterns and UI components

    2. photo-first-review.tsx page:
       - Route: /review or /inspections/review
       - Split-pane layout (CSS Grid):
         - Left pane: PhotoReviewPane (400px, sticky)
         - Right pane: InspectionCompletionForm (scrollable)
       - URL param or state for selected inspection
       - Loading state while fetching inspection details
       - Error state if inspection not found or already completed
       - On complete: call PATCH /api/inspections/:id/complete
       - On discard: call PATCH /api/inspections/:id/discard
       - Success: show confirmation, return to pending list

    3. Navigation:
       - Add link in main navigation for "Review Inspections"
       - Desktop-only (hide or redirect on mobile)

    Use existing form validation patterns and UI components.
  </action>
  <verify>Page loads; split-pane layout works; form submits and completes inspection</verify>
  <done>Photo-first review page complete with form submission</done>
</task>

</tasks>

<verification>
- [ ] usePendingInspections hook fetches and manages pending data
- [ ] PendingInspectionList displays with thumbnails and filters
- [ ] PhotoReviewPane shows photos with progressive loading
- [ ] Photos remain visible (sticky) while scrolling form
- [ ] InspectionCompletionForm has all rating fields
- [ ] Form validates and submits correctly
- [ ] Completion updates inspection status and timestamp
- [ ] Discard functionality works
- [ ] Desktop-optimized layout (split-pane)
</verification>

<success_criteria>
- Desktop users can view all pending review inspections
- Pending list loads in under 2 seconds with thumbnails
- Photos display prominently in sticky sidebar
- Progressive loading: blur -> thumbnail -> full image
- Photos visible while scrolling through form
- All inspection rating fields available for completion
- Completion tracks separate capture and completion timestamps
- Discard removes inspection from pending list
- Form validation prevents incomplete submissions
- Works on desktop screens (1024px+)
</success_criteria>

<output>
After completion, create `.planning/phases/03-workflow-improvements/03-05-SUMMARY.md`
</output>
