---
phase: 03-workflow-improvements
plan: 04
type: execute
wave: 3
depends_on:
  - 03-02
files_modified:
  - src/pages/quick-capture.tsx
  - src/components/capture/CameraCapture.tsx
  - src/components/capture/PhotoPreviewStrip.tsx
  - src/components/capture/QuickNoteInput.tsx
  - src/hooks/useCamera.ts
autonomous: true

must_haves:
  truths:
    - Mobile dashboard has entry point to quick capture mode
    - Camera stays active between photo captures (no re-initialization delay)
    - User can capture multiple photos in succession with one tap per photo
    - Optional quick notes field accepts max 200 characters
    - One-tap save submits quick capture with pending_review status
    - Large touch targets (44px minimum) for field use with gloves
  artifacts:
    - path: src/pages/quick-capture.tsx
      provides: Quick capture page with location selection, camera, notes, save
      min_lines: 150
    - path: src/components/capture/CameraCapture.tsx
      provides: Continuous camera component using react-webcam ref pattern
      exports: ["CameraCapture"]
    - path: src/components/capture/PhotoPreviewStrip.tsx
      provides: Horizontal scrolling thumbnail strip of captured photos
      exports: ["PhotoPreviewStrip"]
    - path: src/components/capture/QuickNoteInput.tsx
      provides: 200-char limited text input with character counter
      exports: ["QuickNoteInput"]
  key_links:
    - from: CameraCapture component
      to: react-webcam ref
      via: getScreenshot() method
      pattern: webcamRef\.current\?\.getScreenshot
---

<objective>
Build Quick Capture page for rapid mobile photo documentation.

Purpose: Enable field inspectors to capture multiple photos quickly with minimal UI friction, deferring full inspection form completion until desktop review.

Output: Complete quick capture flow with continuous camera, location selection, optional notes, and one-tap save.
</objective>

<execution_context>
@C:/Users/veloc/.config/opencode/get-shit-done/workflows/execute-plan.md
@C:/Users/veloc/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-workflow-improvements/03-RESEARCH.md

## Key Research Findings
- Use react-webcam ref pattern to keep camera active between shots (PERF-02)
- Camera initialization takes 1-2s; avoiding re-init is critical for rapid capture
- WCAG 2.5.5 requires 44px touch targets (Tailwind min-h-11 min-w-11)
- Portrait orientation only (no forced landscape)
- Quick notes: single field, 200 chars max, optional
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCamera hook with continuous capture support</name>
  <files>src/hooks/useCamera.ts</files>
  <action>
    Create src/hooks/useCamera.ts hook that wraps react-webcam for continuous capture:

    1. Hook interface:
       - webcamRef: ref to pass to Webcam component
       - capturedImages: array of base64 image strings
       - capture: function to take a screenshot
       - clearImages: function to reset captured images
       - hasPermission: boolean | null (camera permission state)
       - isReady: boolean (camera stream active)

    2. Implementation details:
       - Use useRef for webcamRef
       - Use getScreenshot({ width: 1920, height: 1080 }) for high quality
       - Check camera permission on mount with navigator.mediaDevices.getUserMedia
       - Clean up blob URLs on unmount to prevent memory leaks
       - Return screenshot as base64 data URL

    3. Key pattern (from research):
       const capture = useCallback(() => {
         const imageSrc = webcamRef.current?.getScreenshot({ width: 1920, height: 1080 });
         if (imageSrc) {
           setCapturedImages(prev => [...prev, imageSrc]);
         }
       }, []);

    Follow existing hook patterns in src/hooks/ for consistency.
  </action>
  <verify>Hook compiles; test in component shows camera stream and captures images</verify>
  <done>useCamera hook provides continuous capture with permission handling and cleanup</done>
</task>

<task type="auto">
  <name>Task 2: Create CameraCapture and PhotoPreviewStrip components</name>
  <files>src/components/capture/CameraCapture.tsx, src/components/capture/PhotoPreviewStrip.tsx</files>
  <action>
    Create two components in src/components/capture/:

    1. CameraCapture.tsx:
       - Accepts onCapture callback and optional initial photos
       - Uses useCamera hook for camera management
       - Renders Webcam component with environment facingMode
       - Large capture button (64px circle, min 44px touch target)
       - Shows camera loading state while initializing
       - Shows permission denied message with help instructions
       - Uses Tailwind for styling (responsive, portrait-optimized)

    2. PhotoPreviewStrip.tsx:
       - Accepts photos array and onRemove callback
       - Horizontal scrolling container with thumbnails
       - Each photo shows small X button to remove (44px touch target)
       - Shows photo count indicator
       - Empty state when no photos captured
       - Uses flex overflow-x-auto for horizontal scroll

    Both components:
    - Use TypeScript interfaces for props
    - Handle errors gracefully
    - Follow existing component patterns in src/components/
    - Use Lucide icons (Camera, X, Image)
  </action>
  <verify>Components render correctly; CameraCapture captures photos; PhotoPreviewStrip displays and allows removal</verify>
  <done>Camera and preview components ready for integration</done>
</task>

<task type="auto">
  <name>Task 3: Create Quick Capture page with save functionality</name>
  <files>src/pages/quick-capture.tsx, src/components/capture/QuickNoteInput.tsx</files>
  <action>
    Create src/pages/quick-capture.tsx page with complete flow:

    1. QuickNoteInput.tsx component:
       - Textarea with 200 char max
       - Character counter showing "X/200"
       - Placeholder: "Optional quick notes..."
       - Auto-resize or fixed 3 rows

    2. QuickCapture page structure:
       - Header with title and close button
       - Location selector (dropdown or quick-select buttons)
         - Use existing school/location data
         - Large touch targets (min-h-11)
       - CameraCapture component for photo capture
       - PhotoPreviewStrip showing captured photos
       - QuickNoteInput for optional notes
       - Save button (large, prominent, min-h-14)

    3. Save functionality:
       - Validate at least one photo captured
       - Validate location selected
       - Call POST /api/inspections/quick-capture with:
         - school, captureLocation, inspectorName
         - quickNotes (optional)
         - images array (photo URLs/base64)
       - Show loading state during save
       - On success: show confirmation, clear form, return to dashboard
       - On error: show error message

    4. Add route in src/App.tsx or routing config

    Use existing form patterns and API hooks (useApiMutation, etc.).
  </action>
  <verify>Page loads; can select location, capture photos, add notes, and save; API call succeeds</verify>
  <done>Quick capture page complete with full workflow from entry to save</done>
</task>

</tasks>

<verification>
- [ ] useCamera hook manages camera stream and captures
- [ ] CameraCapture component shows live preview and capture button
- [ ] PhotoPreviewStrip displays captured photos with remove option
- [ ] QuickNoteInput enforces 200 char limit with counter
- [ ] Quick capture page integrates all components
- [ ] Save submits to API with correct data structure
- [ ] All touch targets minimum 44px (Tailwind min-h-11/min-w-11)
- [ ] Portrait orientation works correctly
- [ ] Camera stays active between captures (no re-init delay)
</verification>

<success_criteria>
- User can access quick capture from mobile dashboard
- Location selection requires minimal taps (dropdown or quick-select)
- Camera captures photos without re-initialization between shots
- Multiple photos can be captured in succession
- Optional quick notes field accepts up to 200 characters
- One-tap save creates inspection with pending_review status
- All interactive elements have 44px minimum touch targets
- Page works in portrait orientation
- Save shows confirmation and returns to dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/03-workflow-improvements/03-04-SUMMARY.md`
</output>
