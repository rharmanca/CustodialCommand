# Phase 08 Plan 02: Runbook Update with Validation

**Phase:** 08-monitoring-debt-cleanup  
**Plan:** 02  
**Status:** Planned  
**Goal:** Update monitoring runbook with concrete thresholds and validation steps

---

## Requirements Addressed

- **R2:** Runbook Update - Add concrete thresholds and validation steps

---

## Background

The existing monitoring runbook (`docs/monitoring/monitoring-runbook.md`) documents actions for incidents but lacks concrete validation steps. This plan updates the runbook with:
1. Validated thresholds (tested and confirmed)
2. Step-by-step validation procedures
3. Verification checklists
4. Concrete remediation validation

---

## Tasks

### Task 1: Review Current Runbook
**Purpose:** Understand existing runbook structure and content

**Steps:**
1. Read `docs/monitoring/monitoring-runbook.md`
2. Identify sections to enhance:
   - High Memory Usage section
   - Alert thresholds section
   - Validation procedures (currently missing)
3. Note existing procedures that need validation steps
4. Document gaps

**Expected Output:**
- Current runbook content reviewed
- Gaps identified
- Enhancement areas noted

**Success Criteria:**
- [ ] Runbook read and understood
- [ ] Gaps documented
- [ ] Enhancement areas identified

---

### Task 2: Validate Current Thresholds
**Purpose:** Confirm thresholds are appropriate and actionable

**Steps:**
1. Review current thresholds from Phase 02:
   - Memory: < 70% good, 70-85% warning, > 85% critical
   - Response Time: < 1s good, 1-3s warning, > 3s critical
   - Error Rate: < 1% good, 1-5% warning, > 5% critical
2. Check current application values against thresholds
3. Validate threshold reasonableness:
   - Are they achievable?
   - Are they actionable?
   - Do they provide early warning?
4. Adjust if needed based on current baseline

**Expected Output:**
- Thresholds validated against current data
- Any adjustments documented
- Rationale for thresholds recorded

**Success Criteria:**
- [ ] All thresholds reviewed
- [ ] Current values compared
- [ ] Adjustments documented (if any)

---

### Task 3: Create Validation Procedures
**Purpose:** Define step-by-step validation for each alert type

**Steps:**
For each alert type, create validation procedure:

**High Memory Alert Validation:**
1. Check `/health` endpoint for current memory %
2. Verify Railway dashboard metrics
3. Compare with historical baseline
4. Determine if transient or sustained
5. Validation checklist with checkboxes

**Slow Response Validation:**
1. Test endpoint response time (curl or browser)
2. Check `/metrics` for average response time
3. Identify slow endpoints from metrics
4. Validation checklist with checkboxes

**Error Rate Validation:**
1. Check `/metrics` for error counts
2. Review Railway logs for error patterns
3. Identify error types and frequency
4. Validation checklist with checkboxes

**Database Connection Validation:**
1. Check `/health` for database status
2. Review connection pool metrics
3. Test query response time
4. Validation checklist with checkboxes

**Expected Output:**
- Validation procedures documented
- Checklists created for each alert type
- Step-by-step instructions written

**Success Criteria:**
- [ ] Memory alert validation procedure created
- [ ] Response time validation procedure created
- [ ] Error rate validation procedure created
- [ ] Database validation procedure created

---

### Task 4: Document Remediation Validation
**Purpose:** Define how to confirm fixes worked

**Steps:**
For each remediation action, define validation:

**After Memory Mitigation:**
1. Wait 5 minutes after restart/mitigation
2. Check `/health` endpoint
3. Verify memory % below warning threshold
4. Monitor for 15 minutes to confirm stable
5. Check Railway metrics trend

**After Performance Fix:**
1. Re-test slow endpoints
2. Check `/metrics` for improved response times
3. Monitor for 10 minutes
4. Verify average response time improved

**After Error Fix:**
1. Check `/metrics` for reduced error rate
2. Review logs for error reduction
3. Monitor for 15 minutes
4. Verify error rate below threshold

**Expected Output:**
- Remediation validation steps documented
- Timeframes defined
- Success criteria specified

**Success Criteria:**
- [ ] Memory remediation validation documented
- [ ] Performance remediation validation documented
- [ ] Error remediation validation documented

---

### Task 5: Update Monitoring Runbook
**Purpose:** Apply all enhancements to runbook

**Steps:**
1. Update Alert Thresholds section:
   - Add validated thresholds with rationale
   - Include current baseline values
   - Note when thresholds were validated

2. Enhance High Memory Usage section:
   - Add validation procedure
   - Add step-by-step investigation
   - Add concrete restart procedure
   - Add post-restart validation

3. Enhance Slow Performance section:
   - Add validation procedure
   - Add endpoint-specific checks
   - Add post-fix validation

4. Enhance Error Spikes section:
   - Add validation procedure
   - Add log analysis steps
   - Add post-fix validation

5. Add new section: Validation Procedures:
   - Link to each alert type validation
   - Include quick reference checklist

6. Add new section: Threshold Reference:
   - Table with all thresholds
   - Current baseline values
   - Adjustment history

**Output File:** `docs/monitoring/monitoring-runbook.md` (updated)

**Success Criteria:**
- [ ] Thresholds section updated
- [ ] Memory section enhanced
- [ ] Performance section enhanced
- [ ] Errors section enhanced
- [ ] Validation Procedures section added
- [ ] Threshold Reference section added

---

### Task 6: Test Validation Procedures
**Purpose:** Verify procedures work in practice

**Steps:**
1. Follow High Memory validation procedure
   - Check `/health` endpoint
   - Verify Railway dashboard
   - Complete checklist
2. Document any procedure gaps
3. Adjust procedures based on testing
4. Verify all checkboxes can be completed

**Expected Output:**
- Procedures tested
- Gaps identified and fixed
- Final validated procedures

**Success Criteria:**
- [ ] Memory validation tested
- [ ] Procedure gaps fixed
- [ ] Procedures finalized

---

### Task 7: Create Quick Reference Card
**Purpose:** One-page summary for incident response

**Steps:**
1. Create `docs/monitoring/QUICK-REFERENCE.md`
2. Include:
   - Thresholds at a glance
   - Validation steps summary
   - Key endpoint URLs
   - Log search patterns
   - Escalation contacts (placeholder)
3. Format for quick scanning
4. Include checkboxes for procedures

**Output File:** `docs/monitoring/QUICK-REFERENCE.md`

**Success Criteria:**
- [ ] Quick reference created
- [ ] Thresholds included
- [ ] Validation steps summarized
- [ ] Endpoints documented

---

## Verification

| Task | Verification Method | Expected Result |
|------|---------------------|-----------------|
| Task 1 | Gap analysis document | Gaps identified |
| Task 2 | Threshold validation table | Thresholds confirmed |
| Task 3 | Validation procedure docs | Procedures created |
| Task 4 | Remediation validation docs | Post-fix steps defined |
| Task 5 | Updated runbook exists | All sections enhanced |
| Task 6 | Test notes | Procedures verified |
| Task 7 | QUICK-REFERENCE.md | Quick reference created |

---

## Success Criteria (Plan Level)

- [ ] All current thresholds validated
- [ ] Validation procedures documented for each alert type
- [ ] Remediation validation steps defined
- [ ] Runbook updated with concrete, actionable steps
- [ ] Quick reference created for incident response
- [ ] All checkboxes in procedures tested and working

---

## Related Files

- `docs/monitoring/monitoring-runbook.md` - Primary file to update
- `docs/monitoring/performance-monitoring-guide.md` - Reference
- `docs/monitoring/current-monitoring-inventory.md` - Reference

---

## Estimated Effort

- **Duration:** 45-60 minutes
- **Complexity:** Low-Medium
- **Blocking:** None (can parallel with 08-01)

---

## Wave Structure

| Wave | Plans | Dependencies |
|------|-------|--------------|
| 1 | 08-01, 08-02 | None - can parallel |

---

## Notes

- Focus on concrete, actionable steps
- Use checkboxes for verification
- Include actual values from current system
- Document rationale for thresholds
- Test procedures before finalizing

---

**Created:** 2026-02-19  
**Source:** Phase 02 Monitoring Debt  
**Previous Plan:** 08-01-PLAN.md (Memory Investigation)
