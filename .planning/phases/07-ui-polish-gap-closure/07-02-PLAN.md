---
phase: 07-ui-polish-gap-closure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/review/InspectionCompletionForm.tsx
autonomous: true
must_haves:
  truths:
    - 11 rating fields organized into 4 collapsible accordion sections
    - Each section shows progress (e.g., "3/4 rated")
    - Sections are Physical, Service, Compliance, Satisfaction
    - Accordion uses Radix UI pattern matching project conventions
  artifacts:
    - path: src/components/review/InspectionCompletionForm.tsx
      provides: Grouped accordion sections with per-section progress tracking
  key_links:
    - from: Form values state
      to: Section progress calculation
      via: Derived state from form ratings
---

<objective>
Refactor InspectionCompletionForm from flat 11-field list to 4 grouped accordion sections with per-section progress tracking.
</objective>

<context>
**Gap from Phase 04 Verification:**
- File: `src/components/review/InspectionCompletionForm.tsx:240`
- Current: Flat list of 11 rating fields
- Issue: No accordion/group section structure or per-section progress counters
- Requirement: REV-04 (Photos remain visible while scrolling), REV-05 (Complete with ratings)

**Rating Fields to Group:**
From `shared/schema.ts` inspectionSchema (11 actual fields):
- **Physical Environment** (3): floors, verticalHorizontalSurfaces, ceiling
- **Service Areas** (1): restrooms
- **Maintenance & Operations** (4): trash, projectCleaning, activitySupport, equipment
- **Compliance & Satisfaction** (3): safetyCompliance, monitoring, customerSatisfaction
</context>

<implementation>
**Section Structure:**
```typescript
const RATING_GROUPS = [
  { id: 'physical', label: 'Physical Environment', icon: Building2, 
    fields: ['floors', 'verticalHorizontalSurfaces', 'ceiling'] },
  { id: 'service', label: 'Service Areas', icon: Coffee,
    fields: ['restrooms'] },
  { id: 'maintenance', label: 'Maintenance & Operations', icon: Wrench,
    fields: ['trash', 'projectCleaning', 'activitySupport', 'equipment'] },
  { id: 'compliance', label: 'Compliance & Satisfaction', icon: Shield,
    fields: ['safetyCompliance', 'monitoring', 'customerSatisfaction'] }
];
```

**Progress Calculation:**
```typescript
const getProgress = (section: RatingGroup) => {
  const rated = section.fields.filter(f => ratings[f] !== undefined).length;
  return { rated, total: section.fields.length };
};
```

**UI Pattern:**
- Use Radix UI Accordion (already in project)
- Show progress as "X/Y rated" in section header
- Collapsible sections, all start expanded
- Maintain existing form submission logic
</implementation>

<tasks>

<task name="Create rating groups configuration" type="auto">
<description>Define the 4 rating groups with their fields</description>
<files>
- src/components/review/InspectionCompletionForm.tsx
</files>
<action>
1. Read InspectionCompletionForm.tsx
2. Add RATING_GROUPS constant at top of component
3. Define each group with id, label, icon, and fields
4. Import required icons from lucide-react
</action>
<verify>
- RATING_GROUPS defined with all 11 fields distributed
- All 4 groups have unique IDs and labels
- Icons imported and available
</verify>
<done>Rating groups configuration created</done>
</task>

<task name="Add accordion wrapper with progress tracking" type="auto">
<description>Wrap rating fields in Radix Accordion with progress</description>
<action>
1. Import Accordion components from @radix-ui/react-accordion
2. Create progress calculation helper function
3. Wrap existing rating fields in Accordion structure
4. Add section headers with progress display
5. Maintain form state management
</action>
<verify>
- Accordion imports present
- Progress displays correctly per section
- Form submission still works
- Existing validation preserved
</verify>
<done>Accordion structure with progress tracking added</done>
</task>

<task name="Style accordion to match project theme" type="auto">
<description>Apply Tailwind classes matching project UI patterns</description>
<action>
1. Review existing accordion usage in project (if any)
2. Apply consistent styling:
   - Section headers: card-like appearance
   - Progress: badge or text indicator
   - Borders: subtle separator between sections
   - Animations: smooth expand/collapse
3. Ensure theme colors match (primary, muted, etc.)
</action>
<verify>
- Visual style matches project patterns
- Accordion expands/collapses smoothly
- Progress indicators are clear and readable
- Mobile responsive
</verify>
<done>Accordion styled to match project theme</done>
</task>

</tasks>

<verification>
- 11 rating fields organized into 4 sections
- Each section shows X/Y rated progress
- Accordion uses Radix UI pattern
- Form submission works correctly
- All existing validation preserved
</verification>

<success_criteria>
- [ ] Rating fields grouped into 4 accordion sections
- [ ] Per-section progress tracking implemented
- [ ] Radix UI Accordion pattern used
- [ ] Form submission and validation preserved
- [ ] Visual style matches project theme
- [ ] TypeScript compilation passes
</success_criteria>
