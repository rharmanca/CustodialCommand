---
phase: 04-ui-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/review/InspectionCompletionForm.tsx
  - src/components/ui/accordion.tsx
autonomous: false
must_haves:
  truths:
    - Rating form shows 4 collapsible sections
    - Each section shows progress (e.g., "3/4 rated")
    - Sections expanded by default
    - Form remains functional and submittable
  artifacts:
    - path: src/components/review/InspectionCompletionForm.tsx
      provides: Grouped rating form with accordion sections
    - path: src/components/ui/accordion.tsx
      provides: Accordion UI component (or use existing)
  key_links:
    - from: Accordion sections
      to: form state management
      via: React state for expand/collapse
---

<objective>
Group the 11 rating categories into 4 collapsible sections to reduce cognitive load.

Purpose: 11 ratings at once is overwhelming; grouping helps reviewers focus.
Output: Accordion-based rating form with Physical, Service, Compliance, Satisfaction sections.
</objective>

<execution_context>
@C:/Users/veloc/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/04-ui-polish/04-CONTEXT.md
@src/components/review/InspectionCompletionForm.tsx
</context>

<tasks>

<task type="checkpoint:decision" gate="blocking">
  <name>Checkpoint: Capability inventory and orchestration</name>
  <files>.planning/phases/04-ui-polish/04-02-PLAN.md</files>
  <decision>Confirm tool, agent, and skill inventory for grouped rating form work</decision>
  <context>
    Inventory useful tools, agents, and skills and orchestrate them before implementation. Recommended baseline for this plan:
    - frontend-design (section hierarchy and readability)
    - react-best-practices (state derivation for X/Y progress)
    - webapp-testing (form interaction and regression verification)
    - tools: read/edit/apply_patch and bash verification commands
    - agents: gsd-plan-checker for plan conformance; explore/general for code ownership discovery if needed
  </context>
  <options>
    <option id="option-a">
      <name>Use recommended baseline skills</name>
      <pros>Fastest path with targeted quality safeguards.</pros>
      <cons>May omit niche form-pattern skills.</cons>
    </option>
    <option id="option-b">
      <name>Expand skill inventory first</name>
      <pros>Broader coverage of UX edge cases.</pros>
      <cons>Additional upfront planning time.</cons>
    </option>
  </options>
  <action>Record chosen tools, agents, and skills and orchestrate them before modifying rating form sections and progress logic.</action>
  <verify>Chosen option is recorded and relevant tool/agent/skill choices are documented before code changes begin.</verify>
  <done>Capability orchestration checkpoint completed and implementation can proceed.</done>
  <resume-signal>Select: option-a or option-b to continue execution.</resume-signal>
</task>

<task type="auto">
  <name>Group ratings into sections</name>
  <files>src/components/review/InspectionCompletionForm.tsx</files>
  <action>
    Reorganize the 11 rating inputs into 4 accordion sections:
    
    Section 1: Physical (4 items)
    - Floors
    - Vertical/Horizontal Surfaces
    - Ceiling
    - Restrooms
    
    Section 2: Service (3 items)
    - Trash
    - Project Cleaning
    - Activity Support
    
    Section 3: Compliance (3 items)
    - Safety Compliance
    - Equipment
    - Monitoring
    
    Section 4: Satisfaction (1 item)
    - Customer Satisfaction
    
    Use existing Accordion component from shadcn/ui if available, or create simple collapsible sections.
    Each section header should show: "Section Name (X/Y rated)"
    Keep all sections expanded by default.
    Maintain existing form validation and submission logic.
  </action>
  <verify>
    Run `npm run check` and confirm exit code 0.
    Run `npm run build` and confirm build succeeds.
    Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm JSON contains `reviewOpened: true`.
  </verify>
  <done>
    4 accordion sections render with correct grouping
    Progress shows "X/Y rated" for each section
    Form submits all 11 ratings successfully
  </done>
</task>

<task type="auto">
  <name>Add progress tracking per section</name>
  <files>src/components/review/InspectionCompletionForm.tsx</files>
  <action>
    Calculate and display progress for each section:
    1. Track which ratings have values (not null/undefined)
    2. Count rated items per section
    3. Show "X/Y rated" in section header
    4. Update counts reactively as user rates items
    5. Consider adding visual indicator (checkmark or progress bar) when section complete
    
    Do not change the rating scale (1-3 stars) or the existing rating component.
  </action>
  <verify>
    Run `npm run check` and confirm exit code 0.
    Run `node tests/visual-analysis.cjs` and confirm `tests/screenshots/visual-analysis/04-photo-first-review-desktop.png` is generated.
    Confirm section headers display `X/Y rated` and update after rating input changes.
  </verify>
  <done>
    Section headers show real-time progress
    All sections update independently
  </done>
</task>

</tasks>

<verification>
- Run `npm run check` and `npm run build` successfully.
- Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm `completionSubmitted: true`.
- Run `node tests/visual-analysis.cjs` and verify grouped sections render correctly in review screenshots.
</verification>

<success_criteria>
- 4 sections visible with correct grouping
- Each section shows accurate progress count
- Form submits successfully with all ratings
- Sections can be collapsed/expanded
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-polish/04-02-SUMMARY.md`
</output>
