---
phase: 04-ui-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: 
  - src/pages/photo-first-review.tsx
  - src/components/review/PhotoReviewPane.tsx
autonomous: false
must_haves:
  truths:
    - Photo sidebar stays visible while scrolling through rating form
    - Photos remain in viewport on desktop review page
    - Clicking a review photo opens a zoomed view/modal
    - Multiple review photos render as a selectable thumbnail grid
    - No visual glitches or jumping during scroll
  artifacts:
    - path: src/pages/photo-first-review.tsx
      provides: Sticky photo sidebar layout
    - path: src/components/review/PhotoReviewPane.tsx
      provides: Photo display with sticky behavior, zoom, and multi-photo thumbnail grid
  key_links:
    - from: PhotoReviewPane component
      to: photo-first-review page layout
      via: CSS position: sticky
    - from: PhotoReviewPane thumbnail click
      to: zoom modal state
      via: React click handler and selected photo state
---

<objective>
Make the photo sidebar sticky in Photo-First Review so it stays visible while users scroll through the rating form.

Purpose: Users need to reference photos while rating; scrolling back up breaks their flow.
Output: Updated PhotoReviewPane and photo-first-review page with sticky positioning, photo zoom, and multi-photo thumbnail grid.
</objective>

<execution_context>
@C:/Users/veloc/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/04-ui-polish/04-CONTEXT.md
@src/pages/photo-first-review.tsx
@src/components/review/PhotoReviewPane.tsx
</context>

<tasks>

<task type="checkpoint:decision" gate="blocking">
  <name>Checkpoint: Capability inventory and orchestration</name>
  <files>.planning/phases/04-ui-polish/04-01-PLAN.md</files>
  <decision>Confirm tool, agent, and skill inventory for this plan before coding</decision>
  <context>
    Inventory useful tools, agents, and skills and orchestrate them before implementation. Recommended baseline for this plan:
    - frontend-design (layout refinement without theme change)
    - webapp-testing (visual + flow verification)
    - web-design-guidelines (UX/accessibility guardrails)
    - tools: read/edit/apply_patch and bash verification commands
    - agents: gsd-plan-checker for post-update validation; explore/general if file ownership is unclear
  </context>
  <options>
    <option id="option-a">
      <name>Use recommended baseline skills</name>
      <pros>Fastest start with focused, relevant guidance.</pros>
      <cons>May skip niche optimization skills.</cons>
    </option>
    <option id="option-b">
      <name>Expand skill inventory first</name>
      <pros>Higher coverage for edge cases.</pros>
      <cons>Adds upfront planning overhead.</cons>
    </option>
  </options>
  <action>Document selected tools, agents, and skills in execution notes and orchestrate them before starting implementation tasks in this plan.</action>
  <verify>Selected option is recorded and at least one relevant tool path, one agent strategy, and one skill are explicitly chosen before code changes begin.</verify>
  <done>Capability inventory decision made and execution proceeds with an explicit tools/agents/skills orchestration approach.</done>
  <resume-signal>Select: option-a or option-b to continue execution.</resume-signal>
</task>

<task type="auto">
  <name>Add sticky positioning to photo sidebar</name>
  <files>src/pages/photo-first-review.tsx</files>
  <action>
    Modify the photo-first-review page layout to make the photo sidebar sticky:
    1. Wrap the PhotoReviewPane in a container div with sticky positioning
    2. Set top offset (e.g., top-4 or top-20) to account for header
    3. Set max-height to viewport minus offset (h-[calc(100vh-6rem)])
    4. Add overflow-y-auto to allow scrolling within sidebar if needed
    5. Ensure the parent container has relative positioning
    
    Do NOT change the theme colors, border styles, or photo display logic.
    Only modify the layout structure to support sticky positioning.
  </action>
  <verify>
    Run `npm run check` and confirm exit code 0.
    Run `npm run build` and confirm build succeeds without TypeScript or bundling errors.
  </verify>
  <done>
    Photo sidebar uses sticky positioning with CSS classes like `sticky top-20`
    Sidebar stays visible when scrolling main content area
  </done>
</task>

<task type="auto">
  <name>Ensure parent layout supports sticky</name>
  <files>src/pages/photo-first-review.tsx</files>
  <action>
    Verify the split-pane layout container has proper structure:
    1. Main container should use flex or grid layout
    2. Photo sidebar column needs `relative` positioning on parent
    3. Rating form column should scroll independently
    4. Check that overflow-x is hidden to prevent horizontal scroll
    5. Test that sidebar height is constrained properly
    
    Reference existing SplitPane or flex layout patterns in the codebase.
  </action>
  <verify>
    Run `node tests/visual-analysis.cjs` and confirm `tests/screenshots/visual-analysis/04-photo-first-review-desktop.png` is generated.
    Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm JSON contains `reviewOpened: true`.
  </verify>
  <done>
    Parent layout supports sticky positioning without conflicts
    No horizontal scrollbars appear
  </done>
</task>

<task type="auto">
  <name>Add photo zoom modal and multi-photo thumbnail grid</name>
  <files>src/components/review/PhotoReviewPane.tsx</files>
  <action>
    Implement locked context decisions for the review photo experience:
    1. Add click-to-zoom behavior for the primary review photo.
    2. Implement a zoom modal/lightbox that can be opened and closed with mouse and keyboard (Escape).
    3. If multiple photos exist, show a thumbnail grid/strip with clear selected state.
    4. Clicking a thumbnail updates the primary displayed photo.
    5. Preserve existing theme styling (colors, typography, spacing language).

    Do NOT add image editing/cropping features.
  </action>
  <verify>
    Run `npm run check` and confirm exit code 0.
    Run `npm run build` and confirm build succeeds.
    Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm JSON contains `reviewOpened: true` and `completionSucceeded: true`.
  </verify>
  <done>
    Review photos support click-to-zoom modal behavior.
    Multi-photo inspections show selectable thumbnails with active state.
    Primary displayed photo changes when selecting a thumbnail.
  </done>
</task>

</tasks>

<verification>
- Run `npm run check` and `npm run build` successfully.
- Run `node tests/visual-analysis.cjs` and confirm screenshots are created for review page states.
- Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm `reviewOpened: true`.
- Validate sidebar remains sticky at desktop widths and mobile stacking is preserved.
</verification>

<success_criteria>
- Photo sidebar has position: sticky in computed styles
- Sidebar remains in viewport while rating form is scrolled
- All 11 rating categories can be accessed while photo is visible
- Clicking a review photo opens a zoom modal and closes via Escape/click dismiss.
- Multi-photo inspections display selectable thumbnails with active selection styling.
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-polish/04-01-SUMMARY.md`
</output>
