---
phase: 04-ui-polish
plan: 04
type: execute
wave: 2
depends_on: [04-01, 04-02, 04-03]
files_modified:
  - src/App.tsx
  - src/components/ui/FloatingActionButton.tsx
  - src/hooks/usePendingCount.ts
autonomous: true
must_haves:
  truths:
    - Pending count shows on Review navigation item
    - Badge has pulse animation when count > 0
    - Color coding: amber (1-5), red (5+)
    - Count updates in real-time
  artifacts:
    - path: src/App.tsx
      provides: Workflow navigation wiring with pending count state
    - path: src/components/ui/FloatingActionButton.tsx
      provides: Review card and mobile FAB badge styling
    - path: src/hooks/usePendingCount.ts
      provides: Real-time pending count
  key_links:
    - from: usePendingCount hook
      to: App workflow cards and FAB badge
      via: React state/context
---

<objective>
Add urgency indicators to pending inspections badge with pulse animation and color coding.

Purpose: Visual urgency helps prioritize work.
Output: Navigation badge with count, pulse animation, and color-coded urgency.
</objective>

<execution_context>
@C:/Users/veloc/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/04-ui-polish/04-CONTEXT.md
@src/App.tsx
@src/components/ui/FloatingActionButton.tsx
@src/hooks/usePendingInspections.ts
</context>

<tasks>

<task type="auto">
  <name>Add pending badge to Review nav item</name>
  <files>src/App.tsx</files>
  <action>
    Modify active workflow navigation in App to show pending count on Review entry points:
    1. Import usePendingInspections hook or create usePendingCount
    2. Get count of inspections with status 'pending_review'
    3. Wire pending count into `ReviewInspectionsCard` and `FloatingActionButton` props
    4. Badge should show count number
    5. Keep count visible on both desktop Review card and mobile FAB badge
    
    Use existing Badge component from shadcn/ui if available.
    Ensure badge updates when new inspections are captured.
  </action>
  <verify>
    Run `npm run check` and confirm exit code 0.
    Run `npm run build` and confirm build succeeds.
    Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm JSON contains `reviewListLoaded: true`.
  </verify>
  <done>
    Review nav shows "Review (3)" or badge with number
    Badge responds to count changes
  </done>
</task>

<task type="auto">
  <name>Add pulse animation and color coding</name>
  <files>src/components/ui/FloatingActionButton.tsx</files>
  <action>
    Enhance badge with urgency indicators:
    1. Color coding:
       - amber/orange: count 1-5 (normal)
       - red: count 5+ (backlog)
    2. Add subtle pulse/animate-ping animation when count > 0
    3. Animation should not be distracting (subtle, slow pulse)
    4. Red color only for 5+, otherwise use theme accent
    
    Use Tailwind classes: animate-pulse or custom keyframes
    Reference existing animation patterns in the codebase.
  </action>
  <verify>
    Run `node tests/visual-analysis.cjs` and confirm `tests/screenshots/visual-analysis/01-dashboard-desktop.png` is generated.
    Confirm badge color follows thresholds: amber for 1-5 and red for 5+.
    Confirm pulse animation appears only when count > 0.
  </verify>
  <done>
    Amber badge for 1-5 pending
    Red badge with pulse for 5+ pending
    Clear visual urgency indicators
  </done>
</task>

<task type="auto">
  <name>Ensure real-time updates</name>
  <files>src/hooks/usePendingCount.ts
src/App.tsx</files>
  <action>
    Create or modify hook for real-time pending count:
    1. Fetch pending count on mount
    2. Poll or use SWR for updates (every 30s recommended)
    3. Update when user completes an inspection
    4. Update when user discards an inspection
    5. Consider optimistic updates for immediate feedback
    
    Can extend existing usePendingInspections hook.
  </action>
  <verify>
    Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm `quickCaptureApiFallbackWorked: true` and `completionSucceeded: true`.
    Refresh dashboard and confirm badge count changes accordingly.
    Confirm update loop does not create repeated console/network errors.
  </verify>
  <done>
    Badge count reflects actual pending inspections
    Updates within reasonable time (seconds)
  </done>
</task>

</tasks>

<verification>
- Run `npm run check` and `npm run build` successfully.
- Run `node tests/visual-analysis.cjs` and inspect dashboard screenshots for badge rendering.
- Run `npx cross-env TARGET_URL=https://custodialcommand-dev.up.railway.app node tests/dev-browser-deep-journey.cjs` and confirm capture/review/complete flow remains successful.
</verification>

<success_criteria>
- Badge shows pending count on Review nav
- Amber color for 1-5, red for 5+
- Pulse animation when count > 0
- Count updates in real-time
</success_criteria>

<output>
After completion, create `.planning/phases/04-ui-polish/04-04-SUMMARY.md`
</output>
